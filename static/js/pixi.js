import{g as t,c as e,a as s}from"./arco-design.js";var r=(t=>(t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping",t))(r||{});class n{constructor(t,e=new Array,s=0,r=new DataView(t.buffer)){this.strings=e,this.index=s,this.buffer=r}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){const t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){const t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),s=127&e;return 128&e&&(e=this.readByte(),s|=(127&e)<<7,128&e&&(e=this.readByte(),s|=(127&e)<<14,128&e&&(e=this.readByte(),s|=(127&e)<<21,128&e&&(e=this.readByte(),s|=(127&e)<<28)))),t?s:s>>>1^-(1&s)}readStringRef(){const t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let s=0;s<t;){const t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),s+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:e+=String.fromCharCode(t),s++}}return e}readFloat(){const t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}var i=(t=>(t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",t))(i||{}),a=(t=>(t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",t))(a||{}),o=(t=>(t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent",t))(o||{}),h=(t=>(t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale",t))(h||{}),l=(t=>(t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection",t))(l||{}),c=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(c||{}),u=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(u||{}),d=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(d||{}),f=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(f||{}),p=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(p||{}),m=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(m||{}),g=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(g||{}),x=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(x||{}),y=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(y||{}),b=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(b||{}),_=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(_||{}),v=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(v||{}),E=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(E||{}),w=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(w||{}),A=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(A||{}),T=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(T||{}),S=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(S||{}),I=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(I||{}),R=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(R||{});const M={ADAPTER:{createCanvas:(t,e)=>{const s=document.createElement("canvas");return s.width=t,s.height=e,s},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var C=/iPhone/i,P=/iPod/i,k=/iPad/i,F=/\biOS-universal(?:.+)Mac\b/i,D=/\bAndroid(?:.+)Mobile\b/i,N=/Android/i,B=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,O=/Silk/i,L=/Windows Phone/i,V=/\bWindows(?:.+)ARM\b/i,U=/BlackBerry/i,X=/BB10/i,Y=/Opera Mini/i,G=/\b(CriOS|Chrome)(?:.+)Mobile/i,W=/Mobile(?:.+)Firefox\b/i,H=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function $(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var s=e.userAgent,r=s.split("[FBAN");void 0!==r[1]&&(s=r[0]),void 0!==(r=s.split("Twitter"))[1]&&(s=r[0]);var n=function(t){return function(e){return e.test(t)}}(s),i={apple:{phone:n(C)&&!n(L),ipod:n(P),tablet:!n(C)&&(n(k)||H(e))&&!n(L),universal:n(F),device:(n(C)||n(P)||n(k)||n(F)||H(e))&&!n(L)},amazon:{phone:n(B),tablet:!n(B)&&n(O),device:n(B)||n(O)},android:{phone:!n(L)&&n(B)||!n(L)&&n(D),tablet:!n(L)&&!n(B)&&!n(D)&&(n(O)||n(N)),device:!n(L)&&(n(B)||n(O)||n(D)||n(N))||n(/\bokhttp\b/i)},windows:{phone:n(L),tablet:n(V),device:n(L)||n(V)},other:{blackberry:n(U),blackberry10:n(X),opera:n(Y),firefox:n(W),chrome:n(G),device:n(U)||n(X)||n(Y)||n(W)||n(G)},any:!1,phone:!1,tablet:!1};return i.any=i.apple.device||i.android.device||i.windows.device||i.other.device,i.phone=i.apple.phone||i.android.phone||i.windows.phone,i.tablet=i.apple.tablet||i.android.tablet||i.windows.tablet,i}const j=($.default??$)(globalThis.navigator);M.RETINA_PREFIX=/@([0-9\.]+)x/,M.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var z={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,s="~";function r(){}function n(t,e,s){this.fn=t,this.context=e,this.once=s||!1}function i(t,e,r,i,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new n(r,i||t,a),h=s?s+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),o.prototype.eventNames=function(){var t,r,n=[];if(0===this._eventsCount)return n;for(r in t=this._events)e.call(t,r)&&n.push(s?r.slice(1):r);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(t){var e=s?s+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,i=r.length,a=new Array(i);n<i;n++)a[n]=r[n].fn;return a},o.prototype.listenerCount=function(t){var e=s?s+t:t,r=this._events[e];return r?r.fn?1:r.length:0},o.prototype.emit=function(t,e,r,n,i,a){var o=s?s+t:t;if(!this._events[o])return!1;var h,l,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,n),!0;case 5:return c.fn.call(c.context,e,r,n,i),!0;case 6:return c.fn.call(c.context,e,r,n,i,a),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,n);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},o.prototype.on=function(t,e,s){return i(this,t,e,s,!1)},o.prototype.once=function(t,e,s){return i(this,t,e,s,!0)},o.prototype.removeListener=function(t,e,r,n){var i=s?s+t:t;if(!this._events[i])return this;if(!e)return a(this,i),this;var o=this._events[i];if(o.fn)o.fn!==e||n&&!o.once||r&&o.context!==r||a(this,i);else{for(var h=0,l=[],c=o.length;h<c;h++)(o[h].fn!==e||n&&!o[h].once||r&&o[h].context!==r)&&l.push(o[h]);l.length?this._events[i]=1===l.length?l[0]:l:a(this,i)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=s?s+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,t.exports=o}(z);const q=t(z.exports);var Z={exports:{}};function K(t,e,s){s=s||2;var r,n,i,a,o,h,l,c=e&&e.length,u=c?e[0]*s:t.length,d=Q(t,0,u,s,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(t,e,s,r){var n,i,a,o=[];for(n=0,i=e.length;n<i;n++)(a=Q(t,e[n]*r,n<i-1?e[n+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),o.push(lt(a));for(o.sort(it),n=0;n<o.length;n++)s=at(o[n],s);return s}(t,e,d,s)),t.length>80*s){r=i=t[0],n=a=t[1];for(var p=s;p<u;p+=s)(o=t[p])<r&&(r=o),(h=t[p+1])<n&&(n=h),o>i&&(i=o),h>a&&(a=h);l=0!==(l=Math.max(i-r,a-n))?32767/l:0}return tt(d,f,s,r,n,l,0),f}function Q(t,e,s,r,n){var i,a;if(n===Et(t,e,s,r)>0)for(i=e;i<s;i+=r)a=bt(i,t[i],t[i+1],a);else for(i=s-r;i>=e;i-=r)a=bt(i,t[i],t[i+1],a);return a&&ft(a,a.next)&&(_t(a),a=a.next),a}function J(t,e){if(!t)return t;e||(e=t);var s,r=t;do{if(s=!1,r.steiner||!ft(r,r.next)&&0!==dt(r.prev,r,r.next))r=r.next;else{if(_t(r),(r=e=r.prev)===r.next)break;s=!0}}while(s||r!==e);return e}function tt(t,e,s,r,n,i,a){if(t){!a&&i&&function(t,e,s,r){var n=t;do{0===n.z&&(n.z=ht(n.x,n.y,e,s,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,r,n,i,a,o,h,l=1;do{for(s=t,t=null,i=null,a=0;s;){for(a++,r=s,o=0,e=0;e<l&&(o++,r=r.nextZ);e++);for(h=l;o>0||h>0&&r;)0!==o&&(0===h||!r||s.z<=r.z)?(n=s,s=s.nextZ,o--):(n=r,r=r.nextZ,h--),i?i.nextZ=n:t=n,n.prevZ=i,i=n;s=r}i.nextZ=null,l*=2}while(a>1)}(n)}(t,r,n,i);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,i?st(t,r,n,i):et(t))e.push(o.i/s|0),e.push(t.i/s|0),e.push(h.i/s|0),_t(t),t=h.next,l=h.next;else if((t=h)===l){a?1===a?tt(t=rt(J(t),e,s),e,s,r,n,i,2):2===a&&nt(t,e,s,r,n,i):tt(J(t),e,s,r,n,i,1);break}}}function et(t){var e=t.prev,s=t,r=t.next;if(dt(e,s,r)>=0)return!1;for(var n=e.x,i=s.x,a=r.x,o=e.y,h=s.y,l=r.y,c=n<i?n<a?n:a:i<a?i:a,u=o<h?o<l?o:l:h<l?h:l,d=n>i?n>a?n:a:i>a?i:a,f=o>h?o>l?o:l:h>l?h:l,p=r.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&ct(n,o,i,h,a,l,p.x,p.y)&&dt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function st(t,e,s,r){var n=t.prev,i=t,a=t.next;if(dt(n,i,a)>=0)return!1;for(var o=n.x,h=i.x,l=a.x,c=n.y,u=i.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,m=o>h?o>l?o:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,x=ht(f,p,e,s,r),y=ht(m,g,e,s,r),b=t.prevZ,_=t.nextZ;b&&b.z>=x&&_&&_.z<=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==n&&b!==a&&ct(o,c,h,u,l,d,b.x,b.y)&&dt(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==n&&_!==a&&ct(o,c,h,u,l,d,_.x,_.y)&&dt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;b&&b.z>=x;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==n&&b!==a&&ct(o,c,h,u,l,d,b.x,b.y)&&dt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==n&&_!==a&&ct(o,c,h,u,l,d,_.x,_.y)&&dt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function rt(t,e,s){var r=t;do{var n=r.prev,i=r.next.next;!ft(n,i)&&pt(n,r,r.next,i)&&xt(n,i)&&xt(i,n)&&(e.push(n.i/s|0),e.push(r.i/s|0),e.push(i.i/s|0),_t(r),_t(r.next),r=t=i),r=r.next}while(r!==t);return J(r)}function nt(t,e,s,r,n,i){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&ut(a,o)){var h=yt(a,o);return a=J(a,a.next),h=J(h,h.next),tt(a,e,s,r,n,i,0),void tt(h,e,s,r,n,i,0)}o=o.next}a=a.next}while(a!==t)}function it(t,e){return t.x-e.x}function at(t,e){var s=function(t,e){var s,r=e,n=t.x,i=t.y,a=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>a&&(a=o,s=r.x<r.next.x?r:r.next,o===n))return s}r=r.next}while(r!==e);if(!s)return null;var h,l=s,c=s.x,u=s.y,d=1/0;r=s;do{n>=r.x&&r.x>=c&&n!==r.x&&ct(i<u?n:a,i,c,u,i<u?a:n,i,r.x,r.y)&&(h=Math.abs(i-r.y)/(n-r.x),xt(r,t)&&(h<d||h===d&&(r.x>s.x||r.x===s.x&&ot(s,r)))&&(s=r,d=h)),r=r.next}while(r!==l);return s}(t,e);if(!s)return e;var r=yt(s,t);return J(r,r.next),J(s,s.next)}function ot(t,e){return dt(t.prev,t,e.prev)<0&&dt(e.next,t,t.next)<0}function ht(t,e,s,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lt(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function ct(t,e,s,r,n,i,a,o){return(n-a)*(e-o)>=(t-a)*(i-o)&&(t-a)*(r-o)>=(s-a)*(e-o)&&(s-a)*(i-o)>=(n-a)*(r-o)}function ut(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&pt(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(xt(t,e)&&xt(e,t)&&function(t,e){var s=t,r=!1,n=(t.x+e.x)/2,i=(t.y+e.y)/2;do{s.y>i!=s.next.y>i&&s.next.y!==s.y&&n<(s.next.x-s.x)*(i-s.y)/(s.next.y-s.y)+s.x&&(r=!r),s=s.next}while(s!==t);return r}(t,e)&&(dt(t.prev,t,e.prev)||dt(t,e.prev,e))||ft(t,e)&&dt(t.prev,t,t.next)>0&&dt(e.prev,e,e.next)>0)}function dt(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function ft(t,e){return t.x===e.x&&t.y===e.y}function pt(t,e,s,r){var n=gt(dt(t,e,s)),i=gt(dt(t,e,r)),a=gt(dt(s,r,t)),o=gt(dt(s,r,e));return n!==i&&a!==o||(!(0!==n||!mt(t,s,e))||(!(0!==i||!mt(t,r,e))||(!(0!==a||!mt(s,t,r))||!(0!==o||!mt(s,e,r)))))}function mt(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function gt(t){return t>0?1:t<0?-1:0}function xt(t,e){return dt(t.prev,t,t.next)<0?dt(t,e,t.next)>=0&&dt(t,t.prev,e)>=0:dt(t,e,t.prev)<0||dt(t,t.next,e)<0}function yt(t,e){var s=new vt(t.i,t.x,t.y),r=new vt(e.i,e.x,e.y),n=t.next,i=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,r.next=s,s.prev=r,i.next=r,r.prev=i,r}function bt(t,e,s,r){var n=new vt(t,e,s);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function _t(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function vt(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Et(t,e,s,r){for(var n=0,i=e,a=s-r;i<s;i+=r)n+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return n}Z.exports=K,Z.exports.default=K,K.deviation=function(t,e,s,r){var n=e&&e.length,i=n?e[0]*s:t.length,a=Math.abs(Et(t,0,i,s));if(n)for(var o=0,h=e.length;o<h;o++){var l=e[o]*s,c=o<h-1?e[o+1]*s:t.length;a-=Math.abs(Et(t,l,c,s))}var u=0;for(o=0;o<r.length;o+=3){var d=r[o]*s,f=r[o+1]*s,p=r[o+2]*s;u+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},K.flatten=function(t){for(var e=t[0][0].length,s={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var i=0;i<t[n].length;i++)for(var a=0;a<e;a++)s.vertices.push(t[n][i][a]);n>0&&(r+=t[n-1].length,s.holes.push(r))}return s};const wt=t(Z.exports);var At,Tt,St={exports:{}};
/*! https://mths.be/punycode v1.4.1 by @mathias */At=St,Tt=St.exports,function(t){var s=Tt&&!Tt.nodeType&&Tt,r=At&&!At.nodeType&&At,n="object"==typeof e&&e;n.global!==n&&n.window!==n&&n.self!==n||(t=n);var i,a,o=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,m="-",g=/^xn--/,x=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=h-l,v=Math.floor,E=String.fromCharCode;function w(t){throw new RangeError(b[t])}function A(t,e){for(var s=t.length,r=[];s--;)r[s]=e(t[s]);return r}function T(t,e){var s=t.split("@"),r="";return s.length>1&&(r=s[0]+"@",t=s[1]),r+A((t=t.replace(y,".")).split("."),e).join(".")}function S(t){for(var e,s,r=[],n=0,i=t.length;n<i;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<i?56320==(64512&(s=t.charCodeAt(n++)))?r.push(((1023&e)<<10)+(1023&s)+65536):(r.push(e),n--):r.push(e);return r}function I(t){return A(t,(function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)})).join("")}function R(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function M(t,e,s){var r=0;for(t=s?v(t/d):t>>1,t+=v(t/e);t>_*c>>1;r+=h)t=v(t/_);return v(r+(_+1)*t/(t+u))}function C(t){var e,s,r,n,i,a,u,d,g,x,y,b=[],_=t.length,E=0,A=p,T=f;for((s=t.lastIndexOf(m))<0&&(s=0),r=0;r<s;++r)t.charCodeAt(r)>=128&&w("not-basic"),b.push(t.charCodeAt(r));for(n=s>0?s+1:0;n<_;){for(i=E,a=1,u=h;n>=_&&w("invalid-input"),((d=(y=t.charCodeAt(n++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:h)>=h||d>v((o-E)/a))&&w("overflow"),E+=d*a,!(d<(g=u<=T?l:u>=T+c?c:u-T));u+=h)a>v(o/(x=h-g))&&w("overflow"),a*=x;T=M(E-i,e=b.length+1,0==i),v(E/e)>o-A&&w("overflow"),A+=v(E/e),E%=e,b.splice(E++,0,A)}return I(b)}function P(t){var e,s,r,n,i,a,u,d,g,x,y,b,_,A,T,I=[];for(b=(t=S(t)).length,e=p,s=0,i=f,a=0;a<b;++a)(y=t[a])<128&&I.push(E(y));for(r=n=I.length,n&&I.push(m);r<b;){for(u=o,a=0;a<b;++a)(y=t[a])>=e&&y<u&&(u=y);for(u-e>v((o-s)/(_=r+1))&&w("overflow"),s+=(u-e)*_,e=u,a=0;a<b;++a)if((y=t[a])<e&&++s>o&&w("overflow"),y==e){for(d=s,g=h;!(d<(x=g<=i?l:g>=i+c?c:g-i));g+=h)T=d-x,A=h-x,I.push(E(R(x+T%A,0))),d=v(T/A);I.push(E(R(d,0))),i=M(s,_,r==n),s=0,++r}++s,++e}return I.join("")}if(i={version:"1.4.1",ucs2:{decode:S,encode:I},decode:C,encode:P,toASCII:function(t){return T(t,(function(t){return x.test(t)?"xn--"+P(t):t}))},toUnicode:function(t){return T(t,(function(t){return g.test(t)?C(t.slice(4).toLowerCase()):t}))}},s&&r)if(At.exports==s)r.exports=i;else for(a in i)i.hasOwnProperty(a)&&(s[a]=i[a]);else t.punycode=i}(e);var It,Rt=St.exports,Mt=Error,Ct=EvalError,Pt=RangeError,kt=ReferenceError,Ft=SyntaxError,Dt=TypeError,Nt=URIError,Bt="undefined"!=typeof Symbol&&Symbol,Ot=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),s=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(s))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0},Lt={__proto__:null,foo:{}},Vt=Object,Ut=Object.prototype.toString,Xt=Math.max,Yt=function(t,e){for(var s=[],r=0;r<t.length;r+=1)s[r]=t[r];for(var n=0;n<e.length;n+=1)s[n+t.length]=e[n];return s},Gt=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==Ut.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var s,r=function(t,e){for(var s=[],r=e||0,n=0;r<t.length;r+=1,n+=1)s[n]=t[r];return s}(arguments,1),n=Xt(0,e.length-r.length),i=[],a=0;a<n;a++)i[a]="$"+a;if(s=Function("binder","return function ("+function(t,e){for(var s="",r=0;r<t.length;r+=1)s+=t[r],r+1<t.length&&(s+=e);return s}(i,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var n=e.apply(this,Yt(r,arguments));return Object(n)===n?n:this}return e.apply(t,Yt(r,arguments))})),e.prototype){var o=function(){};o.prototype=e.prototype,s.prototype=new o,o.prototype=null}return s},Wt=Function.prototype.bind||Gt,Ht=Function.prototype.call,$t=Object.prototype.hasOwnProperty,jt=Wt.call(Ht,$t),zt=Mt,qt=Ct,Zt=Pt,Kt=kt,Qt=Ft,Jt=Dt,te=Nt,ee=Function,se=function(t){try{return ee('"use strict"; return ('+t+").constructor;")()}catch(e){}},re=Object.getOwnPropertyDescriptor;if(re)try{re({},"")}catch(Xy){re=null}var ne=function(){throw new Jt},ie=re?function(){try{return ne}catch(t){try{return re(arguments,"callee").get}catch(e){return ne}}}():ne,ae="function"==typeof Bt&&"function"==typeof Symbol&&"symbol"==typeof Bt("foo")&&"symbol"==typeof Symbol("bar")&&Ot(),oe={__proto__:Lt}.foo===Lt.foo&&!(Lt instanceof Vt),he=Object.getPrototypeOf||(oe?function(t){return t.__proto__}:null),le={},ce="undefined"!=typeof Uint8Array&&he?he(Uint8Array):It,ue={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?It:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?It:ArrayBuffer,"%ArrayIteratorPrototype%":ae&&he?he([][Symbol.iterator]()):It,"%AsyncFromSyncIteratorPrototype%":It,"%AsyncFunction%":le,"%AsyncGenerator%":le,"%AsyncGeneratorFunction%":le,"%AsyncIteratorPrototype%":le,"%Atomics%":"undefined"==typeof Atomics?It:Atomics,"%BigInt%":"undefined"==typeof BigInt?It:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?It:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?It:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?It:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":zt,"%eval%":eval,"%EvalError%":qt,"%Float32Array%":"undefined"==typeof Float32Array?It:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?It:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?It:FinalizationRegistry,"%Function%":ee,"%GeneratorFunction%":le,"%Int8Array%":"undefined"==typeof Int8Array?It:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?It:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?It:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ae&&he?he(he([][Symbol.iterator]())):It,"%JSON%":"object"==typeof JSON?JSON:It,"%Map%":"undefined"==typeof Map?It:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&ae&&he?he((new Map)[Symbol.iterator]()):It,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?It:Promise,"%Proxy%":"undefined"==typeof Proxy?It:Proxy,"%RangeError%":Zt,"%ReferenceError%":Kt,"%Reflect%":"undefined"==typeof Reflect?It:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?It:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&ae&&he?he((new Set)[Symbol.iterator]()):It,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?It:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ae&&he?he(""[Symbol.iterator]()):It,"%Symbol%":ae?Symbol:It,"%SyntaxError%":Qt,"%ThrowTypeError%":ie,"%TypedArray%":ce,"%TypeError%":Jt,"%Uint8Array%":"undefined"==typeof Uint8Array?It:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?It:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?It:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?It:Uint32Array,"%URIError%":te,"%WeakMap%":"undefined"==typeof WeakMap?It:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?It:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?It:WeakSet};if(he)try{null.error}catch(Xy){var de=he(he(Xy));ue["%Error.prototype%"]=de}var fe,pe,me=function t(e){var s;if("%AsyncFunction%"===e)s=se("async function () {}");else if("%GeneratorFunction%"===e)s=se("function* () {}");else if("%AsyncGeneratorFunction%"===e)s=se("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(s=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&he&&(s=he(n.prototype))}return ue[e]=s,s},ge={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},xe=Wt,ye=jt,be=xe.call(Function.call,Array.prototype.concat),_e=xe.call(Function.apply,Array.prototype.splice),ve=xe.call(Function.call,String.prototype.replace),Ee=xe.call(Function.call,String.prototype.slice),we=xe.call(Function.call,RegExp.prototype.exec),Ae=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Te=/\\(\\)?/g,Se=function(t,e){var s,r=t;if(ye(ge,r)&&(r="%"+(s=ge[r])[0]+"%"),ye(ue,r)){var n=ue[r];if(n===le&&(n=me(r)),void 0===n&&!e)throw new Jt("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:r,value:n}}throw new Qt("intrinsic "+t+" does not exist!")},Ie=function(t,e){if("string"!=typeof t||0===t.length)throw new Jt("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new Jt('"allowMissing" argument must be a boolean');if(null===we(/^%?[^%]*%?$/,t))throw new Qt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var s=function(t){var e=Ee(t,0,1),s=Ee(t,-1);if("%"===e&&"%"!==s)throw new Qt("invalid intrinsic syntax, expected closing `%`");if("%"===s&&"%"!==e)throw new Qt("invalid intrinsic syntax, expected opening `%`");var r=[];return ve(t,Ae,(function(t,e,s,n){r[r.length]=s?ve(n,Te,"$1"):e||t})),r}(t),r=s.length>0?s[0]:"",n=Se("%"+r+"%",e),i=n.name,a=n.value,o=!1,h=n.alias;h&&(r=h[0],_e(s,be([0,1],h)));for(var l=1,c=!0;l<s.length;l+=1){var u=s[l],d=Ee(u,0,1),f=Ee(u,-1);if(('"'===d||"'"===d||"`"===d||'"'===f||"'"===f||"`"===f)&&d!==f)throw new Qt("property names with quotes must have matching quotes");if("constructor"!==u&&c||(o=!0),ye(ue,i="%"+(r+="."+u)+"%"))a=ue[i];else if(null!=a){if(!(u in a)){if(!e)throw new Jt("base intrinsic for "+t+" exists, but the property is not available.");return}if(re&&l+1>=s.length){var p=re(a,u);a=(c=!!p)&&"get"in p&&!("originalValue"in p.get)?p.get:a[u]}else c=ye(a,u),a=a[u];c&&!o&&(ue[i]=a)}}return a},Re={exports:{}};function Me(){if(pe)return fe;pe=1;var t=Ie("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch(Xy){t=!1}return fe=t}var Ce=Ie("%Object.getOwnPropertyDescriptor%",!0);if(Ce)try{Ce([],"length")}catch(Xy){Ce=null}var Pe=Ce,ke=Me(),Fe=Ft,De=Dt,Ne=Pe,Be=Me(),Oe=function(){return!!Be};Oe.hasArrayLengthDefineBug=function(){if(!Be)return null;try{return 1!==Be([],"length",{value:1}).length}catch(Xy){return!0}};var Le=Ie,Ve=function(t,e,s){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new De("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new De("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new De("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new De("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new De("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new De("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,a=arguments.length>6&&arguments[6],o=!!Ne&&Ne(t,e);if(ke)ke(t,e,{configurable:null===i&&o?o.configurable:!i,enumerable:null===r&&o?o.enumerable:!r,value:s,writable:null===n&&o?o.writable:!n});else{if(!a&&(r||n||i))throw new Fe("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=s}},Ue=Oe(),Xe=Pe,Ye=Dt,Ge=Le("%Math.floor%"),We=function(t,e){if("function"!=typeof t)throw new Ye("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||Ge(e)!==e)throw new Ye("`length` must be a positive 32-bit integer");var s=arguments.length>2&&!!arguments[2],r=!0,n=!0;if("length"in t&&Xe){var i=Xe(t,"length");i&&!i.configurable&&(r=!1),i&&!i.writable&&(n=!1)}return(r||n||!s)&&(Ue?Ve(t,"length",e,!0,!0):Ve(t,"length",e)),t};!function(t){var e=Wt,s=Ie,r=We,n=Dt,i=s("%Function.prototype.apply%"),a=s("%Function.prototype.call%"),o=s("%Reflect.apply%",!0)||e.call(a,i),h=Me(),l=s("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new n("a function is required");var s=o(e,a,arguments);return r(s,1+l(0,t.length-(arguments.length-1)),!0)};var c=function(){return o(e,i,arguments)};h?h(t.exports,"apply",{value:c}):t.exports.apply=c}(Re);var He=Ie,$e=Re.exports,je=$e(He("String.prototype.indexOf"));const ze=s(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var qe="function"==typeof Map&&Map.prototype,Ze=Object.getOwnPropertyDescriptor&&qe?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ke=qe&&Ze&&"function"==typeof Ze.get?Ze.get:null,Qe=qe&&Map.prototype.forEach,Je="function"==typeof Set&&Set.prototype,ts=Object.getOwnPropertyDescriptor&&Je?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,es=Je&&ts&&"function"==typeof ts.get?ts.get:null,ss=Je&&Set.prototype.forEach,rs="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,ns="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,is="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,as=Boolean.prototype.valueOf,os=Object.prototype.toString,hs=Function.prototype.toString,ls=String.prototype.match,cs=String.prototype.slice,us=String.prototype.replace,ds=String.prototype.toUpperCase,fs=String.prototype.toLowerCase,ps=RegExp.prototype.test,ms=Array.prototype.concat,gs=Array.prototype.join,xs=Array.prototype.slice,ys=Math.floor,bs="function"==typeof BigInt?BigInt.prototype.valueOf:null,_s=Object.getOwnPropertySymbols,vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Es="function"==typeof Symbol&&"object"==typeof Symbol.iterator,ws="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Es||"symbol")?Symbol.toStringTag:null,As=Object.prototype.propertyIsEnumerable,Ts=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Ss(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||ps.call(/e/,e))return e;var s=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-ys(-t):ys(t);if(r!==t){var n=String(r),i=cs.call(e,n.length+1);return us.call(n,s,"$&_")+"."+us.call(us.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return us.call(e,s,"$&_")}var Is=ze,Rs=Is.custom,Ms=Ds(Rs)?Rs:null;function Cs(t,e,s){var r="double"===(s.quoteStyle||e)?'"':"'";return r+t+r}function Ps(t){return us.call(String(t),/"/g,"&quot;")}function ks(t){return!("[object Array]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}function Fs(t){return!("[object RegExp]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}function Ds(t){if(Es)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!vs)return!1;try{return vs.call(t),!0}catch(Xy){}return!1}var Ns=Object.prototype.hasOwnProperty||function(t){return t in this};function Bs(t,e){return Ns.call(t,e)}function Os(t){return os.call(t)}function Ls(t,e){if(t.indexOf)return t.indexOf(e);for(var s=0,r=t.length;s<r;s++)if(t[s]===e)return s;return-1}function Vs(t,e){if(t.length>e.maxStringLength){var s=t.length-e.maxStringLength,r="... "+s+" more character"+(s>1?"s":"");return Vs(cs.call(t,0,e.maxStringLength),e)+r}return Cs(us.call(us.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Us),"single",e)}function Us(t){var e=t.charCodeAt(0),s={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return s?"\\"+s:"\\x"+(e<16?"0":"")+ds.call(e.toString(16))}function Xs(t){return"Object("+t+")"}function Ys(t){return t+" { ? }"}function Gs(t,e,s,r){return t+" ("+e+") {"+(r?Ws(s,r):gs.call(s,", "))+"}"}function Ws(t,e){if(0===t.length)return"";var s="\n"+e.prev+e.base;return s+gs.call(t,","+s)+"\n"+e.prev}function Hs(t,e){var s=ks(t),r=[];if(s){r.length=t.length;for(var n=0;n<t.length;n++)r[n]=Bs(t,n)?e(t[n],t):""}var i,a="function"==typeof _s?_s(t):[];if(Es){i={};for(var o=0;o<a.length;o++)i["$"+a[o]]=a[o]}for(var h in t)Bs(t,h)&&(s&&String(Number(h))===h&&h<t.length||Es&&i["$"+h]instanceof Symbol||(ps.call(/[^\w$]/,h)?r.push(e(h,t)+": "+e(t[h],t)):r.push(h+": "+e(t[h],t))));if("function"==typeof _s)for(var l=0;l<a.length;l++)As.call(t,a[l])&&r.push("["+e(a[l])+"]: "+e(t[a[l]],t));return r}var $s=Ie,js=function(t,e){var s=He(t,!!e);return"function"==typeof s&&je(t,".prototype.")>-1?$e(s):s},zs=function t(s,r,n,i){var a=r||{};if(Bs(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Bs(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=!Bs(a,"customInspect")||a.customInspect;if("boolean"!=typeof o&&"symbol"!==o)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Bs(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Bs(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=a.numericSeparator;if(void 0===s)return"undefined";if(null===s)return"null";if("boolean"==typeof s)return s?"true":"false";if("string"==typeof s)return Vs(s,a);if("number"==typeof s){if(0===s)return 1/0/s>0?"0":"-0";var l=String(s);return h?Ss(s,l):l}if("bigint"==typeof s){var c=String(s)+"n";return h?Ss(s,c):c}var u=void 0===a.depth?5:a.depth;if(void 0===n&&(n=0),n>=u&&u>0&&"object"==typeof s)return ks(s)?"[Array]":"[Object]";var d=function(t,e){var s;if("\t"===t.indent)s="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;s=gs.call(Array(t.indent+1)," ")}return{base:s,prev:gs.call(Array(e+1),s)}}(a,n);if(void 0===i)i=[];else if(Ls(i,s)>=0)return"[Circular]";function f(e,s,r){if(s&&(i=xs.call(i)).push(s),r){var o={depth:a.depth};return Bs(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),t(e,o,n+1,i)}return t(e,a,n+1,i)}if("function"==typeof s&&!Fs(s)){var p=function(t){if(t.name)return t.name;var e=ls.call(hs.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(s),m=Hs(s,f);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(m.length>0?" { "+gs.call(m,", ")+" }":"")}if(Ds(s)){var g=Es?us.call(String(s),/^(Symbol\(.*\))_[^)]*$/,"$1"):vs.call(s);return"object"!=typeof s||Es?g:Xs(g)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(s)){for(var x="<"+fs.call(String(s.nodeName)),y=s.attributes||[],b=0;b<y.length;b++)x+=" "+y[b].name+"="+Cs(Ps(y[b].value),"double",a);return x+=">",s.childNodes&&s.childNodes.length&&(x+="..."),x+="</"+fs.call(String(s.nodeName))+">"}if(ks(s)){if(0===s.length)return"[]";var _=Hs(s,f);return d&&!function(t){for(var e=0;e<t.length;e++)if(Ls(t[e],"\n")>=0)return!1;return!0}(_)?"["+Ws(_,d)+"]":"[ "+gs.call(_,", ")+" ]"}if(function(t){return!("[object Error]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}(s)){var v=Hs(s,f);return"cause"in Error.prototype||!("cause"in s)||As.call(s,"cause")?0===v.length?"["+String(s)+"]":"{ ["+String(s)+"] "+gs.call(v,", ")+" }":"{ ["+String(s)+"] "+gs.call(ms.call("[cause]: "+f(s.cause),v),", ")+" }"}if("object"==typeof s&&o){if(Ms&&"function"==typeof s[Ms]&&Is)return Is(s,{depth:u-n});if("symbol"!==o&&"function"==typeof s.inspect)return s.inspect()}if(function(t){if(!Ke||!t||"object"!=typeof t)return!1;try{Ke.call(t);try{es.call(t)}catch(x){return!0}return t instanceof Map}catch(Xy){}return!1}(s)){var E=[];return Qe&&Qe.call(s,(function(t,e){E.push(f(e,s,!0)+" => "+f(t,s))})),Gs("Map",Ke.call(s),E,d)}if(function(t){if(!es||!t||"object"!=typeof t)return!1;try{es.call(t);try{Ke.call(t)}catch(e){return!0}return t instanceof Set}catch(Xy){}return!1}(s)){var w=[];return ss&&ss.call(s,(function(t){w.push(f(t,s))})),Gs("Set",es.call(s),w,d)}if(function(t){if(!rs||!t||"object"!=typeof t)return!1;try{rs.call(t,rs);try{ns.call(t,ns)}catch(x){return!0}return t instanceof WeakMap}catch(Xy){}return!1}(s))return Ys("WeakMap");if(function(t){if(!ns||!t||"object"!=typeof t)return!1;try{ns.call(t,ns);try{rs.call(t,rs)}catch(x){return!0}return t instanceof WeakSet}catch(Xy){}return!1}(s))return Ys("WeakSet");if(function(t){if(!is||!t||"object"!=typeof t)return!1;try{return is.call(t),!0}catch(Xy){}return!1}(s))return Ys("WeakRef");if(function(t){return!("[object Number]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}(s))return Xs(f(Number(s)));if(function(t){if(!t||"object"!=typeof t||!bs)return!1;try{return bs.call(t),!0}catch(Xy){}return!1}(s))return Xs(f(bs.call(s)));if(function(t){return!("[object Boolean]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}(s))return Xs(as.call(s));if(function(t){return!("[object String]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}(s))return Xs(f(String(s)));if("undefined"!=typeof window&&s===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&s===globalThis||void 0!==e&&s===e)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==Os(t)||ws&&"object"==typeof t&&ws in t)}(s)&&!Fs(s)){var A=Hs(s,f),T=Ts?Ts(s)===Object.prototype:s instanceof Object||s.constructor===Object,S=s instanceof Object?"":"null prototype",I=!T&&ws&&Object(s)===s&&ws in s?cs.call(Os(s),8,-1):S?"Object":"",R=(T||"function"!=typeof s.constructor?"":s.constructor.name?s.constructor.name+" ":"")+(I||S?"["+gs.call(ms.call([],I||[],S||[]),": ")+"] ":"");return 0===A.length?R+"{}":d?R+"{"+Ws(A,d)+"}":R+"{ "+gs.call(A,", ")+" }"}return String(s)},qs=Dt,Zs=$s("%WeakMap%",!0),Ks=$s("%Map%",!0),Qs=js("WeakMap.prototype.get",!0),Js=js("WeakMap.prototype.set",!0),tr=js("WeakMap.prototype.has",!0),er=js("Map.prototype.get",!0),sr=js("Map.prototype.set",!0),rr=js("Map.prototype.has",!0),nr=function(t,e){for(var s,r=t;null!==(s=r.next);r=s)if(s.key===e)return r.next=s.next,s.next=t.next,t.next=s,s},ir=String.prototype.replace,ar=/%20/g,or="RFC3986",hr={default:or,formatters:{RFC1738:function(t){return ir.call(t,ar,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:or},lr=hr,cr=Object.prototype.hasOwnProperty,ur=Array.isArray,dr=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),fr=function(t,e){for(var s=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(s[r]=t[r]);return s},pr=1024,mr={arrayToObject:fr,assign:function(t,e){return Object.keys(e).reduce((function(t,s){return t[s]=e[s],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],s=[],r=0;r<e.length;++r)for(var n=e[r],i=n.obj[n.prop],a=Object.keys(i),o=0;o<a.length;++o){var h=a[o],l=i[h];"object"==typeof l&&null!==l&&-1===s.indexOf(l)&&(e.push({obj:i,prop:h}),s.push(l))}return function(t){for(;t.length>1;){var e=t.pop(),s=e.obj[e.prop];if(ur(s)){for(var r=[],n=0;n<s.length;++n)void 0!==s[n]&&r.push(s[n]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,s){var r=t.replace(/\+/g," ");if("iso-8859-1"===s)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(Xy){return r}},encode:function(t,e,s,r,n){if(0===t.length)return t;var i=t;if("symbol"==typeof t?i=Symbol.prototype.toString.call(t):"string"!=typeof t&&(i=String(t)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var a="",o=0;o<i.length;o+=pr){for(var h=i.length>=pr?i.slice(o,o+pr):i,l=[],c=0;c<h.length;++c){var u=h.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||n===lr.RFC1738&&(40===u||41===u)?l[l.length]=h.charAt(c):u<128?l[l.length]=dr[u]:u<2048?l[l.length]=dr[192|u>>6]+dr[128|63&u]:u<55296||u>=57344?l[l.length]=dr[224|u>>12]+dr[128|u>>6&63]+dr[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&h.charCodeAt(c)),l[l.length]=dr[240|u>>18]+dr[128|u>>12&63]+dr[128|u>>6&63]+dr[128|63&u])}a+=l.join("")}return a},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(ur(t)){for(var s=[],r=0;r<t.length;r+=1)s.push(e(t[r]));return s}return e(t)},merge:function t(e,s,r){if(!s)return e;if("object"!=typeof s){if(ur(e))e.push(s);else{if(!e||"object"!=typeof e)return[e,s];(r&&(r.plainObjects||r.allowPrototypes)||!cr.call(Object.prototype,s))&&(e[s]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(s);var n=e;return ur(e)&&!ur(s)&&(n=fr(e,r)),ur(e)&&ur(s)?(s.forEach((function(s,n){if(cr.call(e,n)){var i=e[n];i&&"object"==typeof i&&s&&"object"==typeof s?e[n]=t(i,s,r):e.push(s)}else e[n]=s})),e):Object.keys(s).reduce((function(e,n){var i=s[n];return cr.call(e,n)?e[n]=t(e[n],i,r):e[n]=i,e}),n)}},gr=function(){var t,e,s,r={assert:function(t){if(!r.has(t))throw new qs("Side channel does not contain "+zs(t))},get:function(r){if(Zs&&r&&("object"==typeof r||"function"==typeof r)){if(t)return Qs(t,r)}else if(Ks){if(e)return er(e,r)}else if(s)return function(t,e){var s=nr(t,e);return s&&s.value}(s,r)},has:function(r){if(Zs&&r&&("object"==typeof r||"function"==typeof r)){if(t)return tr(t,r)}else if(Ks){if(e)return rr(e,r)}else if(s)return function(t,e){return!!nr(t,e)}(s,r);return!1},set:function(r,n){Zs&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new Zs),Js(t,r,n)):Ks?(e||(e=new Ks),sr(e,r,n)):(s||(s={key:{},next:null}),function(t,e,s){var r=nr(t,e);r?r.value=s:t.next={key:e,next:t.next,value:s}}(s,r,n))}};return r},xr=mr,yr=hr,br=Object.prototype.hasOwnProperty,_r={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},vr=Array.isArray,Er=Array.prototype.push,wr=function(t,e){Er.apply(t,vr(e)?e:[e])},Ar=Date.prototype.toISOString,Tr=yr.default,Sr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:xr.encode,encodeValuesOnly:!1,format:Tr,formatter:yr.formatters[Tr],indices:!1,serializeDate:function(t){return Ar.call(t)},skipNulls:!1,strictNullHandling:!1},Ir={},Rr=function t(e,s,r,n,i,a,o,h,l,c,u,d,f,p,m,g,x,y){for(var b,_=e,v=y,E=0,w=!1;void 0!==(v=v.get(Ir))&&!w;){var A=v.get(e);if(E+=1,void 0!==A){if(A===E)throw new RangeError("Cyclic object value");w=!0}void 0===v.get(Ir)&&(E=0)}if("function"==typeof c?_=c(s,_):_ instanceof Date?_=f(_):"comma"===r&&vr(_)&&(_=xr.maybeMap(_,(function(t){return t instanceof Date?f(t):t}))),null===_){if(a)return l&&!g?l(s,Sr.encoder,x,"key",p):s;_=""}if("string"==typeof(b=_)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||xr.isBuffer(_))return l?[m(g?s:l(s,Sr.encoder,x,"key",p))+"="+m(l(_,Sr.encoder,x,"value",p))]:[m(s)+"="+m(String(_))];var T,S=[];if(void 0===_)return S;if("comma"===r&&vr(_))g&&l&&(_=xr.maybeMap(_,l)),T=[{value:_.length>0?_.join(",")||null:void 0}];else if(vr(c))T=c;else{var I=Object.keys(_);T=u?I.sort(u):I}var R=h?s.replace(/\./g,"%2E"):s,M=n&&vr(_)&&1===_.length?R+"[]":R;if(i&&vr(_)&&0===_.length)return M+"[]";for(var C=0;C<T.length;++C){var P=T[C],k="object"==typeof P&&void 0!==P.value?P.value:_[P];if(!o||null!==k){var F=d&&h?P.replace(/\./g,"%2E"):P,D=vr(_)?"function"==typeof r?r(M,F):M:M+(d?"."+F:"["+F+"]");y.set(e,E);var N=gr();N.set(Ir,y),wr(S,t(k,D,r,n,i,a,o,h,"comma"===r&&g&&vr(_)?null:l,c,u,d,f,p,m,g,x,N))}}return S},Mr=mr,Cr=Object.prototype.hasOwnProperty,Pr=Array.isArray,kr={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Mr.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},Fr=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},Dr=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},Nr=function(t,e,s,r){if(t){var n=s.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,a=s.depth>0&&/(\[[^[\]]*])/.exec(n),o=a?n.slice(0,a.index):n,h=[];if(o){if(!s.plainObjects&&Cr.call(Object.prototype,o)&&!s.allowPrototypes)return;h.push(o)}for(var l=0;s.depth>0&&null!==(a=i.exec(n))&&l<s.depth;){if(l+=1,!s.plainObjects&&Cr.call(Object.prototype,a[1].slice(1,-1))&&!s.allowPrototypes)return;h.push(a[1])}if(a){if(!0===s.strictDepth)throw new RangeError("Input depth exceeded depth option of "+s.depth+" and strictDepth is true");h.push("["+n.slice(a.index)+"]")}return function(t,e,s,r){for(var n=r?e:Dr(e,s),i=t.length-1;i>=0;--i){var a,o=t[i];if("[]"===o&&s.parseArrays)a=s.allowEmptyArrays&&(""===n||s.strictNullHandling&&null===n)?[]:[].concat(n);else{a=s.plainObjects?Object.create(null):{};var h="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,l=s.decodeDotInKeys?h.replace(/%2E/g,"."):h,c=parseInt(l,10);s.parseArrays||""!==l?!isNaN(c)&&o!==l&&String(c)===l&&c>=0&&s.parseArrays&&c<=s.arrayLimit?(a=[])[c]=n:"__proto__"!==l&&(a[l]=n):a={0:n}}n=a}return n}(h,e,s,r)}},Br={formats:hr,parse:function(t,e){var s=function(t){if(!t)return kr;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.decodeDotInKeys&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?kr.charset:t.charset,s=void 0===t.duplicates?kr.duplicates:t.duplicates;if("combine"!==s&&"first"!==s&&"last"!==s)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===t.allowDots?!0===t.decodeDotInKeys||kr.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:kr.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:kr.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:kr.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:kr.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:kr.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:kr.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:kr.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:kr.decoder,delimiter:"string"==typeof t.delimiter||Mr.isRegExp(t.delimiter)?t.delimiter:kr.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:kr.depth,duplicates:s,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:kr.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:kr.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:kr.plainObjects,strictDepth:"boolean"==typeof t.strictDepth?!!t.strictDepth:kr.strictDepth,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:kr.strictNullHandling}}(e);if(""===t||null==t)return s.plainObjects?Object.create(null):{};for(var r="string"==typeof t?function(t,e){var s={__proto__:null},r=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;r=r.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var n,i=e.parameterLimit===1/0?void 0:e.parameterLimit,a=r.split(e.delimiter,i),o=-1,h=e.charset;if(e.charsetSentinel)for(n=0;n<a.length;++n)0===a[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===a[n]?h="utf-8":"utf8=%26%2310003%3B"===a[n]&&(h="iso-8859-1"),o=n,n=a.length);for(n=0;n<a.length;++n)if(n!==o){var l,c,u=a[n],d=u.indexOf("]="),f=-1===d?u.indexOf("="):d+1;-1===f?(l=e.decoder(u,kr.decoder,h,"key"),c=e.strictNullHandling?null:""):(l=e.decoder(u.slice(0,f),kr.decoder,h,"key"),c=Mr.maybeMap(Dr(u.slice(f+1),e),(function(t){return e.decoder(t,kr.decoder,h,"value")}))),c&&e.interpretNumericEntities&&"iso-8859-1"===h&&(c=Fr(c)),u.indexOf("[]=")>-1&&(c=Pr(c)?[c]:c);var p=Cr.call(s,l);p&&"combine"===e.duplicates?s[l]=Mr.combine(s[l],c):p&&"last"!==e.duplicates||(s[l]=c)}return s}(t,s):t,n=s.plainObjects?Object.create(null):{},i=Object.keys(r),a=0;a<i.length;++a){var o=i[a],h=Nr(o,r[o],s,"string"==typeof t);n=Mr.merge(n,h,s)}return!0===s.allowSparse?n:Mr.compact(n)},stringify:function(t,e){var s,r=t,n=function(t){if(!t)return Sr;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||Sr.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var s=yr.default;if(void 0!==t.format){if(!br.call(yr.formatters,t.format))throw new TypeError("Unknown format option provided.");s=t.format}var r,n=yr.formatters[s],i=Sr.filter;if(("function"==typeof t.filter||vr(t.filter))&&(i=t.filter),r=t.arrayFormat in _r?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":Sr.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=void 0===t.allowDots?!0===t.encodeDotInKeys||Sr.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:Sr.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:Sr.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:Sr.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:void 0===t.delimiter?Sr.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:Sr.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:Sr.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:Sr.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:Sr.encodeValuesOnly,filter:i,format:s,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:Sr.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:Sr.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:Sr.strictNullHandling}}(e);"function"==typeof n.filter?r=(0,n.filter)("",r):vr(n.filter)&&(s=n.filter);var i=[];if("object"!=typeof r||null===r)return"";var a=_r[n.arrayFormat],o="comma"===a&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);for(var h=gr(),l=0;l<s.length;++l){var c=s[l];n.skipNulls&&null===r[c]||wr(i,Rr(r[c],c,a,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,h))}var u=i.join(n.delimiter),d=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}},Or=Rt;function Lr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Vr=/^([a-z0-9.+-]+:)/i,Ur=/:[0-9]*$/,Xr=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Yr=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Gr=["'"].concat(Yr),Wr=["%","/","?",";","#"].concat(Gr),Hr=["/","?","#"],$r=/^[+a-z0-9A-Z_-]{0,63}$/,jr=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,zr={javascript:!0,"javascript:":!0},qr={javascript:!0,"javascript:":!0},Zr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Kr=Br;Lr.prototype.parse=function(t,e,s){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),n=-1!==r&&r<t.indexOf("#")?"?":"#",i=t.split(n);i[0]=i[0].replace(/\\/g,"/");var a=t=i.join(n);if(a=a.trim(),!s&&1===t.split("#").length){var o=Xr.exec(a);if(o)return this.path=a,this.href=a,this.pathname=o[1],o[2]?(this.search=o[2],this.query=e?Kr.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=Vr.exec(a);if(h){var l=(h=h[0]).toLowerCase();this.protocol=l,a=a.substr(h.length)}if(s||h||a.match(/^\/\/[^@/]+@[^@/]+/)){var c="//"===a.substr(0,2);!c||h&&qr[h]||(a=a.substr(2),this.slashes=!0)}if(!qr[h]&&(c||h&&!Zr[h])){for(var u,d,f=-1,p=0;p<Hr.length;p++){-1!==(m=a.indexOf(Hr[p]))&&(-1===f||m<f)&&(f=m)}-1!==(d=-1===f?a.lastIndexOf("@"):a.lastIndexOf("@",f))&&(u=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(u)),f=-1;for(p=0;p<Wr.length;p++){var m;-1!==(m=a.indexOf(Wr[p]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=a.length),this.host=a.slice(0,f),a=a.slice(f),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var x=this.hostname.split(/\./),y=(p=0,x.length);p<y;p++){var b=x[p];if(b&&!b.match($r)){for(var _="",v=0,E=b.length;v<E;v++)b.charCodeAt(v)>127?_+="x":_+=b[v];if(!_.match($r)){var w=x.slice(0,p),A=x.slice(p+1),T=b.match(jr);T&&(w.push(T[1]),A.unshift(T[2])),A.length&&(a="/"+A.join(".")+a),this.hostname=w.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=Or.toASCII(this.hostname));var S=this.port?":"+this.port:"",I=this.hostname||"";this.host=I+S,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!zr[l])for(p=0,y=Gr.length;p<y;p++){var R=Gr[p];if(-1!==a.indexOf(R)){var M=encodeURIComponent(R);M===R&&(M=escape(R)),a=a.split(R).join(M)}}var C=a.indexOf("#");-1!==C&&(this.hash=a.substr(C),a=a.slice(0,C));var P=a.indexOf("?");if(-1!==P?(this.search=a.substr(P),this.query=a.substr(P+1),e&&(this.query=Kr.parse(this.query)),a=a.slice(0,P)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Zr[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){S=this.pathname||"";var k=this.search||"";this.path=S+k}return this.href=this.format(),this},Lr.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",s=this.pathname||"",r=this.hash||"",n=!1,i="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(i=Kr.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||i&&"?"+i||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Zr[e])&&!1!==n?(n="//"+(n||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+n+(s=s.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+r},Lr.prototype.resolve=function(t){return this.resolveObject(function(t,e,s){if(t&&"object"==typeof t&&t instanceof Lr)return t;var r=new Lr;return r.parse(t,e,s),r}(t,!1,!0)).format()},Lr.prototype.resolveObject=function(t){if("string"==typeof t){var e=new Lr;e.parse(t,!1,!0),t=e}for(var s=new Lr,r=Object.keys(this),n=0;n<r.length;n++){var i=r[n];s[i]=this[i]}if(s.hash=t.hash,""===t.href)return s.href=s.format(),s;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),o=0;o<a.length;o++){var h=a[o];"protocol"!==h&&(s[h]=t[h])}return Zr[s.protocol]&&s.hostname&&!s.pathname&&(s.pathname="/",s.path=s.pathname),s.href=s.format(),s}if(t.protocol&&t.protocol!==s.protocol){if(!Zr[t.protocol]){for(var l=Object.keys(t),c=0;c<l.length;c++){var u=l[c];s[u]=t[u]}return s.href=s.format(),s}if(s.protocol=t.protocol,t.host||qr[t.protocol])s.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),s.pathname=d.join("/")}if(s.search=t.search,s.query=t.query,s.host=t.host||"",s.auth=t.auth,s.hostname=t.hostname||t.host,s.port=t.port,s.pathname||s.search){var f=s.pathname||"",p=s.search||"";s.path=f+p}return s.slashes=s.slashes||t.slashes,s.href=s.format(),s}var m=s.pathname&&"/"===s.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=g||m||s.host&&t.pathname,y=x,b=s.pathname&&s.pathname.split("/")||[],_=(d=t.pathname&&t.pathname.split("/")||[],s.protocol&&!Zr[s.protocol]);if(_&&(s.hostname="",s.port=null,s.host&&(""===b[0]?b[0]=s.host:b.unshift(s.host)),s.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),x=x&&(""===d[0]||""===b[0])),g)s.host=t.host||""===t.host?t.host:s.host,s.hostname=t.hostname||""===t.hostname?t.hostname:s.hostname,s.search=t.search,s.query=t.query,b=d;else if(d.length)b||(b=[]),b.pop(),b=b.concat(d),s.search=t.search,s.query=t.query;else if(null!=t.search){if(_)s.host=b.shift(),s.hostname=s.host,(T=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=T.shift(),s.hostname=T.shift(),s.host=s.hostname);return s.search=t.search,s.query=t.query,null===s.pathname&&null===s.search||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s}if(!b.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var v=b.slice(-1)[0],E=(s.host||t.host||b.length>1)&&("."===v||".."===v)||""===v,w=0,A=b.length;A>=0;A--)"."===(v=b[A])?b.splice(A,1):".."===v?(b.splice(A,1),w++):w&&(b.splice(A,1),w--);if(!x&&!y)for(;w--;w)b.unshift("..");!x||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),E&&"/"!==b.join("/").substr(-1)&&b.push("");var T,S=""===b[0]||b[0]&&"/"===b[0].charAt(0);_&&(s.hostname=S?"":b.length?b.shift():"",s.host=s.hostname,(T=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=T.shift(),s.hostname=T.shift(),s.host=s.hostname));return(x=x||s.host&&b.length)&&!S&&b.unshift(""),b.length>0?s.pathname=b.join("/"):(s.pathname=null,s.path=null),null===s.pathname&&null===s.search||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=t.auth||s.auth,s.slashes=s.slashes||t.slashes,s.href=s.format(),s},Lr.prototype.parseHost=function(){var t=this.host,e=Ur.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const Qr={};function Jr(t,e,s=3){if(Qr[e])return;let r=(new Error).stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(r=r.split("\n").splice(s).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(r))),Qr[e]=!0}function tn(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function en(t){return t.split("?")[0].split("#")[0]}const sn={toPosix(t){return e="\\",s="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),s);var e,s},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){tn(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const s=/^[^/:]+:\/{0,2}/.exec(t);return s?s[0]:""},toAbsolute(t,e,s){if(tn(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const r=en(this.toPosix(e??M.ADAPTER.getBaseUrl())),n=en(this.toPosix(s??this.rootname(r)));return(t=this.toPosix(t)).startsWith("/")?sn.join(n,t.slice(1)):this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(tn(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const s=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const r=t.endsWith("/");return(t=function(t,e){let s="",r=0,n=-1,i=0,a=-1;for(let o=0;o<=t.length;++o){if(o<t.length)a=t.charCodeAt(o);else{if(47===a)break;a=47}if(47===a){if(n!==o-1&&1!==i)if(n!==o-1&&2===i){if(s.length<2||2!==r||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){const t=s.lastIndexOf("/");if(t!==s.length-1){-1===t?(s="",r=0):(s=s.slice(0,t),r=s.length-1-s.lastIndexOf("/")),n=o,i=0;continue}}else if(2===s.length||1===s.length){s="",r=0,n=o,i=0;continue}e&&(s.length>0?s+="/..":s="..",r=2)}else s.length>0?s+=`/${t.slice(n+1,o)}`:s=t.slice(n+1,o),r=o-n-1;n=o,i=0}else 46===a&&-1!==i?++i:i=-1}return s}(t,!1)).length>0&&r&&(t+="/"),s?`/${t}`:e+t},isAbsolute(t){return tn(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let s=0;s<t.length;++s){const r=t[s];if(tn(r),r.length>0)if(void 0===e)e=r;else{const n=t[s-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${r}`:e+=`/${r}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(tn(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const s=47===e;let r=-1,n=!0;const i=this.getProtocol(t),a=t;for(let o=(t=t.slice(i.length)).length-1;o>=1;--o)if(e=t.charCodeAt(o),47===e){if(!n){r=o;break}}else n=!1;return-1===r?s?"/":this.isUrl(a)?i+t:i:s&&1===r?"//":i+t.slice(0,r)},rootname(t){tn(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const s=t.indexOf("/",e.length);e=-1!==s?t.slice(0,s):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){tn(t),e&&tn(e),t=en(this.toPosix(t));let s,r=0,n=-1,i=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,o=-1;for(s=t.length-1;s>=0;--s){const h=t.charCodeAt(s);if(47===h){if(!i){r=s+1;break}}else-1===o&&(i=!1,o=s+1),a>=0&&(h===e.charCodeAt(a)?-1==--a&&(n=s):(a=-1,n=o))}return r===n?n=o:-1===n&&(n=t.length),t.slice(r,n)}for(s=t.length-1;s>=0;--s)if(47===t.charCodeAt(s)){if(!i){r=s+1;break}}else-1===n&&(i=!1,n=s+1);return-1===n?"":t.slice(r,n)},extname(t){tn(t);let e=-1,s=0,r=-1,n=!0,i=0;for(let a=(t=en(this.toPosix(t))).length-1;a>=0;--a){const o=t.charCodeAt(a);if(47!==o)-1===r&&(n=!1,r=a+1),46===o?-1===e?e=a:1!==i&&(i=1):-1!==e&&(i=-1);else if(!n){s=a+1;break}}return-1===e||-1===r||0===i||1===i&&e===r-1&&e===s+1?"":t.slice(e,r)},parse(t){tn(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let s=(t=en(this.toPosix(t))).charCodeAt(0);const r=this.isAbsolute(t);let n;e.root=this.rootname(t),n=r||this.hasProtocol(t)?1:0;let i=-1,a=0,o=-1,h=!0,l=t.length-1,c=0;for(;l>=n;--l)if(s=t.charCodeAt(l),47!==s)-1===o&&(h=!1,o=l+1),46===s?-1===i?i=l:1!==c&&(c=1):-1!==i&&(c=-1);else if(!h){a=l+1;break}return-1===i||-1===o||0===c||1===c&&i===o-1&&i===a+1?-1!==o&&(e.base=e.name=0===a&&r?t.slice(1,o):t.slice(a,o)):(0===a&&r?(e.name=t.slice(1,i),e.base=t.slice(1,o)):(e.name=t.slice(a,i),e.base=t.slice(a,o)),e.ext=t.slice(i,o)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let rn,nn;async function an(){return rn??(rn=(async()=>{var t;const e=document.createElement("canvas").getContext("webgl");if(!e)return E.UNPACK;const s=await new Promise((t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()}));if(!s)return E.UNPACK;const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s);const i=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,i),e.deleteFramebuffer(n),e.deleteTexture(r),null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext(),i[0]<=i[3]?E.PMA:E.UNPACK})()),rn}var on={grad:.9,turn:360,rad:360/(2*Math.PI)},hn=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},ln=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=Math.pow(10,e)),Math.round(s*t)/s+0},cn=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),t>s?s:t>e?t:e},un=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},dn=function(t){return{r:cn(t.r,0,255),g:cn(t.g,0,255),b:cn(t.b,0,255),a:cn(t.a)}},fn=function(t){return{r:ln(t.r),g:ln(t.g),b:ln(t.b),a:ln(t.a,3)}},pn=/^#([0-9a-f]{3,8})$/i,mn=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},gn=function(t){var e=t.r,s=t.g,r=t.b,n=t.a,i=Math.max(e,s,r),a=i-Math.min(e,s,r),o=a?i===e?(s-r)/a:i===s?2+(r-e)/a:4+(e-s)/a:0;return{h:60*(o<0?o+6:o),s:i?a/i*100:0,v:i/255*100,a:n}},xn=function(t){var e=t.h,s=t.s,r=t.v,n=t.a;e=e/360*6,s/=100,r/=100;var i=Math.floor(e),a=r*(1-s),o=r*(1-(e-i)*s),h=r*(1-(1-e+i)*s),l=i%6;return{r:255*[r,o,a,a,h,r][l],g:255*[h,r,r,o,a,a][l],b:255*[a,a,h,r,r,o][l],a:n}},yn=function(t){return{h:un(t.h),s:cn(t.s,0,100),l:cn(t.l,0,100),a:cn(t.a)}},bn=function(t){return{h:ln(t.h),s:ln(t.s),l:ln(t.l),a:ln(t.a,3)}},_n=function(t){return xn((s=(e=t).s,{h:e.h,s:(s*=((r=e.l)<50?r:100-r)/100)>0?2*s/(r+s)*100:0,v:r+s,a:e.a}));var e,s,r},vn=function(t){return{h:(e=gn(t)).h,s:(n=(200-(s=e.s))*(r=e.v)/100)>0&&n<200?s*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,s,r,n},En=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wn=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,An=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Tn=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Sn={string:[[function(t){var e=pn.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?ln(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?ln(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=An.exec(t)||Tn.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:dn({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=En.exec(t)||wn.exec(t);if(!e)return null;var s,r,n=yn({h:(s=e[1],r=e[2],void 0===r&&(r="deg"),Number(s)*(on[r]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return _n(n)},"hsl"]],object:[[function(t){var e=t.r,s=t.g,r=t.b,n=t.a,i=void 0===n?1:n;return hn(e)&&hn(s)&&hn(r)?dn({r:Number(e),g:Number(s),b:Number(r),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,s=t.s,r=t.l,n=t.a,i=void 0===n?1:n;if(!hn(e)||!hn(s)||!hn(r))return null;var a=yn({h:Number(e),s:Number(s),l:Number(r),a:Number(i)});return _n(a)},"hsl"],[function(t){var e=t.h,s=t.s,r=t.v,n=t.a,i=void 0===n?1:n;if(!hn(e)||!hn(s)||!hn(r))return null;var a,o=(a={h:Number(e),s:Number(s),v:Number(r),a:Number(i)},{h:un(a.h),s:cn(a.s,0,100),v:cn(a.v,0,100),a:cn(a.a)});return xn(o)},"hsv"]]},In=function(t,e){for(var s=0;s<e.length;s++){var r=e[s][0](t);if(r)return[r,e[s][1]]}return[null,void 0]},Rn=function(t,e){var s=vn(t);return{h:s.h,s:cn(s.s+100*e,0,100),l:s.l,a:s.a}},Mn=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Cn=function(t,e){var s=vn(t);return{h:s.h,s:s.s,l:cn(s.l+100*e,0,100),a:s.a}},Pn=function(){function t(t){this.parsed=function(t){return"string"==typeof t?In(t.trim(),Sn.string):"object"==typeof t&&null!==t?In(t,Sn.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return ln(Mn(this.rgba),2)},t.prototype.isDark=function(){return Mn(this.rgba)<.5},t.prototype.isLight=function(){return Mn(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=fn(this.rgba)).r,s=t.g,r=t.b,i=(n=t.a)<1?mn(ln(255*n)):"","#"+mn(e)+mn(s)+mn(r)+i;var t,e,s,r,n,i},t.prototype.toRgb=function(){return fn(this.rgba)},t.prototype.toRgbString=function(){return e=(t=fn(this.rgba)).r,s=t.g,r=t.b,(n=t.a)<1?"rgba("+e+", "+s+", "+r+", "+n+")":"rgb("+e+", "+s+", "+r+")";var t,e,s,r,n},t.prototype.toHsl=function(){return bn(vn(this.rgba))},t.prototype.toHslString=function(){return e=(t=bn(vn(this.rgba))).h,s=t.s,r=t.l,(n=t.a)<1?"hsla("+e+", "+s+"%, "+r+"%, "+n+")":"hsl("+e+", "+s+"%, "+r+"%)";var t,e,s,r,n},t.prototype.toHsv=function(){return t=gn(this.rgba),{h:ln(t.h),s:ln(t.s),v:ln(t.v),a:ln(t.a,3)};var t},t.prototype.invert=function(){return kn({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),kn(Rn(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),kn(Rn(this.rgba,-t))},t.prototype.grayscale=function(){return kn(Rn(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),kn(Cn(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),kn(Cn(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?kn({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ln(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=vn(this.rgba);return"number"==typeof t?kn({h:t,s:e.s,l:e.l,a:e.a}):ln(e.h)},t.prototype.isEqual=function(t){return this.toHex()===kn(t).toHex()},t}(),kn=function(t){return t instanceof Pn?t:new Pn(t)},Fn=[];[function(t,e){var s={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in s)r[s[n]]=n;var i={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var n,a,o=r[this.toHex()];if(o)return o;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,c="black";if(!i.length)for(var u in s)i[u]=new t(s[u]).toRgb();for(var d in s){var f=(n=h,a=i[d],Math.pow(n.r-a.r,2)+Math.pow(n.g-a.g,2)+Math.pow(n.b-a.b,2));f<l&&(l=f,c=d)}return c}},e.string.push([function(e){var r=e.toLowerCase(),n="transparent"===r?"#0000":s[r];return n?new t(n).toRgb():null},"name"])}].forEach((function(t){Fn.indexOf(t)<0&&(t(Pn,Sn),Fn.push(t))}));const Dn=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const s=typeof t;if(s!==typeof e)return!1;if("number"===s||"string"===s||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,s)=>t===e[s]));if(null!==t&&null!==e){const s=Object.keys(t),r=Object.keys(e);return s.length===r.length&&s.every((s=>t[s]===e[s]))}return t===e}toRgba(){const[t,e,s,r]=this._components;return{r:t,g:e,b:s,a:r}}toRgb(){const[t,e,s]=this._components;return{r:t,g:e,b:s}}toRgbaString(){const[t,e,s]=this.toUint8RgbArray();return`rgba(${t},${e},${s},${this.alpha})`}toUint8RgbArray(t){const[e,s,r]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*s),t[2]=Math.round(255*r),t}toRgbArray(t){t=t??[];const[e,s,r]=this._components;return t[0]=e,t[1]=s,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[s,r,n,i]=t.temp.setValue(e)._components;return this._components[0]*=s,this._components[1]*=r,this._components[2]*=n,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let s=this._int>>16&255,r=this._int>>8&255,n=255&this._int;return e&&(s=s*t+.5|0,r=r*t+.5|0,n=n*t+.5|0),(255*t<<24)+(s<<16)+(r<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,s,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(s*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,s,r,n]=this._components;return t[0]=e,t[1]=s,t[2]=r,t[3]=n,t}normalize(e){let s,r,n,i;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215){s=(e>>16&255)/255,r=(e>>8&255)/255,n=(255&e)/255,i=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[s,r,n,i=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[s,r,n,i=255]=e,s/=255,r/=255,n/=255,i/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const s=t.HEX_PATTERN.exec(e);s&&(e=`#${s[2]}`)}const a=kn(e);a.isValid()&&(({r:s,g:r,b:n,a:i}=a.rgba),s/=255,r/=255,n/=255)}if(void 0===s)throw new Error(`Unable to convert color ${e}`);this._components[0]=s,this._components[1]=r,this._components[2]=n,this._components[3]=i,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,s]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*s|0)}_clamp(t,e=0,s=1){return"number"==typeof t?Math.min(Math.max(t,e),s):(t.forEach(((r,n)=>{t[n]=Math.min(Math.max(r,e),s)})),t)}};Dn.shared=new Dn,Dn.temp=new Dn,Dn.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Nn=Dn;function Bn(t){return Jr("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Nn.shared.setValue(t).toNumber()}const On=function(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[f.NORMAL_NPM]=f.NORMAL,t[f.ADD_NPM]=f.ADD,t[f.SCREEN_NPM]=f.SCREEN,e[f.NORMAL]=f.NORMAL_NPM,e[f.ADD]=f.ADD_NPM,e[f.SCREEN]=f.SCREEN_NPM;const s=[];return s.push(e),s.push(t),s}();function Ln(t,e){return On[e?1:0][t]}function Vn(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function Un(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Xn(t){return!(t&t-1||!t)}function Yn(t){let e=(t>65535?1:0)<<4,s=((t>>>=e)>255?1:0)<<3;return e|=s,s=((t>>>=s)>15?1:0)<<2,e|=s,s=((t>>>=s)>3?1:0)<<1,e|=s,e|(t>>>=s)>>1}function Gn(t,e,s){const r=t.length;let n;if(e>=r||0===s)return;const i=r-(s=e+s>r?r-e:s);for(n=e;n<i;++n)t[n]=t[n+s];t.length=i}function Wn(t){return 0===t?0:t<0?-1:1}let Hn=0;function $n(){return++Hn}const jn=class{constructor(t,e,s,r){this.left=t,this.top=e,this.right=s,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};jn.EMPTY=new jn(0,0,0,0);let zn=jn;const qn={},Zn=Object.create(null),Kn=Object.create(null);class Qn{constructor(t,e,s){this._canvas=M.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=s||M.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Jn(t,e,s){for(let r=0,n=4*s*e;r<e;++r,n+=4)if(0!==t[n+3])return!1;return!0}function ti(t,e,s,r,n){const i=4*e;for(let a=r,o=r*i+4*s;a<=n;++a,o+=i)if(0!==t[o+3])return!1;return!0}function ei(t){const e=function(t){const{width:e,height:s}=t,r=t.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const n=r.getImageData(0,0,e,s).data;let i=0,a=0,o=e-1,h=s-1;for(;a<s&&Jn(n,e,a);)++a;if(a===s)return zn.EMPTY;for(;Jn(n,e,h);)--h;for(;ti(n,e,i,a,h);)++i;for(;ti(n,e,o,a,h);)--o;return++o,++h,new zn(i,a,o,h)}(t),{width:s,height:r}=e;let n=null;if(!e.isEmpty()){const i=t.getContext("2d");if(null===i)throw new TypeError("Failed to get canvas 2D context");n=i.getImageData(e.left,e.top,s,r)}return{width:s,height:r,data:n}}function si(t,e=1){var s;const r=null==(s=M.RETINA_PREFIX)?void 0:s.exec(t);return r?parseFloat(r[1]):e}var ri=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(ri||{});const ni=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},ii=(t,e)=>ni(t).priority??e,ai={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(ni).forEach((t=>{t.type.forEach((e=>{var s,r;return null==(r=(s=this._removeHandlers)[e])?void 0:r.call(s,t)}))})),this},add(...t){return t.map(ni).forEach((t=>{t.type.forEach((e=>{var s,r;const n=this._addHandlers,i=this._queue;n[e]?null==(s=n[e])||s.call(n,t):(i[e]=i[e]||[],null==(r=i[e])||r.push(t))}))})),this},handle(t,e,s){var r;const n=this._addHandlers,i=this._removeHandlers;if(n[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,i[t]=s;const a=this._queue;return a[t]&&(null==(r=a[t])||r.forEach((t=>e(t))),delete a[t]),this},handleByMap(t,e){return this.handle(t,(t=>{t.name&&(e[t.name]=t.ref)}),(t=>{t.name&&delete e[t.name]}))},handleByList(t,e,s=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>ii(e,s)-ii(t,s))))}),(t=>{const s=e.indexOf(t.ref);-1!==s&&e.splice(s,1)}))}};class oi{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const hi=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function li(t){let e="";for(let s=0;s<t;++s)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(test == ${s}.0){}`);return e}class ci{constructor(){this.data=0,this.blendMode=f.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==f.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new ci;return t.depthTest=!1,t.blend=!0,t}}ci.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const ui=[];function di(t,e){if(!t)return null;let s="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(s=e[1].toLowerCase())}for(let r=ui.length-1;r>=0;--r){const n=ui[r];if(n.test&&n.test(t,s))return new n(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class fi{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,s,r,n,i,a,o){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,s,r,n,i,a,o);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(fi.prototype,{dispatch:{value:fi.prototype.emit},run:{value:fi.prototype.emit}});class pi{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new fi("setRealSize"),this.onUpdate=new fi("update"),this.onError=new fi("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class mi extends pi{constructor(t,e){const{width:s,height:r}=e||{};if(!s||!r)throw new Error("BufferResource width or height invalid");super(s,r),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,s){const r=t.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===E.UNPACK);const n=e.realWidth,i=e.realHeight;return s.width===n&&s.height===i?r.texSubImage2D(e.target,0,0,0,n,i,e.format,s.type,this.data):(s.width=n,s.height=i,r.texImage2D(e.target,0,s.internalFormat,n,i,0,e.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return null===t||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const gi={scaleMode:b.NEAREST,alphaMode:E.NPM},xi=class t extends q{constructor(e=null,s=null){super(),s=Object.assign({},t.defaultOptions,s);const{alphaMode:r,mipmap:n,anisotropicLevel:i,scaleMode:a,width:o,height:h,wrapMode:l,format:c,type:u,target:d,resolution:f,resourceOptions:p}=s;e&&!(e instanceof pi)&&((e=di(e,p)).internal=!0),this.resolution=f||M.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=i,this._wrapMode=l,this._scaleMode=a,this.format=c,this.type=u,this.target=d,this.alphaMode=r,this.uid=$n(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let s;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,s=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,s=!0),s&&this.dirtyStyleId++,this}setSize(t,e,s){return s=s||this.resolution,this.setRealSize(t*s,e*s,s)}setRealSize(t,e,s){return this.resolution=s||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Xn(this.realWidth)&&Xn(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Kn[this.cacheId],delete Zn[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,s,r=M.STRICT_TEXTURE_CACHE){const n="string"==typeof e;let i=null;if(n)i=e;else{if(!e._pixiId){const t=(null==s?void 0:s.pixiIdPrefix)||"pixiid";e._pixiId=`${t}_${$n()}`}i=e._pixiId}let a=Kn[i];if(n&&r&&!a)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return a||(a=new t(e,s),a.cacheId=i,t.addToCache(a,i)),a}static fromBuffer(e,s,r,n){e=e||new Float32Array(s*r*4);const i=new mi(e,{width:s,height:r,...null==n?void 0:n.resourceOptions});let a,o;return e instanceof Float32Array?(a=m.RGBA,o=x.FLOAT):e instanceof Int32Array?(a=m.RGBA_INTEGER,o=x.INT):e instanceof Uint32Array?(a=m.RGBA_INTEGER,o=x.UNSIGNED_INT):e instanceof Int16Array?(a=m.RGBA_INTEGER,o=x.SHORT):e instanceof Uint16Array?(a=m.RGBA_INTEGER,o=x.UNSIGNED_SHORT):e instanceof Int8Array?(a=m.RGBA,o=x.BYTE):(a=m.RGBA,o=x.UNSIGNED_BYTE),i.internal=!0,new t(i,Object.assign({},gi,{type:o,format:a},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Kn[e]&&Kn[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Kn[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Kn[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete Kn[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Kn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};xi.defaultOptions={mipmap:v.POW2,anisotropicLevel:0,scaleMode:b.LINEAR,wrapMode:_.CLAMP,alphaMode:E.UNPACK,target:g.TEXTURE_2D,format:m.RGBA,type:x.UNSIGNED_BYTE},xi._globalBatch=0;let yi=xi;class bi{constructor(){this.texArray=null,this.blend=0,this.type=p.TRIANGLES,this.start=0,this.size=0,this.data=null}}let _i=0;class vi{constructor(t,e=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=e,this.id=_i++,this.disposeRunner=new fi("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?R.ELEMENT_ARRAY_BUFFER:R.ARRAY_BUFFER}get index(){return this.type===R.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new vi(t)}}class Ei{constructor(t,e=0,s=!1,r=x.FLOAT,n,i,a,o=1){this.buffer=t,this.size=e,this.normalized=s,this.type=r,this.stride=n,this.start=i,this.instance=a,this.divisor=o}destroy(){this.buffer=null}static from(t,e,s,r,n){return new Ei(t,e,s,r,n)}}const wi={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const Ai={5126:4,5123:2,5121:1};let Ti=0;const Si={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class Ii{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Ti++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new fi("disposeGeometry"),this.refCount=0}addAttribute(t,e,s=0,r=!1,n,i,a,o=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof vi||(e instanceof Array&&(e=new Float32Array(e)),e=new vi(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,s,r,n);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new Ei(l,s,r,n,i,a,o),this.instanced=this.instanced||o,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof vi||(t instanceof Array&&(t=new Uint16Array(t)),t=new vi(t)),t.type=R.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],s=new vi;let r;for(r in this.attributes){const s=this.attributes[r],n=this.buffers[s.buffer];t.push(n.data),e.push(s.size*Ai[s.type]/4),s.buffer=0}for(s.data=function(t,e){let s=0,r=0;const n={};for(let h=0;h<t.length;h++)r+=e[h],s+=t[h].length;const i=new ArrayBuffer(4*s);let a=null,o=0;for(let h=0;h<t.length;h++){const s=e[h],l=t[h],c=Vn(l);n[c]||(n[c]=new wi[c](i)),a=n[c];for(let t=0;t<l.length;t++)a[(t/s|0)*r+o+t%s]=l[t];o+=s}return new Float32Array(i)}(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ii;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new vi(this.buffers[e].data.slice(0));for(const e in this.attributes){const s=this.attributes[e];t.attributes[e]=new Ei(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=R.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ii,s=[],r=[],n=[];let i;for(let a=0;a<t.length;a++){i=t[a];for(let t=0;t<i.buffers.length;t++)r[t]=r[t]||0,r[t]+=i.buffers[t].data.length,n[t]=0}for(let a=0;a<i.buffers.length;a++)s[a]=new(Si[Vn(i.buffers[a].data)])(r[a]),e.buffers[a]=new vi(s[a]);for(let a=0;a<t.length;a++){i=t[a];for(let t=0;t<i.buffers.length;t++)s[t].set(i.buffers[t].data,n[t]),n[t]+=i.buffers[t].data.length}if(e.attributes=i.attributes,i.indexBuffer){e.indexBuffer=e.buffers[i.buffers.indexOf(i.indexBuffer)],e.indexBuffer.type=R.ELEMENT_ARRAY_BUFFER;let s=0,r=0,n=0,a=0;for(let t=0;t<i.buffers.length;t++)if(i.buffers[t]!==i.indexBuffer){a=t;break}for(const t in i.attributes){const e=i.attributes[t];(0|e.buffer)===a&&(r+=e.size*Ai[e.type]/4)}for(let i=0;i<t.length;i++){const o=t[i].indexBuffer.data;for(let t=0;t<o.length;t++)e.indexBuffer.data[t+n]+=s;s+=t[i].buffers[a].data.length/r,n+=o.length}}return e}}class Ri extends Ii{constructor(t=!1){super(),this._buffer=new vi(null,t,!1),this._indexBuffer=new vi(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,x.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,x.FLOAT).addAttribute("aColor",this._buffer,4,!0,x.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,x.FLOAT).addIndex(this._indexBuffer)}}const Mi=2*Math.PI,Ci=180/Math.PI,Pi=Math.PI/180;var ki=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(ki||{});class Fi{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Fi(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Fi.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Di=[new Fi,new Fi,new Fi,new Fi];class Ni{constructor(t=0,e=0,s=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(r),this.type=ki.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ni(0,0,0,0)}clone(){return new Ni(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const s=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>s}const s=this.left,r=this.right,n=this.top,i=this.bottom;if(r<=s||i<=n)return!1;const a=Di[0].set(t.left,t.top),o=Di[1].set(t.left,t.bottom),h=Di[2].set(t.right,t.top),l=Di[3].set(t.right,t.bottom);if(h.x<=a.x||o.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c||(e.apply(a,a),e.apply(o,o),e.apply(h,h),e.apply(l,l),Math.max(a.x,o.x,h.x,l.x)<=s||Math.min(a.x,o.x,h.x,l.x)>=r||Math.max(a.y,o.y,h.y,l.y)<=n||Math.min(a.y,o.y,h.y,l.y)>=i))return!1;const u=c*(o.y-a.y),d=c*(a.x-o.x),f=u*s+d*n,p=u*r+d*n,m=u*s+d*i,g=u*r+d*i;if(Math.max(f,p,m,g)<=u*a.x+d*a.y||Math.min(f,p,m,g)>=u*l.x+d*l.y)return!1;const x=c*(a.y-h.y),y=c*(h.x-a.x),b=x*s+y*n,_=x*r+y*n,v=x*s+y*i,E=x*r+y*i;return!(Math.max(b,_,v,E)<=x*a.x+y*a.y||Math.min(b,_,v,E)>=x*l.x+y*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=r,this.height=n-r,this}}Ni.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Bi{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.radius=s,this.type=ki.CIRC}clone(){return new Bi(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=s}getBounds(){return new Ni(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}Bi.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Oi{constructor(t=0,e=0,s=0,r=0){this.x=t,this.y=e,this.width=s,this.height=r,this.type=ki.ELIP}clone(){return new Oi(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,r=(e-this.y)/this.height;return s*=s,r*=r,s+r<=1}getBounds(){return new Ni(this.x-this.width,this.y-this.height,this.width,this.height)}}Oi.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Li{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let s=0,r=e.length;s<r;s++)t.push(e[s].x,e[s].y);e=t}this.points=e,this.type=ki.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Li(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let s=!1;const r=this.points.length/2;for(let n=0,i=r-1;n<r;i=n++){const r=this.points[2*n],a=this.points[2*n+1],o=this.points[2*i],h=this.points[2*i+1];a>e!=h>e&&t<(e-a)/(h-a)*(o-r)+r&&(s=!s)}return s}}Li.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`};class Vi{constructor(t=0,e=0,s=0,r=0,n=20){this.x=t,this.y=e,this.width=s,this.height=r,this.radius=n,this.type=ki.RREC}clone(){return new Vi(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let r=t-(this.x+s),n=e-(this.y+s);const i=s*s;if(r*r+n*n<=i||(r=t-(this.x+this.width-s),r*r+n*n<=i)||(n=e-(this.y+this.height-s),r*r+n*n<=i)||(r=t-(this.x+s),r*r+n*n<=i))return!0}return!1}}Vi.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Ui{constructor(t=1,e=0,s=0,r=1,n=0,i=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=r,this.tx=n,this.ty=i}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,r,n,i){return this.a=t,this.b=e,this.c=s,this.d=r,this.tx=n,this.ty=i,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new Fi;const s=t.x,r=t.y;return e.x=this.a*s+this.c*r+this.tx,e.y=this.b*s+this.d*r+this.ty,e}applyInverse(t,e){e=e||new Fi;const s=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return e.x=this.d*s*r+-this.c*s*n+(this.ty*this.c-this.tx*this.d)*s,e.y=this.a*s*n+-this.b*s*r+(-this.ty*this.a+this.tx*this.b)*s,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),r=this.a,n=this.c,i=this.tx;return this.a=r*e-this.b*s,this.b=r*s+this.b*e,this.c=n*e-this.d*s,this.d=n*s+this.d*e,this.tx=i*e-this.ty*s,this.ty=i*s+this.ty*e,this}append(t){const e=this.a,s=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*s+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*s+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*s+t.ty*n+this.ty,this}setTransform(t,e,s,r,n,i,a,o,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-o)*i,this.d=Math.cos(a-o)*i,this.tx=t-(s*this.a+r*this.c),this.ty=e-(s*this.b+r*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,s=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,r=this.c,n=this.d,i=t.pivot,a=-Math.atan2(-r,n),o=Math.atan2(s,e),h=Math.abs(a+o);return h<1e-5||Math.abs(Mi-h)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(i.x*e+i.y*r),t.position.y=this.ty+(i.x*s+i.y*n),t}invert(){const t=this.a,e=this.b,s=this.c,r=this.d,n=this.tx,i=t*r-e*s;return this.a=r/i,this.b=-e/i,this.c=-s/i,this.d=t/i,this.tx=(s*this.ty-r*n)/i,this.ty=-(t*this.ty-e*n)/i,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ui;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Ui}static get TEMP_MATRIX(){return new Ui}}Ui.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Xi=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Yi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Gi=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Wi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Hi=[],$i=[],ji=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Hi.push(e);for(let s=0;s<16;s++){const r=ji(Xi[t]*Xi[s]+Gi[t]*Yi[s]),n=ji(Yi[t]*Xi[s]+Wi[t]*Yi[s]),i=ji(Xi[t]*Gi[s]+Gi[t]*Wi[s]),a=ji(Yi[t]*Gi[s]+Wi[t]*Wi[s]);for(let t=0;t<16;t++)if(Xi[t]===r&&Yi[t]===n&&Gi[t]===i&&Wi[t]===a){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Ui;e.set(Xi[t],Yi[t],Gi[t],Wi[t],0,0),$i.push(e)}}();const zi={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Xi[t],uY:t=>Yi[t],vX:t=>Gi[t],vY:t=>Wi[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Hi[t][e],sub:(t,e)=>Hi[t][zi.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?zi.S:zi.N:2*Math.abs(e)<=Math.abs(t)?t>0?zi.E:zi.W:e>0?t>0?zi.SE:zi.SW:t>0?zi.NE:zi.NW,matrixAppendRotationInv:(t,e,s=0,r=0)=>{const n=$i[zi.inv(e)];n.tx=s,n.ty=r,t.append(n)}};class qi{constructor(t,e,s=0,r=0){this._x=s,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new qi(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}qi.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Zi=class{constructor(){this.worldTransform=new Ui,this.localTransform=new Ui,this.position=new qi(this.onChange,this,0,0),this.scale=new qi(this.onChange,this,1,1),this.pivot=new qi(this.onChange,this,0,0),this.skew=new qi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const s=t.worldTransform,r=this.worldTransform;r.a=e.a*s.a+e.b*s.c,r.b=e.a*s.b+e.b*s.d,r.c=e.c*s.a+e.d*s.c,r.d=e.c*s.b+e.d*s.d,r.tx=e.tx*s.a+e.ty*s.c+s.tx,r.ty=e.tx*s.b+e.ty*s.d+s.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};Zi.IDENTITY=new Zi;let Ki=Zi;Ki.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};function Qi(t,e,s){const r=t.createShader(e);return t.shaderSource(r,s),t.compileShader(r),r}function Ji(t){const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=!1;return e}function ta(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Ji(2*e);case"bvec3":return Ji(3*e);case"bvec4":return Ji(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ea=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],sa={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},ra={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const na={};let ia,aa=na;function oa(){if(!ia){ia=T.MEDIUM;const t=function(){if(aa===na||(null==aa?void 0:aa.isContextLost())){const t=M.ADAPTER.createCanvas();let e;M.PREFER_ENV>=c.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),aa=e}return aa}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e&&(ia=e.precision?T.HIGH:T.MEDIUM)}}return ia}function ha(t,e){const s=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),r=t.getShaderInfoLog(e),n=r.split("\n"),i={},a=n.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||i[t])&&(i[t]=!0,!0))),o=[""];a.forEach((t=>{s[t-1]=`%c${s[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=s.join("\n");o[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}const la={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function ca(t){return la[t]}let ua=null;const da={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function fa(t,e){if(!ua){const e=Object.keys(da);ua={};for(let s=0;s<e.length;++s){const r=e[s];ua[t[r]]=da[r]}}return ua[e]}function pa(t,e,s){if("precision"!==t.substring(0,9)){let r=e;return e===T.HIGH&&s!==T.HIGH&&(r=T.MEDIUM),`precision ${r} float;\n${t}`}return s!==T.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let ma;let ga=0;const xa={},ya=class t{constructor(e,s,r="pixi-shader",n={}){this.extra={},this.id=ga++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=s||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),xa[r]?(xa[r]++,r+=`-${xa[r]}`):xa[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}\n${this.fragmentSrc}`,this.vertexSrc=pa(this.vertexSrc,t.defaultVertexPrecision,T.HIGH),this.fragmentSrc=pa(this.fragmentSrc,t.defaultFragmentPrecision,oa())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(e,s,r){const n=e+s;let i=qn[n];return i||(qn[n]=i=new t(e,s,r)),i}};ya.defaultVertexPrecision=T.HIGH,ya.defaultFragmentPrecision=j.apple.device?T.HIGH:T.MEDIUM;let ba=ya,_a=0;class va{constructor(t,e,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=_a++,this.static=!!e,this.ubo=!!s,t instanceof vi?(this.buffer=t,this.buffer.type=R.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new vi(new Float32Array(1)),this.buffer.type=R.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,s){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new va(e,s)}static from(t,e,s){return new va(t,e,s)}static uboFrom(t,e){return new va(t,e??!0,!0)}}class Ea{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof va?e:new va(e):new va({}),this.disposeRunner=new fi("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const s in e.uniforms){const r=e.uniforms[s];if(!0===r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,s){const r=ba.from(t,e);return new Ea(r,s)}}class wa{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=va.from({uSamplers:e},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ba(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ui,default:this.defaultGroupCache[t]};return new Ea(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let s=0;s<t;s++)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(vTextureId < ${s}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${s}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class Aa{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Ta{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Sa=class t extends Ta{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Ri,this.vertexSize=6,this.state=ci.for2d(),this.size=4*t.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const s=M.ADAPTER.getNavigator();if(j.tablet||j.phone){if(j.apple.device){const t=s.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(j.android.device){const t=s.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!j.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Jr("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:e=t.defaultVertexSrc,fragment:s=t.defaultFragmentTemplate}={}){this.shaderGenerator=new wa(e,s)}contextChange(){const e=this.renderer.gl;M.PREFER_ENV===c.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const s=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=hi.replace(/%forloop%/gi,li(t));if(e.shaderSource(s,r),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:s}=t,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new bi);for(;s.length<n;)s.push(new Aa);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:s}=this,r=t._textureArrayPool,n=this.renderer.batch,i=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++yi._globalBatch,h=0,l=r[0],c=0;n.copyBoundTextures(i,s);for(let t=0;t<this._bufferSize;++t){const u=e[t];e[t]=null,u._batchEnabled!==o&&(l.count>=s&&(n.boundArray(l,i,o,s),this.buildDrawCalls(l,c,t),c=t,l=r[++h],++o),u._batchEnabled=o,u.touched=a,l.elements[l.count++]=u)}l.count>0&&(n.boundArray(l,i,o,s),this.buildDrawCalls(l,c,this._bufferSize),++h,++o);for(let t=0;t<i.length;t++)i[t]=null;yi._globalBatch=o}buildDrawCalls(e,s,r){const{_bufferedElements:n,_attributeBuffer:i,_indexBuffer:a,vertexSize:o}=this,h=t._drawCallPool;let l=this._dcIndex,c=this._aIndex,u=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=e;for(let t=s;t<r;++t){const r=n[t],f=r._texture.baseTexture,p=On[f.alphaMode?1:0][r.blendMode];n[t]=null,s<t&&d.blend!==p&&(d.size=u-d.start,s=t,d=h[++l],d.texArray=e,d.start=u),this.packInterleavedGeometry(r,i,a,c,u),c+=r.vertexData.length/2*o,u+=r.indices.length,d.blend=p}s<r&&(d.size=u-d.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let s=0;s<t.count;s++)e.bind(t.elements[s],t.ids[s]),t.elements[s]=null;t.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:s,_indexBuffer:r}=this;t.canUploadSameBuffer?(e[this._flushId]._buffer.update(s.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(s.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:s,state:r}=this.renderer,n=t._drawCallPool;let i=null;for(let t=0;t<e;t++){const{texArray:e,type:a,size:o,start:h,blend:l}=n[t];i!==e&&(i=e,this.bindAndClearTexArray(e)),this.state.blendMode=l,r.set(this.state),s.drawElements(a,o,s.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),t.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Un(Math.ceil(t/8)),s=Yn(e),r=8*e;this._aBuffers.length<=s&&(this._iBuffers.length=s+1);let n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new oi(r*this.vertexSize*4)),n}getIndexBuffer(t){const e=Un(Math.ceil(t/12)),s=Yn(e),r=12*e;this._iBuffers.length<=s&&(this._iBuffers.length=s+1);let n=this._iBuffers[s];return n||(this._iBuffers[s]=n=new Uint16Array(r)),n}packInterleavedGeometry(t,e,s,r,n){const{uint32View:i,float32View:a}=e,o=r/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=Nn.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let p=0;p<c.length;p+=2)a[r++]=c[p],a[r++]=c[p+1],a[r++]=h[p],a[r++]=h[p+1],i[r++]=f,a[r++]=u;for(let p=0;p<l.length;p++)s[n++]=o+l[p]}};Sa.defaultBatchSize=4096,Sa.extension={name:"batch",type:ri.RendererPlugin},Sa._drawCallPool=[],Sa._textureArrayPool=[];let Ia=Sa;ai.add(Ia);const Ra=class t extends Ea{constructor(e,s,r){super(ba.from(e||t.defaultVertexSrc,s||t.defaultFragmentSrc),r),this.padding=0,this.resolution=t.defaultResolution,this.multisample=t.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ci}apply(t,e,s,r,n){t.applyFilter(this,e,s,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};Ra.defaultResolution=1,Ra.defaultMultisample=I.NONE;let Ma=Ra;class Ca{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Nn(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:s,backgroundAlpha:r}=t,n=s??e;void 0!==n&&(this.color=n),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Ca.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Ca.extension={type:[ri.RendererSystem,ri.CanvasRendererSystem],name:"background"},ai.add(Ca);class Pa{constructor(t){this.renderer=t,this.emptyRenderer=new Ta(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:s}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=s[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,s,r){const{elements:n,ids:i,count:a}=t;let o=0;for(let h=0;h<a;h++){const t=n[h],a=t._batchLocation;if(a>=0&&a<r&&e[a]===t)i[h]=a;else for(;o<r;){const r=e[o];if(!r||r._batchEnabled!==s||r._batchLocation!==o){i[h]=o,t._batchLocation=o,e[o]=t;break}o++}}}destroy(){this.renderer=null}}Pa.extension={type:ri.RendererSystem,name:"batch"},ai.add(Pa);let ka=0;class Fa{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ka++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,s=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:s,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ka++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let s;if(M.PREFER_ENV>=c.WEBGL2&&(s=t.getContext("webgl2",e)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Fa.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Fa.extension={type:ri.RendererSystem,name:"context"},ai.add(Fa);class Da{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new fi("disposeFramebuffer"),this.multisample=I.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new yi(null,{scaleMode:b.NEAREST,resolution:1,mipmap:v.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new yi(null,{scaleMode:b.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:v.OFF,format:m.DEPTH_COMPONENT,type:x.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const r=this.colorTextures[s],n=r.resolution;r.setSize(t/n,e/n)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Na extends yi{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=I.NONE),super(null,t),this.mipmap=v.OFF,this.valid=!0,this._clear=new Nn([0,0,0,0]),this.framebuffer=new Da(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ba extends pi{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.displayWidth||e.width,e.naturalHeight||e.videoHeight||e.displayHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,s){void 0!==s||e.startsWith("data:")?!1!==s&&(t.crossOrigin="string"==typeof s?s:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const s=new URL(t,document.baseURI);return s.hostname!==e.hostname||s.port!==e.port||s.protocol!==e.protocol?"anonymous":""}(e)}upload(t,e,s,r){const n=t.gl,i=e.realWidth,a=e.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||0===r.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===E.UNPACK),this.noSubImage||e.target!==n.TEXTURE_2D||s.width!==i||s.height!==a?(s.width=i,s.height=a,n.texImage2D(e.target,0,s.internalFormat,e.format,s.type,r)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,s.type,r),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;this.resize(e,s),super.update()}dispose(){this.source=null}}class Oa extends Ba{constructor(t,e){if(e=e||{},"string"==typeof t){const s=new Image;Ba.crossOrigin(s,t,e.crossorigin),s.src=t,t=s}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??M.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const s=this.source;this.url=s.src;const r=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?r():(s.onload=r,s.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,s=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:s?"cors":"no-cors"}).then((t=>t.blob())).then((s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===E.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,s){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,s,this.bitmap),!this.preserveBitmap){let t=!0;const r=e._glTextures;for(const n in r){const i=r[n];if(i!==s&&i.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}class La{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,s){const r=e.width,n=e.height;if(s){const e=t.width/2/r,i=t.height/2/n,a=t.x/r+e,o=t.y/n+i;s=zi.add(s,zi.NW),this.x0=a+e*zi.uX(s),this.y0=o+i*zi.uY(s),s=zi.add(s,2),this.x1=a+e*zi.uX(s),this.y1=o+i*zi.uY(s),s=zi.add(s,2),this.x2=a+e*zi.uX(s),this.y2=o+i*zi.uY(s),s=zi.add(s,2),this.x3=a+e*zi.uX(s),this.y3=o+i*zi.uY(s)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}La.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Va=new La;function Ua(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Xa extends q{constructor(t,e,s,r,n,i,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Ni(0,0,1,1)),t instanceof Xa&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this.destroyed=!1,this._uvs=Va,this.uvMatrix=null,this.orig=s||e,this._rotate=Number(n||0),!0===n)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=i?new Fi(i.x,i.y):new Fi(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;(null==t?void 0:t.url)&&Zn[t.url]&&Xa.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Xa.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var t;const e=this._frame.clone(),s=this._frame===this.orig?e:this.orig.clone(),r=new Xa(this.baseTexture,!this.noFrame&&e,s,null==(t=this.trim)?void 0:t.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===Va&&(this._uvs=new La),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},s=M.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let n=null;if(r)n=t;else if(t instanceof yi){if(!t.cacheId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${s}-${$n()}`,yi.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${s}_${$n()}`}n=t._pixiId}let i=Zn[n];if(r&&s&&!i)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return i||t instanceof yi?!i&&t instanceof yi&&(i=new Xa(t),Xa.addToCache(i,n)):(e.resolution||(e.resolution=si(t)),i=new Xa(new yi(t,e)),i.baseTexture.cacheId=n,yi.addToCache(i.baseTexture,n),Xa.addToCache(i,n)),i}static fromURL(t,e){const s=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),r=Xa.from(t,Object.assign({resourceOptions:s},e),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then((()=>Promise.resolve(r)))}static fromBuffer(t,e,s,r){return new Xa(yi.fromBuffer(t,e,s,r))}static fromLoader(t,e,s,r){const n=new yi(t,Object.assign({scaleMode:yi.defaultOptions.scaleMode,resolution:si(e)},r)),{resource:i}=n;i instanceof Oa&&(i.url=e);const a=new Xa(n);return s||(s=e),yi.addToCache(a.baseTexture,s),Xa.addToCache(a,s),s!==e&&(yi.addToCache(a.baseTexture,e),Xa.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise((t=>{a.baseTexture.once("loaded",(()=>t(a)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Zn[e]&&Zn[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Zn[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Zn[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete Zn[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Zn[t.textureCacheIds[e]]===t&&delete Zn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:s,width:r,height:n}=t,i=e+r>this.baseTexture.width,a=s+n>this.baseTexture.height;if(i||a){const t=i&&a?"and":"or",o=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,h=`Y: ${s} + ${n} = ${s+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${o} ${t} ${h}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Xa._EMPTY||(Xa._EMPTY=new Xa(new yi),Ua(Xa._EMPTY),Ua(Xa._EMPTY.baseTexture)),Xa._EMPTY}static get WHITE(){if(!Xa._WHITE){const t=M.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Xa._WHITE=new Xa(yi.from(t)),Ua(Xa._WHITE),Ua(Xa._WHITE.baseTexture)}return Xa._WHITE}}class Ya extends Xa{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,s=!0){const r=this.baseTexture.resolution,n=Math.round(t*r)/r,i=Math.round(e*r)/r;this.valid=n>0&&i>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=i,s&&this.baseTexture.resize(n,i),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ya(new Na(t))}}class Ga{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,s=I.NONE){const r=new Na(Object.assign({width:t,height:e,resolution:1,multisample:s},this.textureOptions));return new Ya(r)}getOptimalTexture(t,e,s=1,r=I.NONE){let n;t=Math.max(Math.ceil(t*s-1e-6),1),e=Math.max(Math.ceil(e*s-1e-6),1),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?n=r>1?-r:-1:(n=((65535&(t=Un(t)))<<16|65535&(e=Un(e)))>>>0,r>1&&(n+=4294967296*r)),this.texturePool[n]||(this.texturePool[n]=[]);let i=this.texturePool[n].pop();return i||(i=this.createTexture(t,e,r)),i.filterPoolKey=n,i.setResolution(s),i}getFilterTexture(t,e,s){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,s||I.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Ga.SCREEN_KEY=-1;class Wa extends Ii{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ha extends Ii{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new vi(this.vertices),this.uvBuffer=new vi(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let s=0,r=0;return this.uvs[0]=s,this.uvs[1]=r,this.uvs[2]=s+e.width/t.width,this.uvs[3]=r,this.uvs[4]=s+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=s,this.uvs[7]=r+e.height/t.height,s=e.x,r=e.y,this.vertices[0]=s,this.vertices[1]=r,this.vertices[2]=s+e.width,this.vertices[3]=r,this.vertices[4]=s+e.width,this.vertices[5]=r+e.height,this.vertices[6]=s,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class $a{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=I.NONE,this.sourceFrame=new Ni,this.destinationFrame=new Ni,this.bindingSourceFrame=new Ni,this.bindingDestinationFrame=new Ni,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ja=[new Fi,new Fi,new Fi,new Fi],za=new Ui;class qa{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Ga,this.statePool=[],this.quad=new Wa,this.quadUv=new Ha,this.tempRect=new Ni,this.activeState={},this.globalUniforms=new va({outputFrame:new Ni,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const s=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new $a,i=s.renderTexture;let a,o;if(i.current){const t=i.current;a=t.resolution,o=t.multisample}else a=s.resolution,o=s.multisample;let h=e[0].resolution||a,l=e[0].multisample??o,c=e[0].padding,u=e[0].autoFit,d=e[0].legacy??!0;for(let m=1;m<e.length;m++){const t=e[m];h=Math.min(h,t.resolution||a),l=Math.min(l,t.multisample??o),c=this.useMaxPadding?Math.max(c,t.padding):c+t.padding,u=u&&t.autoFit,d=d||(t.legacy??!0)}1===r.length&&(this.defaultFilterStack[0].renderTexture=i.current),r.push(n),n.resolution=h,n.multisample=l,n.legacy=d,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(c);const f=this.tempRect.copyFrom(i.sourceFrame);s.projection.transform&&this.transformAABB(za.copyFrom(s.projection.transform).invert(),f),u?(n.sourceFrame.fit(f),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(f)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,i.current?i.current.resolution:s.resolution,i.sourceFrame,i.destinationFrame,s.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,h,l),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=n.sourceFrame.width,p.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(i.sourceFrame),n.bindingDestinationFrame.copyFrom(i.destinationFrame),n.transform=s.projection.transform,s.projection.transform=null,i.bind(n.renderTexture,n.sourceFrame,p),s.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),s=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const n=r.inputSize,i=r.inputPixel,a=r.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],i[0]=Math.round(n[0]*e.resolution),i[1]=Math.round(n[1]*e.resolution),i[2]=1/i[0],i[3]=1/i[1],a[0]=.5*i[2],a[1]=.5*i[3],a[2]=e.sourceFrame.width*n[2]-.5*i[2],a[3]=e.sourceFrame.height*n[3]-.5*i[3],e.legacy){const t=r.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const o=t[t.length-1];if(this.renderer.framebuffer.blit(),1===s.length)s[0].apply(this,e.renderTexture,o.renderTexture,w.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,r=this.getOptimalFilterTexture(t.width,t.height,e.resolution);r.filterFrame=t.filterFrame;let n=0;for(n=0;n<s.length-1;++n){1===n&&e.multisample>1&&(r=this.getOptimalFilterTexture(t.width,t.height,e.resolution),r.filterFrame=t.filterFrame),s[n].apply(this,t,r,w.CLEAR,e);const i=t;t=r,r=i}s[n].apply(this,t,o.renderTexture,w.BLEND,e),n>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(r)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=w.CLEAR){const{renderTexture:s,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,null==t?void 0:t.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,s.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=1&r.stateId||this.forceClear;(e===w.CLEAR||e===w.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,s,r){const n=this.renderer;n.state.set(t.state),this.bindAndClear(s,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(p.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(p.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:s,destinationFrame:r}=this.activeState,{orig:n}=e._texture,i=t.set(r.width,0,0,r.height,s.x,s.y),a=e.worldTransform.copyTo(Ui.TEMP_MATRIX);return a.invert(),i.prepend(a),i.scale(1/n.width,1/n.height),i.translate(e.anchor.x,e.anchor.y),i}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,s=1,r=I.NONE){return this.texturePool.getOptimalTexture(t,e,s,r)}getFilterTexture(t,e,s){if("number"==typeof t){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,s||I.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const s=ja[0],r=ja[1],n=ja[2],i=ja[3];s.set(e.left,e.top),r.set(e.left,e.bottom),n.set(e.right,e.top),i.set(e.right,e.bottom),t.apply(s,s),t.apply(r,r),t.apply(n,n),t.apply(i,i);const a=Math.min(s.x,r.x,n.x,i.x),o=Math.min(s.y,r.y,n.y,i.y),h=Math.max(s.x,r.x,n.x,i.x),l=Math.max(s.y,r.y,n.y,i.y);e.x=a,e.y=o,e.width=h-a,e.height=l-o}roundFrame(t,e,s,r,n){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(n){const{a:t,b:e,c:s,d:r}=n;if((Math.abs(e)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4))return}(n=n?za.copyFrom(n):za.identity()).translate(-s.x,-s.y).scale(r.width/s.width,r.height/s.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}qa.extension={type:ri.RendererSystem,name:"filter"},ai.add(qa);class Za{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=I.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Ka=new Ni;class Qa{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Da(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ni,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;M.PREFER_ENV===c.WEBGL_LEGACY&&(e=null,s=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,s=0){const{gl:r}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=s),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const s=t.colorTextures[e];this.renderer.texture.unbind(s.parentTextureArray||s)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>s,r=e.height>>s,n=t/e.width;this.setViewport(e.x*n,e.y*n,t,r)}else{const e=t.width>>s,r=t.height>>s;this.setViewport(0,0,e,r)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,s,r){const n=this.viewport;t=Math.round(t),e=Math.round(e),s=Math.round(s),r=Math.round(r),(n.width!==s||n.height!==r||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=s,n.height=r,this.gl.viewport(t,e,s,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,s,r,n=d.COLOR|d.DEPTH){const{gl:i}=this;i.clearColor(t,e,s,r),i.clear(n)}initFramebuffer(t){const{gl:e}=this,s=new Za(e.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:e}=this,s=t.glFramebuffers[this.CONTEXT_UID];if(s.stencil){let r;e.bindRenderbuffer(e.RENDERBUFFER,s.stencil),r=1===this.renderer.context.webGLVersion?e.DEPTH_STENCIL:t.depth&&t.stencil?e.DEPTH24_STENCIL8:t.depth?e.DEPTH_COMPONENT24:e.STENCIL_INDEX8,s.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,r,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,r,t.width,t.height)}const r=t.colorTextures;let n=r.length;e.drawBuffers||(n=Math.min(n,1));for(let i=0;i<n;i++){const n=r[i],a=n.parentTextureArray||n;this.renderer.texture.bind(a,0),0===i&&s.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,s.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,a._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:s}=this,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let i=n.length;s.drawBuffers||(i=Math.min(i,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||s.createRenderbuffer():r.msaaBuffer&&(s.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const a=[];for(let o=0;o<i;o++){const i=n[o],h=i.parentTextureArray||i;this.renderer.texture.bind(h,0),0===o&&r.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,r.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,r.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+o,i.target,h._glTextures[this.CONTEXT_UID].texture,e),a.push(s.COLOR_ATTACHMENT0+o))}if(a.length>1&&s.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const r=t.depthTexture;this.renderer.texture.bind(r,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,r._glTextures[this.CONTEXT_UID].texture,e)}if(!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture)r.stencil&&(s.deleteRenderbuffer(r.stencil),r.stencil=null);else{let e,n;r.stencil=r.stencil||s.createRenderbuffer(),1===this.renderer.context.webGLVersion?(e=s.DEPTH_STENCIL_ATTACHMENT,n=s.DEPTH_STENCIL):t.depth&&t.stencil?(e=s.DEPTH_STENCIL_ATTACHMENT,n=s.DEPTH24_STENCIL8):t.depth?(e=s.DEPTH_ATTACHMENT,n=s.DEPTH_COMPONENT24):(e=s.STENCIL_ATTACHMENT,n=s.STENCIL_INDEX8),s.bindRenderbuffer(s.RENDERBUFFER,r.stencil),r.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,n,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,n,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,e,s.RENDERBUFFER,r.stencil)}}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let s=I.NONE;if(t<=1||null===e)return s;for(let r=0;r<e.length;r++)if(e[r]<=t){s=e[r];break}return 1===s&&(s=I.NONE),s}blit(t,e,s){const{current:r,renderer:n,gl:i,CONTEXT_UID:a}=this;if(2!==n.context.webGLVersion||!r)return;const o=r.glFramebuffers[a];if(!o)return;if(!t){if(!o.msaaBuffer)return;const e=r.colorTextures[0];if(!e)return;o.blitFramebuffer||(o.blitFramebuffer=new Da(r.width,r.height),o.blitFramebuffer.addColorTexture(0,e)),(t=o.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||((e=Ka).width=r.width,e.height=r.height),s||(s=e);const h=e.width===s.width&&e.height===s.height;this.bind(t),i.bindFramebuffer(i.READ_FRAMEBUFFER,o.framebuffer),i.blitFramebuffer(e.left,e.top,e.right,e.bottom,s.left,s.top,s.right,s.bottom,i.COLOR_BUFFER_BIT,h?i.NEAREST:i.LINEAR),i.bindFramebuffer(i.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const s=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&r.deleteRenderbuffer(s.msaaBuffer),s.stencil&&r.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&this.disposeFramebuffer(s.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<e.length;s++)this.disposeFramebuffer(e[s],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const s=t.width,r=t.height,n=this.gl,i=e.stencil=n.createRenderbuffer();let a,o;n.bindRenderbuffer(n.RENDERBUFFER,i),1===this.renderer.context.webGLVersion?(a=n.DEPTH_STENCIL_ATTACHMENT,o=n.DEPTH_STENCIL):t.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,o=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,o=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,o,s,r):n.renderbufferStorage(n.RENDERBUFFER,o,s,r),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,i)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ni}destroy(){this.renderer=null}}Qa.extension={type:ri.RendererSystem,name:"framebuffer"},ai.add(Qa);const Ja={5126:4,5123:2,5121:1};class to{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;M.PREFER_ENV===c.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,s)=>e.vertexAttribDivisorANGLE(t,s),t.drawElementsInstanced=(t,s,r,n,i)=>e.drawElementsInstancedANGLE(t,s,r,n,i),t.drawArraysInstanced=(t,s,r,n)=>e.drawArraysInstancedANGLE(t,s,r,n)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:s}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const i=r[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==i&&(this._activeVao=i,this.hasVao?s.bindVertexArray(i):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++){const r=t.buffers[s];e.update(r)}}checkCompatibility(t,e){const s=t.attributes,r=e.attributeData;for(const n in r)if(!s[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const s=t.attributes,r=e.attributeData,n=["g",t.id];for(const i in s)r[i]&&n.push(i,r[i].location);return n.join("-")}initGeometryVao(t,e,s=!0){const r=this.gl,n=this.CONTEXT_UID,i=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const o=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[o];if(l)return h[a.id]=l,l;const c=t.buffers,u=t.attributes,d={},f={};for(const p in c)d[p]=0,f[p]=0;for(const p in u)!u[p].size&&a.attributeData[p]?u[p].size=a.attributeData[p].size:u[p].size||console.warn(`PIXI Geometry attribute '${p}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[p].buffer]+=u[p].size*Ja[u[p].type];for(const p in u){const t=u[p],e=t.size;void 0===t.stride&&(d[t.buffer]===e*Ja[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=f[t.buffer],f[t.buffer]+=e*Ja[t.type])}l=r.createVertexArray(),r.bindVertexArray(l);for(let p=0;p<c.length;p++){const t=c[p];i.bind(t),s&&t._glBuffers[n].refCount++}return this.activateVao(t,a),h[a.id]=l,h[o]=l,r.bindVertexArray(null),i.unbind(R.ARRAY_BUFFER),l}disposeGeometry(t,e){var s;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,i=t.buffers,a=null==(s=this.renderer)?void 0:s.buffer;if(t.disposeRunner.remove(this),r){if(a)for(let t=0;t<i.length;t++){const s=i[t]._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0===s.refCount&&!e&&a.dispose(i[t],e))}if(!e)for(const t in r)if("g"===t[0]){const e=r[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let s=0;s<e.length;s++)this.disposeGeometry(this.managedGeometries[e[s]],t)}activateVao(t,e){const s=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,i=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let o=null;for(const h in a){const t=a[h],l=i[t.buffer],c=l._glBuffers[r];if(e.attributeData[h]){o!==c&&(n.bind(l),o=c);const r=e.attributeData[h].location;if(s.enableVertexAttribArray(r),s.vertexAttribPointer(r,t.size,t.type||s.FLOAT,t.normalized,t.stride,t.start),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");s.vertexAttribDivisor(r,t.divisor)}}}}draw(t,e,s,r){const{gl:n}=this,i=this._activeGeometry;if(i.indexBuffer){const a=i.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?i.instanced?n.drawElementsInstanced(t,e||i.indexBuffer.data.length,o,(s||0)*a,r||1):n.drawElements(t,e||i.indexBuffer.data.length,o,(s||0)*a):console.warn("unsupported index buffer type: uint32")}else i.instanced?n.drawArraysInstanced(t,s,e||i.getSize(),r||1):n.drawArrays(t,s,e||i.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}to.extension={type:ri.RendererSystem,name:"geometry"},ai.add(to);const eo=new Ui;class so{constructor(t,e){this._texture=t,this.mapCoord=new Ui,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const s=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],i=t[r+1];e[r]=n*s.a+i*s.c+s.tx,e[r+1]=n*s.b+i*s.d+s.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const s=e._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const r=e.orig,n=e.trim;n&&(eo.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(eo));const i=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/i.resolution,h=this.clampOffset;return a[0]=(e._frame.x+o+h)/i.width,a[1]=(e._frame.y+o+h)/i.height,a[2]=(e._frame.x+e._frame.width-o+h)/i.width,a[3]=(e._frame.y+e._frame.height-o+h)/i.height,this.uClampOffset[0]=h/i.realWidth,this.uClampOffset[1]=h/i.realHeight,this.isSimple=e._frame.width===i.width&&e._frame.height===i.height&&0===e.rotate,!0}}class ro extends Ma{constructor(t,e,s){let r=null;"string"!=typeof t&&void 0===e&&void 0===s&&(r=t,t=void 0,e=void 0,s=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",s),this.maskSprite=r,this.maskMatrix=new Ui}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,s,r){const n=this._maskSprite,i=n._texture;i.valid&&(i.uvMatrix||(i.uvMatrix=new so(i,0)),i.uvMatrix.update(),this.uniforms.npmAlpha=i.baseTexture.alphaMode?0:1,this.uniforms.mask=i,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(i.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=i.uvMatrix.uClampFrame,t.applyFilter(this,e,s,r))}}class no{constructor(t=null){this.type=S.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ma.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=S.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class io{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let s=e;if(!s.isMaskData){const t=this.maskDataPool.pop()||new no;t.pooled=!0,t.maskObject=e,s=t}const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(r),s._colorMask=r?r._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==S.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case S.SCISSOR:this.renderer.scissor.push(s);break;case S.STENCIL:this.renderer.stencil.push(s);break;case S.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case S.COLOR:this.pushColorMask(s)}s.type===S.SPRITE&&this.maskStack.push(s)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case S.SCISSOR:this.renderer.scissor.pop(e);break;case S.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case S.SPRITE:this.popSpriteMask(e);break;case S.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===S.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=S.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=S.SCISSOR:t.type=S.STENCIL:t.type=S.COLOR}pushSpriteMask(t){const{maskObject:e}=t,s=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new ro])),r[0].resolution=t.resolution,r[0].multisample=t.multisample,r[0].maskSprite=e;const n=s.filterArea;s.filterArea=e.getBounds(!0),this.renderer.filter.push(s,r),s.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,s=t._colorMask=e&t.colorMask;s!==e&&this.renderer.gl.colorMask(!!(1&s),!!(2&s),!!(4&s),!!(8&s))}popColorMask(t){const e=t._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==e&&this.renderer.gl.colorMask(!!(1&s),!!(2&s),!!(4&s),!!(8&s))}destroy(){this.renderer=null}}io.extension={type:ri.RendererSystem,name:"mask"},ai.add(io);class ao{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,s=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==s&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const oo=new Ui,ho=[],lo=class t extends ao{constructor(t){super(t),this.glConst=M.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:s}=t,{renderer:r}=this,n=r.renderTexture,i=s.getBounds(!0,ho.pop()??new Ni);this.roundFrameToPixels(i,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),e&&i.fit(e),t._scissorRectLocal=i}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:s,c:r,d:n}=t;return(Math.abs(s)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:s}=e;if(!s.isFastRect||!s.isFastRect()||t.isMatrixRotated(s.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,s,r,n,i){t.isMatrixRotated(i)||((i=i?oo.copyFrom(i):oo.identity()).translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(i,e),e.fit(n),e.x=Math.round(e.x*s),e.y=Math.round(e.y*s),e.width=Math.round(e.width*s),e.height=Math.round(e.height*s))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&ho.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};lo.extension={type:ri.RendererSystem,name:"scissor"};let co=lo;ai.add(co);class uo extends ao{constructor(t){super(t),this.glConst=M.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:s}=this.renderer,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;0!==n&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,r,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==n&&(t._colorMask=n,s.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,r=s?s._colorMask:15;0!==r&&(s._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(s._colorMask=r,e.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}uo.extension={type:ri.RendererSystem,name:"stencil"},ai.add(uo);class fo{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Jr("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(Jr("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(Jr("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}fo.extension={type:[ri.RendererSystem,ri.CanvasRendererSystem],name:"_plugin"},ai.add(fo);class po{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ui,this.transform=null}update(t,e,s,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,s,r){const n=this.projectionMatrix,i=r?-1:1;n.identity(),n.a=1/e.width*2,n.d=i*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-i-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}po.extension={type:ri.RendererSystem,name:"projection"},ai.add(po);const mo=new Ki,go=new Ni;class xo{constructor(t){this.renderer=t,this._tempMatrix=new Ui}generateTexture(t,e){const{region:s,...r}=e||{},n=(null==s?void 0:s.copyTo(go))||t.getLocalBounds(go,!0),i=r.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/i),n.height=Math.max(n.height,1/i),r.width=n.width,r.height=n.height,r.resolution=i,r.multisample??(r.multisample=this.renderer.multisample);const a=Ya.create(r);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const o=t.transform;return t.transform=mo,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}xo.extension={type:[ri.RendererSystem,ri.CanvasRendererSystem],name:"textureGenerator"},ai.add(xo);const yo=new Ni,bo=new Ni;class _o{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ni,this.destinationFrame=new Ni,this.viewportFrame=new Ni}contextChange(){var t;const e=null==(t=this.renderer)?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(t=null,e,s){const r=this.renderer;let n,i,a;this.current=t,t?(n=t.baseTexture,a=n.resolution,e||(yo.width=t.frame.width,yo.height=t.frame.height,e=yo),s||(bo.x=t.frame.x,bo.y=t.frame.y,bo.width=e.width,bo.height=e.height,s=bo),i=n.framebuffer):(a=r.resolution,e||(yo.width=r._view.screen.width,yo.height=r._view.screen.height,e=yo),s||((s=yo).width=e.width,s.height=e.height));const o=this.viewportFrame;o.x=s.x*a,o.y=s.y*a,o.width=s.width*a,o.height=s.height*a,t||(o.y=r.view.height-(o.y+o.height)),o.ceil(),this.renderer.framebuffer.bind(i,o),this.renderer.projection.update(s,e,a,!i),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(s)}clear(t,e){const s=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=Nn.shared.setValue(t||s);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const n=this.destinationFrame,i=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==i.width||n.height!==i.height;if(a){let{x:t,y:e,width:s,height:r}=this.viewportFrame;t=Math.round(t),e=Math.round(e),s=Math.round(s),r=Math.round(r),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,s,r)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}_o.extension={type:ri.RendererSystem,name:"renderTexture"},ai.add(_o);class vo{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Eo(t,e){var s;const r=Qi(t,t.VERTEX_SHADER,e.vertexSrc),n=Qi(t,t.FRAGMENT_SHADER,e.fragmentSrc),i=t.createProgram();t.attachShader(i,r),t.attachShader(i,n);const a=null==(s=e.extra)?void 0:s.transformFeedbackVaryings;if(a&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(i,a.names,"separate"===a.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||function(t,e,s,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(s,t.COMPILE_STATUS)||ha(t,s),t.getShaderParameter(r,t.COMPILE_STATUS)||ha(t,r),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,i,r,n),e.attributeData=function(t,e){const s={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const r=e.getActiveAttrib(t,n);if(r.name.startsWith("gl_"))continue;const i=fa(e,r.type),a={type:i,name:r.name,size:ca(i),location:e.getAttribLocation(t,r.name)};s[r.name]=a}return s}(i,t),e.uniformData=function(t,e){const s={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const r=e.getActiveUniform(t,n),i=r.name.replace(/\[.*?\]$/,""),a=!!r.name.match(/\[.*?\]$/),o=fa(e,r.type);s[i]={name:i,index:n,type:o,size:r.size,isArray:a,value:ta(o,r.size)}}return s}(i,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const s=Object.keys(e.attributeData);s.sort(((t,e)=>t>e?1:-1));for(let r=0;r<s.length;r++)e.attributeData[s[r]].location=r,t.bindAttribLocation(i,r,s[r]);t.linkProgram(i)}t.deleteShader(r),t.deleteShader(n);const o={};for(const h in e.uniformData){const s=e.uniformData[h];o[h]={location:t.getUniformLocation(i,h),value:ta(s.type,s.size)}}return new vo(i,o)}function wo(t,e,s,r,n){s.buffer.update(n)}const Ao={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},To={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function So(t,e){if(!t.autoManage)return{size:0,syncFunc:wo};const s=function(t,e){const s=[];for(const r in t)e[r]&&s.push(e[r]);return s.sort(((t,e)=>t.index-e.index)),s}(t.uniforms,e),{uboElements:r,size:n}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let s=0,r=0,n=0;for(let i=0;i<e.length;i++){const t=e[i];if(s=To[t.data.type],t.data.size>1&&(s=Math.max(s,16)*t.data.size),t.dataLen=s,r%s!=0&&r<16){const t=r%s%16;r+=t,n+=t}r+s>16?(n=16*Math.ceil(n/16),t.offset=n,n+=s,r=s):(t.offset=n,r+=s,n+=s)}return n=16*Math.ceil(n/16),{uboElements:e,size:n}}(s),i=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let a=0;a<r.length;a++){const e=r[a],s=t.uniforms[e.data.name],n=e.data.name;let o=!1;for(let t=0;t<ea.length;t++){const r=ea[t];if(r.codeUbo&&r.test(e.data,s)){i.push(`offset = ${e.offset/4};`,ea[t].codeUbo(e.data.name,s)),o=!0;break}}if(!o)if(e.data.size>1){const t=ca(e.data.type),s=Math.max(To[e.data.type]/16,1),r=t/s,a=(4-r%4)%4;i.push(`\n                cv = ud.${n}.value;\n                v = uv.${n};\n                offset = ${e.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${e.data.size*s}; i++)\n                {\n                    for(var j = 0; j < ${r}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${a};\n                }\n\n                `)}else{const t=Ao[e.data.type];i.push(`\n                cv = ud.${n}.value;\n                v = uv.${n};\n                offset = ${e.offset/4};\n                ${t};\n                `)}}return i.push("\n       renderer.buffer.update(buffer);\n    "),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",i.join("\n"))}}let Io=0;const Ro={textureCount:0,uboCount:0};class Mo{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Io++}systemCheck(){if(!function(){if("boolean"==typeof ma)return ma;try{ma=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{ma=!1}return ma}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,r=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(r.program)),e||(Ro.textureCount=0,Ro.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ro)),r}setUniforms(t){const e=this.shader.program,s=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(s.uniformData,t,this.renderer)}syncUniformGroup(t,e){const s=this.getGlProgram();(!t.static||t.dirtyId!==s.uniformDirtyGroups[t.id])&&(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,e))}syncUniforms(t,e,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var s;const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const i=e[n];if(!i){!0===(null==(s=t.uniforms[n])?void 0:s.group)&&(t.uniforms[n].ubo?r.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):r.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const a=t.uniforms[n];let o=!1;for(let t=0;t<ea.length;t++)if(ea[t].test(i,a)){r.push(ea[t].code(n,a)),o=!0;break}if(!o){const t=(1!==i.size||i.isArray?ra:sa)[i.type].replace("location",`ud["${n}"].location`);r.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const s=this.getGlProgram();if(!t.static||0!==t.dirtyId||!s.uniformGroups[t.id]){t.dirtyId=0;const r=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,e);t.buffer.update(),r(s.uniformData,t.uniforms,this.renderer,Ro,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[e])}createSyncBufferGroup(t,e,s){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,s);e.uniformBufferBindings[s]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const i=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[i];if(a||(a=this._uboCache[i]=So(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(a.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,s){const r=t.uniforms,n=[`${s}-`];for(const i in r)n.push(i),e[i]&&n.push(e[i].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,s=t.program,r=Eo(e,s);return s.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Mo.extension={type:ri.RendererSystem,name:"shader"},ai.add(Mo);class Co{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Co.defaultOptions={hello:!1},Co.extension={type:[ri.RendererSystem,ri.CanvasRendererSystem],name:"startup"},ai.add(Co);const Po=class t{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=f.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ci,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[f.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.ADD]=[t.ONE,t.ONE],e[f.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.NONE]=[0,0],e[f.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[f.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[f.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[f.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[f.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[f.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[f.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[f.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[f.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[f.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[f.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,s=0;for(;e;)1&e&&this.map[s].call(this,!!(t.data&1<<s)),e>>=1,s++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],s=this.gl;2===e.length?s.blendFunc(e[0],e[1]):s.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,s.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const s=this.checks.indexOf(t);e&&-1===s?this.checks.push(t):!e&&-1!==s&&this.checks.splice(s,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Po.extension={type:ri.RendererSystem,name:"state"};let ko=Po;ai.add(ko);class Fo extends q{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),s=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const r of s)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach((t=>{this.runners[t]=new fi(t)}))}addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const r in this.runners)this.runners[r].add(s);return this}emitWithCustomOptions(t,e){const s=Object.keys(this._systemsHash);t.items.forEach((r=>{const n=s.find((t=>this._systemsHash[t]===r));r[t.name](e[n])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Do=class t{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=t.defaultMaxIdle,this.checkCountMax=t.defaultCheckCountMax,this.mode=t.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==A.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let s=!1;for(let r=0;r<e.length;r++){const n=e[r];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[r]=null,s=!0)}if(s){let t=0;for(let s=0;s<e.length;s++)null!==e[s]&&(e[t++]=e[s]);e.length=t}}unload(t){const e=this.renderer.texture,s=t._texture;s&&!s.framebuffer&&e.destroyTexture(s);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}};Do.defaultMode=A.AUTO,Do.defaultMaxIdle=3600,Do.defaultCheckCountMax=600,Do.extension={type:ri.RendererSystem,name:"textureGC"};let No=Do;ai.add(No);class Bo{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=x.UNSIGNED_BYTE,this.internalFormat=m.RGBA,this.samplerType=0}}class Oo{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new yi,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[x.UNSIGNED_BYTE]:{[m.RGBA]:t.RGBA8,[m.RGB]:t.RGB8,[m.RG]:t.RG8,[m.RED]:t.R8,[m.RGBA_INTEGER]:t.RGBA8UI,[m.RGB_INTEGER]:t.RGB8UI,[m.RG_INTEGER]:t.RG8UI,[m.RED_INTEGER]:t.R8UI,[m.ALPHA]:t.ALPHA,[m.LUMINANCE]:t.LUMINANCE,[m.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[x.BYTE]:{[m.RGBA]:t.RGBA8_SNORM,[m.RGB]:t.RGB8_SNORM,[m.RG]:t.RG8_SNORM,[m.RED]:t.R8_SNORM,[m.RGBA_INTEGER]:t.RGBA8I,[m.RGB_INTEGER]:t.RGB8I,[m.RG_INTEGER]:t.RG8I,[m.RED_INTEGER]:t.R8I},[x.UNSIGNED_SHORT]:{[m.RGBA_INTEGER]:t.RGBA16UI,[m.RGB_INTEGER]:t.RGB16UI,[m.RG_INTEGER]:t.RG16UI,[m.RED_INTEGER]:t.R16UI,[m.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[x.SHORT]:{[m.RGBA_INTEGER]:t.RGBA16I,[m.RGB_INTEGER]:t.RGB16I,[m.RG_INTEGER]:t.RG16I,[m.RED_INTEGER]:t.R16I},[x.UNSIGNED_INT]:{[m.RGBA_INTEGER]:t.RGBA32UI,[m.RGB_INTEGER]:t.RGB32UI,[m.RG_INTEGER]:t.RG32UI,[m.RED_INTEGER]:t.R32UI,[m.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[x.INT]:{[m.RGBA_INTEGER]:t.RGBA32I,[m.RGB_INTEGER]:t.RGB32I,[m.RG_INTEGER]:t.RG32I,[m.RED_INTEGER]:t.R32I},[x.FLOAT]:{[m.RGBA]:t.RGBA32F,[m.RGB]:t.RGB32F,[m.RG]:t.RG32F,[m.RED]:t.R32F,[m.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[x.HALF_FLOAT]:{[m.RGBA]:t.RGBA16F,[m.RGB]:t.RGB16F,[m.RG]:t.RG16F,[m.RED]:t.R16F},[x.UNSIGNED_SHORT_5_6_5]:{[m.RGB]:t.RGB565},[x.UNSIGNED_SHORT_4_4_4_4]:{[m.RGBA]:t.RGBA4},[x.UNSIGNED_SHORT_5_5_5_1]:{[m.RGBA]:t.RGB5_A1},[x.UNSIGNED_INT_2_10_10_10_REV]:{[m.RGBA]:t.RGB10_A2,[m.RGBA_INTEGER]:t.RGB10_A2UI},[x.UNSIGNED_INT_10F_11F_11F_REV]:{[m.RGB]:t.R11F_G11F_B10F},[x.UNSIGNED_INT_5_9_9_9_REV]:{[m.RGB]:t.RGB9_E5},[x.UNSIGNED_INT_24_8]:{[m.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[x.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[m.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[x.UNSIGNED_BYTE]:{[m.RGBA]:t.RGBA,[m.RGB]:t.RGB,[m.ALPHA]:t.ALPHA,[m.LUMINANCE]:t.LUMINANCE,[m.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[x.UNSIGNED_SHORT_5_6_5]:{[m.RGB]:t.RGB},[x.UNSIGNED_SHORT_4_4_4_4]:{[m.RGBA]:t.RGBA},[x.UNSIGNED_SHORT_5_5_5_1]:{[m.RGBA]:t.RGBA}},e}(t),this.samplerTypes=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[t.RGB]:y.FLOAT,[t.RGBA]:y.FLOAT,[t.ALPHA]:y.FLOAT,[t.LUMINANCE]:y.FLOAT,[t.LUMINANCE_ALPHA]:y.FLOAT,[t.R8]:y.FLOAT,[t.R8_SNORM]:y.FLOAT,[t.RG8]:y.FLOAT,[t.RG8_SNORM]:y.FLOAT,[t.RGB8]:y.FLOAT,[t.RGB8_SNORM]:y.FLOAT,[t.RGB565]:y.FLOAT,[t.RGBA4]:y.FLOAT,[t.RGB5_A1]:y.FLOAT,[t.RGBA8]:y.FLOAT,[t.RGBA8_SNORM]:y.FLOAT,[t.RGB10_A2]:y.FLOAT,[t.RGB10_A2UI]:y.FLOAT,[t.SRGB8]:y.FLOAT,[t.SRGB8_ALPHA8]:y.FLOAT,[t.R16F]:y.FLOAT,[t.RG16F]:y.FLOAT,[t.RGB16F]:y.FLOAT,[t.RGBA16F]:y.FLOAT,[t.R32F]:y.FLOAT,[t.RG32F]:y.FLOAT,[t.RGB32F]:y.FLOAT,[t.RGBA32F]:y.FLOAT,[t.R11F_G11F_B10F]:y.FLOAT,[t.RGB9_E5]:y.FLOAT,[t.R8I]:y.INT,[t.R8UI]:y.UINT,[t.R16I]:y.INT,[t.R16UI]:y.UINT,[t.R32I]:y.INT,[t.R32UI]:y.UINT,[t.RG8I]:y.INT,[t.RG8UI]:y.UINT,[t.RG16I]:y.INT,[t.RG16UI]:y.UINT,[t.RG32I]:y.INT,[t.RG32UI]:y.UINT,[t.RGB8I]:y.INT,[t.RGB8UI]:y.UINT,[t.RGB16I]:y.INT,[t.RGB16UI]:y.UINT,[t.RGB32I]:y.INT,[t.RGB32UI]:y.UINT,[t.RGBA8I]:y.INT,[t.RGBA8UI]:y.UINT,[t.RGBA16I]:y.INT,[t.RGBA16UI]:y.UINT,[t.RGBA32I]:y.INT,[t.RGBA32UI]:y.UINT,[t.DEPTH_COMPONENT16]:y.FLOAT,[t.DEPTH_COMPONENT24]:y.FLOAT,[t.DEPTH_COMPONENT32F]:y.FLOAT,[t.DEPTH_STENCIL]:y.FLOAT,[t.DEPTH24_STENCIL8]:y.FLOAT,[t.DEPTH32F_STENCIL8]:y.FLOAT}:{[t.RGB]:y.FLOAT,[t.RGBA]:y.FLOAT,[t.ALPHA]:y.FLOAT,[t.LUMINANCE]:y.FLOAT,[t.LUMINANCE_ALPHA]:y.FLOAT,[t.DEPTH_STENCIL]:y.FLOAT},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};const s=new Bo(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Bo(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,e=0){const{gl:s}=this;if((null==(t=null==t?void 0:t.castToBaseTexture())?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<s.length;t++)s[t]===this.unknownTexture&&this.bind(null,t)}for(let r=0;r<s.length;r++)s[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),s[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:s,CONTEXT_UID:r}=this;if(s)for(let n=t-1;n>=0;--n){const t=e[n];t&&t._glTextures[r].samplerType!==y.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new Bo(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var s;e.internalFormat=(null==(s=this.internalFormats[t.type])?void 0:s[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??y.FLOAT,2===this.webGLVersion&&t.type===x.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var e;const s=t._glTextures[this.CONTEXT_UID];if(!s)return;const r=this.renderer;if(this.initTextureType(t,s),null==(e=t.resource)?void 0:e.upload(r,t,s))s.samplerType!==y.FLOAT&&(this.hasIntegerTextures=!0);else{const e=t.realWidth,n=t.realHeight,i=r.gl;(s.width!==e||s.height!==n||s.dirtyId<0)&&(s.width=e,s.height=n,i.texImage2D(t.target,0,s.internalFormat,e,n,0,t.format,s.type,null))}t.dirtyStyleId!==s.dirtyStyleId&&this.updateTextureStyle(t),s.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:s}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Gn(this.managedTextures,e,1)}}updateTextureStyle(t){var e;const s=t._glTextures[this.CONTEXT_UID];s&&(t.mipmap!==v.POW2&&2===this.webGLVersion||t.isPowerOfTwo?s.mipmap=t.mipmap>=1:s.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?s.wrapMode=t.wrapMode:s.wrapMode=_.CLAMP,(null==(e=t.resource)?void 0:e.style(this.renderer,t,s))||this.setStyle(t,s),s.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const s=this.gl;if(e.mipmap&&t.mipmap!==v.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,e.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===b.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===b.LINEAR){const r=Math.min(t.anisotropicLevel,s.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===b.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===b.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Oo.extension={type:ri.RendererSystem,name:"texture"},ai.add(Oo);class Lo{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,r=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:s,renderer:r}=this;e&&r.shader.bind(e),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:s,CONTEXT_UID:r}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[r]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];n&&(s.buffer.update(n),n._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,i,n._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const s=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];if(!s)continue;const r=s._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0===r.refCount&&!e&&n.dispose(s,e))}s&&(e||r.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Lo.extension={type:ri.RendererSystem,name:"transformFeedback"},ai.add(Lo);class Vo{constructor(t){this.renderer=t}init(t){this.screen=new Ni(0,0,t.width,t.height),this.element=t.view||M.ADAPTER.createCanvas(),this.resolution=t.resolution||M.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const s=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=s,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",s,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&(null==(e=this.element.parentNode)||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Vo.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Vo.extension={type:[ri.RendererSystem,ri.CanvasRendererSystem],name:"_view"},ai.add(Vo),M.PREFER_ENV=c.WEBGL2,M.STRICT_TEXTURE_CACHE=!1,M.RENDER_OPTIONS={...Fa.defaultOptions,...Ca.defaultOptions,...Vo.defaultOptions,...Co.defaultOptions},Object.defineProperties(M,{WRAP_MODE:{get:()=>yi.defaultOptions.wrapMode,set(t){Jr("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),yi.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>yi.defaultOptions.scaleMode,set(t){Jr("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),yi.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>yi.defaultOptions.mipmap,set(t){Jr("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),yi.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>yi.defaultOptions.anisotropicLevel,set(t){Jr("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),yi.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(Jr("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ma.defaultResolution),set(t){Ma.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(Jr("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ma.defaultMultisample),set(t){Ma.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>Ia.defaultMaxTextures,set(t){Jr("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ia.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>Ia.defaultBatchSize,set(t){Jr("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ia.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Ia.canUploadSameBuffer,set(t){Jr("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ia.canUploadSameBuffer=t}},GC_MODE:{get:()=>No.defaultMode,set(t){Jr("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),No.defaultMode=t}},GC_MAX_IDLE:{get:()=>No.defaultMaxIdle,set(t){Jr("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),No.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>No.defaultCheckCountMax,set(t){Jr("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),No.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>ba.defaultVertexPrecision,set(t){Jr("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ba.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>ba.defaultFragmentPrecision,set(t){Jr("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ba.defaultFragmentPrecision=t}}});var Uo=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Uo||{});class Xo{constructor(t,e=null,s=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=s,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Yo=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Xo(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=Uo.NORMAL){return this._addListener(new Xo(t,e,s))}addOnce(t,e,s=Uo.NORMAL){return this._addListener(new Xo(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}else t.connect(s);return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s=s.match(t,e)?s.destroy():s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let s;if(e>this.lastTime){if(s=this.elapsedMS=e-this.lastTime,s>this._maxElapsedMS&&(s=this._maxElapsedMS),s*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=s,this.deltaTime=this.deltaMS*t.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const s=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,s)/1e3,t.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};Yo.targetFPMS=.06;let Go=Yo;Object.defineProperties(M,{TARGET_FPMS:{get:()=>Go.targetFPMS,set(t){Jr("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Go.targetFPMS=t}}});class Wo{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Uo.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Go.shared:new Go,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Wo.extension=ri.Application,ai.add(Wo);const Ho=[];ai.handleByList(ri.Renderer,Ho);const $o="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class jo{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}e>=I.HIGH?this.multisample=I.HIGH:e>=I.MEDIUM?this.multisample=I.MEDIUM:e>=I.LOW?this.multisample=I.LOW:this.multisample=I.NONE}destroy(){}}jo.extension={type:ri.RendererSystem,name:"_multisample"},ai.add(jo);class zo{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class qo{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,r=t._glBuffers[s]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:s,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,s.bindBufferBase(s.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,s){const{gl:r,CONTEXT_UID:n}=this;s=s||0;const i=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,i.buffer,256*s,256)}update(t){const{gl:e,CONTEXT_UID:s}=this,r=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),s&&(e||r.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let s=0;s<e.length;s++)this.dispose(this.managedBuffers[e[s]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:s}=this;return t._glBuffers[e]=new zo(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}qo.extension={type:ri.RendererSystem,name:"buffer"},ai.add(qo);class Zo{constructor(t){this.renderer=t}render(t,e){const s=this.renderer;let r,n,i,a;if(e&&(r=e.renderTexture,n=e.clear,i=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!r,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=i,!s.context.isLost){if(r||(this.lastObjectRendered=t),!a){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}s.renderTexture.bind(r),s.batch.currentRenderer.start(),(n??s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),r&&(e.blit&&s.framebuffer.blit(),r.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Zo.extension={type:ri.RendererSystem,name:"objectRenderer"},ai.add(Zo);const Ko=class t extends Fo{constructor(e){super(),this.type=u.WEBGL,e=Object.assign({},M.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new va({projectionMatrix:new Ui},!0);const s={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:t.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(s),"useContextAlpha"in e&&(Jr("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,e.backgroundAlpha=!1===e.useContextAlpha?1:e.backgroundAlpha),this._plugin.rendererPlugins=t.__plugins,this.options=e,this.startup.run(this.options)}static test(t){return!(null==t?void 0:t.forceCanvas)&&(typeof nn>"u"&&(nn=function(){var t;const e={stencil:!0,failIfMajorPerformanceCaveat:M.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!M.ADAPTER.getWebGLRenderingContext())return!1;const s=M.ADAPTER.createCanvas();let r=s.getContext("webgl",e)||s.getContext("experimental-webgl",e);const n=!!(null==(t=null==r?void 0:r.getContextAttributes())?void 0:t.stencil);if(r){const t=r.getExtension("WEBGL_lose_context");t&&t.loseContext()}return r=null,n}catch{return!1}}()),nn)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Jr("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Jr("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Jr("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Jr("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Jr("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Jr("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Jr("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Jr("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Ko.extension={type:ri.Renderer,priority:1},Ko.__plugins={},Ko.__systems={};let Qo=Ko;ai.handleByMap(ri.RendererPlugin,Qo.__plugins),ai.handleByMap(ri.RendererSystem,Qo.__systems),ai.add(Qo);class Jo extends pi{constructor(t,e){const{width:s,height:r}=e||{};super(s,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const t=new yi;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let s=0;s<this.length;s++)t[s]&&(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):t[s]instanceof pi?this.addResourceAt(t[s],s):this.addResourceAt(di(t[s],e),s))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),this.update(),Promise.resolve(this)})),this._load}}const th=class t extends Jo{constructor(e,s){const{width:r,height:n,autoLoad:i,linkBaseTexture:a}=s||{};if(e&&e.length!==t.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:n});for(let o=0;o<t.SIDES;o++)this.items[o].target=g.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==a,e&&this.initFromArray(e,s),!1!==i&&this.load()}bind(t){super.bind(t),t.target=g.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,s){if(void 0===s&&(s=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=g.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(e,s,r){const n=this.itemDirtyIds;for(let i=0;i<t.SIDES;i++){const t=this.items[i];(n[i]<t.dirtyId||r.dirtyId<s.dirtyId)&&(t.valid&&t.resource?(t.resource.upload(e,t,r),n[i]=t.dirtyId):n[i]<-1&&(e.gl.texImage2D(t.target,0,r.internalFormat,s.realWidth,s.realHeight,0,s.format,r.type,null),n[i]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===t.SIDES}};th.SIDES=6;let eh=th;class sh extends Ba{constructor(t,e){let s,r,n;e=e||{},"string"==typeof t?(s=sh.EMPTY,r=t,n=!0):(s=t,r=null,n=!1),super(s),this.url=r,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await M.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await e.blob();if(this.destroyed)return;const r=await createImageBitmap(s,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===E.UNPACK?"premultiply":"none"});if(this.destroyed)return void r.close();this.source=r,this.update(),t(this)}catch(Xy){if(this.destroyed)return;e(Xy),this.onError.emit(Xy)}else t(this)}))),this._load}upload(t,e,s){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,s)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return sh._EMPTY=sh._EMPTY??M.ADAPTER.createCanvas(0,0),sh._EMPTY}}const rh=class t extends Ba{constructor(t,e){e=e||{},super(M.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((e=>{if(this._resolve=()=>{this.update(),e(this)},t.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Ba.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,s=t.height;if(!e||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,n=s*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/s*e,n=this._overrideHeight||this._overrideWidth/e*s),r=Math.round(r),n=Math.round(n);const i=this.source;i.width=r,i.height=n,i._pixiId=`canvas_${$n()}`,i.getContext("2d").drawImage(t,0,0,e,s,0,0,r,n),this._resolve(),this._resolve=null}}static getSize(e){const s=t.SVG_SIZE.exec(e),r={};return s&&(r[s[1]]=Math.round(parseFloat(s[3])),r[s[5]]=Math.round(parseFloat(s[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,s){return"svg"===s||"string"==typeof e&&e.startsWith("data:image/svg+xml")||"string"==typeof e&&t.SVG_XML.test(e)}};rh.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,rh.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let nh=rh;const ih=class t extends Ba{constructor(e,s){if(s=s||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");!1!==s.autoLoad&&r.setAttribute("preload","auto"),!1!==s.playsinline&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),!0===s.muted&&(r.setAttribute("muted",""),r.muted=!0),!0===s.loop&&r.setAttribute("loop",""),!1!==s.autoPlay&&r.setAttribute("autoplay",""),"string"==typeof e&&(e=[e]);const n=e[0].src||e[0];Ba.crossOrigin(r,n,s.crossorigin);for(let s=0;s<e.length;++s){const n=document.createElement("source");let{src:i,mime:a}=e[s];if(i=i||e[s],i.startsWith("data:"))a=i.slice(5,i.indexOf(";"));else if(!i.startsWith("blob:")){const e=i.split("?").shift().toLowerCase(),s=e.slice(e.lastIndexOf(".")+1);a=a||t.MIME_TYPES[s]||`video/${s}`}n.src=i,a&&(n.type=a),r.appendChild(n)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=s.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==s.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==s.autoLoad&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const t=Go.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(((e,s)=>{this.valid?e(this):(this._resolve=e,this._reject=s,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Go.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Go.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Go.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,s){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.includes(s)}};ih.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],ih.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ah=ih;function oh(t){switch(t.toLowerCase()){case"nearest":return hh.Nearest;case"linear":return hh.Linear;case"mipmap":return hh.MipMap;case"mipmapnearestnearest":return hh.MipMapNearestNearest;case"mipmaplinearnearest":return hh.MipMapLinearNearest;case"mipmapnearestlinear":return hh.MipMapNearestLinear;case"mipmaplinearlinear":return hh.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${t}`)}}ui.push(sh,Oa,class extends Ba{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},ah,class extends Ba{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}},nh,mi,eh,class extends Jo{constructor(t,e){const{width:s,height:r}=e||{};let n,i;Array.isArray(t)?(n=t,i=t.length):i=t,super(i,{width:s,height:r}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=g.TEXTURE_2D_ARRAY}upload(t,e,s){const{length:r,itemDirtyIds:n,items:i}=this,{gl:a}=t;s.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,r,0,e.format,s.type,null);for(let o=0;o<r;o++){const t=i[o];n[o]<t.dirtyId&&(n[o]=t.dirtyId,t.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,o,t.resource.width,t.resource.height,1,e.format,s.type,t.resource.source))}return!0}});var hh=(t=>(t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear",t))(hh||{}),lh=(t=>(t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat",t))(lh||{});class ch{constructor(){this.size=null,this.names=null,this.values=null,this.renderObject=null}get width(){const t=this.texture;return t.trim?t.trim.width:t.orig.width}get height(){const t=this.texture;return t.trim?t.trim.height:t.orig.height}get u(){return this.texture._uvs.x0}get v(){return this.texture._uvs.y0}get u2(){return this.texture._uvs.x2}get v2(){return this.texture._uvs.y2}get offsetX(){const t=this.texture;return t.trim?t.trim.x:0}get offsetY(){return this.spineOffsetY}get pixiOffsetY(){const t=this.texture;return t.trim?t.trim.y:0}get spineOffsetY(){const t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}get originalWidth(){return this.texture.orig.width}get originalHeight(){return this.texture.orig.height}get x(){return this.texture.frame.x}get y(){return this.texture.frame.y}get rotate(){return 0!==this.texture.rotate}get degrees(){return(360-45*this.texture.rotate)%360}}class uh{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0}}class dh{constructor(t,e,s){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,s)}addTexture(t,e){const s=this.pages;let r=null;for(let i=0;i<s.length;i++)if(s[i].baseTexture===e.baseTexture){r=s[i];break}if(null===r){r=new ph,r.name="texturePage";const t=e.baseTexture;r.width=t.realWidth,r.height=t.realHeight,r.baseTexture=t,r.minFilter=r.magFilter=hh.Nearest,r.uWrap=lh.ClampToEdge,r.vWrap=lh.ClampToEdge,s.push(r)}const n=new mh;return n.name=t,n.page=r,n.texture=e,n.index=-1,this.regions.push(n),n}addTextureHash(t,e){for(const s in t)t.hasOwnProperty(s)&&this.addTexture(e&&-1!==s.indexOf(".")?s.substr(0,s.lastIndexOf(".")):s,t[s])}addSpineAtlas(t,e,s){return this.load(t,e,s)}load(t,e,s){if(null==e)throw new Error("textureLoader cannot be null.");const r=new fh(t),n=new Array(4);let i=null;const a={};let o=null;a.size=()=>{i.width=parseInt(n[1]),i.height=parseInt(n[2])},a.format=()=>{},a.filter=()=>{i.minFilter=oh(n[1]),i.magFilter=oh(n[2])},a.repeat=()=>{-1!=n[1].indexOf("x")&&(i.uWrap=lh.Repeat),-1!=n[1].indexOf("y")&&(i.vWrap=lh.Repeat)},a.pma=()=>{i.pma="true"==n[1]};const h={xy:()=>{o.x=parseInt(n[1]),o.y=parseInt(n[2])},size:()=>{o.width=parseInt(n[1]),o.height=parseInt(n[2])},bounds:()=>{o.x=parseInt(n[1]),o.y=parseInt(n[2]),o.width=parseInt(n[3]),o.height=parseInt(n[4])},offset:()=>{o.offsetX=parseInt(n[1]),o.offsetY=parseInt(n[2])},orig:()=>{o.originalWidth=parseInt(n[1]),o.originalHeight=parseInt(n[2])},offsets:()=>{o.offsetX=parseInt(n[1]),o.offsetY=parseInt(n[2]),o.originalWidth=parseInt(n[3]),o.originalHeight=parseInt(n[4])},rotate:()=>{const t=n[1];let e=0;e="true"==t.toLocaleLowerCase()?6:"false"==t.toLocaleLowerCase()?0:(720-parseFloat(t))%360/45,o.rotate=e},index:()=>{o.index=parseInt(n[1])}};let l=r.readLine();for(;null!=l&&0==l.trim().length;)l=r.readLine();for(;null!=l&&0!=l.trim().length&&0!=r.readEntry(n,l);)l=r.readLine();const c=()=>{for(;;){if(null==l)return s&&s(this);if(0==l.trim().length)i=null,l=r.readLine();else{if(null===i){for(i=new ph,i.name=l.trim();0!=r.readEntry(n,l=r.readLine());){const t=a[n[0]];t&&t()}this.pages.push(i),e(i.name,(t=>{if(null===t)return this.pages.splice(this.pages.indexOf(i),1),s&&s(null);i.baseTexture=t,i.pma&&(t.alphaMode=E.PMA),t.valid||t.setSize(i.width,i.height),i.setFilters(),i.width&&i.height||(i.width=t.realWidth,i.height=t.realHeight,i.width&&i.height||console.log(`ERROR spine atlas page ${i.name}: meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)`)),c()}));break}{o=new uh;const t=new mh;t.name=l,t.page=i;let e=null,s=null;for(;;){const t=r.readEntry(n,l=r.readLine());if(0==t)break;const i=h[n[0]];if(i)i();else{null==e&&(e=[],s=[]),e.push(n[0]);const r=[];for(let e=0;e<t;e++)r.push(parseInt(n[e+1]));s.push(r)}}0==o.originalWidth&&0==o.originalHeight&&(o.originalWidth=o.width,o.originalHeight=o.height);const a=i.baseTexture.resolution;o.x/=a,o.y/=a,o.width/=a,o.height/=a,o.originalWidth/=a,o.originalHeight/=a,o.offsetX/=a,o.offsetY/=a;const c=o.rotate%4!=0,u=new Ni(o.x,o.y,c?o.height:o.width,c?o.width:o.height),d=new Ni(0,0,o.originalWidth,o.originalHeight),f=new Ni(o.offsetX,o.originalHeight-o.height-o.offsetY,o.width,o.height);t.texture=new Xa(t.page.baseTexture,u,d,f,o.rotate),t.index=o.index,t.texture.updateUvs(),this.regions.push(t)}}}};c()}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}class fh{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(null==e)return 0;if(0==(e=e.trim()).length)return 0;const s=e.indexOf(":");if(-1==s)return 0;t[0]=e.substr(0,s).trim();for(let r=1,n=s+1;;r++){const s=e.indexOf(",",n);if(-1==s)return t[r]=e.substr(n).trim(),r;if(t[r]=e.substr(n,s-n).trim(),n=s+1,4==r)return 4}}}class ph{constructor(){this.minFilter=hh.Nearest,this.magFilter=hh.Nearest,this.uWrap=lh.ClampToEdge,this.vWrap=lh.ClampToEdge}setFilters(){const t=this.baseTexture,e=this.minFilter;e==hh.Linear?t.scaleMode=b.LINEAR:this.minFilter==hh.Nearest?t.scaleMode=b.NEAREST:(t.mipmap=v.POW2,e==hh.MipMapNearestNearest?t.scaleMode=b.NEAREST:t.scaleMode=b.LINEAR)}}class mh extends ch{}class gh{constructor(){this.array=new Array}add(t){const e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class xh{constructor(){this.entries={},this.size=0}add(t){const e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){const e=this.size;for(let s=0,r=t.length;s<r;s++)this.add(t[s]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const yh=class{constructor(t=0,e=0,s=0,r=0){this.r=t,this.g=e,this.b=s,this.a=r}set(t,e,s,r){return this.r=t,this.g=e,this.b=s,this.a=r,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,s,r){return this.r+=t,this.g+=e,this.b+=s,this.a+=r,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new yh).setFromString(t)}};let bh=yh;bh.WHITE=new yh(1,1,1,1),bh.RED=new yh(1,0,0,1),bh.GREEN=new yh(0,1,0,1),bh.BLUE=new yh(0,0,1,1),bh.MAGENTA=new yh(1,0,1,1);const _h=class{static clamp(t,e,s){return t<e?e:t>s?s:t}static cosDeg(t){return Math.cos(t*_h.degRad)}static sinDeg(t){return Math.sin(t*_h.degRad)}static signum(t){return Math.sign(t)}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){const e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return _h.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,s){const r=Math.random(),n=e-t;return r<=(s-t)/n?t+Math.sqrt(r*n*(s-t)):e-Math.sqrt((1-r)*n*(e-s))}static isPowerOfTwo(t){return t&&!(t&t-1)}};let vh=_h;vh.PI=3.1415927,vh.PI2=2*_h.PI,vh.radiansToDegrees=180/_h.PI,vh.radDeg=_h.radiansToDegrees,vh.degreesToRadians=_h.PI/180,vh.degRad=_h.degreesToRadians;class Eh{apply(t,e,s){return t+(e-t)*this.applyInternal(s)}}class wh extends Eh{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class Ah extends wh{applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}const Th=class{static arrayCopy(t,e,s,r,n){for(let i=e,a=r;i<e+n;i++,a++)s[a]=t[i]}static arrayFill(t,e,s,r){for(let n=e;n<s;n++)t[n]=r}static setArraySize(t,e,s=0){const r=t.length;if(r==e)return t;if(t.length=e,r<e)for(let n=r;n<e;n++)t[n]=s;return t}static ensureArrayCapacity(t,e,s=0){return t.length>=e?t:Th.setArraySize(t,e,s)}static newArray(t,e){const s=new Array(t);for(let r=0;r<t;r++)s[r]=e;return s}static newFloatArray(t){if(Th.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=0;return e}static newShortArray(t){if(Th.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=0;return e}static toFloatArray(t){return Th.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return Th.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,s=!0){for(let r=0;r<t.length;r++)if(t[r]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}};let Sh=Th;Sh.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;class Ih{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class Rh{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){const t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class Mh{constructor(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new Ih((()=>Sh.newFloatArray(16)))}update(t,e){if(!t)throw new Error("skeleton cannot be null.");const s=this.boundingBoxes,n=this.polygons,i=this.polygonPool,a=t.slots,o=a.length;s.length=0,i.freeAll(n),n.length=0;for(let h=0;h<o;h++){const t=a[h];if(!t.bone.active)continue;const e=t.getAttachment();if(null!=e&&e.type===r.BoundingBox){const r=e;s.push(r);let a=i.obtain();a.length!=r.worldVerticesLength&&(a=Sh.newFloatArray(r.worldVerticesLength)),n.push(a),r.computeWorldVertices(t,0,r.worldVerticesLength,a,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const n=this.polygons;for(let i=0,a=n.length;i<a;i++){const a=n[i],o=a;for(let n=0,i=a.length;n<i;n+=2){const i=o[n],a=o[n+1];t=Math.min(t,i),e=Math.min(e,a),s=Math.max(s,i),r=Math.max(r,a)}}this.minX=t,this.minY=e,this.maxX=s,this.maxY=r}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,s,r){const n=this.minX,i=this.minY,a=this.maxX,o=this.maxY;if(t<=n&&s<=n||e<=i&&r<=i||t>=a&&s>=a||e>=o&&r>=o)return!1;const h=(r-e)/(s-t);let l=h*(n-t)+e;if(l>i&&l<o)return!0;if(l=h*(a-t)+e,l>i&&l<o)return!0;let c=(i-e)/h+t;return c>n&&c<a||(c=(o-e)/h+t,c>n&&c<a)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){const s=this.polygons;for(let r=0,n=s.length;r<n;r++)if(this.containsPointPolygon(s[r],t,e))return this.boundingBoxes[r];return null}containsPointPolygon(t,e,s){const r=t,n=t.length;let i=n-2,a=!1;for(let o=0;o<n;o+=2){const t=r[o+1],n=r[i+1];if(t<s&&n>=s||n<s&&t>=s){const h=r[o];h+(s-t)/(n-t)*(r[i]-h)<e&&(a=!a)}i=o}return a}intersectsSegment(t,e,s,r){const n=this.polygons;for(let i=0,a=n.length;i<a;i++)if(this.intersectsSegmentPolygon(n[i],t,e,s,r))return this.boundingBoxes[i];return null}intersectsSegmentPolygon(t,e,s,r,n){const i=t,a=t.length,o=e-r,h=s-n,l=e*n-s*r;let c=i[a-2],u=i[a-1];for(let d=0;d<a;d+=2){const t=i[d],a=i[d+1],f=c*a-u*t,p=c-t,m=u-a,g=o*m-h*p,x=(l*p-o*f)/g;if((x>=c&&x<=t||x>=t&&x<=c)&&(x>=e&&x<=r||x>=r&&x<=e)){const t=(l*m-h*f)/g;if((t>=u&&t<=a||t>=a&&t<=u)&&(t>=s&&t<=n||t>=n&&t<=s))return!0}c=t,u=a}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");const e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}const Ch=0;class Ph{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Ni.EMPTY:((t=t||new Ni(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:s,b:r,c:n,d:i,tx:a,ty:o}=t,h=s*e.x+n*e.y+a,l=r*e.x+i*e.y+o;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,s=this.minY,r=this.maxX,n=this.maxY,i=t[0],a=t[1];e=i<e?i:e,s=a<s?a:s,r=i>r?i:r,n=a>n?a:n,i=t[2],a=t[3],e=i<e?i:e,s=a<s?a:s,r=i>r?i:r,n=a>n?a:n,i=t[4],a=t[5],e=i<e?i:e,s=a<s?a:s,r=i>r?i:r,n=a>n?a:n,i=t[6],a=t[7],e=i<e?i:e,s=a<s?a:s,r=i>r?i:r,n=a>n?a:n,this.minX=e,this.minY=s,this.maxX=r,this.maxY=n}addFrame(t,e,s,r,n){this.addFrameMatrix(t.worldTransform,e,s,r,n)}addFrameMatrix(t,e,s,r,n){const i=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=i*e+o*s+l,g=a*e+h*s+c;u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=i*r+o*s+l,g=a*r+h*s+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=i*e+o*n+l,g=a*e+h*n+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=i*r+o*n+l,g=a*r+h*n+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=u,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,s){let r=this.minX,n=this.minY,i=this.maxX,a=this.maxY;for(let o=e;o<s;o+=2){const e=t[o],s=t[o+1];r=e<r?e:r,n=s<n?s:n,i=e>i?e:i,a=s>a?s:a}this.minX=r,this.minY=n,this.maxX=i,this.maxY=a}addVertices(t,e,s,r){this.addVerticesMatrix(t.worldTransform,e,s,r)}addVerticesMatrix(t,e,s,r,n=0,i=n){const a=t.a,o=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let g=s;g<r;g+=2){const t=e[g],s=e[g+1],r=a*t+h*s+c,x=l*s+o*t+u;d=Math.min(d,r-n),p=Math.max(p,r+n),f=Math.min(f,x-i),m=Math.max(m,x+i)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,s=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const s=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,i=t.maxY<e.maxY?t.maxY:e.maxY;if(s<=n&&r<=i){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=s<t?s:t,this.minY=r<e?r:e,this.maxX=n>a?n:a,this.maxY=i>o?i:o}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const s=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,i=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(s<=n&&r<=i){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=s<t?s:t,this.minY=r<e?r:e,this.maxX=n>a?n:a,this.maxY=i>o?i:o}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,s,r,n,i){t-=n,e-=i,s+=n,r+=i,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r}}class kh extends q{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ki,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ph,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let s=0;s<e.length;++s){const r=e[s];Object.defineProperty(kh.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ni),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ni),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ph);const e=this.transform,s=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(null==s?void 0:s.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const i=this.getBounds(!1,t);return this.parent=s,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-n,i}toGlobal(t,e,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,s,r){return e&&(t=e.toGlobal(t,s,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)}setTransform(t=0,e=0,s=1,r=1,n=0,i=0,a=0,o=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=s||1,this.scale.y=r||1,this.rotation=n,this.skew.x=i,this.skew.y=a,this.pivot.x=o,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Fh),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ci}set angle(t){this.transform.rotation=t*Pi}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Fh extends kh{constructor(){super(...arguments),this.sortDirty=null}}kh.prototype.displayObjectUpdateTransform=kh.prototype.updateTransform;const Dh=new Ui;function Nh(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const Bh=class t extends kh{constructor(){super(),this.children=[],this.sortableChildren=t.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const s=this.getChildIndex(t),r=this.getChildIndex(e);this.children[s]=e,this.children[r]=t,this.onChildrenChange(s<r?s:r)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(t);Gn(this.children,s,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],s=this.children.indexOf(e);if(-1===s)return null;e.parent=null,e.transform._parentID=-1,Gn(this.children,s,1),this._boundsID++,this.onChildrenChange(s),e.emit("removed",this),this.emit("childRemoved",e,this,s)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Gn(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const s=t,r=e-s;let n;if(r>0&&r<=e){n=this.children.splice(s,r);for(let t=0;t<n.length;++t)n[t].parent=null,n[t].transform&&(n[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<n.length;++t)n[t].emit("removed",this),this.emit("childRemoved",n[t],this,t);return n}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,s=this.children.length;e<s;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&0!==s.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(Nh),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const s=super.getLocalBounds(t);if(!e)for(let r=0,n=this.children.length;r<n;++r){const t=this.children[r];t.visible&&t.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(e){const s=e.renderTexture.sourceFrame;if(!(s.width>0&&s.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==t.prototype._render&&(r=this.getBounds(!0));const i=e.projection.transform;if(i&&(n?(n=Dh.copyFrom(n),n.prepend(i)):n=i),r&&s.intersects(r,n))this._render(e);else if(this.cullArea)return;for(let t=0,a=this.children.length;t<a;++t){const s=this.children[t],r=s.cullable;s.cullable=r||!this.cullArea,s.render(e),s.cullable=r}}render(t){var e;if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||(null==(e=this.filters)?void 0:e.length))this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}}renderAdvanced(t){var e,s,r;const n=this.filters,i=this._mask;if(n){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<n.length;t++)n[t].enabled&&this._enabledFilters.push(n[t])}const a=n&&(null==(e=this._enabledFilters)?void 0:e.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==S.NONE));if(a&&t.batch.flush(),n&&(null==(s=this._enabledFilters)?void 0:s.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}a&&t.batch.flush(),i&&t.mask.pop(this),n&&(null==(r=this._enabledFilters)?void 0:r.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:null==t?void 0:t.children,s=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<s.length;++r)s[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};Bh.defaultSortableChildren=!1;let Oh=Bh;Oh.prototype.containerUpdateTransform=Oh.prototype.updateTransform,Object.defineProperties(M,{SORTABLE_CHILDREN:{get:()=>Oh.defaultSortableChildren,set(t){Jr("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Oh.defaultSortableChildren=t}}});const Lh=new Fi,Vh=new Uint16Array([0,1,2,0,2,3]);class Uh extends Oh{constructor(t){super(),this._anchor=new qi(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Nn(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=f.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Xa.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Vh,this.pluginName="batch",this.isSprite=!0,this._roundPixels=M.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Wn(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Wn(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,s=e.a,r=e.b,n=e.c,i=e.d,a=e.tx,o=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,f=0,p=0,m=0;if(l?(f=l.x-u._x*c.width,d=f+l.width,m=l.y-u._y*c.height,p=m+l.height):(f=-u._x*c.width,d=f+c.width,m=-u._y*c.height,p=m+c.height),h[0]=s*f+n*m+a,h[1]=i*m+r*f+o,h[2]=s*d+n*m+a,h[3]=i*m+r*d+o,h[4]=s*d+n*p+a,h[5]=i*p+r*d+o,h[6]=s*f+n*p+a,h[7]=i*p+r*f+o,this._roundPixels){const t=M.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,s=t.orig,r=this._anchor,n=this.transform.worldTransform,i=n.a,a=n.b,o=n.c,h=n.d,l=n.tx,c=n.ty,u=-r._x*s.width,d=u+s.width,f=-r._y*s.height,p=f+s.height;if(e[0]=i*u+o*f+l,e[1]=h*f+a*u+c,e[2]=i*d+o*f+l,e[3]=h*f+a*d+c,e[4]=i*d+o*p+l,e[5]=h*p+a*d+c,e[6]=i*u+o*p+l,e[7]=h*p+a*u+c,this._roundPixels){const t=M.RESOLUTION;for(let s=0;s<e.length;++s)e[s]=Math.round(e[s]*t)/t}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Ph),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Ni),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Lh);const e=this._texture.orig.width,s=this._texture.orig.height,r=-e*this.anchor.x;let n=0;return Lh.x>=r&&Lh.x<r+e&&(n=-s*this.anchor.y,Lh.y>=n&&Lh.y<n+s)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const s=t instanceof Xa?t:Xa.from(t,e);return new Uh(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Wn(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Wn(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Xa.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}class Xh{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Yh=new Fi,Gh=new Li,Wh=class t extends Oh{constructor(t,e,s,r=p.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=s||ci.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=M.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(e){const s=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===p.TRIANGLES&&s.length<2*t.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,s=this.shader;s.uvMatrix&&(s.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=s._tintRGB,this._texture=s.texture;const r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const r=this.transform.worldTransform,n=r.a,i=r.b,a=r.c,o=r.d,h=r.tx,l=r.ty,c=this.vertexData;for(let u=0;u<c.length/2;u++){const t=e[2*u],s=e[2*u+1];c[2*u]=n*t+a*s+h,c[2*u+1]=i*t+o*s+l}if(this._roundPixels){const t=M.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=s}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Xh(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Yh);const e=this.geometry.getBuffer("aVertexPosition").data,s=Gh.points,r=this.geometry.getIndex().data,n=r.length,i=4===this.drawMode?3:1;for(let a=0;a+2<n;a+=i){const t=2*r[a],n=2*r[a+1],i=2*r[a+2];if(s[0]=e[t],s[1]=e[t+1],s[2]=e[n],s[3]=e[n+1],s[4]=e[i],s[5]=e[i+1],Gh.contains(Yh.x,Yh.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Wh.BATCHABLE_SIZE=100;let Hh=Wh;class $h extends Ii{constructor(t,e,s){super();const r=new vi(t),n=new vi(e,!0),i=new vi(s,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,x.FLOAT).addAttribute("aTextureCoord",n,2,!1,x.FLOAT).addIndex(i),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class jh extends Ea{constructor(t,e){const s={uSampler:t,alpha:1,uTextureMatrix:Ui.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(s,e.uniforms),super(e.program||ba.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),s),this._colorDirty=!1,this.uvMatrix=new so(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Nn(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Nn.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class zh extends Hh{constructor(t=Xa.EMPTY,e,s,r,n){const i=new $h(e,s,r);i.getBuffer("aVertexPosition").static=!1;super(i,new jh(t),null,n),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}const qh={build(t){const e=t.points;let s,r,n,i,a,o;if(t.type===ki.CIRC){const e=t.shape;s=e.x,r=e.y,a=o=e.radius,n=i=0}else if(t.type===ki.ELIP){const e=t.shape;s=e.x,r=e.y,a=e.width,o=e.height,n=i=0}else{const e=t.shape,h=e.width/2,l=e.height/2;s=e.x+h,r=e.y+l,a=o=Math.max(0,Math.min(e.radius,Math.min(h,l))),n=h-a,i=l-o}if(!(a>=0&&o>=0&&n>=0&&i>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(a+o)),l=8*h+(n?4:0)+(i?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=s+n,e[1]=e[3]=r+i,e[2]=e[4]=s-n,void(e[5]=e[7]=r-i);let c=0,u=4*h+(n?2:0)+2,d=u,f=l;{const t=n+a,o=i,h=s+t,l=s-t,p=r+o;if(e[c++]=h,e[c++]=p,e[--u]=p,e[--u]=l,i){const t=r-o;e[d++]=l,e[d++]=t,e[--f]=t,e[--f]=h}}for(let p=1;p<h;p++){const t=Math.PI/2*(p/h),l=n+Math.cos(t)*a,m=i+Math.sin(t)*o,g=s+l,x=s-l,y=r+m,b=r-m;e[c++]=g,e[c++]=y,e[--u]=y,e[--u]=x,e[d++]=x,e[d++]=b,e[--f]=b,e[--f]=g}{const t=i+o,a=s+n,h=s-n,l=r+t,u=r-t;e[c++]=a,e[c++]=l,e[--f]=u,e[--f]=a,n&&(e[c++]=h,e[c++]=l,e[--f]=u,e[--f]=h)}},triangulate(t,e){const s=t.points,r=e.points,n=e.indices;if(0===s.length)return;let i=r.length/2;const a=i;let o,h;if(t.type!==ki.RREC){const e=t.shape;o=e.x,h=e.y}else{const e=t.shape;o=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;r.push(t.matrix?l.a*o+l.c*h+l.tx:o,t.matrix?l.b*o+l.d*h+l.ty:h),i++,r.push(s[0],s[1]);for(let c=2;c<s.length;c+=2)r.push(s[c],s[c+1]),n.push(i++,a,i);n.push(a+1,a,i)}};function Zh(t,e=!1){const s=t.length;if(s<6)return;let r=0;for(let n=0,i=t[s-2],a=t[s-1];n<s;n+=2){const e=t[n],s=t[n+1];r+=(e-i)*(s+a),i=e,a=s}if(!e&&r>0||e&&r<=0){const e=s/2;for(let r=e+e%2;r<s;r+=2){const e=s-r-2,n=s-r-1,i=r,a=r+1;[t[e],t[i]]=[t[i],t[e]],[t[n],t[a]]=[t[a],t[n]]}}}const Kh={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let s=t.points;const r=t.holes,n=e.points,i=e.indices;if(s.length>=6){Zh(s,!1);const t=[];for(let n=0;n<r.length;n++){const e=r[n];Zh(e.points,!0),t.push(s.length/2),s=s.concat(e.points)}const e=wt(s,t,2);if(!e)return;const a=n.length/2;for(let s=0;s<e.length;s+=3)i.push(e[s]+a),i.push(e[s+1]+a),i.push(e[s+2]+a);for(let r=0;r<s.length;r++)n.push(s[r])}}},Qh={build(t){const e=t.shape,s=e.x,r=e.y,n=e.width,i=e.height,a=t.points;a.length=0,n>=0&&i>=0&&a.push(s,r,s+n,r,s+n,r+i,s,r+i)},triangulate(t,e){const s=t.points,r=e.points;if(0===s.length)return;const n=r.length/2;r.push(s[0],s[1],s[2],s[3],s[6],s[7],s[4],s[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},Jh={build(t){qh.build(t)},triangulate(t,e){qh.triangulate(t,e)}};var tl=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(tl||{}),el=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(el||{});const sl={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let s=Math.ceil(t/this.maxLength);return s<this.minSegments?s=this.minSegments:s>this.maxSegments&&(s=this.maxSegments),s}};class rl{static curveTo(t,e,s,r,n,i){const a=i[i.length-2],o=i[i.length-1]-e,h=a-t,l=r-e,c=s-t,u=Math.abs(o*c-h*l);if(u<1e-8||0===n)return(i[i.length-2]!==t||i[i.length-1]!==e)&&i.push(t,e),null;const d=o*o+h*h,f=l*l+c*c,p=o*l+h*c,m=n*Math.sqrt(d)/u,g=n*Math.sqrt(f)/u,x=m*p/d,y=g*p/f,b=m*c+g*h,_=m*l+g*o,v=h*(g+x),E=o*(g+x),w=c*(m+y),A=l*(m+y);return{cx:b+t,cy:_+e,radius:n,startAngle:Math.atan2(E-_,v-b),endAngle:Math.atan2(A-_,w-b),anticlockwise:h*l>c*o}}static arc(t,e,s,r,n,i,a,o,h){const l=a-i,c=sl._segmentsCount(Math.abs(l)*n,40*Math.ceil(Math.abs(l)/Mi)),u=l/(2*c),d=2*u,f=Math.cos(u),p=Math.sin(u),m=c-1,g=m%1/m;for(let x=0;x<=m;++x){const t=u+i+d*(x+g*x),e=Math.cos(t),a=-Math.sin(t);h.push((f*e+p*a)*n+s,(f*-a+p*e)*n+r)}}}class nl{constructor(){this.reset()}begin(t,e,s){this.reset(),this.style=t,this.start=e,this.attribStart=s}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class il{static curveLength(t,e,s,r,n,i,a,o){let h=0,l=0,c=0,u=0,d=0,f=0,p=0,m=0,g=0,x=0,y=0,b=t,_=e;for(let v=1;v<=10;++v)l=v/10,c=l*l,u=c*l,d=1-l,f=d*d,p=f*d,m=p*t+3*f*l*s+3*d*c*n+u*a,g=p*e+3*f*l*r+3*d*c*i+u*o,x=b-m,y=_-g,b=m,_=g,h+=Math.sqrt(x*x+y*y);return h}static curveTo(t,e,s,r,n,i,a){const o=a[a.length-2],h=a[a.length-1];a.length-=2;const l=sl._segmentsCount(il.curveLength(o,h,t,e,s,r,n,i));let c=0,u=0,d=0,f=0,p=0;a.push(o,h);for(let m=1,g=0;m<=l;++m)g=m/l,c=1-g,u=c*c,d=u*c,f=g*g,p=f*g,a.push(d*o+3*u*g*t+3*c*f*s+p*n,d*h+3*u*g*e+3*c*f*r+p*i)}}function al(t,e,s,r,n,i,a,o){let h,l;a?(h=r,l=-s):(h=-r,l=s);const c=t-s*n+h,u=e-r*n+l,d=t+s*i+h,f=e+r*i+l;return o.push(c,u,d,f),2}function ol(t,e,s,r,n,i,a,o){const h=s-t,l=r-e;let c=Math.atan2(h,l),u=Math.atan2(n-t,i-e);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=1+(15*p*Math.sqrt(m)/Math.PI|0),x=f/g;if(d+=x,o){a.push(t,e,s,r);for(let s=1,r=d;s<g;s++,r+=x)a.push(t,e,t+Math.sin(r)*m,e+Math.cos(r)*m);a.push(t,e,n,i)}else{a.push(s,r,t,e);for(let s=1,r=d;s<g;s++,r+=x)a.push(t+Math.sin(r)*m,e+Math.cos(r)*m,t,e);a.push(n,i,t,e)}return 2*g}function hl(t,e){t.lineStyle.native?function(t,e){let s=0;const r=t.shape,n=t.points||r.points,i=r.type!==ki.POLY||r.closeStroke;if(0===n.length)return;const a=e.points,o=e.indices,h=n.length/2,l=a.length/2;let c=l;for(a.push(n[0],n[1]),s=1;s<h;s++)a.push(n[2*s],n[2*s+1]),o.push(c,c+1),c++;i&&o.push(c,l)}(t,e):function(t,e){const s=t.shape;let r=t.points||s.points.slice();const n=e.closePointEps;if(0===r.length)return;const i=t.lineStyle,a=new Fi(r[0],r[1]),o=new Fi(r[r.length-2],r[r.length-1]),h=s.type!==ki.POLY||s.closeStroke,l=Math.abs(a.x-o.x)<n&&Math.abs(a.y-o.y)<n;if(h){r=r.slice(),l&&(r.pop(),r.pop(),o.set(r[r.length-2],r[r.length-1]));const t=.5*(a.x+o.x),e=.5*(o.y+a.y);r.unshift(t,e),r.push(t,e)}const c=e.points,u=r.length/2;let d=r.length;const f=c.length/2,p=i.width/2,m=p*p,g=i.miterLimit*i.miterLimit;let x=r[0],y=r[1],b=r[2],_=r[3],v=0,E=0,w=-(y-_),A=x-b,T=0,S=0,I=Math.sqrt(w*w+A*A);w/=I,A/=I,w*=p,A*=p;const R=i.alignment,M=2*(1-R),C=2*R;h||(i.cap===el.ROUND?d+=ol(x-w*(M-C)*.5,y-A*(M-C)*.5,x-w*M,y-A*M,x+w*C,y+A*C,c,!0)+2:i.cap===el.SQUARE&&(d+=al(x,y,w,A,M,C,!0,c))),c.push(x-w*M,y-A*M,x+w*C,y+A*C);for(let F=1;F<u-1;++F){x=r[2*(F-1)],y=r[2*(F-1)+1],b=r[2*F],_=r[2*F+1],v=r[2*(F+1)],E=r[2*(F+1)+1],w=-(y-_),A=x-b,I=Math.sqrt(w*w+A*A),w/=I,A/=I,w*=p,A*=p,T=-(_-E),S=b-v,I=Math.sqrt(T*T+S*S),T/=I,S/=I,T*=p,S*=p;const t=b-x,e=y-_,s=b-v,n=E-_,a=t*s+e*n,o=e*s-n*t,h=o<0;if(Math.abs(o)<.001*Math.abs(a)){c.push(b-w*M,_-A*M,b+w*C,_+A*C),a>=0&&(i.join===tl.ROUND?d+=ol(b,_,b-w*M,_-A*M,b-T*M,_-S*M,c,!1)+4:d+=2,c.push(b-T*C,_-S*C,b+T*M,_+S*M));continue}const l=(-w+x)*(-A+_)-(-w+b)*(-A+y),u=(-T+v)*(-S+_)-(-T+b)*(-S+E),f=(t*u-s*l)/o,R=(n*l-e*u)/o,P=(f-b)*(f-b)+(R-_)*(R-_),k=b+(f-b)*M,D=_+(R-_)*M,N=b-(f-b)*C,B=_-(R-_)*C,O=h?M:C,L=P<=Math.min(t*t+e*e,s*s+n*n)+O*O*m;let V=i.join;if(V===tl.MITER&&P/m>g&&(V=tl.BEVEL),L)switch(V){case tl.MITER:c.push(k,D,N,B);break;case tl.BEVEL:h?c.push(k,D,b+w*C,_+A*C,k,D,b+T*C,_+S*C):c.push(b-w*M,_-A*M,N,B,b-T*M,_-S*M,N,B),d+=2;break;case tl.ROUND:h?(c.push(k,D,b+w*C,_+A*C),d+=ol(b,_,b+w*C,_+A*C,b+T*C,_+S*C,c,!0)+4,c.push(k,D,b+T*C,_+S*C)):(c.push(b-w*M,_-A*M,N,B),d+=ol(b,_,b-w*M,_-A*M,b-T*M,_-S*M,c,!1)+4,c.push(b-T*M,_-S*M,N,B))}else{switch(c.push(b-w*M,_-A*M,b+w*C,_+A*C),V){case tl.MITER:h?c.push(N,B,N,B):c.push(k,D,k,D),d+=2;break;case tl.ROUND:d+=h?ol(b,_,b+w*C,_+A*C,b+T*C,_+S*C,c,!0)+2:ol(b,_,b-w*M,_-A*M,b-T*M,_-S*M,c,!1)+2}c.push(b-T*M,_-S*M,b+T*C,_+S*C),d+=2}}x=r[2*(u-2)],y=r[2*(u-2)+1],b=r[2*(u-1)],_=r[2*(u-1)+1],w=-(y-_),A=x-b,I=Math.sqrt(w*w+A*A),w/=I,A/=I,w*=p,A*=p,c.push(b-w*M,_-A*M,b+w*C,_+A*C),h||(i.cap===el.ROUND?d+=ol(b-w*(M-C)*.5,_-A*(M-C)*.5,b-w*M,_-A*M,b+w*C,_+A*C,c,!1)+2:i.cap===el.SQUARE&&(d+=al(b,_,w,A,M,C,!1,c)));const P=e.indices,k=sl.epsilon*sl.epsilon;for(let F=f;F<d+f-2;++F)x=c[2*F],y=c[2*F+1],b=c[2*(F+1)],_=c[2*(F+1)+1],v=c[2*(F+2)],E=c[2*(F+2)+1],!(Math.abs(x*(_-E)+b*(E-y)+v*(y-_))<k)&&P.push(F,F+1,F+2)}(t,e)}class ll{static curveLength(t,e,s,r,n,i){const a=t-2*s+n,o=e-2*r+i,h=2*s-2*t,l=2*r-2*e,c=4*(a*a+o*o),u=4*(a*h+o*l),d=h*h+l*l,f=2*Math.sqrt(c+u+d),p=Math.sqrt(c),m=2*c*p,g=2*Math.sqrt(d),x=u/p;return(m*f+p*u*(f-g)+(4*d*c-u*u)*Math.log((2*p+x+f)/(x+g)))/(4*m)}static curveTo(t,e,s,r,n){const i=n[n.length-2],a=n[n.length-1],o=sl._segmentsCount(ll.curveLength(i,a,t,e,s,r));let h=0,l=0;for(let c=1;c<=o;++c){const u=c/o;h=i+(t-i)*u,l=a+(e-a)*u,n.push(h+(t+(s-t)*u-h)*u,l+(e+(r-e)*u-l)*u)}}}const cl={[ki.POLY]:Kh,[ki.CIRC]:qh,[ki.ELIP]:qh,[ki.RECT]:Qh,[ki.RREC]:Jh},ul=[],dl=[];class fl{constructor(t,e=null,s=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=e,this.matrix=r,this.type=t.type}clone(){return new fl(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const pl=new Fi,ml=class t extends Ri{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ph,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),dl.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),ul.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,s=null,r=null){const n=new fl(t,e,s,r);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const s=new fl(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return s.lineStyle=r.lineStyle,r.holes.push(s),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let s=0;s<e.length;++s){const r=e[s];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,pl):pl.copyFrom(t),r.shape.contains(pl.x,pl.y))){let t=!1;if(r.holes)for(let e=0;e<r.holes.length;e++)if(r.holes[e].shape.contains(pl.x,pl.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let s=null,r=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],r=s.style);for(let o=this.shapeIndex;o<e.length;o++){this.shapeIndex++;const n=e[o],i=n.fillStyle,a=n.lineStyle;cl[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(i.visible||a.visible)&&this.processHoles(n.holes);for(let e=0;e<2;e++){const o=0===e?i:a;if(!o.visible)continue;const h=o.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=_.REPEAT,0===e?this.processFill(n):this.processLine(n);const u=this.points.length/2-c;0!==u&&(s&&!this._compareStyles(r,o)&&(s.end(l,c),s=null),s||(s=ul.pop()||new nl,s.begin(o,l,c),this.batches.push(s),r=o),this.addUvs(this.points,t,o.texture,c,u,o.matrix))}}const n=this.indices.length,i=this.points.length/2;if(s&&s.end(n,i),0===this.batches.length)return void(this.batchable=!0);const a=i>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],s=e.fillStyle,r=e.lineStyle;if(s&&!s.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,s=t.length;e<s;e++){const s=t[e];for(let t=0;t<s.size;t++){const e=s.start+t;this.indicesUint16[e]=this.indicesUint16[e]-s.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*t.BATCHABLE_SIZE}buildDrawCalls(){let t=++yi._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),dl.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,s=this.textureIds;let r=dl.pop();r||(r=new bi,r.texArray=new Aa),r.texArray.count=0,r.start=0,r.size=0,r.type=p.TRIANGLES;let n=0,i=null,a=0,o=!1,h=p.TRIANGLES,l=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,m=f.texture.baseTexture;o!==!!f.native&&(o=!!f.native,h=o?p.LINES:p.TRIANGLES,i=null,n=d,t++),i!==m&&(i=m,m._batchEnabled!==t&&(n===d&&(t++,n=0,r.size>0&&(r=dl.pop(),r||(r=new bi,r.texArray=new Aa),this.drawCalls.push(r)),r.start=l,r.size=0,r.texArray.count=0,r.type=h),m.touched=1,m._batchEnabled=t,m._batchLocation=n,m.wrapMode=_.REPEAT,r.texArray.elements[r.texArray.count++]=m,n++)),r.size+=u.size,l+=u.size,a=m._batchLocation,this.addColors(e,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(s,a,u.attribSize,u.attribStart)}yi._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,s=this.colors,r=this.textureIds,n=new ArrayBuffer(3*t.length*4),i=new Float32Array(n),a=new Uint32Array(n);let o=0;for(let h=0;h<t.length/2;h++)i[o++]=t[2*h],i[o++]=t[2*h+1],i[o++]=e[2*h],i[o++]=e[2*h+1],a[o++]=s[h],i[o++]=r[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Kh.triangulate(t,this):cl[t.type].triangulate(t,this)}processLine(t){hl(t,this);for(let e=0;e<t.holes.length;e++)hl(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const s=t[e];cl[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let s=0;s<t.length/2;s++){const r=t[2*s],n=t[2*s+1];t[2*s]=e.a*r+e.c*n+e.tx,t[2*s+1]=e.b*r+e.d*n+e.ty}}addColors(t,e,s,r,n=0){const i=Nn.shared.setValue(e).toLittleEndianNumber(),a=Nn.shared.setValue(i).toPremultiplied(s);t.length=Math.max(t.length,n+r);for(let o=0;o<r;o++)t[n+o]=a}addTextureIds(t,e,s,r=0){t.length=Math.max(t.length,r+s);for(let n=0;n<s;n++)t[r+n]=e}addUvs(t,e,s,r,n,i=null){let a=0;const o=e.length,h=s.frame;for(;a<n;){let s=t[2*(r+a)],n=t[2*(r+a)+1];if(i){const t=i.a*s+i.c*n+i.tx;n=i.b*s+i.d*n+i.ty,s=t}a++,e.push(s/h.width,n/h.height)}const l=s.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,s,o,n)}adjustUvs(t,e,s,r){const n=e.baseTexture,i=1e-6,a=s+2*r,o=e.frame,h=o.width/n.width,l=o.height/n.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(t[s]+i),f=Math.floor(t[s+1]+i);for(let p=s+2;p<a;p+=2)d=Math.min(d,Math.floor(t[p]+i)),f=Math.min(f,Math.floor(t[p+1]+i));c-=d,u-=f;for(let p=s;p<a;p+=2)t[p]=(t[p]+c)*h,t[p+1]=(t[p+1]+u)*l}};ml.BATCHABLE_SIZE=100;let gl=ml;class xl{constructor(){this.color=16777215,this.alpha=1,this.texture=Xa.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new xl;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Xa.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class yl extends xl{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=el.BUTT,this.join=tl.MITER,this.miterLimit=10}clone(){const t=new yl;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=el.BUTT,this.join=tl.MITER,this.miterLimit=10}}const bl={},_l=class t extends Oh{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new xl,this._lineStyle=new yl,this._matrix=null,this._holeMode=!1,this.state=ci.for2d(),this._geometry=t||new gl,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Nn(16777215),this.blendMode=f.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new t(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,s,r=.5,n=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:s,alignment:r,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Xa.WHITE,color:(null==t?void 0:t.texture)?16777215:0,matrix:null,alignment:.5,native:!1,cap:el.BUTT,join:tl.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const s=t.width>0&&t.alpha>0;return s?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:s},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Li,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Li,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const s=this.currentPath.points,r=s[s.length-2],n=s[s.length-1];return(r!==t||n!==e)&&s.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,s,r){this._initCurve();const n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),ll.curveTo(t,e,s,r,n),this}bezierCurveTo(t,e,s,r,n,i){return this._initCurve(),il.curveTo(t,e,s,r,n,i,this.currentPath.points),this}arcTo(t,e,s,r,n){this._initCurve(t,e);const i=this.currentPath.points,a=rl.curveTo(t,e,s,r,n,i);if(a){const{cx:t,cy:e,radius:s,startAngle:r,endAngle:n,anticlockwise:i}=a;this.arc(t,e,s,r,n,i)}return this}arc(t,e,s,r,n,i=!1){if(r===n)return this;if(!i&&n<=r?n+=Mi:i&&r<=n&&(r+=Mi),n-r==0)return this;const a=t+Math.cos(r)*s,o=e+Math.sin(r)*s,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-a),e=Math.abs(l[l.length-1]-o);t<h&&e<h||l.push(a,o)}else this.moveTo(a,o),l=this.currentPath.points;return rl.arc(a,o,t,e,s,r,n,i,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Xa.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Nn.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Xa.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const s=t.alpha>0;return s?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:s},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,s,r){return this.drawShape(new Ni(t,e,s,r))}drawRoundedRect(t,e,s,r,n){return this.drawShape(new Vi(t,e,s,r,n))}drawCircle(t,e,s){return this.drawShape(new Bi(t,e,s))}drawEllipse(t,e,s,r){return this.drawShape(new Oi(t,e,s,r))}drawPolygon(...t){let e,s=!0;const r=t[0];r.points?(s=r.closeStroke,e=r.points):e=Array.isArray(t[0])?t[0]:t;const n=new Li(e);return n.closeStroke=s,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==ki.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,s=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=s,this.vertexData=new Float32Array(t.points);for(let r=0;r<s;r++){const s=t.batches[r],n=s.style.color,i=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),o={vertexData:i,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*s.start,s.size),uvs:a,_batchRGB:Nn.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=o}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,s=this.batches.length;e<s;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),s=this._geometry,r=this.worldAlpha,n=e.uniforms,i=s.drawCalls;n.translationMatrix=this.transform.worldTransform,Nn.shared.setValue(this._tintColor).premultiply(r).toArray(n.tint),t.shader.bind(e),t.geometry.bind(s,e),t.state.set(this.state);for(let a=0,o=i.length;a<o;a++)this._renderDrawCallDirect(t,s.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:s,type:r,size:n,start:i}=e,a=s.count;for(let o=0;o<a;o++)t.texture.bind(s.elements[o],o);t.geometry.draw(r,n,i)}_resolveDirectShader(t){let e=this.shader;const s=this.pluginName;if(!e){if(!bl[s]){const{maxTextures:e}=t.plugins[s],r=new Int32Array(e);for(let t=0;t<e;t++)r[t]=t;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ui,default:va.from({uSamplers:r},!0)},i=t.plugins[s]._shader.program;bl[s]=new Ea(i,n)}e=bl[s]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:s,maxX:r,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,s,r,n)}containsPoint(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Nn.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,s=e.a,r=e.b,n=e.c,i=e.d,a=e.tx,o=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let u=0;u<h.length;u+=2){const t=h[u],e=h[u+1];l[c++]=s*t+n*e+a,l[c++]=i*e+r*t+o}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};_l.curves=sl,_l._TEMP_POINT=new Fi;let vl=_l;const El=[0,0,0];class wl extends Uh{constructor(){super(...arguments),this.region=null,this.attachment=null}}class Al extends zh{constructor(t,e,s,r,n){super(t,e,s,r,n),this.region=null,this.attachment=null}}const Tl=class extends Oh{constructor(t){if(super(),!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');this.spineData=t,this.createSkeleton(t),this.slotContainers=[],this.tempClipContainers=[];for(let e=0,s=this.skeleton.slots.length;e<s;e++){const t=this.skeleton.slots[e],s=t.getAttachment(),n=this.newContainer();if(this.slotContainers.push(n),this.addChild(n),this.tempClipContainers.push(null),s)if(s.type===r.Region){const e=s.name,r=this.createSprite(t,s,e);t.currentSprite=r,t.currentSpriteName=e,n.addChild(r)}else if(s.type===r.Mesh){const e=this.createMesh(t,s);t.currentMesh=e,t.currentMeshId=s.id,t.currentMeshName=s.name,n.addChild(e)}else s.type===r.Clipping&&(this.createGraphics(t,s),n.addChild(t.clippingContainer),n.addChild(t.currentGraphics))}this.tintRgb=new Float32Array([1,1,1]),this.autoUpdate=!0,this.visible=!0}get debug(){return this._debug}set debug(t){var e;t!=this._debug&&(null==(e=this._debug)||e.unregisterSpine(this),null==t||t.registerSpine(this),this._debug=t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this.updateTransform=t?Tl.prototype.autoUpdateTransform:Oh.prototype.updateTransform)}get tint(){return Bn(this.tintRgb)}set tint(t){this.tintRgb=function(t,e=[]){return Jr("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Nn.shared.setValue(t).toRgbArray(e)}(t,this.tintRgb)}get delayLimit(){return(void 0!==this.localDelayLimit?this.localDelayLimit:Ch)||Number.MAX_VALUE}update(t){var e;const s=this.delayLimit;if(t>s&&(t=s),this.state.update(t),this.state.apply(this.skeleton),!this.skeleton)return;this.skeleton.updateWorldTransform();const n=this.skeleton.slots,i=this.color;let a=null,o=null;i?(a=i.light,o=i.dark):a=this.tintRgb;for(let u=0,d=n.length;u<d;u++){const t=n[u],e=t.getAttachment(),s=this.slotContainers[u];if(!e){s.visible=!1;continue}let i=null;e.sequence&&e.sequence.apply(t,e);let h=e.region;const l=e.color;switch(null!=e&&e.type){case r.Region:if(s.transform.setFromMatrix(t.bone.matrix),h=e.region,t.currentMesh&&(t.currentMesh.visible=!1,t.currentMesh=null,t.currentMeshId=void 0,t.currentMeshName=void 0),!h){t.currentSprite&&(t.currentSprite.renderable=!1);break}if(!t.currentSpriteName||t.currentSpriteName!==e.name){const r=e.name;if(t.currentSprite&&(t.currentSprite.visible=!1),t.sprites=t.sprites||{},void 0!==t.sprites[r])t.sprites[r].visible=!0;else{const n=this.createSprite(t,e,r);s.addChild(n)}t.currentSprite=t.sprites[r],t.currentSpriteName=r}t.currentSprite.renderable=!0,t.hackRegion||this.setSpriteRegion(e,t.currentSprite,h),t.currentSprite.color?i=t.currentSprite.color:(El[0]=a[0]*t.color.r*l.r,El[1]=a[1]*t.color.g*l.g,El[2]=a[2]*t.color.b*l.b,t.currentSprite.tint=Bn(El)),t.currentSprite.blendMode=t.blendMode;break;case r.Mesh:if(t.currentSprite){t.currentSprite.visible=!1,t.currentSprite=null,t.currentSpriteName=void 0;const e=new Ki;e._parentID=-1,e._worldID=s.transform._worldID,s.transform=e}if(!h){t.currentMesh&&(t.currentMesh.renderable=!1);break}const n=e.id;if(void 0===t.currentMeshId||t.currentMeshId!==n){const r=n;if(t.currentMesh&&(t.currentMesh.visible=!1),t.meshes=t.meshes||{},void 0!==t.meshes[r])t.meshes[r].visible=!0;else{const r=this.createMesh(t,e);s.addChild(r)}t.currentMesh=t.meshes[r],t.currentMeshName=e.name,t.currentMeshId=r}t.currentMesh.renderable=!0,e.computeWorldVerticesOld(t,t.currentMesh.vertices),t.currentMesh.color?i=t.currentMesh.color:(El[0]=a[0]*t.color.r*l.r,El[1]=a[1]*t.color.g*l.g,El[2]=a[2]*t.color.b*l.b,t.currentMesh.tint=Bn(El)),t.currentMesh.blendMode=t.blendMode,t.hackRegion||this.setMeshRegion(e,t.currentMesh,h);break;case r.Clipping:t.currentGraphics||(this.createGraphics(t,e),s.addChild(t.clippingContainer),s.addChild(t.currentGraphics)),this.updateGraphics(t,e),s.alpha=1,s.visible=!0;continue;default:s.visible=!1;continue}if(s.visible=!0,i){let e=t.color.r*l.r,s=t.color.g*l.g,r=t.color.b*l.b;i.setLight(a[0]*e+o[0]*(1-e),a[1]*s+o[1]*(1-s),a[2]*r+o[2]*(1-r)),t.darkColor?(e=t.darkColor.r,s=t.darkColor.g,r=t.darkColor.b):(e=0,s=0,r=0),i.setDark(a[0]*e+o[0]*(1-e),a[1]*s+o[1]*(1-s),a[2]*r+o[2]*(1-r))}s.alpha=t.color.a}const h=this.skeleton.drawOrder;let l=null,c=null;for(let r=0,u=h.length;r<u;r++){const t=n[h[r].data.index],e=this.slotContainers[h[r].data.index];if(c||null!==e.parent&&e.parent!==this&&(e.parent.removeChild(e),e.parent=this),t.currentGraphics&&t.getAttachment())c=t.clippingContainer,l=t.getAttachment(),c.children.length=0,this.children[r]=e,l.endSlot===t.data&&(l.endSlot=null);else if(c){let s=this.tempClipContainers[r];s||(s=this.tempClipContainers[r]=this.newContainer(),s.visible=!1),this.children[r]=s,e.parent=null,c.addChild(e),l.endSlot==t.data&&(c.renderable=!0,c=null,l=null)}else this.children[r]=e}null==(e=this._debug)||e.renderDebug(this)}setSpriteRegion(t,e,s){e.attachment===t&&e.region===s||(e.region=s,e.attachment=t,e.texture=s.texture,e.rotation=t.rotation*vh.degRad,e.position.x=t.x,e.position.y=t.y,e.alpha=t.color.a,s.size?(e.scale.x=s.size.width/s.originalWidth,e.scale.y=-s.size.height/s.originalHeight):(e.scale.x=t.scaleX*t.width/s.originalWidth,e.scale.y=-t.scaleY*t.height/s.originalHeight))}setMeshRegion(t,e,s){e.attachment===t&&e.region===s||(e.region=s,e.attachment=t,e.texture=s.texture,s.texture.updateUvs(),e.uvBuffer.update(t.regionUVs))}autoUpdateTransform(){{this.lastTime=this.lastTime||Date.now();const t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}Oh.prototype.updateTransform.call(this)}createSprite(t,e,s){let r=e.region;t.hackAttachment===e&&(r=t.hackRegion);const n=r?r.texture:null,i=this.newSprite(n);return i.anchor.set(.5),r&&this.setSpriteRegion(e,i,e.region),t.sprites=t.sprites||{},t.sprites[s]=i,i}createMesh(t,e){let s=e.region;t.hackAttachment===e&&(s=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);const r=this.newMesh(s?s.texture:null,new Float32Array(e.regionUVs.length),e.regionUVs,new Uint16Array(e.triangles),p.TRIANGLES);return void 0!==r._canvasPadding&&(r._canvasPadding=1.5),r.alpha=e.color.a,r.region=e.region,s&&this.setMeshRegion(e,r,s),t.meshes=t.meshes||{},t.meshes[e.id]=r,r}createGraphics(t,e){const s=this.newGraphics(),r=new Li([]);return s.clear(),s.beginFill(16777215,1),s.drawPolygon(r),s.renderable=!1,t.currentGraphics=s,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,s}updateGraphics(t,e){const s=t.currentGraphics.geometry,r=s.graphicsData[0].shape.points,n=e.worldVerticesLength;r.length=n,e.computeWorldVertices(t,0,n,r,0,2),s.invalidate()}hackTextureBySlotIndex(t,e=null,s=null){const r=this.skeleton.slots[t];if(!r)return!1;const n=r.getAttachment();let i=n.region;return e?(i=new ch,i.texture=e,i.size=s,r.hackRegion=i,r.hackAttachment=n):(r.hackRegion=null,r.hackAttachment=null),r.currentSprite?this.setSpriteRegion(n,r.currentSprite,i):r.currentMesh&&this.setMeshRegion(n,r.currentMesh,i),!0}hackTextureBySlotName(t,e=null,s=null){const r=this.skeleton.findSlotIndex(t);return-1!=r&&this.hackTextureBySlotIndex(r,e,s)}hackTextureAttachment(t,e,s,r=null){const n=this.skeleton.findSlotIndex(t),i=this.skeleton.getAttachmentByName(t,e);i.region.texture=s;const a=this.skeleton.slots[n];if(!a)return!1;const o=a.getAttachment();if(e===o.name){let t=i.region;return s?(t=new ch,t.texture=s,t.size=r,a.hackRegion=t,a.hackAttachment=o):(a.hackRegion=null,a.hackAttachment=null),a.currentSprite&&a.currentSprite.region!=t?(this.setSpriteRegion(o,a.currentSprite,t),a.currentSprite.region=t):a.currentMesh&&a.currentMesh.region!=t&&this.setMeshRegion(o,a.currentMesh,t),!0}return!1}newContainer(){return new Oh}newSprite(t){return new wl(t)}newGraphics(){return new vl}newMesh(t,e,s,r,n){return new Al(t,e,s,r,n)}transformHack(){return 1}hackAttachmentGroups(t,e,s){if(!t)return;const r=[],n=[];for(let i=0,a=this.skeleton.slots.length;i<a;i++){const a=this.skeleton.slots[i],o=a.currentSpriteName||a.currentMeshName||"",h=a.currentSprite||a.currentMesh;o.endsWith(t)?(h.parentGroup=e,n.push(h)):s&&h&&(h.parentGroup=s,r.push(h))}return[r,n]}destroy(t){this.debug=null;for(let e=0,s=this.skeleton.slots.length;e<s;e++){const s=this.skeleton.slots[e];for(const e in s.meshes)s.meshes[e].destroy(t);s.meshes=null;for(const e in s.sprites)s.sprites[e].destroy(t);s.sprites=null}for(let e=0,s=this.slotContainers.length;e<s;e++)this.slotContainers[e].destroy(t);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,super.destroy(t)}};let Sl=Tl;Sl.clippingPolygon=[],Object.defineProperty(Sl.prototype,"visible",{get(){return this._visible},set(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}});const Il={loader:ri.LoadParser,resolver:ri.ResolveParser,cache:ri.CacheParser,detection:ri.DetectionParser};ai.handle(ri.Asset,(t=>{const e=t.ref;Object.entries(Il).filter((([t])=>!!e[t])).forEach((([t,s])=>ai.add(Object.assign(e[t],{extension:e[t].extension??s}))))}),(t=>{const e=t.ref;Object.keys(Il).filter((t=>!!e[t])).forEach((t=>ai.remove(e[t])))}));class Rl{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<e;s++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ml(t,e){if(Array.isArray(e)){for(const s of e)if(t.startsWith(`data:${s}`))return!0;return!1}return t.startsWith(`data:${e}`)}function Cl(t,e){const s=t.split("?")[0],r=sn.extname(s).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const Pl=(t,e,s=!1)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t||s?e(t):t)):t),kl=(t,e)=>{const s=e.split("?")[1];return s&&(t+=`?${s}`),t};function Fl(t,e,s,r,n){const i=e[s];for(let a=0;a<i.length;a++){const o=i[a];s<e.length-1?Fl(t.replace(r[s],o),e,s+1,r,n):n.push(t.replace(r[s],o))}}function Dl(t){const e=t.match(/\{(.*?)\}/g),s=[];if(e){const r=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");r.push(e)})),Fl(t,r,0,e,s)}else s.push(t);return s}const Nl=t=>!Array.isArray(t);const Bl=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const s=Pl(t);let r;for(let a=0;a<this.parsers.length;a++){const t=this.parsers[a];if(t.test(e)){r=t.getCacheableAssets(s,e);break}}r||(r={},s.forEach((t=>{r[t]=e})));const n=Object.keys(r),i={cacheKeys:n,keys:s};if(s.forEach((t=>{this._cacheMap.set(t,i)})),n.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,r[t])})),e instanceof Xa){const t=e;s.forEach((e=>{t.baseTexture!==Xa.EMPTY.baseTexture&&yi.addToCache(t.baseTexture,e),Xa.addToCache(t,e)}))}}remove(t){if(!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}};class Ol{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,s)=>(this._parsersValidated=!1,t[e]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const s={promise:null,parser:null};return s.promise=(async()=>{var r,n;let i=null,a=null;if(e.loadParser&&(a=this._parserHash[e.loadParser],a||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!a){for(let s=0;s<this.parsers.length;s++){const n=this.parsers[s];if(n.load&&(null==(r=n.test)?void 0:r.call(n,t,e,this))){a=n;break}}if(!a)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await a.load(t,e,this),s.parser=a;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];r.parse&&r.parse&&await(null==(n=r.testParse)?void 0:n.call(r,i,e,this))&&(i=await r.parse(i,e,this)||i,s.parser=r)}return i})(),s}async load(t,e){this._parsersValidated||this._validateParsers();let s=0;const r={},n=Nl(t),i=Pl(t,(t=>({alias:[t],src:t}))),a=i.length,o=i.map((async t=>{const n=sn.toAbsolute(t.src);if(!r[t.src])try{this.promiseCache[n]||(this.promiseCache[n]=this._getLoadPromiseAndParser(n,t)),r[t.src]=await this.promiseCache[n].promise,e&&e(++s/a)}catch(Xy){throw delete this.promiseCache[n],delete r[t.src],new Error(`[Loader.load] Failed to load ${n}.\n${Xy}`)}}));return await Promise.all(o),n?r[i[0].src]:r}async unload(t){const e=Pl(t,(t=>({alias:[t],src:t}))).map((async t=>{var e,s;const r=sn.toAbsolute(t.src),n=this.promiseCache[r];if(n){const i=await n.promise;delete this.promiseCache[r],null==(s=null==(e=n.parser)?void 0:e.unload)||s.call(e,i,t,this)}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e})),{})}}var Ll=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ll||{});const Vl={extension:{type:ri.LoadParser,priority:Ll.Low},name:"loadJson",test:t=>Ml(t,"application/json")||Cl(t,".json"),load:async t=>await(await M.ADAPTER.fetch(t)).json()};ai.add(Vl);const Ul={name:"loadTxt",extension:{type:ri.LoadParser,priority:Ll.Low},test:t=>Ml(t,"text/plain")||Cl(t,".txt"),load:async t=>await(await M.ADAPTER.fetch(t)).text()};ai.add(Ul);const Xl=["normal","bold","100","200","300","400","500","600","700","800","900"],Yl=[".ttf",".otf",".woff",".woff2"],Gl=["font/ttf","font/otf","font/woff","font/woff2"],Wl=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const Hl=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;const $l={extension:{type:ri.LoadParser,priority:Ll.Low},name:"loadWebFont",test:t=>Ml(t,Gl)||Cl(t,Yl),async load(t,e){var s,r,n;const i=M.ADAPTER.getFontFaceSet();if(i){const o=[],h=(null==(s=e.data)?void 0:s.family)??function(t){const e=sn.extname(t),s=sn.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let r=s.length>0;for(const i of s)if(!i.match(Wl)){r=!1;break}let n=s.join(" ");return r||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}(t),l=(null==(n=null==(r=e.data)?void 0:r.weights)?void 0:n.filter((t=>Xl.includes(t))))??["normal"],c=e.data??{};for(let e=0;e<l.length;e++){const s=l[e],r=new FontFace(h,`url(${a=t,Hl.test(a)?a:encodeURI(a)})`,{...c,weight:s});await r.load(),i.add(r),o.push(r)}return 1===o.length?o[0]:o}var a;return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>M.ADAPTER.getFontFaceSet().delete(t)))}};ai.add($l);let jl=null,zl=class{constructor(){jl||(jl=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(jl)}};zl.revokeObjectURL=function(){jl&&(URL.revokeObjectURL(jl),jl=null)};let ql=null;class Zl{constructor(){ql||(ql=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(ql)}}Zl.revokeObjectURL=function(){ql&&(URL.revokeObjectURL(ql),ql=null)};let Kl,Ql=0;const Jl=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const{worker:e}=new zl;e.addEventListener("message",(s=>{e.terminate(),zl.revokeObjectURL(),t(s.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Kl&&(Kl=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Kl&&(this._createdWorkers++,t=(new Zl).worker,t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const s=new Promise(((s,r)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:r})}));return this.next(),s}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),s=e.id;this.resolveHash[Ql]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Ql++,id:s})}};function tc(t,e,s){t.resource.internal=!0;const r=new Xa(t),n=()=>{delete e.promiseCache[s],Bl.has(s)&&Bl.remove(s)};return r.baseTexture.once("destroyed",(()=>{s in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())})),r.once("destroyed",(()=>{t.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())})),r}const ec=[".jpeg",".jpg",".png",".webp",".avif"],sc=["image/jpeg","image/png","image/webp","image/avif"];const rc={name:"loadTextures",extension:{type:ri.LoadParser,priority:Ll.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Ml(t,sc)||Cl(t,ec),async load(t,e,s){var r;const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let i;i=n?this.config.preferWorkers&&await Jl.isImageBitmapSupported()?await Jl.loadImageBitmap(t):await async function(t){const e=await M.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const s=await e.blob();return await createImageBitmap(s)}(t):await new Promise(((e,s)=>{const r=new Image;r.crossOrigin=this.config.crossOrigin,r.src=t,r.complete?e(r):(r.onload=()=>e(r),r.onerror=t=>s(t))}));const a={...e.data};a.resolution??(a.resolution=si(t)),n&&void 0===(null==(r=a.resourceOptions)?void 0:r.ownsImageBitmap)&&(a.resourceOptions={...a.resourceOptions},a.resourceOptions.ownsImageBitmap=!0);const o=new yi(i,a);return o.resource.src=t,tc(o,s,t)},unload(t){t.destroy(!0)}};ai.add(rc);const nc={extension:{type:ri.LoadParser,priority:Ll.High},name:"loadSVG",test:t=>Ml(t,"image/svg+xml")||Cl(t,".svg"),testParse:async t=>nh.test(t),async parse(t,e,s){var r;const n=new nh(t,null==(r=null==e?void 0:e.data)?void 0:r.resourceOptions);await n.load();const i=new yi(n,{resolution:si(t),...null==e?void 0:e.data});return i.resource.src=e.src,tc(i,s,e.src)},load:async(t,e)=>(await M.ADAPTER.fetch(t)).text(),unload:rc.unload};ai.add(nc);const ic=[".mp4",".m4v",".webm",".ogv"],ac=["video/mp4","video/webm","video/ogg"],oc={name:"loadVideo",extension:{type:ri.LoadParser,priority:Ll.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:t=>Ml(t,ac)||Cl(t,ic),async load(t,e,s){var r;let n;const i=await(await M.ADAPTER.fetch(t)).blob(),a=URL.createObjectURL(i);try{const i={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...null==(r=null==e?void 0:e.data)?void 0:r.resourceOptions,autoLoad:!0},o=new ah(a,i);await o.load();const h=new yi(o,{alphaMode:await an(),resolution:si(t),...null==e?void 0:e.data});h.resource.src=t,n=tc(h,s,t),n.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(a)}))}catch(Xy){throw URL.revokeObjectURL(a),Xy}return n},unload(t){t.destroy(!0)}};ai.add(oc);class hc{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}getAlias(t){const{alias:e,name:s,src:r,srcs:n}=t;return Pl(e||s||r||n,(t=>"string"==typeof t?t:Array.isArray(t)?t.map((t=>(null==t?void 0:t.src)??(null==t?void 0:t.srcs)??t)):(null==t?void 0:t.src)||(null==t?void 0:t.srcs)?t.src??t.srcs:t),!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const s=[];Array.isArray(e)?e.forEach((e=>{const r=e.src??e.srcs,n=e.alias??e.name;let i;if("string"==typeof n){const e=this._createBundleAssetId(t,n);s.push(e),i=[n,e]}else{const e=n.map((e=>this._createBundleAssetId(t,e)));s.push(...e),i=[...n,...e]}this.add({...e,alias:i,src:r})})):Object.keys(e).forEach((r=>{const n=[r,this._createBundleAssetId(t,r)];if("string"==typeof e[r])this.add({alias:n,src:e[r]});else if(Array.isArray(e[r]))this.add({alias:n,src:e[r]});else{const t=e[r],s=t.src??t.srcs;this.add({...t,alias:n,src:Array.isArray(s)?s:[s]})}s.push(...n)})),this._bundles[t]=s}add(t,e,s,r,n){const i=[];let a;"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]?(Jr("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),i.push({alias:t,src:e,data:s,format:r,loadParser:n})):Array.isArray(t)?i.push(...t):i.push(t),a=t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)},Pl(i).forEach((t=>{const{src:e,srcs:s}=t;let{data:r,format:n,loadParser:i}=t;const o=Pl(e||s).map((t=>"string"==typeof t?Dl(t):Array.isArray(t)?t:[t])),h=this.getAlias(t);Array.isArray(h)?h.forEach(a):a(h);const l=[];o.forEach((t=>{t.forEach((t=>{let e={};if("object"!=typeof t){e.src=t;for(let s=0;s<this._parsers.length;s++){const r=this._parsers[s];if(r.test(t)){e=r.parse(t);break}}}else r=t.data??r,n=t.format??n,i=t.loadParser??i,e={...e,...t};if(!h)throw new Error(`[Resolver] alias is undefined for this asset: ${e.src}`);e=this.buildResolvedAsset(e,{aliases:h,data:r,format:n,loadParser:i}),l.push(e)}))})),h.forEach((t=>{this._assetMap[t]=l}))}))}resolveBundle(t){const e=Nl(t);t=Pl(t);const s={};return t.forEach((t=>{const e=this._bundles[t];if(e){const r=this.resolve(e),n={};for(const e in r){const s=r[e];n[this._extractAssetIdFromBundle(t,e)]=s}s[t]=n}})),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const s in e)t[s]=e[s].src;return t}return e.src}resolve(t){const e=Nl(t);t=Pl(t);const s={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const s=e[0],r=this._getPreferredOrder(e);null==r||r.priority.forEach((t=>{r.params[t].forEach((s=>{const r=e.filter((e=>!!e[t]&&e[t]===s));r.length&&(e=r)}))})),this._resolverHash[t]=e[0]??s}else this._resolverHash[t]=this.buildResolvedAsset({alias:[t],src:t},{});s[t]=this._resolverHash[t]})),e?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],s=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:s,data:r,loadParser:n,format:i}=e;return(this._basePath||this._rootPath)&&(t.src=sn.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=s??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=n??t.loadParser,t.format=i??t.format??sn.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}const lc=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new hc,this.loader=new Ol,this.cache=Bl,this._backgroundLoader=new Rl(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var e,s;if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const r=(null==(e=t.texturePreference)?void 0:e.resolution)??1,n="number"==typeof r?[r]:r,i=await this._detectFormats({preferredFormats:null==(s=t.texturePreference)?void 0:s.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,s,r,n){this.resolver.add(t,e,s,r,n)}async load(t,e){this._initialized||await this.init();const s=Nl(t),r=Pl(t).map((t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some((t=>!this.resolver.hasKey(t)))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t})),n=this.resolver.resolve(r),i=await this._mapLoadToResolve(n,e);return s?i[r[0]]:i}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let s=!1;"string"==typeof t&&(s=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},i=Object.keys(r);let a=0,o=0;const h=()=>{null==e||e(++a/o)},l=i.map((t=>{const e=r[t];return o+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{n[t]=e}))}));return await Promise.all(l),s?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Bl.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=Bl.get(t[s]);return e}async _mapLoadToResolve(t,e){const s=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(s,e);this._backgroundLoader.active=!0;const i={};return s.forEach(((t,e)=>{const s=n[t.src],a=[t.src];t.alias&&a.push(...t.alias),i[r[e]]=s,Bl.set(a,s)})),i}async unload(t){this._initialized||await this.init();const e=Pl(t).map((t=>"string"!=typeof t?t.src:t)),s=this.resolver.resolve(e);await this._unloadFromResolved(s)}async unloadBundle(t){this._initialized||await this.init(),t=Pl(t);const e=this.resolver.resolveBundle(t),s=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(s)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Bl.remove(t.src)})),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const s of t.detections)t.skipDetections||await s.test()?e=await s.add(e):t.skipDetections||(e=await s.remove(e));return e=e.filter(((t,s)=>e.indexOf(t)===s)),e}get detections(){return this._detections}get preferWorkers(){return rc.config.preferWorkers}set preferWorkers(t){Jr("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((s=>{e.config[s]=t[s]}))}))}};ai.handleByList(ri.LoadParser,lc.loader.parsers).handleByList(ri.ResolveParser,lc.resolver.parsers).handleByList(ri.CacheParser,lc.cache.parsers).handleByList(ri.DetectionParser,lc.detections);const cc={extension:ri.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Xa)),getCacheableAssets:(t,e)=>{const s={};return t.forEach((t=>{e.forEach(((e,r)=>{s[t+(0===r?"":r+1)]=e}))})),s}};async function uc(t){if("Image"in globalThis)return new Promise((e=>{const s=new Image;s.onload=()=>{e(!0)},s.onerror=()=>{e(!1)},s.src=t}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}ai.add(cc);const dc={extension:{type:ri.DetectionParser,priority:1},test:async()=>uc("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};ai.add(dc);const fc={extension:{type:ri.DetectionParser,priority:0},test:async()=>uc("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};ai.add(fc);const pc=["png","jpg","jpeg"],mc={extension:{type:ri.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...pc],remove:async t=>t.filter((t=>!pc.includes(t)))};ai.add(mc);const gc="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function xc(t){return!gc&&""!==document.createElement("video").canPlayType(t)}const yc={extension:{type:ri.DetectionParser,priority:0},test:async()=>xc("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter((t=>"webm"!==t))};ai.add(yc);const bc={extension:{type:ri.DetectionParser,priority:0},test:async()=>xc("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter((t=>"mp4"!==t&&"m4v"!==t))};ai.add(bc);const _c={extension:{type:ri.DetectionParser,priority:0},test:async()=>xc("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter((t=>"ogv"!==t))};ai.add(_c);const vc={extension:ri.ResolveParser,test:rc.test,parse:t=>{var e;return{resolution:parseFloat((null==(e=M.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:sn.extname(t).slice(1),src:t}}};ai.add(vc);const Ec={extension:ri.Asset,loader:{extension:{type:ri.LoadParser,priority:Ll.Normal},test:t=>Cl(t,".atlas"),async load(t){const e=await M.ADAPTER.fetch(t);return await e.text()},testParse(t,e){const s=Cl(e.src,".atlas"),r="string"==typeof t;return Promise.resolve(s&&r)},async parse(t,e,s){const r=e.data;let n=sn.dirname(e.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let i=null,a=null;const o=new Promise(((t,e)=>{i=t,a=e}));let h;const l=t=>{t||a("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),i(h)};if(r.image||r.images){const e=Object.assign(r.image?{default:r.image}:{},r.images);h=new dh(t,((t,s)=>{const r=e[t]||e.default;r&&r.baseTexture?s(r.baseTexture):s(r)}),l)}else h=new dh(t,wc(s,n,r.imageMetadata),l);return await o},unload(t){t.dispose()}}},wc=(t,e,s)=>async(r,n)=>{const i=sn.normalize([...e.split(sn.sep),r].join(sn.sep));n((await t.load({src:i,data:s})).baseTexture)};function Ac(t){return t.hasOwnProperty("bones")}ai.add(Ec);class Tc{constructor(){}installLoader(){const t=this,e={extension:ri.Asset,loader:{extension:{type:ri.LoadParser,priority:Ll.Normal},test:t=>Cl(t,".skel"),async load(t){const e=await M.ADAPTER.fetch(t);return await e.arrayBuffer()},testParse(t,e){var s;const r=Cl(e.src,".json")&&Ac(t),n=Cl(e.src,".skel")&&t instanceof ArrayBuffer;const i=!1===(null==(s=e.data)?void 0:s.spineAtlas);return Promise.resolve(r&&!i||n)},async parse(e,s,r){const n=sn.extname(s.src).toLowerCase(),i=sn.basename(s.src,n);let a=sn.dirname(s.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let o=null,h=e;Cl(s.src,".json")&&Ac(e)?o=t.createJsonParser():(o=t.createBinaryParser(),h=new Uint8Array(e));const l=s.data||{},c=(null==l?void 0:l.spineSkeletonScale)??null;c&&(o.scale=c);const u=l.spineAtlas;if(u&&u.pages)return t.parseData(o,u,h);const d=l.atlasRawData;if(d){let e=null,s=null;const n=new Promise(((t,r)=>{e=t,s=r})),i=new dh(d,wc(r,a,l.imageMetadata),(t=>{t||s("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),e(i)})),c=await n;return t.parseData(o,c,h)}let f=l.spineAtlasFile;f||(f=`${a+i}.atlas`);const p=await r.load({src:f,data:l,alias:l.spineAtlasAlias});return t.parseData(o,p,h)}}};return ai.add(e),e}}let Sc=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const Ic=class extends Sc{constructor(t){super(t),this.id=(65535&Ic.nextID++)<<11,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,r,n,i){s=n+(s>>1)*i;const a=t.bone.skeleton,o=t.deform;let h=this.vertices;const l=this.bones;if(null==l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,f=a.b,p=a.d;for(let t=e,o=n;o<s;t+=2,o+=i){const e=h[t],s=h[t+1];r[o]=e*u+s*d+l,r[o+1]=e*f+s*p+c}return}let c=0,u=0;for(let f=0;f<e;f+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let f=n,p=3*u;f<s;f+=i){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,p+=3){const s=d[l[c]].matrix,r=h[p],n=h[p+1],i=h[p+2];t+=(r*s.a+n*s.c+s.tx)*i,e+=(r*s.b+n*s.d+s.ty)*i}r[f]=t,r[f+1]=e}else{const t=o;for(let e=n,a=3*u,o=u<<1;e<s;e+=i){let s=0,n=0,i=l[c++];for(i+=c;c<i;c++,a+=3,o+=2){const e=d[l[c]].matrix,r=h[a]+t[o],i=h[a+1]+t[o+1],u=h[a+2];s+=(r*e.a+i*e.c+e.tx)*u,n+=(r*e.b+i*e.d+e.ty)*u}r[e]=s,r[e+1]=n}}}copyTo(t){null!=this.bones?(t.bones=new Array(this.bones.length),Sh.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=Sh.newFloatArray(this.vertices.length),Sh.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}};let Rc=Ic;Rc.nextID=0;let Mc=class t extends Rc{constructor(t){super(t),this.type=r.BoundingBox,this.color=new bh(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.color.setFromColor(this.color),e}},Cc=class t extends Rc{constructor(t){super(t),this.type=r.Clipping,this.color=new bh(.2275,.2275,.8078,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.endSlot=this.endSlot,e.color.setFromColor(this.color),e}},Pc=class t extends Rc{constructor(t){super(t),this.type=r.Mesh,this.color=new bh(1,1,1,1),this.tempColor=new bh(0,0,0,0)}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(null!=this.parentMesh)return this.newLinkedMesh();const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Float32Array(this.regionUVs.length),Sh.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.triangles=new Array(this.triangles.length),Sh.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),Sh.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e}newLinkedMesh(){const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),e.deformAttachment=this.deformAttachment,e.setParentMesh(null!=this.parentMesh?this.parentMesh:this),e}},kc=class t extends Rc{constructor(t){super(t),this.type=r.Path,this.closed=!1,this.constantSpeed=!1,this.color=new bh(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),Sh.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e}},Fc=class t extends Rc{constructor(t){super(t),this.type=r.Point,this.color=new bh(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=vh.cosDeg(this.rotation),r=vh.sinDeg(this.rotation),n=s*e.a+r*e.c,i=s*e.b+r*e.d;return Math.atan2(i,n)*vh.radDeg}copy(){const e=new t(this.name);return e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.color.setFromColor(this.color),e}},Dc=class{constructor(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new bh,this.darkColor=null==t.darkColor?null:new bh,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const Nc=class extends Sc{constructor(t){super(t),this.type=r.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new bh(1,1,1,1),this.offset=Sh.newFloatArray(8),this.uvs=Sh.newFloatArray(8),this.tempColor=new bh(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,n=s+this.region.width*t,i=r+this.region.height*e,a=this.rotation*Math.PI/180,o=Math.cos(a),h=Math.sin(a),l=s*o+this.x,c=s*h,u=r*o+this.y,d=r*h,f=n*o+this.x,p=n*h,m=i*o+this.y,g=i*h,x=this.offset;x[Nc.OX1]=l-d,x[Nc.OY1]=u+c,x[Nc.OX2]=l-g,x[Nc.OY2]=m+c,x[Nc.OX3]=f-g,x[Nc.OY3]=m+p,x[Nc.OX4]=f-d,x[Nc.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,r){const n=this.offset,i=t instanceof Dc?t.bone.matrix:t.matrix,a=i.tx,o=i.ty,h=i.a,l=i.c,c=i.b,u=i.d;let d=0,f=0;d=n[Nc.OX1],f=n[Nc.OY1],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=r,d=n[Nc.OX2],f=n[Nc.OY2],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=r,d=n[Nc.OX3],f=n[Nc.OY3],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=r,d=n[Nc.OX4],f=n[Nc.OY4],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o}copy(){const t=new Nc(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Sh.arrayCopy(this.uvs,0,t.uvs,0,8),Sh.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}};let Bc=Nc;Bc.OX1=0,Bc.OY1=1,Bc.OX2=2,Bc.OY2=3,Bc.OX3=4,Bc.OY3=5,Bc.OX4=6,Bc.OY4=7,Bc.X1=0,Bc.Y1=1,Bc.C1R=2,Bc.C1G=3,Bc.C1B=4,Bc.C1A=5,Bc.U1=6,Bc.V1=7,Bc.X2=8,Bc.Y2=9,Bc.C2R=10,Bc.C2G=11,Bc.C2B=12,Bc.C2A=13,Bc.U2=14,Bc.V2=15,Bc.X3=16,Bc.Y3=17,Bc.C3R=18,Bc.C3G=19,Bc.C3B=20,Bc.C3A=21,Bc.U3=22,Bc.V3=23,Bc.X4=24,Bc.Y4=25,Bc.C4R=26,Bc.C4G=27,Bc.C4B=28,Bc.C4A=29,Bc.U4=30,Bc.V4=31;const Oc=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,s,r){const n=this.angle*vh.degreesToRadians,i=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(i*i+a*a);if(o<this.radius){const e=Oc.interpolation.apply(0,n,(this.radius-o)/this.radius),s=Math.cos(e),r=Math.sin(e);t.x=s*i-r*a+this.worldX,t.y=r*i+s*a+this.worldY}}end(){}};let Lc=Oc;Lc.interpolation=new Ah(2);let Vc=class{constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(let r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=s}hasTimeline(t){return 1==this.timelineIds[t]}apply(t,e,s,r,n,i,a,o){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,n,i,a,o)}static binarySearch(t,e,s=1){let r=0,n=t.length/s-2;if(0==n)return s;let i=n>>>1;for(;;){if(t[(i+1)*s]<=e?r=i+1:n=i,r==n)return(r+1)*s;i=r+n>>>1}}static linearSearch(t,e,s){for(let r=0,n=t.length-s;r<=n;r+=s)if(t[r]>e)return r;return-1}};var Uc=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(Uc||{});const Xc=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=Sh.newFloatArray((t-1)*Xc.BEZIER_SIZE)}getFrameCount(){return this.curves.length/Xc.BEZIER_SIZE+1}setLinear(t){this.curves[t*Xc.BEZIER_SIZE]=Xc.LINEAR}setStepped(t){this.curves[t*Xc.BEZIER_SIZE]=Xc.STEPPED}getCurveType(t){const e=t*Xc.BEZIER_SIZE;if(e==this.curves.length)return Xc.LINEAR;const s=this.curves[e];return s==Xc.LINEAR?Xc.LINEAR:s==Xc.STEPPED?Xc.STEPPED:Xc.BEZIER}setCurve(t,e,s,r,n){const i=.03*(2*-e+r),a=.03*(2*-s+n),o=.006*(3*(e-r)+1),h=.006*(3*(s-n)+1);let l=2*i+o,c=2*a+h,u=.3*e+i+.16666667*o,d=.3*s+a+.16666667*h,f=t*Xc.BEZIER_SIZE;const p=this.curves;p[f++]=Xc.BEZIER;let m=u,g=d;for(let x=f+Xc.BEZIER_SIZE-1;f<x;f+=2)p[f]=m,p[f+1]=g,u+=l,d+=c,l+=o,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=vh.clamp(e,0,1);const s=this.curves;let r=t*Xc.BEZIER_SIZE;const n=s[r];if(n==Xc.LINEAR)return e;if(n==Xc.STEPPED)return 0;r++;let i=0;for(let o=r,h=r+Xc.BEZIER_SIZE-1;r<h;r+=2)if(i=s[r],i>=e){let t,n;return r==o?(t=0,n=0):(t=s[r-2],n=s[r-1]),n+(s[r+1]-n)*(e-t)/(i-t)}const a=s[r-1];return a+(1-a)*(e-i)/(1-i)}};let Yc=Xc;Yc.LINEAR=0,Yc.STEPPED=1,Yc.BEZIER=2,Yc.BEZIER_SIZE=19;const Gc=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+Gc.ROTATION]=s}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(s<h[0]){switch(a){case i.setup:return void(l.rotation=l.data.rotation);case i.first:const t=l.data.rotation-l.rotation;l.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*n}return}if(s>=h[h.length-Gc.ENTRIES]){let t=h[h.length+Gc.PREV_ROTATION];switch(a){case i.setup:l.rotation=l.data.rotation+t*n;break;case i.first:case i.replace:t+=l.data.rotation-l.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case i.add:l.rotation+=t*n}return}const c=Vc.binarySearch(h,s,Gc.ENTRIES),u=h[c+Gc.PREV_ROTATION],d=h[c],f=this.getCurvePercent((c>>1)-1,1-(s-d)/(h[c+Gc.PREV_TIME]-d));let p=h[c+Gc.ROTATION]-u;switch(p=u+(p-360*(16384-(16384.499999999996-p/360|0)))*f,a){case i.setup:l.rotation=l.data.rotation+(p-360*(16384-(16384.499999999996-p/360|0)))*n;break;case i.first:case i.replace:p+=l.data.rotation-l.rotation;case i.add:l.rotation+=(p-360*(16384-(16384.499999999996-p/360|0)))*n}}};let Wc=Gc;Wc.ENTRIES=2,Wc.PREV_TIME=-2,Wc.PREV_ROTATION=-1,Wc.ROTATION=1;const Hc=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*Hc.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,s,r){t*=Hc.ENTRIES,this.frames[t]=e,this.frames[t+Hc.X]=s,this.frames[t+Hc.Y]=r}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(s<h[0]){switch(a){case i.setup:return l.x=l.data.x,void(l.y=l.data.y);case i.first:l.x+=(l.data.x-l.x)*n,l.y+=(l.data.y-l.y)*n}return}let c=0,u=0;if(s>=h[h.length-Hc.ENTRIES])c=h[h.length+Hc.PREV_X],u=h[h.length+Hc.PREV_Y];else{const t=Vc.binarySearch(h,s,Hc.ENTRIES);c=h[t+Hc.PREV_X],u=h[t+Hc.PREV_Y];const e=h[t],r=this.getCurvePercent(t/Hc.ENTRIES-1,1-(s-e)/(h[t+Hc.PREV_TIME]-e));c+=(h[t+Hc.X]-c)*r,u+=(h[t+Hc.Y]-u)*r}switch(a){case i.setup:l.x=l.data.x+c*n,l.y=l.data.y+u*n;break;case i.first:case i.replace:l.x+=(l.data.x+c-l.x)*n,l.y+=(l.data.y+u-l.y)*n;break;case i.add:l.x+=c*n,l.y+=u*n}}};let $c=Hc;$c.ENTRIES=3,$c.PREV_TIME=-3,$c.PREV_X=-2,$c.PREV_Y=-1,$c.X=1,$c.Y=2;let jc=class t extends $c{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,s,r,n,o,h,l){const c=this.frames,u=e.bones[this.boneIndex];if(!u.active)return;if(r<c[0]){switch(h){case i.setup:return u.scaleX=u.data.scaleX,void(u.scaleY=u.data.scaleY);case i.first:u.scaleX+=(u.data.scaleX-u.scaleX)*o,u.scaleY+=(u.data.scaleY-u.scaleY)*o}return}let d=0,f=0;if(r>=c[c.length-t.ENTRIES])d=c[c.length+t.PREV_X]*u.data.scaleX,f=c[c.length+t.PREV_Y]*u.data.scaleY;else{const e=Vc.binarySearch(c,r,t.ENTRIES);d=c[e+t.PREV_X],f=c[e+t.PREV_Y];const s=c[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(r-s)/(c[e+t.PREV_TIME]-s));d=(d+(c[e+t.X]-d)*n)*u.data.scaleX,f=(f+(c[e+t.Y]-f)*n)*u.data.scaleY}if(1==o)h==i.add?(u.scaleX+=d-u.data.scaleX,u.scaleY+=f-u.data.scaleY):(u.scaleX=d,u.scaleY=f);else{let t=0,e=0;if(l==a.mixOut)switch(h){case i.setup:t=u.data.scaleX,e=u.data.scaleY,u.scaleX=t+(Math.abs(d)*vh.signum(t)-t)*o,u.scaleY=e+(Math.abs(f)*vh.signum(e)-e)*o;break;case i.first:case i.replace:t=u.scaleX,e=u.scaleY,u.scaleX=t+(Math.abs(d)*vh.signum(t)-t)*o,u.scaleY=e+(Math.abs(f)*vh.signum(e)-e)*o;break;case i.add:t=u.scaleX,e=u.scaleY,u.scaleX=t+(Math.abs(d)*vh.signum(t)-u.data.scaleX)*o,u.scaleY=e+(Math.abs(f)*vh.signum(e)-u.data.scaleY)*o}else switch(h){case i.setup:t=Math.abs(u.data.scaleX)*vh.signum(d),e=Math.abs(u.data.scaleY)*vh.signum(f),u.scaleX=t+(d-t)*o,u.scaleY=e+(f-e)*o;break;case i.first:case i.replace:t=Math.abs(u.scaleX)*vh.signum(d),e=Math.abs(u.scaleY)*vh.signum(f),u.scaleX=t+(d-t)*o,u.scaleY=e+(f-e)*o;break;case i.add:t=vh.signum(d),e=vh.signum(f),u.scaleX=Math.abs(u.scaleX)*t+(d-Math.abs(u.data.scaleX)*t)*o,u.scaleY=Math.abs(u.scaleY)*e+(f-Math.abs(u.data.scaleY)*e)*o}}}},zc=class t extends $c{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,s,r,n,a,o,h){const l=this.frames,c=e.bones[this.boneIndex];if(!c.active)return;if(r<l[0]){switch(o){case i.setup:return c.shearX=c.data.shearX,void(c.shearY=c.data.shearY);case i.first:c.shearX+=(c.data.shearX-c.shearX)*a,c.shearY+=(c.data.shearY-c.shearY)*a}return}let u=0,d=0;if(r>=l[l.length-t.ENTRIES])u=l[l.length+t.PREV_X],d=l[l.length+t.PREV_Y];else{const e=Vc.binarySearch(l,r,t.ENTRIES);u=l[e+t.PREV_X],d=l[e+t.PREV_Y];const s=l[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(r-s)/(l[e+t.PREV_TIME]-s));u+=(l[e+t.X]-u)*n,d+=(l[e+t.Y]-d)*n}switch(o){case i.setup:c.shearX=c.data.shearX+u*a,c.shearY=c.data.shearY+d*a;break;case i.first:case i.replace:c.shearX+=(c.data.shearX+u-c.shearX)*a,c.shearY+=(c.data.shearY+d-c.shearY)*a;break;case i.add:c.shearX+=u*a,c.shearY+=d*a}}};const qc=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*qc.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,s,r,n,i){t*=qc.ENTRIES,this.frames[t]=e,this.frames[t+qc.R]=s,this.frames[t+qc.G]=r,this.frames[t+qc.B]=n,this.frames[t+qc.A]=i}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=this.frames;if(s<l[0]){switch(a){case i.setup:return void h.color.setFromColor(h.data.color);case i.first:const t=h.color,e=h.data.color;t.add((e.r-t.r)*n,(e.g-t.g)*n,(e.b-t.b)*n,(e.a-t.a)*n)}return}let c=0,u=0,d=0,f=0;if(s>=l[l.length-qc.ENTRIES]){const t=l.length;c=l[t+qc.PREV_R],u=l[t+qc.PREV_G],d=l[t+qc.PREV_B],f=l[t+qc.PREV_A]}else{const t=Vc.binarySearch(l,s,qc.ENTRIES);c=l[t+qc.PREV_R],u=l[t+qc.PREV_G],d=l[t+qc.PREV_B],f=l[t+qc.PREV_A];const e=l[t],r=this.getCurvePercent(t/qc.ENTRIES-1,1-(s-e)/(l[t+qc.PREV_TIME]-e));c+=(l[t+qc.R]-c)*r,u+=(l[t+qc.G]-u)*r,d+=(l[t+qc.B]-d)*r,f+=(l[t+qc.A]-f)*r}if(1==n)h.color.set(c,u,d,f);else{const t=h.color;a==i.setup&&t.setFromColor(h.data.color),t.add((c-t.r)*n,(u-t.g)*n,(d-t.b)*n,(f-t.a)*n)}}};let Zc=qc;Zc.ENTRIES=5,Zc.PREV_TIME=-5,Zc.PREV_R=-4,Zc.PREV_G=-3,Zc.PREV_B=-2,Zc.PREV_A=-1,Zc.R=1,Zc.G=2,Zc.B=3,Zc.A=4;const Kc=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*Kc.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,s,r,n,i,a,o,h){t*=Kc.ENTRIES,this.frames[t]=e,this.frames[t+Kc.R]=s,this.frames[t+Kc.G]=r,this.frames[t+Kc.B]=n,this.frames[t+Kc.A]=i,this.frames[t+Kc.R2]=a,this.frames[t+Kc.G2]=o,this.frames[t+Kc.B2]=h}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=this.frames;if(s<l[0]){switch(a){case i.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case i.first:const t=h.color,e=h.darkColor,s=h.data.color,r=h.data.darkColor;t.add((s.r-t.r)*n,(s.g-t.g)*n,(s.b-t.b)*n,(s.a-t.a)*n),e.add((r.r-e.r)*n,(r.g-e.g)*n,(r.b-e.b)*n,0)}return}let c=0,u=0,d=0,f=0,p=0,m=0,g=0;if(s>=l[l.length-Kc.ENTRIES]){const t=l.length;c=l[t+Kc.PREV_R],u=l[t+Kc.PREV_G],d=l[t+Kc.PREV_B],f=l[t+Kc.PREV_A],p=l[t+Kc.PREV_R2],m=l[t+Kc.PREV_G2],g=l[t+Kc.PREV_B2]}else{const t=Vc.binarySearch(l,s,Kc.ENTRIES);c=l[t+Kc.PREV_R],u=l[t+Kc.PREV_G],d=l[t+Kc.PREV_B],f=l[t+Kc.PREV_A],p=l[t+Kc.PREV_R2],m=l[t+Kc.PREV_G2],g=l[t+Kc.PREV_B2];const e=l[t],r=this.getCurvePercent(t/Kc.ENTRIES-1,1-(s-e)/(l[t+Kc.PREV_TIME]-e));c+=(l[t+Kc.R]-c)*r,u+=(l[t+Kc.G]-u)*r,d+=(l[t+Kc.B]-d)*r,f+=(l[t+Kc.A]-f)*r,p+=(l[t+Kc.R2]-p)*r,m+=(l[t+Kc.G2]-m)*r,g+=(l[t+Kc.B2]-g)*r}if(1==n)h.color.set(c,u,d,f),h.darkColor.set(p,m,g,1);else{const t=h.color,e=h.darkColor;a==i.setup&&(t.setFromColor(h.data.color),e.setFromColor(h.data.darkColor)),t.add((c-t.r)*n,(u-t.g)*n,(d-t.b)*n,(f-t.a)*n),e.add((p-e.r)*n,(m-e.g)*n,(g-e.b)*n,0)}}};let Qc=Kc;Qc.ENTRIES=8,Qc.PREV_TIME=-8,Qc.PREV_R=-7,Qc.PREV_G=-6,Qc.PREV_B=-5,Qc.PREV_A=-4,Qc.PREV_R2=-3,Qc.PREV_G2=-2,Qc.PREV_B2=-1,Qc.R=1,Qc.G=2,Qc.B=3,Qc.A=4,Qc.R2=5,Qc.G2=6,Qc.B2=7;let Jc=class{constructor(t){this.frames=Sh.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,r,n,o,h){const l=t.slots[this.slotIndex];if(!l.bone.active)return;if(h==a.mixOut)return void(o==i.setup&&this.setAttachment(t,l,l.data.attachmentName));const c=this.frames;if(s<c[0])return void(o!=i.setup&&o!=i.first||this.setAttachment(t,l,l.data.attachmentName));let u=0;u=s>=c[c.length-1]?c.length-1:Vc.binarySearch(c,s,1)-1;const d=this.attachmentNames[u];t.slots[this.slotIndex].setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}setAttachment(t,e,s){e.setAttachment(null==s?null:t.getAttachment(this.slotIndex,s))}},tu=null,eu=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t),this.frameVertices=new Array(t),null==tu&&(tu=Sh.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=h.getAttachment();if(!(l instanceof Rc)||l.deformAttachment!=this.attachment)return;const c=h.deform;0==c.length&&(a=i.setup);const u=this.frameVertices,d=u[0].length,f=this.frames;if(s<f[0]){const t=l;switch(a){case i.setup:return void(c.length=0);case i.first:if(1==n){c.length=0;break}const e=Sh.setArraySize(c,d);if(null==t.bones){const s=t.vertices;for(let t=0;t<d;t++)e[t]+=(s[t]-e[t])*n}else{n=1-n;for(let t=0;t<d;t++)e[t]*=n}}return}const p=Sh.setArraySize(c,d);if(s>=f[f.length-1]){const t=u[f.length-1];if(1==n)if(a==i.add){const e=l;if(null==e.bones){const s=e.vertices;for(let e=0;e<d;e++)p[e]+=t[e]-s[e]}else for(let s=0;s<d;s++)p[s]+=t[s]}else Sh.arrayCopy(t,0,p,0,d);else switch(a){case i.setup:{const e=l;if(null==e.bones){const s=e.vertices;for(let e=0;e<d;e++){const r=s[e];p[e]=r+(t[e]-r)*n}}else for(let s=0;s<d;s++)p[s]=t[s]*n;break}case i.first:case i.replace:for(let s=0;s<d;s++)p[s]+=(t[s]-p[s])*n;break;case i.add:const e=l;if(null==e.bones){const s=e.vertices;for(let e=0;e<d;e++)p[e]+=(t[e]-s[e])*n}else for(let s=0;s<d;s++)p[s]+=t[s]*n}return}const m=Vc.binarySearch(f,s),g=u[m-1],x=u[m],y=f[m],b=this.getCurvePercent(m-1,1-(s-y)/(f[m-1]-y));if(1==n)if(a==i.add){const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<d;t++){const s=g[t];p[t]+=s+(x[t]-s)*b-e[t]}}else for(let e=0;e<d;e++){const t=g[e];p[e]+=t+(x[e]-t)*b}}else for(let i=0;i<d;i++){const t=g[i];p[i]=t+(x[i]-t)*b}else switch(a){case i.setup:{const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<d;t++){const s=g[t],r=e[t];p[t]=r+(s+(x[t]-s)*b-r)*n}}else for(let e=0;e<d;e++){const t=g[e];p[e]=(t+(x[e]-t)*b)*n}break}case i.first:case i.replace:for(let e=0;e<d;e++){const t=g[e];p[e]+=(t+(x[e]-t)*b-p[e])*n}break;case i.add:const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<d;t++){const s=g[t];p[t]+=(s+(x[t]-s)*b-e[t])*n}}else for(let e=0;e<d;e++){const t=g[e];p[e]+=(t+(x[e]-t)*b)*n}}}},su=class{constructor(t){this.frames=Sh.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,r,n,i,a){if(null==r)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,r,n,i,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=Vc.binarySearch(o,e);const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)r.push(this.events[l])}},ru=class{constructor(t){this.frames=Sh.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,r,n,o,h){const l=t.drawOrder,c=t.slots;if(h==a.mixOut&&o==i.setup)return void Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const u=this.frames;if(s<u[0])return void(o!=i.setup&&o!=i.first||Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let d=0;d=s>=u[u.length-1]?u.length-1:Vc.binarySearch(u,s)-1;const f=this.drawOrders[d];if(null==f)Sh.arrayCopy(c,0,l,0,c.length);else for(let i=0,a=f.length;i<a;i++)l[i]=c[f[i]]}};const nu=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*nu.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,s,r,n,i,a){t*=nu.ENTRIES,this.frames[t]=e,this.frames[t+nu.MIX]=s,this.frames[t+nu.SOFTNESS]=r,this.frames[t+nu.BEND_DIRECTION]=n,this.frames[t+nu.COMPRESS]=i?1:0,this.frames[t+nu.STRETCH]=a?1:0}apply(t,e,s,r,n,o,h){const l=this.frames,c=t.ikConstraints[this.ikConstraintIndex];if(!c.active)return;if(s<l[0]){switch(o){case i.setup:return c.mix=c.data.mix,c.softness=c.data.softness,c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,void(c.stretch=c.data.stretch);case i.first:c.mix+=(c.data.mix-c.mix)*n,c.softness+=(c.data.softness-c.softness)*n,c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch}return}if(s>=l[l.length-nu.ENTRIES])return void(o==i.setup?(c.mix=c.data.mix+(l[l.length+nu.PREV_MIX]-c.data.mix)*n,c.softness=c.data.softness+(l[l.length+nu.PREV_SOFTNESS]-c.data.softness)*n,h==a.mixOut?(c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch):(c.bendDirection=l[l.length+nu.PREV_BEND_DIRECTION],c.compress=0!=l[l.length+nu.PREV_COMPRESS],c.stretch=0!=l[l.length+nu.PREV_STRETCH])):(c.mix+=(l[l.length+nu.PREV_MIX]-c.mix)*n,c.softness+=(l[l.length+nu.PREV_SOFTNESS]-c.softness)*n,h==a.mixIn&&(c.bendDirection=l[l.length+nu.PREV_BEND_DIRECTION],c.compress=0!=l[l.length+nu.PREV_COMPRESS],c.stretch=0!=l[l.length+nu.PREV_STRETCH])));const u=Vc.binarySearch(l,s,nu.ENTRIES),d=l[u+nu.PREV_MIX],f=l[u+nu.PREV_SOFTNESS],p=l[u],m=this.getCurvePercent(u/nu.ENTRIES-1,1-(s-p)/(l[u+nu.PREV_TIME]-p));o==i.setup?(c.mix=c.data.mix+(d+(l[u+nu.MIX]-d)*m-c.data.mix)*n,c.softness=c.data.softness+(f+(l[u+nu.SOFTNESS]-f)*m-c.data.softness)*n,h==a.mixOut?(c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch):(c.bendDirection=l[u+nu.PREV_BEND_DIRECTION],c.compress=0!=l[u+nu.PREV_COMPRESS],c.stretch=0!=l[u+nu.PREV_STRETCH])):(c.mix+=(d+(l[u+nu.MIX]-d)*m-c.mix)*n,c.softness+=(f+(l[u+nu.SOFTNESS]-f)*m-c.softness)*n,h==a.mixIn&&(c.bendDirection=l[u+nu.PREV_BEND_DIRECTION],c.compress=0!=l[u+nu.PREV_COMPRESS],c.stretch=0!=l[u+nu.PREV_STRETCH]))}};let iu=nu;iu.ENTRIES=6,iu.PREV_TIME=-6,iu.PREV_MIX=-5,iu.PREV_SOFTNESS=-4,iu.PREV_BEND_DIRECTION=-3,iu.PREV_COMPRESS=-2,iu.PREV_STRETCH=-1,iu.MIX=1,iu.SOFTNESS=2,iu.BEND_DIRECTION=3,iu.COMPRESS=4,iu.STRETCH=5;const au=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*au.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,s,r,n,i){t*=au.ENTRIES,this.frames[t]=e,this.frames[t+au.ROTATE]=s,this.frames[t+au.TRANSLATE]=r,this.frames[t+au.SCALE]=n,this.frames[t+au.SHEAR]=i}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(!l.active)return;if(s<h[0]){const t=l.data;switch(a){case i.setup:return l.rotateMix=t.rotateMix,l.translateMix=t.translateMix,l.scaleMix=t.scaleMix,void(l.shearMix=t.shearMix);case i.first:l.rotateMix+=(t.rotateMix-l.rotateMix)*n,l.translateMix+=(t.translateMix-l.translateMix)*n,l.scaleMix+=(t.scaleMix-l.scaleMix)*n,l.shearMix+=(t.shearMix-l.shearMix)*n}return}let c=0,u=0,d=0,f=0;if(s>=h[h.length-au.ENTRIES]){const t=h.length;c=h[t+au.PREV_ROTATE],u=h[t+au.PREV_TRANSLATE],d=h[t+au.PREV_SCALE],f=h[t+au.PREV_SHEAR]}else{const t=Vc.binarySearch(h,s,au.ENTRIES);c=h[t+au.PREV_ROTATE],u=h[t+au.PREV_TRANSLATE],d=h[t+au.PREV_SCALE],f=h[t+au.PREV_SHEAR];const e=h[t],r=this.getCurvePercent(t/au.ENTRIES-1,1-(s-e)/(h[t+au.PREV_TIME]-e));c+=(h[t+au.ROTATE]-c)*r,u+=(h[t+au.TRANSLATE]-u)*r,d+=(h[t+au.SCALE]-d)*r,f+=(h[t+au.SHEAR]-f)*r}if(a==i.setup){const t=l.data;l.rotateMix=t.rotateMix+(c-t.rotateMix)*n,l.translateMix=t.translateMix+(u-t.translateMix)*n,l.scaleMix=t.scaleMix+(d-t.scaleMix)*n,l.shearMix=t.shearMix+(f-t.shearMix)*n}else l.rotateMix+=(c-l.rotateMix)*n,l.translateMix+=(u-l.translateMix)*n,l.scaleMix+=(d-l.scaleMix)*n,l.shearMix+=(f-l.shearMix)*n}};let ou=au;ou.ENTRIES=5,ou.PREV_TIME=-5,ou.PREV_ROTATE=-4,ou.PREV_TRANSLATE=-3,ou.PREV_SCALE=-2,ou.PREV_SHEAR=-1,ou.ROTATE=1,ou.TRANSLATE=2,ou.SCALE=3,ou.SHEAR=4;const hu=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*hu.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=hu.ENTRIES,this.frames[t]=e,this.frames[t+hu.VALUE]=s}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(s<h[0]){switch(a){case i.setup:return void(l.position=l.data.position);case i.first:l.position+=(l.data.position-l.position)*n}return}let c=0;if(s>=h[h.length-hu.ENTRIES])c=h[h.length+hu.PREV_VALUE];else{const t=Vc.binarySearch(h,s,hu.ENTRIES);c=h[t+hu.PREV_VALUE];const e=h[t],r=this.getCurvePercent(t/hu.ENTRIES-1,1-(s-e)/(h[t+hu.PREV_TIME]-e));c+=(h[t+hu.VALUE]-c)*r}a==i.setup?l.position=l.data.position+(c-l.data.position)*n:l.position+=(c-l.position)*n}};let lu=hu;lu.ENTRIES=2,lu.PREV_TIME=-2,lu.PREV_VALUE=-1,lu.VALUE=1;let cu=class t extends lu{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,s,r,n,a,o,h){const l=this.frames,c=e.pathConstraints[this.pathConstraintIndex];if(!c.active)return;if(r<l[0]){switch(o){case i.setup:return void(c.spacing=c.data.spacing);case i.first:c.spacing+=(c.data.spacing-c.spacing)*a}return}let u=0;if(r>=l[l.length-t.ENTRIES])u=l[l.length+t.PREV_VALUE];else{const e=Vc.binarySearch(l,r,t.ENTRIES);u=l[e+t.PREV_VALUE];const s=l[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(r-s)/(l[e+t.PREV_TIME]-s));u+=(l[e+t.VALUE]-u)*n}o==i.setup?c.spacing=c.data.spacing+(u-c.data.spacing)*a:c.spacing+=(u-c.spacing)*a}};const uu=class extends Yc{constructor(t){super(t),this.frames=Sh.newFloatArray(t*uu.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,s,r){t*=uu.ENTRIES,this.frames[t]=e,this.frames[t+uu.ROTATE]=s,this.frames[t+uu.TRANSLATE]=r}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(s<h[0]){switch(a){case i.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case i.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*n,l.translateMix+=(l.data.translateMix-l.translateMix)*n}return}let c=0,u=0;if(s>=h[h.length-uu.ENTRIES])c=h[h.length+uu.PREV_ROTATE],u=h[h.length+uu.PREV_TRANSLATE];else{const t=Vc.binarySearch(h,s,uu.ENTRIES);c=h[t+uu.PREV_ROTATE],u=h[t+uu.PREV_TRANSLATE];const e=h[t],r=this.getCurvePercent(t/uu.ENTRIES-1,1-(s-e)/(h[t+uu.PREV_TIME]-e));c+=(h[t+uu.ROTATE]-c)*r,u+=(h[t+uu.TRANSLATE]-u)*r}a==i.setup?(l.rotateMix=l.data.rotateMix+(c-l.data.rotateMix)*n,l.translateMix=l.data.translateMix+(u-l.data.translateMix)*n):(l.rotateMix+=(c-l.rotateMix)*n,l.translateMix+=(u-l.translateMix)*n)}};let du=uu;du.ENTRIES=3,du.PREV_TIME=-3,du.PREV_ROTATE=-2,du.PREV_TRANSLATE=-1,du.ROTATE=1,du.TRANSLATE=2;const fu=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new yu(this),this.propertyIDs=new gh,this.animationsChanged=!1,this.trackEntryPool=new Ih((()=>new gu)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(null==r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let n=t*r.timeScale;if(r.delay>0){if(r.delay-=n,r.delay>0)continue;n=-r.delay,r.delay=0}let i=r.next;if(null!=i){const e=r.trackLast-i.delay;if(e>=0){for(i.delay=0,i.trackTime+=0==r.timeScale?0:(e/r.timeScale+t)*i.timeScale,r.trackTime+=n,this.setCurrent(s,i,!0);null!=i.mixingFrom;)i.mixTime+=t,i=i.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[s]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(null==s)return!0;const r=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),r):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let r=!1;for(let h=0,l=s.length;h<l;h++){const n=s[h];if(null==n||n.delay>0)continue;r=!0;const o=0==h?i.first:n.mixBlend;let l=n.alpha;null!=n.mixingFrom?l*=this.applyMixingFrom(n,t,o):n.trackTime>=n.trackEnd&&null==n.next&&(l=0);const c=n.animationLast,u=n.getAnimationTime(),d=n.animation.timelines.length,f=n.animation.timelines;if(0==h&&1==l||o==i.add)for(let s=0;s<d;s++){const r=f[s];r instanceof Jc?this.applyAttachmentTimeline(r,t,u,o,!0):r.apply(t,c,u,e,l,o,a.mixIn)}else{const s=n.timelineMode,r=0==n.timelinesRotation.length;r&&Sh.setArraySize(n.timelinesRotation,d<<1,null);const h=n.timelinesRotation;for(let n=0;n<d;n++){const d=f[n],p=s[n]==fu.SUBSEQUENT?o:i.setup;d instanceof Wc?this.applyRotateTimeline(d,t,u,l,p,h,n<<1,r):d instanceof Jc?this.applyAttachmentTimeline(d,t,u,o,!0):d.apply(t,c,u,e,l,p,a.mixIn)}}this.queueEvents(n,u),e.length=0,n.nextAnimationLast=u,n.nextTrackLast=n.trackTime}const n=this.unkeyedState+fu.SETUP,o=t.slots;for(let i=0,a=t.slots.length;i<a;i++){const e=o[i];if(e.attachmentState==n){const s=e.data.attachmentName;e.setAttachment(null==s?null:t.getAttachment(e.data.index,s))}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,s){const r=t.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,e,s);let n=0;0==t.mixDuration?(n=1,s==i.first&&(s=i.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=i.first&&(s=r.mixBlend));const o=n<r.eventThreshold?this.events:null,h=n<r.attachmentThreshold,l=n<r.drawOrderThreshold,c=r.animationLast,u=r.getAnimationTime(),d=r.animation.timelines.length,f=r.animation.timelines,p=r.alpha*t.interruptAlpha,m=p*(1-n);if(s==i.add)for(let i=0;i<d;i++)f[i].apply(e,c,u,o,m,s,a.mixOut);else{const t=r.timelineMode,n=r.timelineHoldMix,g=0==r.timelinesRotation.length;g&&Sh.setArraySize(r.timelinesRotation,d<<1,null);const x=r.timelinesRotation;r.totalAlpha=0;for(let y=0;y<d;y++){const d=f[y];let b,_=a.mixOut,v=0;switch(t[y]){case fu.SUBSEQUENT:if(!l&&d instanceof ru)continue;b=s,v=m;break;case fu.FIRST:b=i.setup,v=m;break;case fu.HOLD_SUBSEQUENT:b=s,v=p;break;case fu.HOLD_FIRST:b=i.setup,v=p;break;default:b=i.setup;const t=n[y];v=p*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=v,d instanceof Wc?this.applyRotateTimeline(d,e,u,v,b,x,y<<1,g):d instanceof Jc?this.applyAttachmentTimeline(d,e,u,b,h):(l&&d instanceof ru&&b==i.setup&&(_=a.mixIn),d.apply(e,c,u,o,v,b,_))}}return t.mixDuration>0&&this.queueEvents(r,u),this.events.length=0,r.nextAnimationLast=u,r.nextTrackLast=r.trackTime,n}applyAttachmentTimeline(t,e,s,r,n){const a=e.slots[t.slotIndex];if(!a.bone.active)return;const o=t.frames;if(s<o[0])r!=i.setup&&r!=i.first||this.setAttachment(e,a,a.data.attachmentName,n);else{let r;r=s>=o[o.length-1]?o.length-1:Vc.binarySearch(o,s)-1,this.setAttachment(e,a,t.attachmentNames[r],n)}a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+fu.SETUP)}setAttachment(t,e,s,r){e.setAttachment(null==s?null:t.getAttachment(e.data.index,s)),r&&(e.attachmentState=this.unkeyedState+fu.CURRENT)}applyRotateTimeline(t,e,s,r,n,o,h,l){if(l&&(o[h]=0),1==r)return void t.apply(e,0,s,null,1,n,a.mixIn);const c=t,u=c.frames,d=e.bones[c.boneIndex];if(!d.active)return;let f=0,p=0;if(s<u[0])switch(n){case i.setup:d.rotation=d.data.rotation;default:return;case i.first:f=d.rotation,p=d.data.rotation}else if(f=n==i.setup?d.data.rotation:d.rotation,s>=u[u.length-Wc.ENTRIES])p=d.data.rotation+u[u.length+Wc.PREV_ROTATION];else{const t=Vc.binarySearch(u,s,Wc.ENTRIES),e=u[t+Wc.PREV_ROTATION],r=u[t],n=c.getCurvePercent((t>>1)-1,1-(s-r)/(u[t+Wc.PREV_TIME]-r));p=u[t+Wc.ROTATION]-e,p-=360*(16384-(16384.499999999996-p/360|0)),p=e+p*n+d.data.rotation,p-=360*(16384-(16384.499999999996-p/360|0))}let m=0,g=p-f;if(g-=360*(16384-(16384.499999999996-g/360|0)),0==g)m=o[h];else{let t=0,e=0;l?(t=0,e=g):(t=o[h],e=o[h+1]);const s=g>0;let r=t>=0;vh.signum(e)!=vh.signum(g)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*vh.signum(t)),r=s),m=g+t-t%360,r!=s&&(m+=360*vh.signum(t)),o[h]=m}o[h+1]=g,f+=m*r,d.rotation=f-360*(16384-(16384.499999999996-f/360|0))}queueEvents(t,e){const s=t.animationStart,r=t.animationEnd,n=r-s,i=t.trackLast%n,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<i)break;e.time>r||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==n||i>t.trackTime%n:e>=r&&t.animationLast<r,l&&this.queue.complete(t);o<h;o++){a[o].time<s||this.queue.event(t,a[o])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){const t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(s&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){const r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,r,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let r=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,r=!1):this.disposeNext(n));const i=this.trackEntry(t,e,s,n);return this.setCurrent(t,i,r),this.queue.drain(),i}addAnimation(t,e,s,r){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,n,s,r)}addAnimationWith(t,e,s,r){if(null==e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;const i=this.trackEntry(t,e,s,n);if(null==n)this.setCurrent(t,i,!0),this.queue.drain();else if(n.next=i,r<=0){const t=n.animationEnd-n.animationStart;0!=t?(n.loop?r+=t*(1+(n.trackTime/t|0)):r+=Math.max(t,n.trackTime),r-=this.data.getMix(n.animation,e)):r=n.trackTime}return i.delay=r,i}setEmptyAnimation(t,e){const s=this.setAnimationWith(t,fu.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);const r=this.addAnimationWith(t,fu.emptyAnimation,!1,s);return r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,r=this.tracks.length;s<r;s++){const e=this.tracks[s];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Sh.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,r){const n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==r?0:this.data.getMix(r.animation,e),n.mixBlend=i.replace,n}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==i.add||this.computeHold(e),e=e.mixingTo}while(null!=e)}}}computeHold(t){const e=t.mixingTo,s=t.animation.timelines,r=t.animation.timelines.length,n=Sh.setArraySize(t.timelineMode,r);t.timelineHoldMix.length=0;const i=Sh.setArraySize(t.timelineHoldMix,r),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let o=0;o<r;o++)n[o]=a.add(s[o].getPropertyId())?fu.HOLD_FIRST:fu.HOLD_SUBSEQUENT;else t:for(let o=0;o<r;o++){const r=s[o],h=r.getPropertyId();if(a.add(h))if(null==e||r instanceof Jc||r instanceof ru||r instanceof su||!e.animation.hasTimeline(h))n[o]=fu.FIRST;else{for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!s.animation.hasTimeline(h)){if(t.mixDuration>0){n[o]=fu.HOLD_MIX,i[o]=s;continue t}break}n[o]=fu.HOLD_FIRST}else n[o]=fu.SUBSEQUENT}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){fu.deprecatedWarning1||(fu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,r){fu.deprecatedWarning2||(fu.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,r)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return fu.deprecatedWarning3||(fu.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let pu=fu;pu.emptyAnimation=new Vc("<empty>",[],0),pu.SUBSEQUENT=0,pu.FIRST=1,pu.HOLD_SUBSEQUENT=2,pu.HOLD_FIRST=3,pu.HOLD_MIX=4,pu.SETUP=1,pu.CURRENT=2,pu.deprecatedWarning1=!1,pu.deprecatedWarning2=!1,pu.deprecatedWarning3=!1;const mu=class{constructor(){this.mixBlend=i.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return mu.deprecatedWarning1||(mu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){mu.deprecatedWarning1||(mu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return mu.deprecatedWarning2||(mu.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){mu.deprecatedWarning2||(mu.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let gu=mu;gu.deprecatedWarning1=!1,gu.deprecatedWarning2=!1;const xu=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(bu.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(bu.interrupt),this.objects.push(t)}end(t){this.objects.push(bu.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(bu.dispose),this.objects.push(t)}complete(t){this.objects.push(bu.complete),this.objects.push(t)}event(t,e){this.objects.push(bu.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return xu.deprecatedWarning1||(xu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const r=t[s],n=t[s+1];switch(r){case bu.start:null!=n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(n);n.onStart&&this.deprecateStuff()&&n.onStart(n.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(n.trackIndex);break;case bu.interrupt:null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(n);break;case bu.end:null!=n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(n);n.onEnd&&this.deprecateStuff()&&n.onEnd(n.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(n.trackIndex);case bu.dispose:null!=n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(n);this.animState.trackEntryPool.free(n);break;case bu.complete:null!=n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(n);const r=vh.toInt(n.loopsCount());n.onComplete&&this.deprecateStuff()&&n.onComplete(n.trackIndex,r),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(n.trackIndex,r);break;case bu.event:const i=t[2+s++];null!=n.listener&&n.listener.event&&n.listener.event(n,i);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(n,i);n.onEvent&&this.deprecateStuff()&&n.onEvent(n.trackIndex,i),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(n.trackIndex,i)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let yu=xu;yu.deprecatedWarning1=!1;var bu=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(bu||{});const _u=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const r=this.skeletonData.findAnimation(t);if(null==r)throw new Error(`Animation not found: ${t}`);const n=this.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);this.setMixWith(r,n,s)}setMixByName(t,e,s){_u.deprecatedWarning1||(_u.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const r=`${t.name}.${e.name}`;this.animationToMixTime[r]=s}getMix(t,e){const s=`${t.name}.${e.name}`,r=this.animationToMixTime[s];return void 0===r?this.defaultMix:r}};let vu=_u;vu.deprecatedWarning1=!1;let Eu=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,s){const r=this.atlas.findRegion(s);if(null==r)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);const n=new Bc(e);return n.region=r,n}newMeshAttachment(t,e,s){const r=this.atlas.findRegion(s);if(null==r)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);const n=new Pc(e);return n.region=r,n}newBoundingBoxAttachment(t,e){return new Mc(e)}newPathAttachment(t,e){return new kc(e)}newPointAttachment(t,e){return new Fc(e)}newClippingAttachment(t,e){return new Cc(e)}},wu=class{constructor(t,e,s){if(this.matrix=new Ui,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,r,n,i,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=r,this.ascaleY=n,this.ashearX=i,this.ashearY=a,this.appliedValid=!0;const o=this.parent,h=this.matrix,c=this.skeleton.scaleX,u=-this.skeleton.scaleY;if(null==o){const o=this.skeleton,l=s+90+a;return h.a=vh.cosDeg(s+i)*r*c,h.c=vh.cosDeg(l)*n*c,h.b=vh.sinDeg(s+i)*r*u,h.d=vh.sinDeg(l)*n*u,h.tx=t*c+o.x,void(h.ty=e*u+o.y)}let d=o.matrix.a,f=o.matrix.c,p=o.matrix.b,m=o.matrix.d;switch(h.tx=d*t+f*e+o.matrix.tx,h.ty=p*t+m*e+o.matrix.ty,this.data.transformMode){case l.Normal:{const t=s+90+a,e=vh.cosDeg(s+i)*r,o=vh.cosDeg(t)*n,l=vh.sinDeg(s+i)*r,c=vh.sinDeg(t)*n;return h.a=d*e+f*l,h.c=d*o+f*c,h.b=p*e+m*l,void(h.d=p*o+m*c)}case l.OnlyTranslation:{const t=s+90+a;h.a=vh.cosDeg(s+i)*r,h.c=vh.cosDeg(t)*n,h.b=vh.sinDeg(s+i)*r,h.d=vh.sinDeg(t)*n;break}case l.NoRotationOrReflection:{let t=d*d+p*p,e=0;t>1e-4?(t=Math.abs(d*m-f*p)/t,d/=this.skeleton.scaleX,p/=this.skeleton.scaleY,f=p*t,m=d*t,e=Math.atan2(p,d)*vh.radDeg):(d=0,p=0,e=90-Math.atan2(m,f)*vh.radDeg);const o=s+i-e,l=s+a-e+90,c=vh.cosDeg(o)*r,u=vh.cosDeg(l)*n,g=vh.sinDeg(o)*r,x=vh.sinDeg(l)*n;h.a=d*c-f*g,h.c=d*u-f*x,h.b=p*c+m*g,h.d=p*u+m*x;break}case l.NoScale:case l.NoScaleOrReflection:{const t=vh.cosDeg(s),e=vh.sinDeg(s);let o=(d*t+f*e)/c,g=(p*t+m*e)/u,x=Math.sqrt(o*o+g*g);x>1e-5&&(x=1/x),o*=x,g*=x,x=Math.sqrt(o*o+g*g),this.data.transformMode==l.NoScale&&d*m-f*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(x=-x);const y=Math.PI/2+Math.atan2(g,o),b=Math.cos(y)*x,_=Math.sin(y)*x,v=vh.cosDeg(i)*r,E=vh.cosDeg(90+a)*n,w=vh.sinDeg(i)*r,A=vh.sinDeg(90+a)*n;h.a=o*v+b*w,h.c=o*E+b*A,h.b=g*v+_*w,h.d=g*E+_*A;break}}h.a*=c,h.c*=c,h.b*=u,h.d*=u}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*vh.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*vh.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*vh.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*vh.radDeg);const s=t.matrix,r=1/(s.a*s.d-s.b*s.c),n=e.tx-s.tx,i=e.ty-s.ty;this.ax=n*s.d*r-i*s.c*r,this.ay=i*s.a*r-n*s.b*r;const a=r*s.d,o=r*s.a,h=r*s.c,l=r*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,f=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*vh.radDeg,this.arotation=Math.atan2(d,c)*vh.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*vh.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,r=e.c,n=e.b,i=e.d,a=1/(s*i-r*n),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*i*a-h*r*a,t.y=h*s*a-o*n*a,t}localToWorld(t){const e=this.matrix,s=t.x,r=t.y;return t.x=s*e.a+r*e.c+e.tx,t.y=s*e.b+r*e.d+e.ty,t}worldToLocalRotation(t){const e=vh.sinDeg(t),s=vh.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*s,r.d*s-r.c*e)*vh.radDeg}localToWorldRotation(t){const e=vh.sinDeg(t),s=vh.cosDeg(t),r=this.matrix;return Math.atan2(s*r.b+e*r.d,s*r.a+e*r.c)*vh.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,r=e.c,n=e.b,i=e.d,a=vh.cosDeg(t),o=vh.sinDeg(t);e.a=a*s-o*n,e.c=a*r-o*i,e.b=o*s+a*n,e.d=o*r+a*i,this.appliedValid=!1}},Au=class{constructor(t,e,s){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=l.Normal,this.skinRequired=!1,this.color=new bh,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}},Tu=class{constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}},Su=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},Iu=class{constructor(t){this.name=t}},Ru=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}apply1(t,e,s,r,n,i,a){t.appliedValid||t.updateAppliedTransform();const o=t.parent.matrix,h=o.a;let c=o.c;const u=o.b;let d=o.d,f=-t.ashearX-t.arotation,p=0,m=0;switch(t.data.transformMode){case l.OnlyTranslation:p=e-t.worldX,m=s-t.worldY;break;case l.NoRotationOrReflection:const r=Math.abs(h*d-c*u)/(h*h+u*u),n=h/t.skeleton.scaleX,i=u/t.skeleton.scaleY;c=-i*r*t.skeleton.scaleX,d=n*r*t.skeleton.scaleY,f+=Math.atan2(i,n)*vh.radDeg;default:const a=e-o.tx,g=s-o.ty,x=h*d-c*u;p=(a*d-g*c)/x-t.ax,m=(g*h-a*u)/x-t.ay}f+=Math.atan2(m,p)*vh.radDeg,t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let g=t.ascaleX,x=t.ascaleY;if(r||n){switch(t.data.transformMode){case l.NoScale:case l.NoScaleOrReflection:p=e-t.worldX,m=s-t.worldY}const o=t.data.length*g,h=Math.sqrt(p*p+m*m);if(r&&h<o||n&&h>o&&o>1e-4){const t=(h/o-1)*a+1;g*=t,i&&(x*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*a,g,x,t.ashearX,t.ashearY)}apply2(t,e,s,r,n,i,a,o){if(0==o)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const h=t.ax,l=t.ay;let c=t.ascaleX,u=c,d=t.ascaleY,f=e.ascaleX;const p=t.matrix;let m=0,g=0,x=0;c<0?(c=-c,m=180,x=-1):(m=0,x=1),d<0&&(d=-d,x=-x),f<0?(f=-f,g=180):g=0;const y=e.ax;let b=0,_=0,v=0,E=p.a,w=p.c,A=p.b,T=p.d;const S=Math.abs(c-d)<=1e-4;S?(b=e.ay,_=E*y+w*b+p.tx,v=A*y+T*b+p.ty):(b=0,_=E*y+p.tx,v=A*y+p.ty);const I=t.parent.matrix;E=I.a,w=I.c,A=I.b,T=I.d;const R=1/(E*T-w*A);let M=_-I.tx,C=v-I.ty;const P=(M*T-C*w)*R-h,k=(C*E-M*A)*R-l,F=Math.sqrt(P*P+k*k);let D,N,B=e.data.length*f;if(F<1e-4)return this.apply1(t,s,r,!1,i,!1,o),void e.updateWorldTransformWith(y,b,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);M=s-I.tx,C=r-I.ty;let O=(M*T-C*w)*R-h,L=(C*E-M*A)*R-l,V=O*O+L*L;if(0!=a){a*=c*(f+1)/2;const t=Math.sqrt(V),e=t-F-B*c+a;if(e>0){let s=Math.min(1,e/(2*a))-1;s=(e-a*(1-s*s))/t,O-=s*O,L-=s*L,V=O*O+L*L}}t:if(S){B*=c;let t=(V-F*F-B*B)/(2*F*B);t<-1?t=-1:t>1&&(t=1,i&&(u*=(Math.sqrt(V)/(F+B)-1)*o+1)),N=Math.acos(t)*n,E=F+B*t,w=B*Math.sin(N),D=Math.atan2(L*E-O*w,O*E+L*w)}else{E=c*B,w=d*B;const t=E*E,e=w*w,s=Math.atan2(L,O);A=e*F*F+t*V-t*e;const r=-2*e*F,i=e-t;if(T=r*r-4*i*A,T>=0){let t=Math.sqrt(T);r<0&&(t=-t),t=-(r+t)/2;const e=t/i,a=A/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=V){C=Math.sqrt(V-o*o)*n,D=s-Math.atan2(C,o),N=Math.atan2(C/d,(o-F)/c);break t}}let a=vh.PI,o=F-E,h=o*o,l=0,u=0,f=F+E,p=f*f,m=0;A=-E*F/(t-e),A>=-1&&A<=1&&(A=Math.acos(A),M=E*Math.cos(A)+F,C=w*Math.sin(A),T=M*M+C*C,T<h&&(a=A,h=T,o=M,l=C),T>p&&(u=A,p=T,f=M,m=C)),V<=(h+p)/2?(D=s-Math.atan2(l*n,o),N=a*n):(D=s-Math.atan2(m*n,f),N=u*n)}const U=Math.atan2(b,y)*x;let X=t.arotation;D=(D-U)*vh.radDeg+m-X,D>180?D-=360:D<-180&&(D+=360),t.updateWorldTransformWith(h,l,X+D*o,u,t.ascaleY,0,0),X=e.arotation,N=((N+U)*vh.radDeg-e.ashearX)*x+g-X,N>180?N-=360:N<-180&&(N+=360),e.updateWorldTransformWith(y,b,X+N*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},Mu=class extends Tu{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}},Cu=class extends Tu{constructor(t){super(t,0,!1),this.bones=new Array}};var Pu=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(Pu||{});const ku=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,r=t.bones.length;s<r;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof kc))return;const e=this.rotateMix,s=this.translateMix,r=e>0;if(!(s>0)&&!r)return;const n=this.data,i=n.spacingMode,a=i==Pu.Length,l=n.rotateMode,c=l==h.Tangent,u=l==h.ChainScale,d=this.bones.length,f=c?d:d+1,p=this.bones,m=Sh.setArraySize(this.spaces,f);let g=null;const x=this.spacing;if(u||a){u&&(g=Sh.setArraySize(this.lengths,d));for(let t=0,e=f-1;t<e;){const e=p[t],s=e.data.length;if(s<ku.epsilon)u&&(g[t]=0),m[++t]=0;else{const r=s*e.matrix.a,n=s*e.matrix.b,i=Math.sqrt(r*r+n*n);u&&(g[t]=i),m[++t]=(a?s+x:x)*i/s}}}else for(let o=1;o<f;o++)m[o]=x;const y=this.computeWorldPositions(t,f,c,n.positionMode==o.Percent,i==Pu.Percent);let b=y[0],_=y[1],v=n.offsetRotation,E=!1;if(0==v)E=l==h.Chain;else{E=!1;const t=this.target.bone.matrix;v*=t.a*t.d-t.b*t.c>0?vh.degRad:-vh.degRad}for(let o=0,h=3;o<d;o++,h+=3){const t=p[o],n=t.matrix;n.tx+=(b-n.tx)*s,n.ty+=(_-n.ty)*s;const i=y[h],a=y[h+1],l=i-b,d=a-_;if(u){const t=g[o];if(0!=t){const s=(Math.sqrt(l*l+d*d)/t-1)*e+1;n.a*=s,n.b*=s}}if(b=i,_=a,r){const s=n.a,r=n.c,i=n.b,a=n.d;let u=0,f=0,p=0;if(c&&(u=c?y[h-1]:0==m[o+1]?y[h+2]:Math.atan2(d,l)),u-=Math.atan2(i,s),E){f=Math.cos(u),p=Math.sin(u);const r=t.data.length;b+=(r*(f*s-p*i)-l)*e,_+=(r*(p*s+f*i)-d)*e}else u+=v;u>vh.PI?u-=vh.PI2:u<-vh.PI&&(u+=vh.PI2),u*=e,f=Math.cos(u),p=Math.sin(u),n.a=f*s-p*i,n.c=f*r-p*a,n.b=p*s+f*i,n.d=p*r+f*a}t.appliedValid=!1}}computeWorldPositions(t,e,s,r,n){const i=this.target;let a=this.position;const o=this.spaces,h=Sh.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,f=ku.NONE;if(!t.constantSpeed){const p=t.lengths;d-=c?1:2;const m=p[d];if(r&&(a*=m),n)for(let t=0;t<e;t++)o[t]*=m;l=Sh.setArraySize(this.world,8);for(let r=0,n=0,g=0;r<e;r++,n+=3){const e=o[r];a+=e;let x=a;if(c)x%=m,x<0&&(x+=m),g=0;else{if(x<0){f!=ku.BEFORE&&(f=ku.BEFORE,t.computeWorldVertices(i,2,4,l,0,2)),this.addBeforePosition(x,l,0,h,n);continue}if(x>m){f!=ku.AFTER&&(f=ku.AFTER,t.computeWorldVertices(i,u-6,4,l,0,2)),this.addAfterPosition(x-m,l,0,h,n);continue}}for(;;g++){const t=p[g];if(!(x>t)){if(0==g)x/=t;else{const e=p[g-1];x=(x-e)/(t-e)}break}}g!=f&&(f=g,c&&g==d?(t.computeWorldVertices(i,u-4,4,l,0,2),t.computeWorldVertices(i,0,4,l,4,2)):t.computeWorldVertices(i,6*g+2,8,l,0,2)),this.addCurvePosition(x,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,n,s||r>0&&0==e)}return h}c?(u+=2,l=Sh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u-4,l,0,2),t.computeWorldVertices(i,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=Sh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u,l,0,2));const p=Sh.setArraySize(this.curves,d);let m=0,g=l[0],x=l[1],y=0,b=0,_=0,v=0,E=0,w=0,A=0,T=0,S=0,I=0,R=0,M=0,C=0,P=0;for(let D=0,N=2;D<d;D++,N+=6)y=l[N],b=l[N+1],_=l[N+2],v=l[N+3],E=l[N+4],w=l[N+5],A=.1875*(g-2*y+_),T=.1875*(x-2*b+v),S=.09375*(3*(y-_)-g+E),I=.09375*(3*(b-v)-x+w),R=2*A+S,M=2*T+I,C=.75*(y-g)+A+.16666667*S,P=.75*(b-x)+T+.16666667*I,m+=Math.sqrt(C*C+P*P),C+=R,P+=M,R+=S,M+=I,m+=Math.sqrt(C*C+P*P),C+=R,P+=M,m+=Math.sqrt(C*C+P*P),C+=R+S,P+=M+I,m+=Math.sqrt(C*C+P*P),p[D]=m,g=E,x=w;if(r&&(a*=m),n)for(let D=0;D<e;D++)o[D]*=m;const k=this.segments;let F=0;for(let D=0,N=0,B=0,O=0;D<e;D++,N+=3){const t=o[D];a+=t;let e=a;if(c)e%=m,e<0&&(e+=m),B=0;else{if(e<0){this.addBeforePosition(e,l,0,h,N);continue}if(e>m){this.addAfterPosition(e-m,l,u-4,h,N);continue}}for(;;B++){const t=p[B];if(!(e>t)){if(0==B)e/=t;else{const s=p[B-1];e=(e-s)/(t-s)}break}}if(B!=f){f=B;let t=6*B;for(g=l[t],x=l[t+1],y=l[t+2],b=l[t+3],_=l[t+4],v=l[t+5],E=l[t+6],w=l[t+7],A=.03*(g-2*y+_),T=.03*(x-2*b+v),S=.006*(3*(y-_)-g+E),I=.006*(3*(b-v)-x+w),R=2*A+S,M=2*T+I,C=.3*(y-g)+A+.16666667*S,P=.3*(b-x)+T+.16666667*I,F=Math.sqrt(C*C+P*P),k[0]=F,t=1;t<8;t++)C+=R,P+=M,R+=S,M+=I,F+=Math.sqrt(C*C+P*P),k[t]=F;C+=R,P+=M,F+=Math.sqrt(C*C+P*P),k[8]=F,C+=R+S,P+=M+I,F+=Math.sqrt(C*C+P*P),k[9]=F,O=0}for(e*=F;;O++){const t=k[O];if(!(e>t)){if(0==O)e/=t;else{const s=k[O-1];e=O+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,x,y,b,_,v,E,w,h,N,s||D>0&&0==t)}return h}addBeforePosition(t,e,s,r,n){const i=e[s],a=e[s+1],o=e[s+2]-i,h=e[s+3]-a,l=Math.atan2(h,o);r[n]=i+t*Math.cos(l),r[n+1]=a+t*Math.sin(l),r[n+2]=l}addAfterPosition(t,e,s,r,n){const i=e[s+2],a=e[s+3],o=i-e[s],h=a-e[s+1],l=Math.atan2(h,o);r[n]=i+t*Math.cos(l),r[n+1]=a+t*Math.sin(l),r[n+2]=l}addCurvePosition(t,e,s,r,n,i,a,o,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,x=p*t,y=3*x,b=p*y,_=y*t,v=e*g+r*b+i*_+o*f,E=s*g+n*b+a*_+h*f;l[c]=v,l[c+1]=E,u&&(l[c+2]=Math.atan2(E-(s*m+n*x*2+a*d),v-(e*m+r*x*2+i*d)))}};let Fu=ku;Fu.NONE=-1,Fu.BEFORE=-2,Fu.AFTER=-3,Fu.epsilon=1e-5;let Du=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new Rh,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target,i=n.matrix,a=i.a,o=i.c,h=i.b,l=i.d,c=a*l-o*h>0?vh.degRad:-vh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const i=f[p];let c=!1;const m=i.matrix;if(0!=t){const e=m.a,s=m.c,r=m.b,n=m.d;let i=Math.atan2(h,a)-Math.atan2(r,e)+u;i>vh.PI?i-=vh.PI2:i<-vh.PI&&(i+=vh.PI2),i*=t;const o=Math.cos(i),l=Math.sin(i);m.a=o*e-l*r,m.c=o*s-l*n,m.b=l*e+o*r,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,c=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(a*a+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(o*o+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.c*=t,m.d*=t,c=!0}if(r>0){const t=m.c,e=m.d,s=Math.atan2(e,t);let n=Math.atan2(l,o)-Math.atan2(h,a)-(s-Math.atan2(m.b,m.a));n>vh.PI?n-=vh.PI2:n<-vh.PI&&(n+=vh.PI2),n=s+(n+d)*r;const i=Math.sqrt(t*t+e*e);m.c=Math.cos(n)*i,m.d=Math.sin(n)*i,c=!0}c&&(i.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target,i=n.matrix,a=i.a,o=i.c,h=i.b,l=i.d,c=a*l-o*h>0?vh.degRad:-vh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const i=f[p];let c=!1;const m=i.matrix;if(0!=t){const e=m.a,s=m.c,r=m.b,n=m.d;let i=Math.atan2(h,a)+u;i>vh.PI?i-=vh.PI2:i<-vh.PI&&(i+=vh.PI2),i*=t;const o=Math.cos(i),l=Math.sin(i);m.a=o*e-l*r,m.c=o*s-l*n,m.b=l*e+o*r,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,c=!0}if(s>0){let t=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.b*=t,t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleY)*s+1,m.c*=t,m.d*=t,c=!0}if(r>0){let t=Math.atan2(l,o)-Math.atan2(h,a);t>vh.PI?t-=vh.PI2:t<-vh.PI&&(t+=vh.PI2);const e=m.c,s=m.d;t=Math.atan2(s,e)+(t-vh.PI/2+d)*r;const n=Math.sqrt(e*e+s*s);m.c=Math.cos(t)*n,m.d=Math.sin(t)*n,c=!0}c&&(i.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const i=this.bones;for(let a=0,o=i.length;a<o;a++){const o=i[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;if(0!=t){let e=n.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax-l+this.data.offsetX)*e,c+=(n.ay-c+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u=(u+(n.ascaleX-u+this.data.offsetScaleX)*s)/u),d>1e-5&&(d=(d+(n.ascaleY-d+this.data.offsetScaleY)*s)/d));const f=o.ashearY;if(r>0){let t=n.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*r}o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const i=this.bones;for(let a=0,o=i.length;a<o;a++){const o=i[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;0!=t&&(h+=(n.arotation+this.data.offsetRotation)*t);let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u*=(n.ascaleX-1+this.data.offsetScaleX)*s+1),d>1e-5&&(d*=(n.ascaleY-1+this.data.offsetScaleY)*s+1));let f=o.ashearY;r>0&&(f+=(n.ashearY+this.data.offsetShearY)*r),o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}};const Nu=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let r;if(null==s.parent)r=new wu(s,this,null);else{const t=this.bones[s.parent.index];r=new wu(s,this,t),t.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],r=this.bones[s.boneData.index],n=new Dc(s,r);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new Ru(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new Du(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new Fu(s,this))}this.color=new bh(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++){const e=t[h];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(null!=this.skin){const t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(null!=s)}}const e=this.ikConstraints,s=this.transformConstraints,r=this.pathConstraints,n=e.length,i=s.length,a=r.length,o=n+i+a;t:for(let h=0;h<o;h++){for(let t=0;t<n;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<i;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=r[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&Sh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const s=t.bones,r=s[0];if(this.sortBone(r),s.length>1){const t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(r.children),s[s.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&Sh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,s=e.data.index,r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,r);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,r);const n=e.getAttachment();n instanceof kc&&this.sortPathConstraintAttachmentWith(n,r);const i=t.bones,a=i.length;for(let o=0;o<a;o++)this.sortBone(i[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(i[o].children);for(let o=0;o<a;o++)i[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&Sh.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let r=0;r<s;r++){const t=e[r];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let r=0;r<s;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<s;r++)this.sortReset(e[r].children);for(let r=0;r<s;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,s){const r=t.attachments[e];if(r)for(const n in r)this.sortPathConstraintAttachmentWith(r[n],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof kc))return;const s=t.bones;if(null==s)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<s.length;){const r=s[e++];for(let n=e+r;e<n;e++){const r=s[e];this.sortBone(t[r])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){const t=this.updateCacheReset;for(let s=0,r=t.length;s<r;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let s=0,r=e.length;s<r;s++)e[s].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let n=0,i=t.length;n<i;n++)t[n].setToSetupPose();const e=this.ikConstraints;for(let n=0,i=e.length;n<i;n++){const t=e[n];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const s=this.transformConstraints;for(let n=0,i=s.length;n<i;n++){const t=s[n],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const r=this.pathConstraints;for(let n=0,i=r.length;n<i;n++){const t=r[n],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;Sh.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s],n=r.data.attachmentName;if(null!=n){const e=t.getAttachment(s,n);null!=e&&r.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const s=this.slots;for(let r=0,n=s.length;r<n;r++){const n=s[r];if(n.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(r,e),null==s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void n.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}getBounds(t,e,s=new Array(2)){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const r=this.drawOrder;let n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=r.length;h<l;h++){const t=r[h];if(!t.bone.active)continue;let e=0,l=null;const c=t.getAttachment();if(c instanceof Bc)e=8,l=Sh.setArraySize(s,e,0),c.computeWorldVertices(t.bone,l,0,2);else if(c instanceof Pc){const r=c;e=r.worldVerticesLength,l=Sh.setArraySize(s,e,0),r.computeWorldVertices(t,0,e,l,0,2)}if(null!=l)for(let s=0,r=l.length;s<r;s+=2){const t=l[s],e=l[s+1];n=Math.min(n,t),i=Math.min(i,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(n,i),e.set(a-n,o-i)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){Nu.deprecatedWarning1||(Nu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){Nu.deprecatedWarning1||(Nu.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let Bu=Nu;Bu.deprecatedWarning1=!1;let Ou=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}},Lu=class{constructor(t,e,s){if(this.color=new bh(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}},Vu=class extends Tu{constructor(t){super(t,0,!1),this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}},Uu=class{constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}},Xu=class{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");const r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=s}addSkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];null!=t.attachment&&(t.attachment instanceof Pc?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){const s=this.attachments[t];s&&(s[e]=null)}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const s=this.attachments[e];if(s)for(const r in s){const n=s[r];n&&t.push(new Uu(e,r,n))}}return t}getAttachmentsForSlot(t,e){const s=this.attachments[t];if(s)for(const r in s){const n=s[r];n&&e.push(new Uu(t,r,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let r=0;r<t.slots.length;r++){const n=t.slots[r],i=n.getAttachment();if(i&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(i==t[e]){const t=this.getAttachment(s,e);null!=t&&n.setAttachment(t);break}}}s++}}};const Yu=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new Ou;s.name="";const r=new n(t);if(s.hash=r.readString(),s.version=r.readString(),"3.8.75"===s.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}s.x=r.readFloat(),s.y=r.readFloat(),s.width=r.readFloat(),s.height=r.readFloat();const i=r.readBoolean();i&&(s.fps=r.readFloat(),s.imagesPath=r.readString(),s.audioPath=r.readString());let a=0;a=r.readInt(!0);for(let n=0;n<a;n++)r.strings.push(r.readString());a=r.readInt(!0);for(let n=0;n<a;n++){const t=r.readString(),a=0==n?null:s.bones[r.readInt(!0)],o=new Au(n,t,a);o.rotation=r.readFloat(),o.x=r.readFloat()*e,o.y=r.readFloat()*e,o.scaleX=r.readFloat(),o.scaleY=r.readFloat(),o.shearX=r.readFloat(),o.shearY=r.readFloat(),o.length=r.readFloat()*e,o.transformMode=Yu.TransformModeValues[r.readInt(!0)],o.skinRequired=r.readBoolean(),i&&bh.rgba8888ToColor(o.color,r.readInt32()),s.bones.push(o)}a=r.readInt(!0);for(let n=0;n<a;n++){const t=r.readString(),e=s.bones[r.readInt(!0)],i=new Lu(n,t,e);bh.rgba8888ToColor(i.color,r.readInt32());const a=r.readInt32();-1!=a&&bh.rgb888ToColor(i.darkColor=new bh,a),i.attachmentName=r.readStringRef(),i.blendMode=Yu.BlendModeValues[r.readInt(!0)],s.slots.push(i)}a=r.readInt(!0);for(let n,o=0;o<a;o++){const t=new Mu(r.readString());t.order=r.readInt(!0),t.skinRequired=r.readBoolean(),n=r.readInt(!0);for(let e=0;e<n;e++)t.bones.push(s.bones[r.readInt(!0)]);t.target=s.bones[r.readInt(!0)],t.mix=r.readFloat(),t.softness=r.readFloat()*e,t.bendDirection=r.readByte(),t.compress=r.readBoolean(),t.stretch=r.readBoolean(),t.uniform=r.readBoolean(),s.ikConstraints.push(t)}a=r.readInt(!0);for(let n,o=0;o<a;o++){const t=new Vu(r.readString());t.order=r.readInt(!0),t.skinRequired=r.readBoolean(),n=r.readInt(!0);for(let e=0;e<n;e++)t.bones.push(s.bones[r.readInt(!0)]);t.target=s.bones[r.readInt(!0)],t.local=r.readBoolean(),t.relative=r.readBoolean(),t.offsetRotation=r.readFloat(),t.offsetX=r.readFloat()*e,t.offsetY=r.readFloat()*e,t.offsetScaleX=r.readFloat(),t.offsetScaleY=r.readFloat(),t.offsetShearY=r.readFloat(),t.rotateMix=r.readFloat(),t.translateMix=r.readFloat(),t.scaleMix=r.readFloat(),t.shearMix=r.readFloat(),s.transformConstraints.push(t)}a=r.readInt(!0);for(let n,l=0;l<a;l++){const t=new Cu(r.readString());t.order=r.readInt(!0),t.skinRequired=r.readBoolean(),n=r.readInt(!0);for(let e=0;e<n;e++)t.bones.push(s.bones[r.readInt(!0)]);t.target=s.slots[r.readInt(!0)],t.positionMode=Yu.PositionModeValues[r.readInt(!0)],t.spacingMode=Yu.SpacingModeValues[r.readInt(!0)],t.rotateMode=Yu.RotateModeValues[r.readInt(!0)],t.offsetRotation=r.readFloat(),t.position=r.readFloat(),t.positionMode==o.Fixed&&(t.position*=e),t.spacing=r.readFloat(),t.spacingMode!=Pu.Length&&t.spacingMode!=Pu.Fixed||(t.spacing*=e),t.rotateMix=r.readFloat(),t.translateMix=r.readFloat(),s.pathConstraints.push(t)}const h=this.readSkin(r,s,!0,i);null!=h&&(s.defaultSkin=h,s.skins.push(h));{let t=s.skins.length;for(Sh.setArraySize(s.skins,a=t+r.readInt(!0));t<a;t++)s.skins[t]=this.readSkin(r,s,!1,i)}a=this.linkedMeshes.length;for(let n=0;n<a;n++){const t=this.linkedMeshes[n],e=null==t.skin?s.defaultSkin:s.findSkin(t.skin);if(null==e)throw new Error(`Skin not found: ${t.skin}`);const r=e.getAttachment(t.slotIndex,t.parent);if(null==r)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.deformAttachment=t.inheritDeform?r:t.mesh,t.mesh.setParentMesh(r)}this.linkedMeshes.length=0,a=r.readInt(!0);for(let n=0;n<a;n++){const t=new Iu(r.readStringRef());t.intValue=r.readInt(!1),t.floatValue=r.readFloat(),t.stringValue=r.readString(),t.audioPath=r.readString(),null!=t.audioPath&&(t.volume=r.readFloat(),t.balance=r.readFloat()),s.events.push(t)}a=r.readInt(!0);for(let n=0;n<a;n++)s.animations.push(this.readAnimation(r,r.readString(),s));return s}readSkin(t,e,s,r){let n=null,i=0;if(s){if(i=t.readInt(!0),0==i)return null;n=new Xu("default")}else{n=new Xu(t.readStringRef()),n.bones.length=t.readInt(!0);for(let s=0,r=n.bones.length;s<r;s++)n.bones[s]=e.bones[t.readInt(!0)];for(let s=0,r=t.readInt(!0);s<r;s++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let s=0,r=t.readInt(!0);s<r;s++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let s=0,r=t.readInt(!0);s<r;s++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);i=t.readInt(!0)}for(let a=0;a<i;a++){const s=t.readInt(!0);for(let i=0,a=t.readInt(!0);i<a;i++){const i=t.readStringRef(),a=this.readAttachment(t,e,n,s,i,r);null!=a&&n.setAttachment(s,i,a)}}return n}readAttachment(t,e,s,n,i,a){const o=this.scale;let h=t.readStringRef();null==h&&(h=i);const l=t.readByte();switch(Yu.AttachmentTypeValues[l]){case r.Region:{let e=t.readStringRef();const r=t.readFloat(),n=t.readFloat(),i=t.readFloat(),a=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32();null==e&&(e=h);const f=this.attachmentLoader.newRegionAttachment(s,h,e);return null==f?null:(f.path=e,f.x=n*o,f.y=i*o,f.scaleX=a,f.scaleY=l,f.rotation=r,f.width=c*o,f.height=u*o,bh.rgba8888ToColor(f.color,d),f)}case r.BoundingBox:{const e=t.readInt(!0),r=this.readVertices(t,e),n=a?t.readInt32():0,i=this.attachmentLoader.newBoundingBoxAttachment(s,h);return null==i?null:(i.worldVerticesLength=e<<1,i.vertices=r.vertices,i.bones=r.bones,a&&bh.rgba8888ToColor(i.color,n),i)}case r.Mesh:{let e=t.readStringRef();const r=t.readInt32(),n=t.readInt(!0),i=this.readFloatArray(t,n<<1,1),l=this.readShortArray(t),c=this.readVertices(t,n),u=t.readInt(!0);let d=null,f=0,p=0;a&&(d=this.readShortArray(t),f=t.readFloat(),p=t.readFloat()),null==e&&(e=h);const m=this.attachmentLoader.newMeshAttachment(s,h,e);return null==m?null:(m.path=e,bh.rgba8888ToColor(m.color,r),m.bones=c.bones,m.vertices=c.vertices,m.worldVerticesLength=n<<1,m.triangles=l,m.regionUVs=new Float32Array(i),m.hullLength=u<<1,a&&(m.edges=d,m.width=f*o,m.height=p*o),m)}case r.LinkedMesh:{let e=t.readStringRef();const r=t.readInt32(),i=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean();let u=0,d=0;a&&(u=t.readFloat(),d=t.readFloat()),null==e&&(e=h);const f=this.attachmentLoader.newMeshAttachment(s,h,e);return null==f?null:(f.path=e,bh.rgba8888ToColor(f.color,r),a&&(f.width=u*o,f.height=d*o),this.linkedMeshes.push(new Wu(f,i,n,l,c)),f)}case r.Path:{const e=t.readBoolean(),r=t.readBoolean(),n=t.readInt(!0),i=this.readVertices(t,n),l=Sh.newArray(n/3,0);for(let s=0,a=l.length;s<a;s++)l[s]=t.readFloat()*o;const c=a?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(s,h);return null==u?null:(u.closed=e,u.constantSpeed=r,u.worldVerticesLength=n<<1,u.vertices=i.vertices,u.bones=i.bones,u.lengths=l,a&&bh.rgba8888ToColor(u.color,c),u)}case r.Point:{const e=t.readFloat(),r=t.readFloat(),n=t.readFloat(),i=a?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(s,h);return null==l?null:(l.x=r*o,l.y=n*o,l.rotation=e,a&&bh.rgba8888ToColor(l.color,i),l)}case r.Clipping:{const r=t.readInt(!0),n=t.readInt(!0),i=this.readVertices(t,n),o=a?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(s,h);return null==l?null:(l.endSlot=e.slots[r],l.worldVerticesLength=n<<1,l.vertices=i.vertices,l.bones=i.bones,a&&bh.rgba8888ToColor(l.color,o),l)}}return null}readVertices(t,e){const s=e<<1,r=new Hu,n=this.scale;if(!t.readBoolean())return r.vertices=this.readFloatArray(t,s,n),r;const i=new Array,a=new Array;for(let o=0;o<e;o++){const e=t.readInt(!0);a.push(e);for(let s=0;s<e;s++)a.push(t.readInt(!0)),i.push(t.readFloat()*n),i.push(t.readFloat()*n),i.push(t.readFloat())}return r.vertices=Sh.toFloatArray(i),r.bones=a,r}readFloatArray(t,e,s){const r=new Array(e);if(1==s)for(let n=0;n<e;n++)r[n]=t.readFloat();else for(let n=0;n<e;n++)r[n]=t.readFloat()*s;return r}readShortArray(t){const e=t.readInt(!0),s=new Array(e);for(let r=0;r<e;r++)s[r]=t.readShort();return s}readAnimation(t,e,s){const r=new Array,n=this.scale;let i=0;const a=new bh,h=new bh;for(let o=0,u=t.readInt(!0);o<u;o++){const e=t.readInt(!0);for(let s=0,n=t.readInt(!0);s<n;s++){const s=t.readByte(),n=t.readInt(!0);switch(s){case Yu.SLOT_ATTACHMENT:{const s=new Jc(n);s.slotIndex=e;for(let e=0;e<n;e++)s.setFrame(e,t.readFloat(),t.readStringRef());r.push(s),i=Math.max(i,s.frames[n-1]);break}case Yu.SLOT_COLOR:{const s=new Zc(n);s.slotIndex=e;for(let e=0;e<n;e++){const r=t.readFloat();bh.rgba8888ToColor(a,t.readInt32()),s.setFrame(e,r,a.r,a.g,a.b,a.a),e<n-1&&this.readCurve(t,e,s)}r.push(s),i=Math.max(i,s.frames[(n-1)*Zc.ENTRIES]);break}case Yu.SLOT_TWO_COLOR:{const s=new Qc(n);s.slotIndex=e;for(let e=0;e<n;e++){const r=t.readFloat();bh.rgba8888ToColor(a,t.readInt32()),bh.rgb888ToColor(h,t.readInt32()),s.setFrame(e,r,a.r,a.g,a.b,a.a,h.r,h.g,h.b),e<n-1&&this.readCurve(t,e,s)}r.push(s),i=Math.max(i,s.frames[(n-1)*Qc.ENTRIES]);break}}}}for(let o=0,u=t.readInt(!0);o<u;o++){const e=t.readInt(!0);for(let s=0,a=t.readInt(!0);s<a;s++){const s=t.readByte(),a=t.readInt(!0);switch(s){case Yu.BONE_ROTATE:{const s=new Wc(a);s.boneIndex=e;for(let e=0;e<a;e++)s.setFrame(e,t.readFloat(),t.readFloat()),e<a-1&&this.readCurve(t,e,s);r.push(s),i=Math.max(i,s.frames[(a-1)*Wc.ENTRIES]);break}case Yu.BONE_TRANSLATE:case Yu.BONE_SCALE:case Yu.BONE_SHEAR:{let o,h=1;s==Yu.BONE_SCALE?o=new jc(a):s==Yu.BONE_SHEAR?o=new zc(a):(o=new $c(a),h=n),o.boneIndex=e;for(let e=0;e<a;e++)o.setFrame(e,t.readFloat(),t.readFloat()*h,t.readFloat()*h),e<a-1&&this.readCurve(t,e,o);r.push(o),i=Math.max(i,o.frames[(a-1)*$c.ENTRIES]);break}}}}for(let o=0,u=t.readInt(!0);o<u;o++){const e=t.readInt(!0),s=t.readInt(!0),a=new iu(s);a.ikConstraintIndex=e;for(let r=0;r<s;r++)a.setFrame(r,t.readFloat(),t.readFloat(),t.readFloat()*n,t.readByte(),t.readBoolean(),t.readBoolean()),r<s-1&&this.readCurve(t,r,a);r.push(a),i=Math.max(i,a.frames[(s-1)*iu.ENTRIES])}for(let o=0,u=t.readInt(!0);o<u;o++){const e=t.readInt(!0),s=t.readInt(!0),n=new ou(s);n.transformConstraintIndex=e;for(let r=0;r<s;r++)n.setFrame(r,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),r<s-1&&this.readCurve(t,r,n);r.push(n),i=Math.max(i,n.frames[(s-1)*ou.ENTRIES])}for(let u=0,d=t.readInt(!0);u<d;u++){const e=t.readInt(!0),a=s.pathConstraints[e];for(let s=0,h=t.readInt(!0);s<h;s++){const s=t.readByte(),h=t.readInt(!0);switch(s){case Yu.PATH_POSITION:case Yu.PATH_SPACING:{let l,c=1;s==Yu.PATH_SPACING?(l=new cu(h),a.spacingMode!=Pu.Length&&a.spacingMode!=Pu.Fixed||(c=n)):(l=new lu(h),a.positionMode==o.Fixed&&(c=n)),l.pathConstraintIndex=e;for(let e=0;e<h;e++)l.setFrame(e,t.readFloat(),t.readFloat()*c),e<h-1&&this.readCurve(t,e,l);r.push(l),i=Math.max(i,l.frames[(h-1)*lu.ENTRIES]);break}case Yu.PATH_MIX:{const s=new du(h);s.pathConstraintIndex=e;for(let e=0;e<h;e++)s.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()),e<h-1&&this.readCurve(t,e,s);r.push(s),i=Math.max(i,s.frames[(h-1)*du.ENTRIES]);break}}}}for(let o=0,u=t.readInt(!0);o<u;o++){const e=s.skins[t.readInt(!0)];for(let s=0,a=t.readInt(!0);s<a;s++){const s=t.readInt(!0);for(let a=0,o=t.readInt(!0);a<o;a++){const a=e.getAttachment(s,t.readStringRef()),o=null!=a.bones,h=a.vertices,l=o?h.length/3*2:h.length,c=t.readInt(!0),u=new eu(c);u.slotIndex=s,u.attachment=a;for(let e=0;e<c;e++){const s=t.readFloat();let r,i=t.readInt(!0);if(0==i)r=o?Sh.newFloatArray(l):h;else{r=Sh.newFloatArray(l);const e=t.readInt(!0);if(i+=e,1==n)for(let s=e;s<i;s++)r[s]=t.readFloat();else for(let s=e;s<i;s++)r[s]=t.readFloat()*n;if(!o)for(let t=0,s=r.length;t<s;t++)r[t]+=h[t]}u.setFrame(e,s,r),e<c-1&&this.readCurve(t,e,u)}r.push(u),i=Math.max(i,u.frames[c-1])}}}const l=t.readInt(!0);if(l>0){const e=new ru(l),n=s.slots.length;for(let s=0;s<l;s++){const r=t.readFloat(),i=t.readInt(!0),a=Sh.newArray(n,0);for(let t=n-1;t>=0;t--)a[t]=-1;const o=Sh.newArray(n-i,0);let h=0,l=0;for(let e=0;e<i;e++){const e=t.readInt(!0);for(;h!=e;)o[l++]=h++;a[h+t.readInt(!0)]=h++}for(;h<n;)o[l++]=h++;for(let t=n-1;t>=0;t--)-1==a[t]&&(a[t]=o[--l]);e.setFrame(s,r,a)}r.push(e),i=Math.max(i,e.frames[l-1])}const c=t.readInt(!0);if(c>0){const e=new su(c);for(let r=0;r<c;r++){const n=t.readFloat(),i=s.events[t.readInt(!0)],a=new Su(n,i);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readBoolean()?t.readString():i.stringValue,null!=a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(r,a)}r.push(e),i=Math.max(i,e.frames[c-1])}return new Vc(e,r,i)}readCurve(t,e,s){switch(t.readByte()){case Yu.CURVE_STEPPED:s.setStepped(e);break;case Yu.CURVE_BEZIER:this.setCurve(s,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}setCurve(t,e,s,r,n,i){t.setCurve(e,s,r,n,i)}};let Gu=Yu;Gu.AttachmentTypeValues=[0,1,2,3,4,5,6],Gu.TransformModeValues=[l.Normal,l.OnlyTranslation,l.NoRotationOrReflection,l.NoScale,l.NoScaleOrReflection],Gu.PositionModeValues=[o.Fixed,o.Percent],Gu.SpacingModeValues=[Pu.Length,Pu.Fixed,Pu.Percent],Gu.RotateModeValues=[h.Tangent,h.Chain,h.ChainScale],Gu.BlendModeValues=[f.NORMAL,f.ADD,f.MULTIPLY,f.SCREEN],Gu.BONE_ROTATE=0,Gu.BONE_TRANSLATE=1,Gu.BONE_SCALE=2,Gu.BONE_SHEAR=3,Gu.SLOT_ATTACHMENT=0,Gu.SLOT_COLOR=1,Gu.SLOT_TWO_COLOR=2,Gu.PATH_POSITION=0,Gu.PATH_SPACING=1,Gu.PATH_MIX=2,Gu.CURVE_LINEAR=0,Gu.CURVE_STEPPED=1,Gu.CURVE_BEZIER=2;let Wu=class{constructor(t,e,s,r,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=r,this.inheritDeform=n}},Hu=class{constructor(t=null,e=null){this.bones=t,this.vertices=e}},$u=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const s=this.scale,r=new Ou,n="string"==typeof e?JSON.parse(e):e,i=n.skeleton;if(null!=i){if(r.hash=i.hash,r.version=i.spine,"3.8"!==r.version.substr(0,3)){const t=`Spine 3.8 loader cant load version ${i.spine}. Please configure your pixi-spine bundle`;console.error(t)}if("3.8.75"===r.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,r.fps=i.fps,r.imagesPath=i.images}if(n.bones)for(let a=0;a<n.bones.length;a++){const e=n.bones[a];let i=null;const o=this.getValue(e,"parent",null);if(null!=o&&(i=r.findBone(o),null==i))throw new Error(`Parent bone not found: ${o}`);const h=new Au(r.bones.length,e.name,i);h.length=this.getValue(e,"length",0)*s,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.rotation=this.getValue(e,"rotation",0),h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.shearX=this.getValue(e,"shearX",0),h.shearY=this.getValue(e,"shearY",0),h.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),h.skinRequired=this.getValue(e,"skin",!1),r.bones.push(h)}if(n.slots)for(let a=0;a<n.slots.length;a++){const e=n.slots[a],s=e.name,i=e.bone,o=r.findBone(i);if(null==o)throw new Error(`Slot bone not found: ${i}`);const h=new Lu(r.slots.length,s,o),l=this.getValue(e,"color",null);null!=l&&h.color.setFromString(l);const c=this.getValue(e,"dark",null);null!=c&&(h.darkColor=new bh(1,1,1,1),h.darkColor.setFromString(c)),h.attachmentName=this.getValue(e,"attachment",null),h.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),r.slots.push(h)}if(n.ik)for(let t=0;t<n.ik.length;t++){const e=n.ik[t],i=new Mu(e.name);i.order=this.getValue(e,"order",0),i.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=r.findBone(s);if(null==n)throw new Error(`IK bone not found: ${s}`);i.bones.push(n)}const a=e.target;if(i.target=r.findBone(a),null==i.target)throw new Error(`IK target bone not found: ${a}`);i.mix=this.getValue(e,"mix",1),i.softness=this.getValue(e,"softness",0)*s,i.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,i.compress=this.getValue(e,"compress",!1),i.stretch=this.getValue(e,"stretch",!1),i.uniform=this.getValue(e,"uniform",!1),r.ikConstraints.push(i)}if(n.transform)for(let t=0;t<n.transform.length;t++){const e=n.transform[t],i=new Vu(e.name);i.order=this.getValue(e,"order",0),i.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=r.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);i.bones.push(n)}const a=e.target;if(i.target=r.findBone(a),null==i.target)throw new Error(`Transform constraint target bone not found: ${a}`);i.local=this.getValue(e,"local",!1),i.relative=this.getValue(e,"relative",!1),i.offsetRotation=this.getValue(e,"rotation",0),i.offsetX=this.getValue(e,"x",0)*s,i.offsetY=this.getValue(e,"y",0)*s,i.offsetScaleX=this.getValue(e,"scaleX",0),i.offsetScaleY=this.getValue(e,"scaleY",0),i.offsetShearY=this.getValue(e,"shearY",0),i.rotateMix=this.getValue(e,"rotateMix",1),i.translateMix=this.getValue(e,"translateMix",1),i.scaleMix=this.getValue(e,"scaleMix",1),i.shearMix=this.getValue(e,"shearMix",1),r.transformConstraints.push(i)}if(n.path)for(let a=0;a<n.path.length;a++){const e=n.path[a],i=new Cu(e.name);i.order=this.getValue(e,"order",0),i.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=r.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);i.bones.push(n)}const h=e.target;if(i.target=r.findSlot(h),null==i.target)throw new Error(`Path target slot not found: ${h}`);i.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),i.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),i.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),i.offsetRotation=this.getValue(e,"rotation",0),i.position=this.getValue(e,"position",0),i.positionMode==o.Fixed&&(i.position*=s),i.spacing=this.getValue(e,"spacing",0),i.spacingMode!=Pu.Length&&i.spacingMode!=Pu.Fixed||(i.spacing*=s),i.rotateMix=this.getValue(e,"rotateMix",1),i.translateMix=this.getValue(e,"translateMix",1),r.pathConstraints.push(i)}if(n.skins)for(let t=0;t<n.skins.length;t++){const e=n.skins[t],s=new Xu(e.name);if(e.bones)for(let n=0;n<e.bones.length;n++){const i=r.findBone(e.bones[n]);if(null==i)throw new Error(`Skin bone not found: ${e.bones[t]}`);s.bones.push(i)}if(e.ik)for(let n=0;n<e.ik.length;n++){const i=r.findIkConstraint(e.ik[n]);if(null==i)throw new Error(`Skin IK constraint not found: ${e.ik[t]}`);s.constraints.push(i)}if(e.transform)for(let n=0;n<e.transform.length;n++){const i=r.findTransformConstraint(e.transform[n]);if(null==i)throw new Error(`Skin transform constraint not found: ${e.transform[t]}`);s.constraints.push(i)}if(e.path)for(let n=0;n<e.path.length;n++){const i=r.findPathConstraint(e.path[n]);if(null==i)throw new Error(`Skin path constraint not found: ${e.path[t]}`);s.constraints.push(i)}for(const t in e.attachments){const n=r.findSlot(t);if(null==n)throw new Error(`Slot not found: ${t}`);const i=e.attachments[t];for(const t in i){const e=this.readAttachment(i[t],s,n.index,t,r);null!=e&&s.setAttachment(n.index,t,e)}}r.skins.push(s),"default"==s.name&&(r.defaultSkin=s)}for(let t=0,a=this.linkedMeshes.length;t<a;t++){const e=this.linkedMeshes[t],s=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==s)throw new Error(`Skin not found: ${e.skin}`);const n=s.getAttachment(e.slotIndex,e.parent);if(null==n)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.deformAttachment=e.inheritDeform?n:e.mesh,e.mesh.setParentMesh(n)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new Iu(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),r.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,s,r,n){const i=this.scale;r=this.getValue(t,"name",r);switch(this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",r),n=this.attachmentLoader.newRegionAttachment(e,r,s);if(null==n)return null;n.path=s,n.x=this.getValue(t,"x",0)*i,n.y=this.getValue(t,"y",0)*i,n.scaleX=this.getValue(t,"scaleX",1),n.scaleY=this.getValue(t,"scaleY",1),n.rotation=this.getValue(t,"rotation",0),n.width=t.width*i,n.height=t.height*i;const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{const n=this.getValue(t,"path",r),a=this.attachmentLoader.newMeshAttachment(e,r,n);if(null==a)return null;a.path=n;const o=this.getValue(t,"color",null);null!=o&&a.color.setFromString(o),a.width=this.getValue(t,"width",0)*i,a.height=this.getValue(t,"height",0)*i;const h=this.getValue(t,"parent",null);if(null!=h)return this.linkedMeshes.push(new ju(a,this.getValue(t,"skin",null),s,h,this.getValue(t,"deform",!0))),a;const l=t.uvs;return this.readVertices(t,a,l.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(l),a.edges=this.getValue(t,"edges",null),a.hullLength=2*this.getValue(t,"hull",0),a}case"path":{const s=this.attachmentLoader.newPathAttachment(e,r);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const n=t.vertexCount;this.readVertices(t,s,n<<1);const a=Sh.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*i;s.lengths=a;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,r);if(null==s)return null;s.x=this.getValue(t,"x",0)*i,s.y=this.getValue(t,"y",0)*i,s.rotation=this.getValue(t,"rotation",0);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,r);if(null==s)return null;const i=this.getValue(t,"end",null);if(null!=i){const t=n.findSlot(i);if(null==t)throw new Error(`Clipping end slot not found: ${i}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){const r=this.scale;e.worldVerticesLength=s;const n=t.vertices;if(s==n.length){const t=Sh.toFloatArray(n);if(1!=r)for(let e=0,s=n.length;e<s;e++)t[e]*=r;return void(e.vertices=t)}const i=new Array,a=new Array;for(let o=0,h=n.length;o<h;){const t=n[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(n[o]),i.push(n[o+1]*r),i.push(n[o+2]*r),i.push(n[o+3])}e.bones=a,e.vertices=Sh.toFloatArray(i)}readAnimation(t,e,s){const r=this.scale,n=new Array;let i=0;if(t.slots)for(const o in t.slots){const e=t.slots[o],r=s.findSlotIndex(o);if(-1==r)throw new Error(`Slot not found: ${o}`);for(const t in e){const s=e[t];if("attachment"==t){const t=new Jc(s.length);t.slotIndex=r;let e=0;for(let r=0;r<s.length;r++){const n=s[r];t.setFrame(e++,this.getValue(n,"time",0),n.name)}n.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new Zc(s.length);t.slotIndex=r;let e=0;for(let r=0;r<s.length;r++){const n=s[r],i=new bh;i.setFromString(n.color||"ffffffff"),t.setFrame(e,this.getValue(n,"time",0),i.r,i.g,i.b,i.a),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Zc.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${o})`);{const t=new Qc(s.length);t.slotIndex=r;let e=0;for(let r=0;r<s.length;r++){const n=s[r],i=new bh,a=new bh;i.setFromString(n.light),a.setFromString(n.dark),t.setFrame(e,this.getValue(n,"time",0),i.r,i.g,i.b,i.a,a.r,a.g,a.b),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Qc.ENTRIES])}}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],a=s.findBoneIndex(o);if(-1==a)throw new Error(`Bone not found: ${o}`);for(const t in e){const s=e[t];if("rotate"===t){const t=new Wc(s.length);t.boneIndex=a;let e=0;for(let r=0;r<s.length;r++){const n=s[r];t.setFrame(e,this.getValue(n,"time",0),this.getValue(n,"angle",0)),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Wc.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${o})`);{let e=null,o=1,h=0;"scale"===t?(e=new jc(s.length),h=1):"shear"===t?e=new zc(s.length):(e=new $c(s.length),o=r),e.boneIndex=a;let l=0;for(let t=0;t<s.length;t++){const r=s[t],n=this.getValue(r,"x",h),i=this.getValue(r,"y",h);e.setFrame(l,this.getValue(r,"time",0),n*o,i*o),this.readCurve(r,e,l),l++}n.push(e),i=Math.max(i,e.frames[(e.getFrameCount()-1)*$c.ENTRIES])}}}}if(t.ik)for(const o in t.ik){const e=t.ik[o],a=s.findIkConstraint(o),h=new iu(e.length);h.ikConstraintIndex=s.ikConstraints.indexOf(a);let l=0;for(let t=0;t<e.length;t++){const s=e[t];h.setFrame(l,this.getValue(s,"time",0),this.getValue(s,"mix",1),this.getValue(s,"softness",0)*r,this.getValue(s,"bendPositive",!0)?1:-1,this.getValue(s,"compress",!1),this.getValue(s,"stretch",!1)),this.readCurve(s,h,l),l++}n.push(h),i=Math.max(i,h.frames[(h.getFrameCount()-1)*iu.ENTRIES])}if(t.transform)for(const o in t.transform){const e=t.transform[o],r=s.findTransformConstraint(o),a=new ou(e.length);a.transformConstraintIndex=s.transformConstraints.indexOf(r);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,this.getValue(s,"time",0),this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1),this.getValue(s,"scaleMix",1),this.getValue(s,"shearMix",1)),this.readCurve(s,a,h),h++}n.push(a),i=Math.max(i,a.frames[(a.getFrameCount()-1)*ou.ENTRIES])}if(t.path)for(const h in t.path){const e=t.path[h],a=s.findPathConstraintIndex(h);if(-1==a)throw new Error(`Path constraint not found: ${h}`);const l=s.pathConstraints[a];for(const t in e){const s=e[t];if("position"===t||"spacing"===t){let e=null,h=1;"spacing"===t?(e=new cu(s.length),l.spacingMode!=Pu.Length&&l.spacingMode!=Pu.Fixed||(h=r)):(e=new lu(s.length),l.positionMode==o.Fixed&&(h=r)),e.pathConstraintIndex=a;let c=0;for(let r=0;r<s.length;r++){const n=s[r];e.setFrame(c,this.getValue(n,"time",0),this.getValue(n,t,0)*h),this.readCurve(n,e,c),c++}n.push(e),i=Math.max(i,e.frames[(e.getFrameCount()-1)*lu.ENTRIES])}else if("mix"===t){const t=new du(s.length);t.pathConstraintIndex=a;let e=0;for(let r=0;r<s.length;r++){const n=s[r];t.setFrame(e,this.getValue(n,"time",0),this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1)),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*du.ENTRIES])}}}if(t.deform)for(const o in t.deform){const e=t.deform[o],a=s.findSkin(o);if(null!=a)for(const t in e){const o=e[t],h=s.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${o.name}`);for(const t in o){const e=o[t],s=a.getAttachment(h,t);if(null==s)throw new Error(`Deform attachment not found: ${e.name}`);const l=null!=s.bones,c=s.vertices,u=l?c.length/3*2:c.length,d=new eu(e.length);d.slotIndex=h,d.attachment=s;let f=0;for(let t=0;t<e.length;t++){const s=e[t];let n;const i=this.getValue(s,"vertices",null);if(null==i)n=l?Sh.newFloatArray(u):c;else{n=Sh.newFloatArray(u);const t=this.getValue(s,"offset",0);if(Sh.arrayCopy(i,0,n,t,i.length),1!=r)for(let e=t,s=e+i.length;e<s;e++)n[e]*=r;if(!l)for(let e=0;e<u;e++)n[e]+=c[e]}d.setFrame(f,this.getValue(s,"time",0),n),this.readCurve(s,d,f),f++}n.push(d),i=Math.max(i,d.frames[d.getFrameCount()-1])}}}let a=t.drawOrder;if(null==a&&(a=t.draworder),null!=a){const t=new ru(a.length),e=s.slots.length;let r=0;for(let n=0;n<a.length;n++){const i=a[n];let o=null;const h=this.getValue(i,"offsets",null);if(null!=h){o=Sh.newArray(e,-1);const t=Sh.newArray(e-h.length,0);let r=0,n=0;for(let e=0;e<h.length;e++){const i=h[e],a=s.findSlotIndex(i.slot);if(-1==a)throw new Error(`Slot not found: ${i.slot}`);for(;r!=a;)t[n++]=r++;o[r+i.offset]=r++}for(;r<e;)t[n++]=r++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}t.setFrame(r++,this.getValue(i,"time",0),o)}n.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}if(t.events){const e=new su(t.events.length);let r=0;for(let n=0;n<t.events.length;n++){const i=t.events[n],a=s.findEvent(i.name);if(null==a)throw new Error(`Event not found: ${i.name}`);const o=new Su(Sh.toSinglePrecision(this.getValue(i,"time",0)),a);o.intValue=this.getValue(i,"int",a.intValue),o.floatValue=this.getValue(i,"float",a.floatValue),o.stringValue=this.getValue(i,"string",a.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(i,"volume",1),o.balance=this.getValue(i,"balance",0)),e.setFrame(r++,o)}n.push(e),i=Math.max(i,e.frames[e.getFrameCount()-1])}if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new Vc(e,n,i))}readCurve(t,e,s){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(s);else{const r=t.curve;e.setCurve(s,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return f.NORMAL;if("additive"==t)return f.ADD;if("multiply"==t)return f.MULTIPLY;if("screen"==t)return f.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return o.Fixed;if("percent"==t)return o.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return Pu.Length;if("fixed"==t)return Pu.Fixed;if("percent"==t)return Pu.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return h.Tangent;if("chain"==t)return h.Chain;if("chainscale"==t)return h.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return l.Normal;if("onlytranslation"==t)return l.OnlyTranslation;if("norotationorreflection"==t)return l.NoRotationOrReflection;if("noscale"==t)return l.NoScale;if("noscaleorreflection"==t)return l.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},ju=class{constructor(t,e,s,r,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=r,this.inheritDeform=n}};const zu=Object.freeze(Object.defineProperty({__proto__:null,Animation:Vc,AnimationState:pu,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:vu,AtlasAttachmentLoader:Eu,Attachment:Sc,AttachmentTimeline:Jc,Bone:wu,BoneData:Au,BoundingBoxAttachment:Mc,ClippingAttachment:Cc,ColorTimeline:Zc,ConstraintData:Tu,CurveTimeline:Yc,DeformTimeline:eu,DrawOrderTimeline:ru,Event:Su,EventData:Iu,EventQueue:yu,EventTimeline:su,EventType:bu,IkConstraint:Ru,IkConstraintData:Mu,IkConstraintTimeline:iu,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,s,r){t.x+=vh.randomTriangular(-this.jitterX,this.jitterY),t.y+=vh.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:Pc,PathAttachment:kc,PathConstraint:Fu,PathConstraintData:Cu,PathConstraintMixTimeline:du,PathConstraintPositionTimeline:lu,PathConstraintSpacingTimeline:cu,PointAttachment:Fc,RegionAttachment:Bc,RotateTimeline:Wc,ScaleTimeline:jc,ShearTimeline:zc,Skeleton:Bu,SkeletonBinary:Gu,SkeletonBounds:class extends Mh{},SkeletonData:Ou,SkeletonJson:$u,Skin:Xu,SkinEntry:Uu,Slot:Dc,SlotData:Lu,SpacingMode:Pu,Spine:class extends Sl{createSkeleton(t){this.skeleton=new Bu(t),this.skeleton.updateWorldTransform(),this.stateData=new vu(t),this.state=new pu(this.stateData)}},SwirlEffect:Lc,TimelineType:Uc,TrackEntry:gu,TransformConstraint:Du,TransformConstraintData:Vu,TransformConstraintTimeline:ou,TranslateTimeline:$c,TwoColorTimeline:Qc,VertexAttachment:Rc},Symbol.toStringTag,{value:"Module"}));let qu=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const Zu=class extends qu{constructor(t){super(t),this.id=(65535&Zu.nextID++)<<11,this.worldVerticesLength=0}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,r,n,i){s=n+(s>>1)*i;const a=t.bone.skeleton,o=t.attachmentVertices;let h=this.vertices;const l=this.bones;if(null==l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,f=a.b,p=a.d;for(let t=e,o=n;o<s;t+=2,o+=i){const e=h[t],s=h[t+1];r[o]=e*u+s*d+l,r[o+1]=e*f+s*p+c}return}let c=0,u=0;for(let f=0;f<e;f+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let f=n,p=3*u;f<s;f+=i){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,p+=3){const s=d[l[c]].matrix,r=h[p],n=h[p+1],i=h[p+2];t+=(r*s.a+n*s.c+s.tx)*i,e+=(r*s.b+n*s.d+s.ty)*i}r[f]=t,r[f+1]=e}else{const t=o;for(let e=n,a=3*u,o=u<<1;e<s;e+=i){let s=0,n=0,i=l[c++];for(i+=c;c<i;c++,a+=3,o+=2){const e=d[l[c]].matrix,r=h[a]+t[o],i=h[a+1]+t[o+1],u=h[a+2];s+=(r*e.a+i*e.c+e.tx)*u,n+=(r*e.b+i*e.d+e.ty)*u}r[e]=s,r[e+1]=n}}}applyDeform(t){return this==t}};let Ku=Zu;Ku.nextID=0;let Qu=class extends Ku{constructor(t){super(t),this.type=r.BoundingBox,this.color=new bh(1,1,1,1)}},Ju=class extends Ku{constructor(t){super(t),this.type=r.Clipping,this.color=new bh(.2275,.2275,.8078,1)}},td=class extends Ku{constructor(t){super(t),this.type=r.Mesh,this.color=new bh(1,1,1,1),this.inheritDeform=!1,this.tempColor=new bh(0,0,0,0)}applyDeform(t){return this==t||this.inheritDeform&&this.parentMesh==t}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},ed=class extends Ku{constructor(t){super(t),this.type=r.Path,this.closed=!1,this.constantSpeed=!1,this.color=new bh(1,1,1,1)}},sd=class extends Ku{constructor(t){super(t),this.type=r.Point,this.color=new bh(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=vh.cosDeg(this.rotation),r=vh.sinDeg(this.rotation),n=s*e.a+r*e.c,i=s*e.b+r*e.d;return Math.atan2(i,n)*vh.radDeg}},rd=class{constructor(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new bh,this.darkColor=null==t.darkColor?null:new bh,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const nd=class extends qu{constructor(t){super(t),this.type=r.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new bh(1,1,1,1),this.offset=Sh.newFloatArray(8),this.uvs=Sh.newFloatArray(8),this.tempColor=new bh(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,n=s+this.region.width*t,i=r+this.region.height*e,a=this.rotation*Math.PI/180,o=Math.cos(a),h=Math.sin(a),l=s*o+this.x,c=s*h,u=r*o+this.y,d=r*h,f=n*o+this.x,p=n*h,m=i*o+this.y,g=i*h,x=this.offset;x[nd.OX1]=l-d,x[nd.OY1]=u+c,x[nd.OX2]=l-g,x[nd.OY2]=m+c,x[nd.OX3]=f-g,x[nd.OY3]=m+p,x[nd.OX4]=f-d,x[nd.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,r){const n=this.offset,i=t instanceof rd?t.bone.matrix:t.matrix,a=i.tx,o=i.ty,h=i.a,l=i.c,c=i.b,u=i.d;let d=0,f=0;d=n[nd.OX1],f=n[nd.OY1],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=r,d=n[nd.OX2],f=n[nd.OY2],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=r,d=n[nd.OX3],f=n[nd.OY3],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=r,d=n[nd.OX4],f=n[nd.OY4],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o}};let id=nd;id.OX1=0,id.OY1=1,id.OX2=2,id.OY2=3,id.OX3=4,id.OY3=5,id.OX4=6,id.OY4=7,id.X1=0,id.Y1=1,id.C1R=2,id.C1G=3,id.C1B=4,id.C1A=5,id.U1=6,id.V1=7,id.X2=8,id.Y2=9,id.C2R=10,id.C2G=11,id.C2B=12,id.C2A=13,id.U2=14,id.V2=15,id.X3=16,id.Y3=17,id.C3R=18,id.C3G=19,id.C3B=20,id.C3A=21,id.U3=22,id.V3=23,id.X4=24,id.Y4=25,id.C4R=26,id.C4G=27,id.C4B=28,id.C4A=29,id.U4=30,id.V4=31;const ad=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,s,r){const n=this.angle*vh.degreesToRadians,i=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(i*i+a*a);if(o<this.radius){const e=ad.interpolation.apply(0,n,(this.radius-o)/this.radius),s=Math.cos(e),r=Math.sin(e);t.x=s*i-r*a+this.worldX,t.y=r*i+s*a+this.worldY}}end(){}};let od=ad;od.interpolation=new Ah(2);let hd=class{constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=s}apply(t,e,s,r,n,i,a,o){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,n,i,a,o)}static binarySearch(t,e,s=1){let r=0,n=t.length/s-2;if(0==n)return s;let i=n>>>1;for(;;){if(t[(i+1)*s]<=e?r=i+1:n=i,r==n)return(r+1)*s;i=r+n>>>1}}static linearSearch(t,e,s){for(let r=0,n=t.length-s;r<=n;r+=s)if(t[r]>e)return r;return-1}};var ld=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(ld||{});const cd=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=Sh.newFloatArray((t-1)*cd.BEZIER_SIZE)}getFrameCount(){return this.curves.length/cd.BEZIER_SIZE+1}setLinear(t){this.curves[t*cd.BEZIER_SIZE]=cd.LINEAR}setStepped(t){this.curves[t*cd.BEZIER_SIZE]=cd.STEPPED}getCurveType(t){const e=t*cd.BEZIER_SIZE;if(e==this.curves.length)return cd.LINEAR;const s=this.curves[e];return s==cd.LINEAR?cd.LINEAR:s==cd.STEPPED?cd.STEPPED:cd.BEZIER}setCurve(t,e,s,r,n){const i=.03*(2*-e+r),a=.03*(2*-s+n),o=.006*(3*(e-r)+1),h=.006*(3*(s-n)+1);let l=2*i+o,c=2*a+h,u=.3*e+i+.16666667*o,d=.3*s+a+.16666667*h,f=t*cd.BEZIER_SIZE;const p=this.curves;p[f++]=cd.BEZIER;let m=u,g=d;for(let x=f+cd.BEZIER_SIZE-1;f<x;f+=2)p[f]=m,p[f+1]=g,u+=l,d+=c,l+=o,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=vh.clamp(e,0,1);const s=this.curves;let r=t*cd.BEZIER_SIZE;const n=s[r];if(n==cd.LINEAR)return e;if(n==cd.STEPPED)return 0;r++;let i=0;for(let o=r,h=r+cd.BEZIER_SIZE-1;r<h;r+=2)if(i=s[r],i>=e){let t,n;return r==o?(t=0,n=0):(t=s[r-2],n=s[r-1]),n+(s[r+1]-n)*(e-t)/(i-t)}const a=s[r-1];return a+(1-a)*(e-i)/(1-i)}};let ud=cd;ud.LINEAR=0,ud.STEPPED=1,ud.BEZIER=2,ud.BEZIER_SIZE=19;const dd=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+dd.ROTATION]=s}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.bones[this.boneIndex];if(s<h[0]){switch(a){case i.setup:return void(l.rotation=l.data.rotation);case i.first:const t=l.data.rotation-l.rotation;l.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*n}return}if(s>=h[h.length-dd.ENTRIES]){let t=h[h.length+dd.PREV_ROTATION];switch(a){case i.setup:l.rotation=l.data.rotation+t*n;break;case i.first:case i.replace:t+=l.data.rotation-l.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case i.add:l.rotation+=t*n}return}const c=hd.binarySearch(h,s,dd.ENTRIES),u=h[c+dd.PREV_ROTATION],d=h[c],f=this.getCurvePercent((c>>1)-1,1-(s-d)/(h[c+dd.PREV_TIME]-d));let p=h[c+dd.ROTATION]-u;switch(p=u+(p-360*(16384-(16384.499999999996-p/360|0)))*f,a){case i.setup:l.rotation=l.data.rotation+(p-360*(16384-(16384.499999999996-p/360|0)))*n;break;case i.first:case i.replace:p+=l.data.rotation-l.rotation;case i.add:l.rotation+=(p-360*(16384-(16384.499999999996-p/360|0)))*n}}};let fd=dd;fd.ENTRIES=2,fd.PREV_TIME=-2,fd.PREV_ROTATION=-1,fd.ROTATION=1;const pd=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*pd.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,s,r){t*=pd.ENTRIES,this.frames[t]=e,this.frames[t+pd.X]=s,this.frames[t+pd.Y]=r}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.bones[this.boneIndex];if(s<h[0]){switch(a){case i.setup:return l.x=l.data.x,void(l.y=l.data.y);case i.first:l.x+=(l.data.x-l.x)*n,l.y+=(l.data.y-l.y)*n}return}let c=0,u=0;if(s>=h[h.length-pd.ENTRIES])c=h[h.length+pd.PREV_X],u=h[h.length+pd.PREV_Y];else{const t=hd.binarySearch(h,s,pd.ENTRIES);c=h[t+pd.PREV_X],u=h[t+pd.PREV_Y];const e=h[t],r=this.getCurvePercent(t/pd.ENTRIES-1,1-(s-e)/(h[t+pd.PREV_TIME]-e));c+=(h[t+pd.X]-c)*r,u+=(h[t+pd.Y]-u)*r}switch(a){case i.setup:l.x=l.data.x+c*n,l.y=l.data.y+u*n;break;case i.first:case i.replace:l.x+=(l.data.x+c-l.x)*n,l.y+=(l.data.y+u-l.y)*n;break;case i.add:l.x+=c*n,l.y+=u*n}}};let md=pd;md.ENTRIES=3,md.PREV_TIME=-3,md.PREV_X=-2,md.PREV_Y=-1,md.X=1,md.Y=2;let gd=class t extends md{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,s,r,n,o,h,l){const c=this.frames,u=e.bones[this.boneIndex];if(r<c[0]){switch(h){case i.setup:return u.scaleX=u.data.scaleX,void(u.scaleY=u.data.scaleY);case i.first:u.scaleX+=(u.data.scaleX-u.scaleX)*o,u.scaleY+=(u.data.scaleY-u.scaleY)*o}return}let d=0,f=0;if(r>=c[c.length-t.ENTRIES])d=c[c.length+t.PREV_X]*u.data.scaleX,f=c[c.length+t.PREV_Y]*u.data.scaleY;else{const e=hd.binarySearch(c,r,t.ENTRIES);d=c[e+t.PREV_X],f=c[e+t.PREV_Y];const s=c[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(r-s)/(c[e+t.PREV_TIME]-s));d=(d+(c[e+t.X]-d)*n)*u.data.scaleX,f=(f+(c[e+t.Y]-f)*n)*u.data.scaleY}if(1==o)h==i.add?(u.scaleX+=d-u.data.scaleX,u.scaleY+=f-u.data.scaleY):(u.scaleX=d,u.scaleY=f);else{let t=0,e=0;if(l==a.mixOut)switch(h){case i.setup:t=u.data.scaleX,e=u.data.scaleY,u.scaleX=t+(Math.abs(d)*vh.signum(t)-t)*o,u.scaleY=e+(Math.abs(f)*vh.signum(e)-e)*o;break;case i.first:case i.replace:t=u.scaleX,e=u.scaleY,u.scaleX=t+(Math.abs(d)*vh.signum(t)-t)*o,u.scaleY=e+(Math.abs(f)*vh.signum(e)-e)*o;break;case i.add:t=u.scaleX,e=u.scaleY,u.scaleX=t+(Math.abs(d)*vh.signum(t)-u.data.scaleX)*o,u.scaleY=e+(Math.abs(f)*vh.signum(e)-u.data.scaleY)*o}else switch(h){case i.setup:t=Math.abs(u.data.scaleX)*vh.signum(d),e=Math.abs(u.data.scaleY)*vh.signum(f),u.scaleX=t+(d-t)*o,u.scaleY=e+(f-e)*o;break;case i.first:case i.replace:t=Math.abs(u.scaleX)*vh.signum(d),e=Math.abs(u.scaleY)*vh.signum(f),u.scaleX=t+(d-t)*o,u.scaleY=e+(f-e)*o;break;case i.add:t=vh.signum(d),e=vh.signum(f),u.scaleX=Math.abs(u.scaleX)*t+(d-Math.abs(u.data.scaleX)*t)*o,u.scaleY=Math.abs(u.scaleY)*e+(f-Math.abs(u.data.scaleY)*e)*o}}}},xd=class t extends md{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,s,r,n,a,o,h){const l=this.frames,c=e.bones[this.boneIndex];if(r<l[0]){switch(o){case i.setup:return c.shearX=c.data.shearX,void(c.shearY=c.data.shearY);case i.first:c.shearX+=(c.data.shearX-c.shearX)*a,c.shearY+=(c.data.shearY-c.shearY)*a}return}let u=0,d=0;if(r>=l[l.length-t.ENTRIES])u=l[l.length+t.PREV_X],d=l[l.length+t.PREV_Y];else{const e=hd.binarySearch(l,r,t.ENTRIES);u=l[e+t.PREV_X],d=l[e+t.PREV_Y];const s=l[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(r-s)/(l[e+t.PREV_TIME]-s));u+=(l[e+t.X]-u)*n,d+=(l[e+t.Y]-d)*n}switch(o){case i.setup:c.shearX=c.data.shearX+u*a,c.shearY=c.data.shearY+d*a;break;case i.first:case i.replace:c.shearX+=(c.data.shearX+u-c.shearX)*a,c.shearY+=(c.data.shearY+d-c.shearY)*a;break;case i.add:c.shearX+=u*a,c.shearY+=d*a}}};const yd=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*yd.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,s,r,n,i){t*=yd.ENTRIES,this.frames[t]=e,this.frames[t+yd.R]=s,this.frames[t+yd.G]=r,this.frames[t+yd.B]=n,this.frames[t+yd.A]=i}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex],l=this.frames;if(s<l[0]){switch(a){case i.setup:return void h.color.setFromColor(h.data.color);case i.first:const t=h.color,e=h.data.color;t.add((e.r-t.r)*n,(e.g-t.g)*n,(e.b-t.b)*n,(e.a-t.a)*n)}return}let c=0,u=0,d=0,f=0;if(s>=l[l.length-yd.ENTRIES]){const t=l.length;c=l[t+yd.PREV_R],u=l[t+yd.PREV_G],d=l[t+yd.PREV_B],f=l[t+yd.PREV_A]}else{const t=hd.binarySearch(l,s,yd.ENTRIES);c=l[t+yd.PREV_R],u=l[t+yd.PREV_G],d=l[t+yd.PREV_B],f=l[t+yd.PREV_A];const e=l[t],r=this.getCurvePercent(t/yd.ENTRIES-1,1-(s-e)/(l[t+yd.PREV_TIME]-e));c+=(l[t+yd.R]-c)*r,u+=(l[t+yd.G]-u)*r,d+=(l[t+yd.B]-d)*r,f+=(l[t+yd.A]-f)*r}if(1==n)h.color.set(c,u,d,f);else{const t=h.color;a==i.setup&&t.setFromColor(h.data.color),t.add((c-t.r)*n,(u-t.g)*n,(d-t.b)*n,(f-t.a)*n)}}};let bd=yd;bd.ENTRIES=5,bd.PREV_TIME=-5,bd.PREV_R=-4,bd.PREV_G=-3,bd.PREV_B=-2,bd.PREV_A=-1,bd.R=1,bd.G=2,bd.B=3,bd.A=4;const _d=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*_d.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,s,r,n,i,a,o,h){t*=_d.ENTRIES,this.frames[t]=e,this.frames[t+_d.R]=s,this.frames[t+_d.G]=r,this.frames[t+_d.B]=n,this.frames[t+_d.A]=i,this.frames[t+_d.R2]=a,this.frames[t+_d.G2]=o,this.frames[t+_d.B2]=h}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex],l=this.frames;if(s<l[0]){switch(a){case i.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case i.first:const t=h.color,e=h.darkColor,s=h.data.color,r=h.data.darkColor;t.add((s.r-t.r)*n,(s.g-t.g)*n,(s.b-t.b)*n,(s.a-t.a)*n),e.add((r.r-e.r)*n,(r.g-e.g)*n,(r.b-e.b)*n,0)}return}let c=0,u=0,d=0,f=0,p=0,m=0,g=0;if(s>=l[l.length-_d.ENTRIES]){const t=l.length;c=l[t+_d.PREV_R],u=l[t+_d.PREV_G],d=l[t+_d.PREV_B],f=l[t+_d.PREV_A],p=l[t+_d.PREV_R2],m=l[t+_d.PREV_G2],g=l[t+_d.PREV_B2]}else{const t=hd.binarySearch(l,s,_d.ENTRIES);c=l[t+_d.PREV_R],u=l[t+_d.PREV_G],d=l[t+_d.PREV_B],f=l[t+_d.PREV_A],p=l[t+_d.PREV_R2],m=l[t+_d.PREV_G2],g=l[t+_d.PREV_B2];const e=l[t],r=this.getCurvePercent(t/_d.ENTRIES-1,1-(s-e)/(l[t+_d.PREV_TIME]-e));c+=(l[t+_d.R]-c)*r,u+=(l[t+_d.G]-u)*r,d+=(l[t+_d.B]-d)*r,f+=(l[t+_d.A]-f)*r,p+=(l[t+_d.R2]-p)*r,m+=(l[t+_d.G2]-m)*r,g+=(l[t+_d.B2]-g)*r}if(1==n)h.color.set(c,u,d,f),h.darkColor.set(p,m,g,1);else{const t=h.color,e=h.darkColor;a==i.setup&&(t.setFromColor(h.data.color),e.setFromColor(h.data.darkColor)),t.add((c-t.r)*n,(u-t.g)*n,(d-t.b)*n,(f-t.a)*n),e.add((p-e.r)*n,(m-e.g)*n,(g-e.b)*n,0)}}};let vd=_d;vd.ENTRIES=8,vd.PREV_TIME=-8,vd.PREV_R=-7,vd.PREV_G=-6,vd.PREV_B=-5,vd.PREV_A=-4,vd.PREV_R2=-3,vd.PREV_G2=-2,vd.PREV_B2=-1,vd.R=1,vd.G=2,vd.B=3,vd.A=4,vd.R2=5,vd.G2=6,vd.B2=7;let Ed=class{constructor(t){this.frames=Sh.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,r,n,o,h){const l=t.slots[this.slotIndex];if(h==a.mixOut&&o==i.setup){const e=l.data.attachmentName;return void l.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}const c=this.frames;if(s<c[0]){if(o==i.setup||o==i.first){const e=l.data.attachmentName;l.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}return}let u=0;u=s>=c[c.length-1]?c.length-1:hd.binarySearch(c,s,1)-1;const d=this.attachmentNames[u];t.slots[this.slotIndex].setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}},wd=null,Ad=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t),this.frameVertices=new Array(t),null==wd&&(wd=Sh.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex],l=h.getAttachment();if(!(l instanceof Ku&&l.applyDeform(this.attachment)))return;const c=h.attachmentVertices;0==c.length&&(a=i.setup);const u=this.frameVertices,d=u[0].length,f=this.frames;if(s<f[0]){const t=l;switch(a){case i.setup:return void(c.length=0);case i.first:if(1==n){c.length=0;break}const e=Sh.setArraySize(c,d);if(null==t.bones){const s=t.vertices;for(let t=0;t<d;t++)e[t]+=(s[t]-e[t])*n}else{n=1-n;for(let t=0;t<d;t++)e[t]*=n}}return}const p=Sh.setArraySize(c,d);if(s>=f[f.length-1]){const t=u[f.length-1];if(1==n)if(a==i.add){const e=l;if(null==e.bones){const s=e.vertices;for(let e=0;e<d;e++)p[e]+=t[e]-s[e]}else for(let s=0;s<d;s++)p[s]+=t[s]}else Sh.arrayCopy(t,0,p,0,d);else switch(a){case i.setup:{const e=l;if(null==e.bones){const s=e.vertices;for(let e=0;e<d;e++){const r=s[e];p[e]=r+(t[e]-r)*n}}else for(let s=0;s<d;s++)p[s]=t[s]*n;break}case i.first:case i.replace:for(let s=0;s<d;s++)p[s]+=(t[s]-p[s])*n;case i.add:const e=l;if(null==e.bones){const s=e.vertices;for(let e=0;e<d;e++)p[e]+=(t[e]-s[e])*n}else for(let s=0;s<d;s++)p[s]+=t[s]*n}return}const m=hd.binarySearch(f,s),g=u[m-1],x=u[m],y=f[m],b=this.getCurvePercent(m-1,1-(s-y)/(f[m-1]-y));if(1==n)if(a==i.add){const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<d;t++){const s=g[t];p[t]+=s+(x[t]-s)*b-e[t]}}else for(let e=0;e<d;e++){const t=g[e];p[e]+=t+(x[e]-t)*b}}else for(let i=0;i<d;i++){const t=g[i];p[i]=t+(x[i]-t)*b}else switch(a){case i.setup:{const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<d;t++){const s=g[t],r=e[t];p[t]=r+(s+(x[t]-s)*b-r)*n}}else for(let e=0;e<d;e++){const t=g[e];p[e]=(t+(x[e]-t)*b)*n}break}case i.first:case i.replace:for(let e=0;e<d;e++){const t=g[e];p[e]+=(t+(x[e]-t)*b-p[e])*n}break;case i.add:const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<d;t++){const s=g[t];p[t]+=(s+(x[t]-s)*b-e[t])*n}}else for(let e=0;e<d;e++){const t=g[e];p[e]+=(t+(x[e]-t)*b)*n}}}},Td=class{constructor(t){this.frames=Sh.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,r,n,i,a){if(null==r)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,r,n,i,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=hd.binarySearch(o,e);const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)r.push(this.events[l])}},Sd=class{constructor(t){this.frames=Sh.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,r,n,o,h){const l=t.drawOrder,c=t.slots;if(h==a.mixOut&&o==i.setup)return void Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const u=this.frames;if(s<u[0])return void(o!=i.setup&&o!=i.first||Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let d=0;d=s>=u[u.length-1]?u.length-1:hd.binarySearch(u,s)-1;const f=this.drawOrders[d];if(null==f)Sh.arrayCopy(c,0,l,0,c.length);else for(let i=0,a=f.length;i<a;i++)l[i]=c[f[i]]}};const Id=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*Id.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,s,r,n,i){t*=Id.ENTRIES,this.frames[t]=e,this.frames[t+Id.MIX]=s,this.frames[t+Id.BEND_DIRECTION]=r,this.frames[t+Id.COMPRESS]=n?1:0,this.frames[t+Id.STRETCH]=i?1:0}apply(t,e,s,r,n,o,h){const l=this.frames,c=t.ikConstraints[this.ikConstraintIndex];if(s<l[0]){switch(o){case i.setup:return c.mix=c.data.mix,c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,void(c.stretch=c.data.stretch);case i.first:c.mix+=(c.data.mix-c.mix)*n,c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch}return}if(s>=l[l.length-Id.ENTRIES])return void(o==i.setup?(c.mix=c.data.mix+(l[l.length+Id.PREV_MIX]-c.data.mix)*n,h==a.mixOut?(c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch):(c.bendDirection=l[l.length+Id.PREV_BEND_DIRECTION],c.compress=0!=l[l.length+Id.PREV_COMPRESS],c.stretch=0!=l[l.length+Id.PREV_STRETCH])):(c.mix+=(l[l.length+Id.PREV_MIX]-c.mix)*n,h==a.mixIn&&(c.bendDirection=l[l.length+Id.PREV_BEND_DIRECTION],c.compress=0!=l[l.length+Id.PREV_COMPRESS],c.stretch=0!=l[l.length+Id.PREV_STRETCH])));const u=hd.binarySearch(l,s,Id.ENTRIES),d=l[u+Id.PREV_MIX],f=l[u],p=this.getCurvePercent(u/Id.ENTRIES-1,1-(s-f)/(l[u+Id.PREV_TIME]-f));o==i.setup?(c.mix=c.data.mix+(d+(l[u+Id.MIX]-d)*p-c.data.mix)*n,h==a.mixOut?(c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch):(c.bendDirection=l[u+Id.PREV_BEND_DIRECTION],c.compress=0!=l[u+Id.PREV_COMPRESS],c.stretch=0!=l[u+Id.PREV_STRETCH])):(c.mix+=(d+(l[u+Id.MIX]-d)*p-c.mix)*n,h==a.mixIn&&(c.bendDirection=l[u+Id.PREV_BEND_DIRECTION],c.compress=0!=l[u+Id.PREV_COMPRESS],c.stretch=0!=l[u+Id.PREV_STRETCH]))}};let Rd=Id;Rd.ENTRIES=5,Rd.PREV_TIME=-5,Rd.PREV_MIX=-4,Rd.PREV_BEND_DIRECTION=-3,Rd.PREV_COMPRESS=-2,Rd.PREV_STRETCH=-1,Rd.MIX=1,Rd.BEND_DIRECTION=2,Rd.COMPRESS=3,Rd.STRETCH=4;const Md=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*Md.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,s,r,n,i){t*=Md.ENTRIES,this.frames[t]=e,this.frames[t+Md.ROTATE]=s,this.frames[t+Md.TRANSLATE]=r,this.frames[t+Md.SCALE]=n,this.frames[t+Md.SHEAR]=i}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(s<h[0]){const t=l.data;switch(a){case i.setup:return l.rotateMix=t.rotateMix,l.translateMix=t.translateMix,l.scaleMix=t.scaleMix,void(l.shearMix=t.shearMix);case i.first:l.rotateMix+=(t.rotateMix-l.rotateMix)*n,l.translateMix+=(t.translateMix-l.translateMix)*n,l.scaleMix+=(t.scaleMix-l.scaleMix)*n,l.shearMix+=(t.shearMix-l.shearMix)*n}return}let c=0,u=0,d=0,f=0;if(s>=h[h.length-Md.ENTRIES]){const t=h.length;c=h[t+Md.PREV_ROTATE],u=h[t+Md.PREV_TRANSLATE],d=h[t+Md.PREV_SCALE],f=h[t+Md.PREV_SHEAR]}else{const t=hd.binarySearch(h,s,Md.ENTRIES);c=h[t+Md.PREV_ROTATE],u=h[t+Md.PREV_TRANSLATE],d=h[t+Md.PREV_SCALE],f=h[t+Md.PREV_SHEAR];const e=h[t],r=this.getCurvePercent(t/Md.ENTRIES-1,1-(s-e)/(h[t+Md.PREV_TIME]-e));c+=(h[t+Md.ROTATE]-c)*r,u+=(h[t+Md.TRANSLATE]-u)*r,d+=(h[t+Md.SCALE]-d)*r,f+=(h[t+Md.SHEAR]-f)*r}if(a==i.setup){const t=l.data;l.rotateMix=t.rotateMix+(c-t.rotateMix)*n,l.translateMix=t.translateMix+(u-t.translateMix)*n,l.scaleMix=t.scaleMix+(d-t.scaleMix)*n,l.shearMix=t.shearMix+(f-t.shearMix)*n}else l.rotateMix+=(c-l.rotateMix)*n,l.translateMix+=(u-l.translateMix)*n,l.scaleMix+=(d-l.scaleMix)*n,l.shearMix+=(f-l.shearMix)*n}};let Cd=Md;Cd.ENTRIES=5,Cd.PREV_TIME=-5,Cd.PREV_ROTATE=-4,Cd.PREV_TRANSLATE=-3,Cd.PREV_SCALE=-2,Cd.PREV_SHEAR=-1,Cd.ROTATE=1,Cd.TRANSLATE=2,Cd.SCALE=3,Cd.SHEAR=4;const Pd=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*Pd.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=Pd.ENTRIES,this.frames[t]=e,this.frames[t+Pd.VALUE]=s}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(s<h[0]){switch(a){case i.setup:return void(l.position=l.data.position);case i.first:l.position+=(l.data.position-l.position)*n}return}let c=0;if(s>=h[h.length-Pd.ENTRIES])c=h[h.length+Pd.PREV_VALUE];else{const t=hd.binarySearch(h,s,Pd.ENTRIES);c=h[t+Pd.PREV_VALUE];const e=h[t],r=this.getCurvePercent(t/Pd.ENTRIES-1,1-(s-e)/(h[t+Pd.PREV_TIME]-e));c+=(h[t+Pd.VALUE]-c)*r}a==i.setup?l.position=l.data.position+(c-l.data.position)*n:l.position+=(c-l.position)*n}};let kd=Pd;kd.ENTRIES=2,kd.PREV_TIME=-2,kd.PREV_VALUE=-1,kd.VALUE=1;let Fd=class t extends kd{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,s,r,n,a,o,h){const l=this.frames,c=e.pathConstraints[this.pathConstraintIndex];if(r<l[0]){switch(o){case i.setup:return void(c.spacing=c.data.spacing);case i.first:c.spacing+=(c.data.spacing-c.spacing)*a}return}let u=0;if(r>=l[l.length-t.ENTRIES])u=l[l.length+t.PREV_VALUE];else{const e=hd.binarySearch(l,r,t.ENTRIES);u=l[e+t.PREV_VALUE];const s=l[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(r-s)/(l[e+t.PREV_TIME]-s));u+=(l[e+t.VALUE]-u)*n}o==i.setup?c.spacing=c.data.spacing+(u-c.data.spacing)*a:c.spacing+=(u-c.spacing)*a}};const Dd=class extends ud{constructor(t){super(t),this.frames=Sh.newFloatArray(t*Dd.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,s,r){t*=Dd.ENTRIES,this.frames[t]=e,this.frames[t+Dd.ROTATE]=s,this.frames[t+Dd.TRANSLATE]=r}apply(t,e,s,r,n,a,o){const h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(s<h[0]){switch(a){case i.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case i.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*n,l.translateMix+=(l.data.translateMix-l.translateMix)*n}return}let c=0,u=0;if(s>=h[h.length-Dd.ENTRIES])c=h[h.length+Dd.PREV_ROTATE],u=h[h.length+Dd.PREV_TRANSLATE];else{const t=hd.binarySearch(h,s,Dd.ENTRIES);c=h[t+Dd.PREV_ROTATE],u=h[t+Dd.PREV_TRANSLATE];const e=h[t],r=this.getCurvePercent(t/Dd.ENTRIES-1,1-(s-e)/(h[t+Dd.PREV_TIME]-e));c+=(h[t+Dd.ROTATE]-c)*r,u+=(h[t+Dd.TRANSLATE]-u)*r}a==i.setup?(l.rotateMix=l.data.rotateMix+(c-l.data.rotateMix)*n,l.translateMix=l.data.translateMix+(u-l.data.translateMix)*n):(l.rotateMix+=(c-l.rotateMix)*n,l.translateMix+=(u-l.translateMix)*n)}};let Nd=Dd;Nd.ENTRIES=3,Nd.PREV_TIME=-3,Nd.PREV_ROTATE=-2,Nd.PREV_TRANSLATE=-1,Nd.ROTATE=1,Nd.TRANSLATE=2;const Bd=class{constructor(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new Xd(this),this.propertyIDs=new gh,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new Ih((()=>new Vd)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(null==r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let n=t*r.timeScale;if(r.delay>0){if(r.delay-=n,r.delay>0)continue;n=-r.delay,r.delay=0}let i=r.next;if(null!=i){const e=r.trackLast-i.delay;if(e>=0){for(i.delay=0,i.trackTime=0==r.timeScale?0:(e/r.timeScale+t)*i.timeScale,r.trackTime+=n,this.setCurrent(s,i,!0);null!=i.mixingFrom;)i.mixTime+=t,i=i.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[s]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(null==s)return!0;const r=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),r):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let r=!1;for(let n=0,o=s.length;n<o;n++){const o=s[n];if(null==o||o.delay>0)continue;r=!0;const h=0==n?i.first:o.mixBlend;let l=o.alpha;null!=o.mixingFrom?l*=this.applyMixingFrom(o,t,h):o.trackTime>=o.trackEnd&&null==o.next&&(l=0);const c=o.animationLast,u=o.getAnimationTime(),d=o.animation.timelines.length,f=o.animation.timelines;if(0==n&&1==l||h==i.add)for(let s=0;s<d;s++)f[s].apply(t,c,u,e,l,h,a.mixIn);else{const s=o.timelineMode,r=0==o.timelinesRotation.length;r&&Sh.setArraySize(o.timelinesRotation,d<<1,null);const n=o.timelinesRotation;for(let o=0;o<d;o++){const d=f[o],p=s[o]==Bd.SUBSEQUENT?h:i.setup;d instanceof fd?this.applyRotateTimeline(d,t,u,l,p,n,o<<1,r):d.apply(t,c,u,e,l,p,a.mixIn)}}this.queueEvents(o,u),e.length=0,o.nextAnimationLast=u,o.nextTrackLast=o.trackTime}return this.queue.drain(),r}applyMixingFrom(t,e,s){const r=t.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,e,s);let n=0;0==t.mixDuration?(n=1,s==i.first&&(s=i.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=i.first&&(s=r.mixBlend));const o=n<r.eventThreshold?this.events:null,h=n<r.attachmentThreshold,l=n<r.drawOrderThreshold,c=r.animationLast,u=r.getAnimationTime(),d=r.animation.timelines.length,f=r.animation.timelines,p=r.alpha*t.interruptAlpha,m=p*(1-n);if(s==i.add)for(let i=0;i<d;i++)f[i].apply(e,c,u,o,m,s,a.mixOut);else{const t=r.timelineMode,n=r.timelineHoldMix,g=0==r.timelinesRotation.length;g&&Sh.setArraySize(r.timelinesRotation,d<<1,null);const x=r.timelinesRotation;r.totalAlpha=0;for(let y=0;y<d;y++){const d=f[y];let b,_=a.mixOut,v=0;switch(t[y]){case Bd.SUBSEQUENT:if(!h&&d instanceof Ed)continue;if(!l&&d instanceof Sd)continue;b=s,v=m;break;case Bd.FIRST:b=i.setup,v=m;break;case Bd.HOLD:b=i.setup,v=p;break;default:b=i.setup;const t=n[y];v=p*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=v,d instanceof fd?this.applyRotateTimeline(d,e,u,v,b,x,y<<1,g):(b==i.setup&&(d instanceof Ed?h&&(_=a.mixOut):d instanceof Sd&&l&&(_=a.mixOut)),d.apply(e,c,u,o,v,b,_))}}return t.mixDuration>0&&this.queueEvents(r,u),this.events.length=0,r.nextAnimationLast=u,r.nextTrackLast=r.trackTime,n}applyRotateTimeline(t,e,s,r,n,o,h,l){if(l&&(o[h]=0),1==r)return void t.apply(e,0,s,null,1,n,a.mixIn);const c=t,u=c.frames,d=e.bones[c.boneIndex];let f=0,p=0;if(s<u[0])switch(n){case i.setup:d.rotation=d.data.rotation;default:return;case i.first:f=d.rotation,p=d.data.rotation}else if(f=n==i.setup?d.data.rotation:d.rotation,s>=u[u.length-fd.ENTRIES])p=d.data.rotation+u[u.length+fd.PREV_ROTATION];else{const t=hd.binarySearch(u,s,fd.ENTRIES),e=u[t+fd.PREV_ROTATION],r=u[t],n=c.getCurvePercent((t>>1)-1,1-(s-r)/(u[t+fd.PREV_TIME]-r));p=u[t+fd.ROTATION]-e,p-=360*(16384-(16384.499999999996-p/360|0)),p=e+p*n+d.data.rotation,p-=360*(16384-(16384.499999999996-p/360|0))}let m=0,g=p-f;if(g-=360*(16384-(16384.499999999996-g/360|0)),0==g)m=o[h];else{let t=0,e=0;l?(t=0,e=g):(t=o[h],e=o[h+1]);const s=g>0;let r=t>=0;vh.signum(e)!=vh.signum(g)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*vh.signum(t)),r=s),m=g+t-t%360,r!=s&&(m+=360*vh.signum(t)),o[h]=m}o[h+1]=g,f+=m*r,d.rotation=f-360*(16384-(16384.499999999996-f/360|0))}queueEvents(t,e){const s=t.animationStart,r=t.animationEnd,n=r-s,i=t.trackLast%n,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<i)break;e.time>r||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==n||i>t.trackTime%n:e>=r&&t.animationLast<r,l&&this.queue.complete(t);o<h;o++){a[o].time<s||this.queue.event(t,a[o])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){const t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(s&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){const r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,r,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let r=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,r=!1):this.disposeNext(n));const i=this.trackEntry(t,e,s,n);return this.setCurrent(t,i,r),this.queue.drain(),i}addAnimation(t,e,s,r){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,n,s,r)}addAnimationWith(t,e,s,r){if(null==e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;const i=this.trackEntry(t,e,s,n);if(null==n)this.setCurrent(t,i,!0),this.queue.drain();else if(n.next=i,r<=0){const t=n.animationEnd-n.animationStart;0!=t?(n.loop?r+=t*(1+(n.trackTime/t|0)):r+=Math.max(t,n.trackTime),r-=this.data.getMix(n.animation,e)):r=n.trackTime}return i.delay=r,i}setEmptyAnimation(t,e){const s=this.setAnimationWith(t,Bd.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);const r=this.addAnimationWith(t,Bd.emptyAnimation,!1,s);return r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,r=this.tracks.length;s<r;s++){const e=this.tracks[s];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Sh.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,r){const n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==r?0:this.data.getMix(r.animation,e),n}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==i.add||this.setTimelineModes(e),e=e.mixingTo}while(null!=e)}}}setTimelineModes(t){const e=t.mixingTo,s=t.animation.timelines,r=t.animation.timelines.length,n=Sh.setArraySize(t.timelineMode,r);t.timelineHoldMix.length=0;const i=Sh.setArraySize(t.timelineHoldMix,r),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let o=0;o<r;o++)a.add(s[o].getPropertyId()),n[o]=Bd.HOLD;else t:for(let o=0;o<r;o++){const r=s[o].getPropertyId();if(a.add(r))if(null!=e&&this.hasTimeline(e,r)){for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!this.hasTimeline(s,r)){if(t.mixDuration>0){n[o]=Bd.HOLD_MIX,i[o]=s;continue t}break}n[o]=Bd.HOLD}else n[o]=Bd.FIRST;else n[o]=Bd.SUBSEQUENT}}hasTimeline(t,e){const s=t.animation.timelines;for(let r=0,n=s.length;r<n;r++)if(s[r].getPropertyId()==e)return!0;return!1}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){Bd.deprecatedWarning1||(Bd.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,r){Bd.deprecatedWarning2||(Bd.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,r)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return Bd.deprecatedWarning3||(Bd.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Od=Bd;Od.emptyAnimation=new hd("<empty>",[],0),Od.SUBSEQUENT=0,Od.FIRST=1,Od.HOLD=2,Od.HOLD_MIX=3,Od.deprecatedWarning1=!1,Od.deprecatedWarning2=!1,Od.deprecatedWarning3=!1;const Ld=class{constructor(){this.mixBlend=i.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return Ld.deprecatedWarning1||(Ld.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Ld.deprecatedWarning1||(Ld.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Ld.deprecatedWarning2||(Ld.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Ld.deprecatedWarning2||(Ld.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Vd=Ld;Vd.deprecatedWarning1=!1,Vd.deprecatedWarning2=!1;const Ud=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Yd.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Yd.interrupt),this.objects.push(t)}end(t){this.objects.push(Yd.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Yd.dispose),this.objects.push(t)}complete(t){this.objects.push(Yd.complete),this.objects.push(t)}event(t,e){this.objects.push(Yd.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return Ud.deprecatedWarning1||(Ud.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const r=t[s],n=t[s+1];switch(r){case Yd.start:null!=n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(n);n.onStart&&this.deprecateStuff()&&n.onStart(n.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(n.trackIndex);break;case Yd.interrupt:null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(n);break;case Yd.end:null!=n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(n);n.onEnd&&this.deprecateStuff()&&n.onEnd(n.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(n.trackIndex);case Yd.dispose:null!=n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(n);this.animState.trackEntryPool.free(n);break;case Yd.complete:null!=n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(n);const r=vh.toInt(n.loopsCount());n.onComplete&&this.deprecateStuff()&&n.onComplete(n.trackIndex,r),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(n.trackIndex,r);break;case Yd.event:const i=t[2+s++];null!=n.listener&&n.listener.event&&n.listener.event(n,i);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(n,i);n.onEvent&&this.deprecateStuff()&&n.onEvent(n.trackIndex,i),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(n.trackIndex,i)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let Xd=Ud;Xd.deprecatedWarning1=!1;var Yd=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(Yd||{});const Gd=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const r=this.skeletonData.findAnimation(t);if(null==r)throw new Error(`Animation not found: ${t}`);const n=this.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);this.setMixWith(r,n,s)}setMixByName(t,e,s){Gd.deprecatedWarning1||(Gd.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const r=`${t.name}.${e.name}`;this.animationToMixTime[r]=s}getMix(t,e){const s=`${t.name}.${e.name}`,r=this.animationToMixTime[s];return void 0===r?this.defaultMix:r}};let Wd=Gd;Wd.deprecatedWarning1=!1;let Hd=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,s){const r=this.atlas.findRegion(s);if(null==r)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);const n=new id(e);return n.region=r,n}newMeshAttachment(t,e,s){const r=this.atlas.findRegion(s);if(null==r)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);const n=new td(e);return n.region=r,n}newBoundingBoxAttachment(t,e){return new Qu(e)}newPathAttachment(t,e){return new ed(e)}newPointAttachment(t,e){return new sd(e)}newClippingAttachment(t,e){return new Ju(e)}},$d=class{constructor(t,e,s){if(this.matrix=new Ui,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,r,n,i,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=r,this.ascaleY=n,this.ashearX=i,this.ashearY=a,this.appliedValid=!0;const o=this.parent,h=this.matrix,c=this.skeleton.scaleX,u=-this.skeleton.scaleY;if(null==o){const o=this.skeleton,l=s+90+a;return h.a=vh.cosDeg(s+i)*r*c,h.c=vh.cosDeg(l)*n*c,h.b=vh.sinDeg(s+i)*r*u,h.d=vh.sinDeg(l)*n*u,h.tx=t*c+o.x,void(h.ty=e*u+o.y)}let d=o.matrix.a,f=o.matrix.c,p=o.matrix.b,m=o.matrix.d;switch(h.tx=d*t+f*e+o.matrix.tx,h.ty=p*t+m*e+o.matrix.ty,this.data.transformMode){case l.Normal:{const t=s+90+a,e=vh.cosDeg(s+i)*r,o=vh.cosDeg(t)*n,l=vh.sinDeg(s+i)*r,c=vh.sinDeg(t)*n;return h.a=d*e+f*l,h.c=d*o+f*c,h.b=p*e+m*l,void(h.d=p*o+m*c)}case l.OnlyTranslation:{const t=s+90+a;h.a=vh.cosDeg(s+i)*r,h.c=vh.cosDeg(t)*n,h.b=vh.sinDeg(s+i)*r,h.d=vh.sinDeg(t)*n;break}case l.NoRotationOrReflection:{let t=d*d+p*p,e=0;t>1e-4?(t=Math.abs(d*m-f*p)/t,f=p*t,m=d*t,e=Math.atan2(p,d)*vh.radDeg):(d=0,p=0,e=90-Math.atan2(m,f)*vh.radDeg);const o=s+i-e,l=s+a-e+90,c=vh.cosDeg(o)*r,u=vh.cosDeg(l)*n,g=vh.sinDeg(o)*r,x=vh.sinDeg(l)*n;h.a=d*c-f*g,h.c=d*u-f*x,h.b=p*c+m*g,h.d=p*u+m*x;break}case l.NoScale:case l.NoScaleOrReflection:{const t=vh.cosDeg(s),e=vh.sinDeg(s);let o=(d*t+f*e)/c,g=(p*t+m*e)/u,x=Math.sqrt(o*o+g*g);x>1e-5&&(x=1/x),o*=x,g*=x,x=Math.sqrt(o*o+g*g),this.data.transformMode==l.NoScale&&d*m-f*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(x=-x);const y=Math.PI/2+Math.atan2(g,o),b=Math.cos(y)*x,_=Math.sin(y)*x,v=vh.cosDeg(i)*r,E=vh.cosDeg(90+a)*n,w=vh.sinDeg(i)*r,A=vh.sinDeg(90+a)*n;h.a=o*v+b*w,h.c=o*E+b*A,h.b=g*v+_*w,h.d=g*E+_*A;break}}h.a*=c,h.c*=c,h.b*=u,h.d*=u}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*vh.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*vh.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*vh.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*vh.radDeg);const s=t.matrix,r=1/(s.a*s.d-s.b*s.c),n=e.tx-s.tx,i=e.ty-s.ty;this.ax=n*s.d*r-i*s.c*r,this.ay=i*s.a*r-n*s.b*r;const a=r*s.d,o=r*s.a,h=r*s.c,l=r*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,f=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*vh.radDeg,this.arotation=Math.atan2(d,c)*vh.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*vh.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,r=e.c,n=e.b,i=e.d,a=1/(s*i-r*n),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*i*a-h*r*a,t.y=h*s*a-o*n*a,t}localToWorld(t){const e=this.matrix,s=t.x,r=t.y;return t.x=s*e.a+r*e.c+e.tx,t.y=s*e.b+r*e.d+e.ty,t}worldToLocalRotation(t){const e=vh.sinDeg(t),s=vh.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*s,r.d*s-r.c*e)*vh.radDeg}localToWorldRotation(t){const e=vh.sinDeg(t),s=vh.cosDeg(t),r=this.matrix;return Math.atan2(s*r.b+e*r.d,s*r.a+e*r.c)*vh.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,r=e.c,n=e.b,i=e.d,a=vh.cosDeg(t),o=vh.sinDeg(t);e.a=a*s-o*n,e.c=a*r-o*i,e.b=o*s+a*n,e.d=o*r+a*i,this.appliedValid=!1}},jd=class{constructor(t,e,s){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=l.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}},zd=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},qd=class{constructor(t){this.name=t}},Zd=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}getOrder(){return this.data.order}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix)}}apply1(t,e,s,r,n,i,a){t.appliedValid||t.updateAppliedTransform();const o=t.parent.matrix,h=1/(o.a*o.d-o.b*o.c),l=e-o.tx,c=s-o.ty,u=(l*o.d-c*o.c)*h-t.ax,d=(c*o.a-l*o.b)*h-t.ay;let f=Math.atan2(d,u)*vh.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let p=t.ascaleX,m=t.ascaleY;if(r||n){const e=t.data.length*p,s=Math.sqrt(u*u+d*d);if(r&&s<e||n&&s>e&&e>1e-4){const t=(s/e-1)*a+1;p*=t,i&&(m*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*a,p,m,t.ashearX,t.ashearY)}apply2(t,e,s,r,n,i,a){if(0==a)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const o=t.ax,h=t.ay;let l=t.ascaleX,c=l,u=t.ascaleY,d=e.ascaleX;const f=t.matrix;let p=0,m=0,g=0;l<0?(l=-l,p=180,g=-1):(p=0,g=1),u<0&&(u=-u,g=-g),d<0?(d=-d,m=180):m=0;const x=e.ax;let y=0,b=0,_=0,v=f.a,E=f.c,w=f.b,A=f.d;const T=Math.abs(l-u)<=1e-4;T?(y=e.ay,b=v*x+E*y+f.tx,_=w*x+A*y+f.ty):(y=0,b=v*x+f.tx,_=w*x+f.ty);const S=t.parent.matrix;v=S.a,E=S.c,w=S.b,A=S.d;const I=1/(v*A-E*w);let R=s-S.tx,M=r-S.ty;const C=(R*A-M*E)*I-o,P=(M*v-R*w)*I-h,k=C*C+P*P;R=b-S.tx,M=_-S.ty;const F=(R*A-M*E)*I-o,D=(M*v-R*w)*I-h,N=Math.sqrt(F*F+D*D);let B=e.data.length*d,O=0,L=0;t:if(T){B*=l;let t=(k-N*N-B*B)/(2*N*B);t<-1?t=-1:t>1&&(t=1,i&&N+B>1e-4&&(c*=(Math.sqrt(k)/(N+B)-1)*a+1)),L=Math.acos(t)*n,v=N+B*t,E=B*Math.sin(L),O=Math.atan2(P*v-C*E,C*v+P*E)}else{v=l*B,E=u*B;const t=v*v,e=E*E,s=Math.atan2(P,C);w=e*N*N+t*k-t*e;const r=-2*e*N,i=e-t;if(A=r*r-4*i*w,A>=0){let t=Math.sqrt(A);r<0&&(t=-t),t=-(r+t)/2;const e=t/i,a=w/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=k){M=Math.sqrt(k-o*o)*n,O=s-Math.atan2(M,o),L=Math.atan2(M/u,(o-N)/l);break t}}let a=vh.PI,o=N-v,h=o*o,c=0,d=0,f=N+v,p=f*f,m=0;w=-v*N/(t-e),w>=-1&&w<=1&&(w=Math.acos(w),R=v*Math.cos(w)+N,M=E*Math.sin(w),A=R*R+M*M,A<h&&(a=w,h=A,o=R,c=M),A>p&&(d=w,p=A,f=R,m=M)),k<=(h+p)/2?(O=s-Math.atan2(c*n,o),L=a*n):(O=s-Math.atan2(m*n,f),L=d*n)}const V=Math.atan2(y,x)*g;let U=t.arotation;O=(O-V)*vh.radDeg+p-U,O>180?O-=360:O<-180&&(O+=360),t.updateWorldTransformWith(o,h,U+O*a,c,t.ascaleY,0,0),U=e.arotation,L=((L+V)*vh.radDeg-e.ashearX)*g+m-U,L>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(x,y,U+L*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},Kd=class{constructor(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t}},Qd=class{constructor(t){this.order=0,this.bones=new Array,this.name=t}};var Jd=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(Jd||{});const tf=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,r=t.bones.length;s<r;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof ed))return;const e=this.rotateMix,s=this.translateMix,r=e>0;if(!(s>0)&&!r)return;const n=this.data,i=n.spacingMode,a=i==Jd.Length,l=n.rotateMode,c=l==h.Tangent,u=l==h.ChainScale,d=this.bones.length,f=c?d:d+1,p=this.bones,m=Sh.setArraySize(this.spaces,f);let g=null;const x=this.spacing;if(u||a){u&&(g=Sh.setArraySize(this.lengths,d));for(let t=0,e=f-1;t<e;){const e=p[t],s=e.data.length;if(s<tf.epsilon)u&&(g[t]=0),m[++t]=0;else{const r=s*e.matrix.a,n=s*e.matrix.b,i=Math.sqrt(r*r+n*n);u&&(g[t]=i),m[++t]=(a?s+x:x)*i/s}}}else for(let o=1;o<f;o++)m[o]=x;const y=this.computeWorldPositions(t,f,c,n.positionMode==o.Percent,i==Jd.Percent);let b=y[0],_=y[1],v=n.offsetRotation,E=!1;if(0==v)E=l==h.Chain;else{E=!1;const t=this.target.bone.matrix;v*=t.a*t.d-t.b*t.c>0?vh.degRad:-vh.degRad}for(let o=0,h=3;o<d;o++,h+=3){const t=p[o],n=t.matrix;n.tx+=(b-n.tx)*s,n.ty+=(_-n.ty)*s;const i=y[h],a=y[h+1],l=i-b,d=a-_;if(u){const t=g[o];if(0!=t){const s=(Math.sqrt(l*l+d*d)/t-1)*e+1;n.a*=s,n.b*=s}}if(b=i,_=a,r){const s=n.a,r=n.c,i=n.b,a=n.d;let u=0,f=0,p=0;if(c&&(u=c?y[h-1]:0==m[o+1]?y[h+2]:Math.atan2(d,l)),u-=Math.atan2(i,s),E){f=Math.cos(u),p=Math.sin(u);const r=t.data.length;b+=(r*(f*s-p*i)-l)*e,_+=(r*(p*s+f*i)-d)*e}else u+=v;u>vh.PI?u-=vh.PI2:u<-vh.PI&&(u+=vh.PI2),u*=e,f=Math.cos(u),p=Math.sin(u),n.a=f*s-p*i,n.c=f*r-p*a,n.b=p*s+f*i,n.d=p*r+f*a}t.appliedValid=!1}}computeWorldPositions(t,e,s,r,n){const i=this.target;let a=this.position;const o=this.spaces,h=Sh.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,f=tf.NONE;if(!t.constantSpeed){const p=t.lengths;d-=c?1:2;const m=p[d];if(r&&(a*=m),n)for(let t=0;t<e;t++)o[t]*=m;l=Sh.setArraySize(this.world,8);for(let r=0,n=0,g=0;r<e;r++,n+=3){const e=o[r];a+=e;let x=a;if(c)x%=m,x<0&&(x+=m),g=0;else{if(x<0){f!=tf.BEFORE&&(f=tf.BEFORE,t.computeWorldVertices(i,2,4,l,0,2)),this.addBeforePosition(x,l,0,h,n);continue}if(x>m){f!=tf.AFTER&&(f=tf.AFTER,t.computeWorldVertices(i,u-6,4,l,0,2)),this.addAfterPosition(x-m,l,0,h,n);continue}}for(;;g++){const t=p[g];if(!(x>t)){if(0==g)x/=t;else{const e=p[g-1];x=(x-e)/(t-e)}break}}g!=f&&(f=g,c&&g==d?(t.computeWorldVertices(i,u-4,4,l,0,2),t.computeWorldVertices(i,0,4,l,4,2)):t.computeWorldVertices(i,6*g+2,8,l,0,2)),this.addCurvePosition(x,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,n,s||r>0&&0==e)}return h}c?(u+=2,l=Sh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u-4,l,0,2),t.computeWorldVertices(i,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=Sh.setArraySize(this.world,u),t.computeWorldVertices(i,2,u,l,0,2));const p=Sh.setArraySize(this.curves,d);let m=0,g=l[0],x=l[1],y=0,b=0,_=0,v=0,E=0,w=0,A=0,T=0,S=0,I=0,R=0,M=0,C=0,P=0;for(let D=0,N=2;D<d;D++,N+=6)y=l[N],b=l[N+1],_=l[N+2],v=l[N+3],E=l[N+4],w=l[N+5],A=.1875*(g-2*y+_),T=.1875*(x-2*b+v),S=.09375*(3*(y-_)-g+E),I=.09375*(3*(b-v)-x+w),R=2*A+S,M=2*T+I,C=.75*(y-g)+A+.16666667*S,P=.75*(b-x)+T+.16666667*I,m+=Math.sqrt(C*C+P*P),C+=R,P+=M,R+=S,M+=I,m+=Math.sqrt(C*C+P*P),C+=R,P+=M,m+=Math.sqrt(C*C+P*P),C+=R+S,P+=M+I,m+=Math.sqrt(C*C+P*P),p[D]=m,g=E,x=w;if(r&&(a*=m),n)for(let D=0;D<e;D++)o[D]*=m;const k=this.segments;let F=0;for(let D=0,N=0,B=0,O=0;D<e;D++,N+=3){const t=o[D];a+=t;let e=a;if(c)e%=m,e<0&&(e+=m),B=0;else{if(e<0){this.addBeforePosition(e,l,0,h,N);continue}if(e>m){this.addAfterPosition(e-m,l,u-4,h,N);continue}}for(;;B++){const t=p[B];if(!(e>t)){if(0==B)e/=t;else{const s=p[B-1];e=(e-s)/(t-s)}break}}if(B!=f){f=B;let t=6*B;for(g=l[t],x=l[t+1],y=l[t+2],b=l[t+3],_=l[t+4],v=l[t+5],E=l[t+6],w=l[t+7],A=.03*(g-2*y+_),T=.03*(x-2*b+v),S=.006*(3*(y-_)-g+E),I=.006*(3*(b-v)-x+w),R=2*A+S,M=2*T+I,C=.3*(y-g)+A+.16666667*S,P=.3*(b-x)+T+.16666667*I,F=Math.sqrt(C*C+P*P),k[0]=F,t=1;t<8;t++)C+=R,P+=M,R+=S,M+=I,F+=Math.sqrt(C*C+P*P),k[t]=F;C+=R,P+=M,F+=Math.sqrt(C*C+P*P),k[8]=F,C+=R+S,P+=M+I,F+=Math.sqrt(C*C+P*P),k[9]=F,O=0}for(e*=F;;O++){const t=k[O];if(!(e>t)){if(0==O)e/=t;else{const s=k[O-1];e=O+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,x,y,b,_,v,E,w,h,N,s||D>0&&0==t)}return h}addBeforePosition(t,e,s,r,n){const i=e[s],a=e[s+1],o=e[s+2]-i,h=e[s+3]-a,l=Math.atan2(h,o);r[n]=i+t*Math.cos(l),r[n+1]=a+t*Math.sin(l),r[n+2]=l}addAfterPosition(t,e,s,r,n){const i=e[s+2],a=e[s+3],o=i-e[s],h=a-e[s+1],l=Math.atan2(h,o);r[n]=i+t*Math.cos(l),r[n+1]=a+t*Math.sin(l),r[n+2]=l}addCurvePosition(t,e,s,r,n,i,a,o,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,x=p*t,y=3*x,b=p*y,_=y*t,v=e*g+r*b+i*_+o*f,E=s*g+n*b+a*_+h*f;l[c]=v,l[c+1]=E,u&&(l[c+2]=Math.atan2(E-(s*m+n*x*2+a*d),v-(e*m+r*x*2+i*d)))}getOrder(){return this.data.order}};let ef=tf;ef.NONE=-1,ef.BEFORE=-2,ef.AFTER=-3,ef.epsilon=1e-5;let sf=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new Rh,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target,i=n.matrix,a=i.a,o=i.c,h=i.b,l=i.d,c=a*l-o*h>0?vh.degRad:-vh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const i=f[p];let c=!1;const m=i.matrix;if(0!=t){const e=m.a,s=m.c,r=m.b,n=m.d;let i=Math.atan2(h,a)-Math.atan2(r,e)+u;i>vh.PI?i-=vh.PI2:i<-vh.PI&&(i+=vh.PI2),i*=t;const o=Math.cos(i),l=Math.sin(i);m.a=o*e-l*r,m.c=o*s-l*n,m.b=l*e+o*r,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,c=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(a*a+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(o*o+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.c*=t,m.d*=t,c=!0}if(r>0){const t=m.c,e=m.d,s=Math.atan2(e,t);let n=Math.atan2(l,o)-Math.atan2(h,a)-(s-Math.atan2(m.b,m.a));n>vh.PI?n-=vh.PI2:n<-vh.PI&&(n+=vh.PI2),n=s+(n+d)*r;const i=Math.sqrt(t*t+e*e);m.c=Math.cos(n)*i,m.d=Math.sin(n)*i,c=!0}c&&(i.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target,i=n.matrix,a=i.a,o=i.c,h=i.b,l=i.d,c=a*l-o*h>0?vh.degRad:-vh.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const i=f[p];let c=!1;const m=i.matrix;if(0!=t){const e=m.a,s=m.c,r=m.b,n=m.d;let i=Math.atan2(h,a)+u;i>vh.PI?i-=vh.PI2:i<-vh.PI&&(i+=vh.PI2),i*=t;const o=Math.cos(i),l=Math.sin(i);m.a=o*e-l*r,m.c=o*s-l*n,m.b=l*e+o*r,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,c=!0}if(s>0){let t=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.b*=t,t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleY)*s+1,m.c*=t,m.d*=t,c=!0}if(r>0){let t=Math.atan2(l,o)-Math.atan2(h,a);t>vh.PI?t-=vh.PI2:t<-vh.PI&&(t+=vh.PI2);const e=m.c,s=m.d;t=Math.atan2(s,e)+(t-vh.PI/2+d)*r;const n=Math.sqrt(e*e+s*s);m.c=Math.cos(t)*n,m.d=Math.sin(t)*n,c=!0}c&&(i.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const i=this.bones;for(let a=0,o=i.length;a<o;a++){const o=i[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;if(0!=t){let e=n.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax-l+this.data.offsetX)*e,c+=(n.ay-c+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u=(u+(n.ascaleX-u+this.data.offsetScaleX)*s)/u),d>1e-5&&(d=(d+(n.ascaleY-d+this.data.offsetScaleY)*s)/d));const f=o.ashearY;if(r>0){let t=n.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*r}o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const i=this.bones;for(let a=0,o=i.length;a<o;a++){const o=i[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;0!=t&&(h+=(n.arotation+this.data.offsetRotation)*t);let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u*=(n.ascaleX-1+this.data.offsetScaleX)*s+1),d>1e-5&&(d*=(n.ascaleY-1+this.data.offsetScaleY)*s+1));let f=o.ashearY;r>0&&(f+=(n.ashearY+this.data.offsetShearY)*r),o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}getOrder(){return this.data.order}};const rf=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let r;if(null==s.parent)r=new $d(s,this,null);else{const t=this.bones[s.parent.index];r=new $d(s,this,t),t.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],r=this.bones[s.boneData.index],n=new rd(s,r);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new Zd(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new sf(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new ef(s,this))}this.color=new bh(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++)t[h].sorted=!1;const e=this.ikConstraints,s=this.transformConstraints,r=this.pathConstraints,n=e.length,i=s.length,a=r.length,o=n+i+a;t:for(let h=0;h<o;h++){for(let t=0;t<n;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<i;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=r[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){const e=t.target;this.sortBone(e);const s=t.bones,r=s[0];if(this.sortBone(r),s.length>1){const t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(r.children),s[s.length-1].sorted=!0}sortPathConstraint(t){const e=t.target,s=e.data.index,r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,r);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,r);const n=e.getAttachment();n instanceof ed&&this.sortPathConstraintAttachmentWith(n,r);const i=t.bones,a=i.length;for(let o=0;o<a;o++)this.sortBone(i[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(i[o].children);for(let o=0;o<a;o++)i[o].sorted=!0}sortTransformConstraint(t){this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let r=0;r<s;r++){const t=e[r];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let r=0;r<s;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<s;r++)this.sortReset(e[r].children);for(let r=0;r<s;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,s){const r=t.attachments[e];if(r)for(const n in r)this.sortPathConstraintAttachmentWith(r[n],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof ed))return;const s=t.bones;if(null==s)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<s.length;){const r=s[e++];for(let n=e+r;e<n;e++){const r=s[e];this.sortBone(t[r])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.sorted&&this.sortReset(s.children),s.sorted=!1}}updateWorldTransform(){const t=this.updateCacheReset;for(let s=0,r=t.length;s<r;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let s=0,r=e.length;s<r;s++)e[s].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let n=0,i=t.length;n<i;n++)t[n].setToSetupPose();const e=this.ikConstraints;for(let n=0,i=e.length;n<i;n++){const t=e[n];t.bendDirection=t.data.bendDirection,t.mix=t.data.mix}const s=this.transformConstraints;for(let n=0,i=s.length;n<i;n++){const t=s[n],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const r=this.pathConstraints;for(let n=0,i=r.length;n<i;n++){const t=r[n],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;Sh.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s],n=r.data.attachmentName;if(null!=n){const e=t.getAttachment(s,n);null!=e&&r.setAttachment(e)}}}this.skin=t}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const s=this.slots;for(let r=0,n=s.length;r<n;r++){const n=s[r];if(n.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(r,e),null==s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void n.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}getBounds(t,e,s){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const r=this.drawOrder;let n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=r.length;h<l;h++){const t=r[h];let e=0,l=null;const c=t.getAttachment();if(c instanceof id)e=8,l=Sh.setArraySize(s,e,0),c.computeWorldVertices(t.bone,l,0,2);else if(c instanceof td){const r=c;e=r.worldVerticesLength,l=Sh.setArraySize(s,e,0),r.computeWorldVertices(t,0,e,l,0,2)}if(null!=l)for(let s=0,r=l.length;s<r;s+=2){const t=l[s],e=l[s+1];n=Math.min(n,t),i=Math.min(i,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(n,i),e.set(a-n,o-i)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){rf.deprecatedWarning1||(rf.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){rf.deprecatedWarning1||(rf.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let nf=rf;nf.deprecatedWarning1=!1;let af=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}},of=class{constructor(t,e,s){if(this.color=new bh(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}},hf=class{constructor(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t}},lf=class{constructor(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}addAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");const r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=s}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}attachAll(t,e){let s=0;for(let r=0;r<t.slots.length;r++){const n=t.slots[r],i=n.getAttachment();if(i&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(i==t[e]){const t=this.getAttachment(s,e);null!=t&&n.setAttachment(t);break}}}s++}}},cf=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const s=this.scale,r=new af,n="string"==typeof e?JSON.parse(e):e,i=n.skeleton;if(null!=i&&(r.hash=i.hash,r.version=i.spine,r.width=i.width,r.height=i.height,r.fps=i.fps,r.imagesPath=i.images),n.bones)for(let a=0;a<n.bones.length;a++){const e=n.bones[a];let i=null;const o=this.getValue(e,"parent",null);if(null!=o&&(i=r.findBone(o),null==i))throw new Error(`Parent bone not found: ${o}`);const h=new jd(r.bones.length,e.name,i);h.length=this.getValue(e,"length",0)*s,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.rotation=this.getValue(e,"rotation",0),h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.shearX=this.getValue(e,"shearX",0),h.shearY=this.getValue(e,"shearY",0),h.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),r.bones.push(h)}if(n.slots)for(let a=0;a<n.slots.length;a++){const e=n.slots[a],s=e.name,i=e.bone,o=r.findBone(i);if(null==o)throw new Error(`Slot bone not found: ${i}`);const h=new of(r.slots.length,s,o),l=this.getValue(e,"color",null);null!=l&&h.color.setFromString(l);const c=this.getValue(e,"dark",null);null!=c&&(h.darkColor=new bh(1,1,1,1),h.darkColor.setFromString(c)),h.attachmentName=this.getValue(e,"attachment",null),h.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),r.slots.push(h)}if(n.ik)for(let t=0;t<n.ik.length;t++){const e=n.ik[t],s=new Kd(e.name);s.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`IK bone not found: ${n}`);s.bones.push(i)}const i=e.target;if(s.target=r.findBone(i),null==s.target)throw new Error(`IK target bone not found: ${i}`);s.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,s.mix=this.getValue(e,"mix",1),r.ikConstraints.push(s)}if(n.transform)for(let t=0;t<n.transform.length;t++){const e=n.transform[t],i=new hf(e.name);i.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=r.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);i.bones.push(n)}const a=e.target;if(i.target=r.findBone(a),null==i.target)throw new Error(`Transform constraint target bone not found: ${a}`);i.local=this.getValue(e,"local",!1),i.relative=this.getValue(e,"relative",!1),i.offsetRotation=this.getValue(e,"rotation",0),i.offsetX=this.getValue(e,"x",0)*s,i.offsetY=this.getValue(e,"y",0)*s,i.offsetScaleX=this.getValue(e,"scaleX",0),i.offsetScaleY=this.getValue(e,"scaleY",0),i.offsetShearY=this.getValue(e,"shearY",0),i.rotateMix=this.getValue(e,"rotateMix",1),i.translateMix=this.getValue(e,"translateMix",1),i.scaleMix=this.getValue(e,"scaleMix",1),i.shearMix=this.getValue(e,"shearMix",1),r.transformConstraints.push(i)}if(n.path)for(let a=0;a<n.path.length;a++){const e=n.path[a],i=new Qd(e.name);i.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=r.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);i.bones.push(n)}const h=e.target;if(i.target=r.findSlot(h),null==i.target)throw new Error(`Path target slot not found: ${h}`);i.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),i.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),i.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),i.offsetRotation=this.getValue(e,"rotation",0),i.position=this.getValue(e,"position",0),i.positionMode==o.Fixed&&(i.position*=s),i.spacing=this.getValue(e,"spacing",0),i.spacingMode!=Jd.Length&&i.spacingMode!=Jd.Fixed||(i.spacing*=s),i.rotateMix=this.getValue(e,"rotateMix",1),i.translateMix=this.getValue(e,"translateMix",1),r.pathConstraints.push(i)}if(n.skins)for(const t in n.skins){const e=n.skins[t],s=new lf(t);for(const t in e){const n=r.findSlotIndex(t);if(-1==n)throw new Error(`Slot not found: ${t}`);const i=e[t];for(const t in i){const e=this.readAttachment(i[t],s,n,t,r);null!=e&&s.addAttachment(n,t,e)}}r.skins.push(s),"default"==s.name&&(r.defaultSkin=s)}for(let t=0,a=this.linkedMeshes.length;t<a;t++){const e=this.linkedMeshes[t],s=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==s)throw new Error(`Skin not found: ${e.skin}`);const n=s.getAttachment(e.slotIndex,e.parent);if(null==n)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.setParentMesh(n)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new qd(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),r.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,s,r,n){const i=this.scale;r=this.getValue(t,"name",r);switch(this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",r),n=this.attachmentLoader.newRegionAttachment(e,r,s);if(null==n)return null;n.path=s,n.x=this.getValue(t,"x",0)*i,n.y=this.getValue(t,"y",0)*i,n.scaleX=this.getValue(t,"scaleX",1),n.scaleY=this.getValue(t,"scaleY",1),n.rotation=this.getValue(t,"rotation",0),n.width=t.width*i,n.height=t.height*i;const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{const n=this.getValue(t,"path",r),i=this.attachmentLoader.newMeshAttachment(e,r,n);if(null==i)return null;i.path=n;const a=this.getValue(t,"color",null);null!=a&&i.color.setFromString(a);const o=this.getValue(t,"parent",null);if(null!=o)return i.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new uf(i,this.getValue(t,"skin",null),s,o)),i;const h=t.uvs;return this.readVertices(t,i,h.length),i.triangles=t.triangles,i.regionUVs=new Float32Array(h),i.hullLength=2*this.getValue(t,"hull",0),i}case"path":{const s=this.attachmentLoader.newPathAttachment(e,r);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const n=t.vertexCount;this.readVertices(t,s,n<<1);const a=Sh.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*i;s.lengths=a;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,r);if(null==s)return null;s.x=this.getValue(t,"x",0)*i,s.y=this.getValue(t,"y",0)*i,s.rotation=this.getValue(t,"rotation",0);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,r);if(null==s)return null;const i=this.getValue(t,"end",null);if(null!=i){const t=n.findSlot(i);if(null==t)throw new Error(`Clipping end slot not found: ${i}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){const r=this.scale;e.worldVerticesLength=s;const n=t.vertices;if(s==n.length){const t=Sh.toFloatArray(n);if(1!=r)for(let e=0,s=n.length;e<s;e++)t[e]*=r;return void(e.vertices=t)}const i=new Array,a=new Array;for(let o=0,h=n.length;o<h;){const t=n[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(n[o]),i.push(n[o+1]*r),i.push(n[o+2]*r),i.push(n[o+3])}e.bones=a,e.vertices=Sh.toFloatArray(i)}readAnimation(t,e,s){const r=this.scale,n=new Array;let i=0;if(t.slots)for(const o in t.slots){const e=t.slots[o],r=s.findSlotIndex(o);if(-1==r)throw new Error(`Slot not found: ${o}`);for(const t in e){const s=e[t];if("attachment"==t){const t=new Ed(s.length);t.slotIndex=r;let e=0;for(let r=0;r<s.length;r++){const n=s[r];t.setFrame(e++,n.time,n.name)}n.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new bd(s.length);t.slotIndex=r;let e=0;for(let r=0;r<s.length;r++){const n=s[r],i=new bh;i.setFromString(n.color||"ffffffff"),t.setFrame(e,n.time,i.r,i.g,i.b,i.a),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*bd.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${o})`);{const t=new vd(s.length);t.slotIndex=r;let e=0;for(let r=0;r<s.length;r++){const n=s[r],i=new bh,a=new bh;i.setFromString(n.light),a.setFromString(n.dark),t.setFrame(e,n.time,i.r,i.g,i.b,i.a,a.r,a.g,a.b),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*vd.ENTRIES])}}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],a=s.findBoneIndex(o);if(-1==a)throw new Error(`Bone not found: ${o}`);for(const t in e){const s=e[t];if("rotate"===t){const t=new fd(s.length);t.boneIndex=a;let e=0;for(let r=0;r<s.length;r++){const n=s[r];t.setFrame(e,n.time,n.angle),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*fd.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${o})`);{let e=null,o=1;"scale"===t?e=new gd(s.length):"shear"===t?e=new xd(s.length):(e=new md(s.length),o=r),e.boneIndex=a;let h=0;for(let t=0;t<s.length;t++){const r=s[t],n=this.getValue(r,"x",0),i=this.getValue(r,"y",0);e.setFrame(h,r.time,n*o,i*o),this.readCurve(r,e,h),h++}n.push(e),i=Math.max(i,e.frames[(e.getFrameCount()-1)*md.ENTRIES])}}}}if(t.ik)for(const o in t.ik){const e=t.ik[o],r=s.findIkConstraint(o),a=new Rd(e.length);a.ikConstraintIndex=s.ikConstraints.indexOf(r);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,s.time,this.getValue(s,"mix",1),this.getValue(s,"bendPositive",!0)?1:-1,this.getValue(s,"compress",!1),this.getValue(s,"stretch",!1)),this.readCurve(s,a,h),h++}n.push(a),i=Math.max(i,a.frames[(a.getFrameCount()-1)*Rd.ENTRIES])}if(t.transform)for(const o in t.transform){const e=t.transform[o],r=s.findTransformConstraint(o),a=new Cd(e.length);a.transformConstraintIndex=s.transformConstraints.indexOf(r);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,s.time,this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1),this.getValue(s,"scaleMix",1),this.getValue(s,"shearMix",1)),this.readCurve(s,a,h),h++}n.push(a),i=Math.max(i,a.frames[(a.getFrameCount()-1)*Cd.ENTRIES])}if(t.paths)for(const h in t.paths){const e=t.paths[h],a=s.findPathConstraintIndex(h);if(-1==a)throw new Error(`Path constraint not found: ${h}`);const l=s.pathConstraints[a];for(const t in e){const s=e[t];if("position"===t||"spacing"===t){let e=null,h=1;"spacing"===t?(e=new Fd(s.length),l.spacingMode!=Jd.Length&&l.spacingMode!=Jd.Fixed||(h=r)):(e=new kd(s.length),l.positionMode==o.Fixed&&(h=r)),e.pathConstraintIndex=a;let c=0;for(let r=0;r<s.length;r++){const n=s[r];e.setFrame(c,n.time,this.getValue(n,t,0)*h),this.readCurve(n,e,c),c++}n.push(e),i=Math.max(i,e.frames[(e.getFrameCount()-1)*kd.ENTRIES])}else if("mix"===t){const t=new Nd(s.length);t.pathConstraintIndex=a;let e=0;for(let r=0;r<s.length;r++){const n=s[r];t.setFrame(e,n.time,this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1)),this.readCurve(n,t,e),e++}n.push(t),i=Math.max(i,t.frames[(t.getFrameCount()-1)*Nd.ENTRIES])}}}if(t.deform)for(const o in t.deform){const e=t.deform[o],a=s.findSkin(o);if(null!=a)for(const t in e){const o=e[t],h=s.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${o.name}`);for(const t in o){const e=o[t],s=a.getAttachment(h,t);if(null==s)throw new Error(`Deform attachment not found: ${e.name}`);const l=null!=s.bones,c=s.vertices,u=l?c.length/3*2:c.length,d=new Ad(e.length);d.slotIndex=h,d.attachment=s;let f=0;for(let t=0;t<e.length;t++){const s=e[t];let n;const i=this.getValue(s,"vertices",null);if(null==i)n=l?Sh.newFloatArray(u):c;else{n=Sh.newFloatArray(u);const t=this.getValue(s,"offset",0);if(Sh.arrayCopy(i,0,n,t,i.length),1!=r)for(let e=t,s=e+i.length;e<s;e++)n[e]*=r;if(!l)for(let e=0;e<u;e++)n[e]+=c[e]}d.setFrame(f,s.time,n),this.readCurve(s,d,f),f++}n.push(d),i=Math.max(i,d.frames[d.getFrameCount()-1])}}}let a=t.drawOrder;if(null==a&&(a=t.draworder),null!=a){const t=new Sd(a.length),e=s.slots.length;let r=0;for(let n=0;n<a.length;n++){const i=a[n];let o=null;const h=this.getValue(i,"offsets",null);if(null!=h){o=Sh.newArray(e,-1);const t=Sh.newArray(e-h.length,0);let r=0,n=0;for(let e=0;e<h.length;e++){const i=h[e],a=s.findSlotIndex(i.slot);if(-1==a)throw new Error(`Slot not found: ${i.slot}`);for(;r!=a;)t[n++]=r++;o[r+i.offset]=r++}for(;r<e;)t[n++]=r++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}t.setFrame(r++,i.time,o)}n.push(t),i=Math.max(i,t.frames[t.getFrameCount()-1])}if(t.events){const e=new Td(t.events.length);let r=0;for(let n=0;n<t.events.length;n++){const i=t.events[n],a=s.findEvent(i.name);if(null==a)throw new Error(`Event not found: ${i.name}`);const o=new zd(Sh.toSinglePrecision(i.time),a);o.intValue=this.getValue(i,"int",a.intValue),o.floatValue=this.getValue(i,"float",a.floatValue),o.stringValue=this.getValue(i,"string",a.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(i,"volume",1),o.balance=this.getValue(i,"balance",0)),e.setFrame(r++,o)}n.push(e),i=Math.max(i,e.frames[e.getFrameCount()-1])}if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new hd(e,n,i))}readCurve(t,e,s){if(t.curve)if("stepped"===t.curve)e.setStepped(s);else if("[object Array]"===Object.prototype.toString.call(t.curve)){const r=t.curve;e.setCurve(s,r[0],r[1],r[2],r[3])}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return f.NORMAL;if("additive"==t)return f.ADD;if("multiply"==t)return f.MULTIPLY;if("screen"==t)return f.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return o.Fixed;if("percent"==t)return o.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return Jd.Length;if("fixed"==t)return Jd.Fixed;if("percent"==t)return Jd.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return h.Tangent;if("chain"==t)return h.Chain;if("chainscale"==t)return h.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return l.Normal;if("onlytranslation"==t)return l.OnlyTranslation;if("norotationorreflection"==t)return l.NoRotationOrReflection;if("noscale"==t)return l.NoScale;if("noscaleorreflection"==t)return l.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},uf=class{constructor(t,e,s,r){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=r}};const df=Object.freeze(Object.defineProperty({__proto__:null,Animation:hd,AnimationState:Od,AnimationStateAdapter2:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:Wd,AtlasAttachmentLoader:Hd,Attachment:qu,AttachmentTimeline:Ed,Bone:$d,BoneData:jd,BoundingBoxAttachment:Qu,ClippingAttachment:Ju,ColorTimeline:bd,CurveTimeline:ud,DeformTimeline:Ad,DrawOrderTimeline:Sd,Event:zd,EventData:qd,EventQueue:Xd,EventTimeline:Td,EventType:Yd,IkConstraint:Zd,IkConstraintData:Kd,IkConstraintTimeline:Rd,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,s,r){t.x+=vh.randomTriangular(-this.jitterX,this.jitterY),t.y+=vh.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:td,PathAttachment:ed,PathConstraint:ef,PathConstraintData:Qd,PathConstraintMixTimeline:Nd,PathConstraintPositionTimeline:kd,PathConstraintSpacingTimeline:Fd,PointAttachment:sd,RegionAttachment:id,RotateTimeline:fd,ScaleTimeline:gd,ShearTimeline:xd,Skeleton:nf,SkeletonBounds:class extends Mh{},SkeletonData:af,SkeletonJson:cf,Skin:lf,Slot:rd,SlotData:of,SpacingMode:Jd,Spine:class extends Sl{createSkeleton(t){this.skeleton=new nf(t),this.skeleton.updateWorldTransform(),this.stateData=new Wd(t),this.state=new Od(this.stateData)}},SwirlEffect:od,TimelineType:ld,TrackEntry:Vd,TransformConstraint:sf,TransformConstraintData:hf,TransformConstraintTimeline:Cd,TranslateTimeline:md,TwoColorTimeline:vd,VertexAttachment:Ku},Symbol.toStringTag,{value:"Module"}));class ff{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}const pf=class extends ff{constructor(t){super(t),this.id=pf.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,r,n,i){s=n+(s>>1)*i;const a=t.bone.skeleton,o=t.deform;let h=this.vertices;const l=this.bones;if(!l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,f=a.b,p=a.d;for(let t=e,o=n;o<s;t+=2,o+=i){const e=h[t],s=h[t+1];r[o]=e*u+s*d+l,r[o+1]=e*f+s*p+c}return}let c=0,u=0;for(let f=0;f<e;f+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let f=n,p=3*u;f<s;f+=i){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,p+=3){const s=d[l[c]].matrix,r=h[p],n=h[p+1],i=h[p+2];t+=(r*s.a+n*s.c+s.tx)*i,e+=(r*s.b+n*s.d+s.ty)*i}r[f]=t,r[f+1]=e}else{const t=o;for(let e=n,a=3*u,o=u<<1;e<s;e+=i){let s=0,n=0,i=l[c++];for(i+=c;c<i;c++,a+=3,o+=2){const e=d[l[c]].matrix,r=h[a]+t[o],i=h[a+1]+t[o+1],u=h[a+2];s+=(r*e.a+i*e.c+e.tx)*u,n+=(r*e.b+i*e.d+e.ty)*u}r[e]=s,r[e+1]=n}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),Sh.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=Sh.newFloatArray(this.vertices.length),Sh.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}};let mf=pf;mf.nextID=0;class gf extends mf{constructor(t){super(t),this.type=r.BoundingBox,this.color=new bh(1,1,1,1)}copy(){const t=new gf(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class xf extends mf{constructor(t){super(t),this.type=r.Clipping,this.endSlot=null,this.color=new bh(.2275,.2275,.8078,1)}copy(){const t=new xf(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class yf extends mf{constructor(t,e){super(t),this.type=r.Mesh,this.region=null,this.triangles=[],this.color=new bh(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new bh(0,0,0,0),this.path=e}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();const t=new yf(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),Sh.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),Sh.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),Sh.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,s,r,n,i){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,s,r,n,i)}newLinkedMesh(){const t=new yf(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t}}class bf extends mf{constructor(t){super(t),this.type=r.Path,this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new bh(1,1,1,1)}copy(){const t=new bf(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),Sh.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class _f extends mf{constructor(t){super(t),this.type=r.Point,this.x=0,this.y=0,this.rotation=0,this.color=new bh(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=vh.cosDeg(this.rotation),r=vh.sinDeg(this.rotation),n=s*e.a+r*e.c,i=s*e.b+r*e.d;return Math.atan2(i,n)*vh.radDeg}copy(){const t=new _f(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const vf=class extends ff{constructor(t,e){super(t),this.type=r.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new bh(1,1,1,1),this.rendererObject=null,this.region=null,this.sequence=null,this.offset=Sh.newFloatArray(8),this.uvs=Sh.newFloatArray(8),this.tempColor=new bh(1,1,1,1),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");const t=this.region,e=this.width/this.region.originalWidth*this.scaleX,s=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*e,n=-this.height/2*this.scaleY+this.region.offsetY*s,i=r+this.region.width*e,a=n+this.region.height*s,o=this.rotation*Math.PI/180,h=Math.cos(o),l=Math.sin(o),c=this.x,u=this.y,d=r*h+c,f=r*l,p=n*h+u,m=n*l,g=i*h+c,x=i*l,y=a*h+u,b=a*l,_=this.offset;_[0]=d-m,_[1]=p+f,_[2]=d-b,_[3]=y+f,_[4]=g-b,_[5]=y+x,_[6]=g-m,_[7]=p+x;const v=this.uvs;90==t.degrees?(v[2]=t.u,v[3]=t.v2,v[4]=t.u,v[5]=t.v,v[6]=t.u2,v[7]=t.v,v[0]=t.u2,v[1]=t.v2):(v[0]=t.u,v[1]=t.v2,v[2]=t.u,v[3]=t.v,v[4]=t.u2,v[5]=t.v,v[6]=t.u2,v[7]=t.v2)}computeWorldVertices(t,e,s,r){null!=this.sequence&&this.sequence.apply(t,this);const n=t.bone,i=this.offset,a=n.matrix,o=a.tx,h=a.ty,l=a.a,c=a.c,u=a.b,d=a.d;let f=0,p=0;f=i[0],p=i[1],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h,s+=r,f=i[2],p=i[3],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h,s+=r,f=i[4],p=i[5],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h,s+=r,f=i[6],p=i[7],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h}copy(){const t=new vf(this.name,this.path);return t.region=this.region,t.rendererObject=this.rendererObject,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Sh.arrayCopy(this.uvs,0,t.uvs,0,8),Sh.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}};let Ef=vf;Ef.X1=0,Ef.Y1=1,Ef.C1R=2,Ef.C1G=3,Ef.C1B=4,Ef.C1A=5,Ef.U1=6,Ef.V1=7,Ef.X2=8,Ef.Y2=9,Ef.C2R=10,Ef.C2G=11,Ef.C2B=12,Ef.C2A=13,Ef.U2=14,Ef.V2=15,Ef.X3=16,Ef.Y3=17,Ef.C3R=18,Ef.C3G=19,Ef.C3B=20,Ef.C3A=21,Ef.U3=22,Ef.V3=23,Ef.X4=24,Ef.Y4=25,Ef.C4R=26,Ef.C4G=27,Ef.C4B=28,Ef.C4A=29,Ef.U4=30,Ef.V4=31;const wf=class{constructor(t){this.id=wf.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(t)}copy(){const t=new wf(this.regions.length);return Sh.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let s=t.sequenceIndex;-1==s&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);const r=this.regions[s];e.region!=r&&(e.region=r)}getPath(t,e){let s=t;const r=(this.start+e).toString();for(let n=this.digits-r.length;n>0;n--)s+="0";return s+=r,s}static nextID(){return wf._nextID++}};let Af=wf;Af._nextID=0;var Tf=(t=>(t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse",t))(Tf||{});const Sf=[0,1,2,3,4,5,6];class If{constructor(t,e,s){if(this.timelines=[],this.timelineIds=new xh,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=s}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(let e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,s,r,n,i,a,o){if(!t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,n,i,a,o)}}const Rf=0,Mf=1,Cf=2,Pf=3,kf=4,Ff=5,Df=6,Nf=7,Bf=8,Of=9,Lf=10,Vf=11,Uf=12,Xf=13,Yf=14,Gf=15,Wf=16,Hf=17,$f=18,jf=19;class zf{constructor(t,e){this.propertyIds=e,this.frames=Sh.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){const s=t.length;for(let r=1;r<s;r++)if(t[r]>e)return r-1;return s-1}static search(t,e,s){const r=t.length;for(let n=s;n<r;n+=s)if(t[n]>e)return n-s;return r-s}}class qf extends zf{constructor(t,e,s){super(t,s),this.curves=Sh.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){const e=this.getFrameCount()+18*t;if(this.curves.length>e){const t=Sh.newFloatArray(e);Sh.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,s,r,n,i,a,o,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==s&&(u[e]=2+d);const f=.03*(r-2*i+o),p=.03*(n-2*a+h),m=.006*(3*(i-o)-r+l),g=.006*(3*(a-h)-n+c);let x=2*f+m,y=2*p+g,b=.3*(i-r)+f+.16666667*m,_=.3*(a-n)+p+.16666667*g,v=r+b,E=n+_;for(let w=d+18;d<w;d+=2)u[d]=v,u[d+1]=E,b+=x,_+=y,x+=m,y+=g,v+=b,E+=_}getBezierValue(t,e,s,r){const n=this.curves;if(n[r]>t){const i=this.frames[e],a=this.frames[e+s];return a+(t-i)/(n[r]-i)*(n[r+1]-a)}const i=r+18;for(r+=2;r<i;r+=2)if(n[r]>=t){const e=n[r-2],s=n[r-1];return s+(t-e)/(n[r]-e)*(n[r+1]-s)}e+=this.getFrameEntries();const a=n[i-2],o=n[i-1];return o+(t-a)/(this.frames[e]-a)*(this.frames[e+s]-o)}}class Zf extends qf{constructor(t,e,s){super(t,e,[s])}getFrameEntries(){return 2}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+1]=s}getCurveValue(t){const e=this.frames;let s=e.length-2;for(let n=2;n<=s;n+=2)if(e[n]>t){s=n-2;break}const r=this.curves[s>>1];switch(r){case 0:const r=e[s],n=e[s+1];return n+(t-r)/(e[s+2]-r)*(e[s+2+1]-n);case 1:return e[s+1]}return this.getBezierValue(t,s,1,r-2)}}class Kf extends qf{constructor(t,e,s,r){super(t,e,[s,r])}getFrameEntries(){return 3}setFrame(t,e,s,r){t*=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=r}}class Qf extends Zf{constructor(t,e,s){super(t,e,`${Rf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.rotation=h.data.rotation);case i.first:h.rotation+=(h.data.rotation-h.rotation)*n}return}let l=this.getCurveValue(s);switch(a){case i.setup:h.rotation=h.data.rotation+l*n;break;case i.first:case i.replace:l+=h.data.rotation-h.rotation;case i.add:h.rotation+=l*n}}}class Jf extends Kf{constructor(t,e,s){super(t,e,`${Mf}|${s}`,`${Cf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;const l=this.frames;if(s<l[0]){switch(a){case i.setup:return h.x=h.data.x,void(h.y=h.data.y);case i.first:h.x+=(h.data.x-h.x)*n,h.y+=(h.data.y-h.y)*n}return}let c=0,u=0;const d=zf.search(l,s,3),f=this.curves[d/3];switch(f){case 0:const t=l[d];c=l[d+1],u=l[d+2];const e=(s-t)/(l[d+3]-t);c+=(l[d+3+1]-c)*e,u+=(l[d+3+2]-u)*e;break;case 1:c=l[d+1],u=l[d+2];break;default:c=this.getBezierValue(s,d,1,f-2),u=this.getBezierValue(s,d,2,f+18-2)}switch(a){case i.setup:h.x=h.data.x+c*n,h.y=h.data.y+u*n;break;case i.first:case i.replace:h.x+=(h.data.x+c-h.x)*n,h.y+=(h.data.y+u-h.y)*n;break;case i.add:h.x+=c*n,h.y+=u*n}}}class tp extends Zf{constructor(t,e,s){super(t,e,`${Mf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.x=h.data.x);case i.first:h.x+=(h.data.x-h.x)*n}return}const l=this.getCurveValue(s);switch(a){case i.setup:h.x=h.data.x+l*n;break;case i.first:case i.replace:h.x+=(h.data.x+l-h.x)*n;break;case i.add:h.x+=l*n}}}class ep extends Zf{constructor(t,e,s){super(t,e,`${Cf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.y=h.data.y);case i.first:h.y+=(h.data.y-h.y)*n}return}const l=this.getCurveValue(s);switch(a){case i.setup:h.y=h.data.y+l*n;break;case i.first:case i.replace:h.y+=(h.data.y+l-h.y)*n;break;case i.add:h.y+=l*n}}}class sp extends Kf{constructor(t,e,s){super(t,e,`${Pf}|${s}`,`${kf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,o,h){const l=t.bones[this.boneIndex];if(!l.active)return;const c=this.frames;if(s<c[0]){switch(o){case i.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case i.first:l.scaleX+=(l.data.scaleX-l.scaleX)*n,l.scaleY+=(l.data.scaleY-l.scaleY)*n}return}let u,d;const f=zf.search(c,s,3),p=this.curves[f/3];switch(p){case 0:const t=c[f];u=c[f+1],d=c[f+2];const e=(s-t)/(c[f+3]-t);u+=(c[f+3+1]-u)*e,d+=(c[f+3+2]-d)*e;break;case 1:u=c[f+1],d=c[f+2];break;default:u=this.getBezierValue(s,f,1,p-2),d=this.getBezierValue(s,f,2,p+18-2)}if(u*=l.data.scaleX,d*=l.data.scaleY,1==n)o==i.add?(l.scaleX+=u-l.data.scaleX,l.scaleY+=d-l.data.scaleY):(l.scaleX=u,l.scaleY=d);else{let t=0,e=0;if(h==a.mixOut)switch(o){case i.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(u)*vh.signum(t)-t)*n,l.scaleY=e+(Math.abs(d)*vh.signum(e)-e)*n;break;case i.first:case i.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(u)*vh.signum(t)-t)*n,l.scaleY=e+(Math.abs(d)*vh.signum(e)-e)*n;break;case i.add:l.scaleX+=(u-l.data.scaleX)*n,l.scaleY+=(d-l.data.scaleY)*n}else switch(o){case i.setup:t=Math.abs(l.data.scaleX)*vh.signum(u),e=Math.abs(l.data.scaleY)*vh.signum(d),l.scaleX=t+(u-t)*n,l.scaleY=e+(d-e)*n;break;case i.first:case i.replace:t=Math.abs(l.scaleX)*vh.signum(u),e=Math.abs(l.scaleY)*vh.signum(d),l.scaleX=t+(u-t)*n,l.scaleY=e+(d-e)*n;break;case i.add:l.scaleX+=(u-l.data.scaleX)*n,l.scaleY+=(d-l.data.scaleY)*n}}}}class rp extends Zf{constructor(t,e,s){super(t,e,`${Pf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,o,h){const l=t.bones[this.boneIndex];if(!l.active)return;if(s<this.frames[0]){switch(o){case i.setup:return void(l.scaleX=l.data.scaleX);case i.first:l.scaleX+=(l.data.scaleX-l.scaleX)*n}return}const c=this.getCurveValue(s)*l.data.scaleX;if(1==n)o==i.add?l.scaleX+=c-l.data.scaleX:l.scaleX=c;else{let t=0;if(h==a.mixOut)switch(o){case i.setup:t=l.data.scaleX,l.scaleX=t+(Math.abs(c)*vh.signum(t)-t)*n;break;case i.first:case i.replace:t=l.scaleX,l.scaleX=t+(Math.abs(c)*vh.signum(t)-t)*n;break;case i.add:l.scaleX+=(c-l.data.scaleX)*n}else switch(o){case i.setup:t=Math.abs(l.data.scaleX)*vh.signum(c),l.scaleX=t+(c-t)*n;break;case i.first:case i.replace:t=Math.abs(l.scaleX)*vh.signum(c),l.scaleX=t+(c-t)*n;break;case i.add:l.scaleX+=(c-l.data.scaleX)*n}}}}class np extends Zf{constructor(t,e,s){super(t,e,`${kf}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,o,h){const l=t.bones[this.boneIndex];if(!l.active)return;if(s<this.frames[0]){switch(o){case i.setup:return void(l.scaleY=l.data.scaleY);case i.first:l.scaleY+=(l.data.scaleY-l.scaleY)*n}return}const c=this.getCurveValue(s)*l.data.scaleY;if(1==n)o==i.add?l.scaleY+=c-l.data.scaleY:l.scaleY=c;else{let t=0;if(h==a.mixOut)switch(o){case i.setup:t=l.data.scaleY,l.scaleY=t+(Math.abs(c)*vh.signum(t)-t)*n;break;case i.first:case i.replace:t=l.scaleY,l.scaleY=t+(Math.abs(c)*vh.signum(t)-t)*n;break;case i.add:l.scaleY+=(c-l.data.scaleY)*n}else switch(o){case i.setup:t=Math.abs(l.data.scaleY)*vh.signum(c),l.scaleY=t+(c-t)*n;break;case i.first:case i.replace:t=Math.abs(l.scaleY)*vh.signum(c),l.scaleY=t+(c-t)*n;break;case i.add:l.scaleY+=(c-l.data.scaleY)*n}}}}class ip extends Kf{constructor(t,e,s){super(t,e,`${Ff}|${s}`,`${Df}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;const l=this.frames;if(s<l[0]){switch(a){case i.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case i.first:h.shearX+=(h.data.shearX-h.shearX)*n,h.shearY+=(h.data.shearY-h.shearY)*n}return}let c=0,u=0;const d=zf.search(l,s,3),f=this.curves[d/3];switch(f){case 0:const t=l[d];c=l[d+1],u=l[d+2];const e=(s-t)/(l[d+3]-t);c+=(l[d+3+1]-c)*e,u+=(l[d+3+2]-u)*e;break;case 1:c=l[d+1],u=l[d+2];break;default:c=this.getBezierValue(s,d,1,f-2),u=this.getBezierValue(s,d,2,f+18-2)}switch(a){case i.setup:h.shearX=h.data.shearX+c*n,h.shearY=h.data.shearY+u*n;break;case i.first:case i.replace:h.shearX+=(h.data.shearX+c-h.shearX)*n,h.shearY+=(h.data.shearY+u-h.shearY)*n;break;case i.add:h.shearX+=c*n,h.shearY+=u*n}}}class ap extends Zf{constructor(t,e,s){super(t,e,`${Ff}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.shearX=h.data.shearX);case i.first:h.shearX+=(h.data.shearX-h.shearX)*n}return}const l=this.getCurveValue(s);switch(a){case i.setup:h.shearX=h.data.shearX+l*n;break;case i.first:case i.replace:h.shearX+=(h.data.shearX+l-h.shearX)*n;break;case i.add:h.shearX+=l*n}}}class op extends Zf{constructor(t,e,s){super(t,e,`${Df}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,r,n,a,o){const h=t.bones[this.boneIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.shearY=h.data.shearY);case i.first:h.shearY+=(h.data.shearY-h.shearY)*n}return}const l=this.getCurveValue(s);switch(a){case i.setup:h.shearY=h.data.shearY+l*n;break;case i.first:case i.replace:h.shearY+=(h.data.shearY+l-h.shearY)*n;break;case i.add:h.shearY+=l*n}}}class hp extends qf{constructor(t,e,s){super(t,e,[`${Nf}|${s}`,`${Bf}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 5}setFrame(t,e,s,r,n,i){t*=5,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=i}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=this.frames,c=h.color;if(s<l[0]){const t=h.data.color;switch(a){case i.setup:return void c.setFromColor(t);case i.first:c.add((t.r-c.r)*n,(t.g-c.g)*n,(t.b-c.b)*n,(t.a-c.a)*n)}return}let u=0,d=0,f=0,p=0;const m=zf.search(l,s,5),g=this.curves[m/5];switch(g){case 0:const t=l[m];u=l[m+1],d=l[m+2],f=l[m+3],p=l[m+4];const e=(s-t)/(l[m+5]-t);u+=(l[m+5+1]-u)*e,d+=(l[m+5+2]-d)*e,f+=(l[m+5+3]-f)*e,p+=(l[m+5+4]-p)*e;break;case 1:u=l[m+1],d=l[m+2],f=l[m+3],p=l[m+4];break;default:u=this.getBezierValue(s,m,1,g-2),d=this.getBezierValue(s,m,2,g+18-2),f=this.getBezierValue(s,m,3,g+36-2),p=this.getBezierValue(s,m,4,g+54-2)}1==n?c.set(u,d,f,p):(a==i.setup&&c.setFromColor(h.data.color),c.add((u-c.r)*n,(d-c.g)*n,(f-c.b)*n,(p-c.a)*n))}}class lp extends qf{constructor(t,e,s){super(t,e,[`${Nf}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,r,n){t<<=2,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=r,this.frames[t+3]=n}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=this.frames,c=h.color;if(s<l[0]){const t=h.data.color;switch(a){case i.setup:return c.r=t.r,c.g=t.g,void(c.b=t.b);case i.first:c.r+=(t.r-c.r)*n,c.g+=(t.g-c.g)*n,c.b+=(t.b-c.b)*n}return}let u=0,d=0,f=0;const p=zf.search(l,s,4),m=this.curves[p>>2];switch(m){case 0:const t=l[p];u=l[p+1],d=l[p+2],f=l[p+3];const e=(s-t)/(l[p+4]-t);u+=(l[p+4+1]-u)*e,d+=(l[p+4+2]-d)*e,f+=(l[p+4+3]-f)*e;break;case 1:u=l[p+1],d=l[p+2],f=l[p+3];break;default:u=this.getBezierValue(s,p,1,m-2),d=this.getBezierValue(s,p,2,m+18-2),f=this.getBezierValue(s,p,3,m+36-2)}if(1==n)c.r=u,c.g=d,c.b=f;else{if(a==i.setup){const t=h.data.color;c.r=t.r,c.g=t.g,c.b=t.b}c.r+=(u-c.r)*n,c.g+=(d-c.g)*n,c.b+=(f-c.b)*n}}}class cp extends Zf{constructor(t,e,s){super(t,e,`${Bf}|${s}`),this.slotIndex=0,this.slotIndex=s}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=h.color;if(s<this.frames[0]){const t=h.data.color;switch(a){case i.setup:return void(l.a=t.a);case i.first:l.a+=(t.a-l.a)*n}return}const c=this.getCurveValue(s);1==n?l.a=c:(a==i.setup&&(l.a=h.data.color.a),l.a+=(c-l.a)*n)}}class up extends qf{constructor(t,e,s){super(t,e,[`${Nf}|${s}`,`${Bf}|${s}`,`${Of}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 8}setFrame(t,e,s,r,n,i,a,o,h){t<<=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=i,this.frames[t+5]=a,this.frames[t+6]=o,this.frames[t+7]=h}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=this.frames,c=h.color,u=h.darkColor;if(s<l[0]){const t=h.data.color,e=h.data.darkColor;switch(a){case i.setup:return c.setFromColor(t),u.r=e.r,u.g=e.g,void(u.b=e.b);case i.first:c.add((t.r-c.r)*n,(t.g-c.g)*n,(t.b-c.b)*n,(t.a-c.a)*n),u.r+=(e.r-u.r)*n,u.g+=(e.g-u.g)*n,u.b+=(e.b-u.b)*n}return}let d=0,f=0,p=0,m=0,g=0,x=0,y=0;const b=zf.search(l,s,8),_=this.curves[b>>3];switch(_){case 0:const t=l[b];d=l[b+1],f=l[b+2],p=l[b+3],m=l[b+4],g=l[b+5],x=l[b+6],y=l[b+7];const e=(s-t)/(l[b+8]-t);d+=(l[b+8+1]-d)*e,f+=(l[b+8+2]-f)*e,p+=(l[b+8+3]-p)*e,m+=(l[b+8+4]-m)*e,g+=(l[b+8+5]-g)*e,x+=(l[b+8+6]-x)*e,y+=(l[b+8+7]-y)*e;break;case 1:d=l[b+1],f=l[b+2],p=l[b+3],m=l[b+4],g=l[b+5],x=l[b+6],y=l[b+7];break;default:d=this.getBezierValue(s,b,1,_-2),f=this.getBezierValue(s,b,2,_+18-2),p=this.getBezierValue(s,b,3,_+36-2),m=this.getBezierValue(s,b,4,_+54-2),g=this.getBezierValue(s,b,5,_+72-2),x=this.getBezierValue(s,b,6,_+90-2),y=this.getBezierValue(s,b,7,_+108-2)}if(1==n)c.set(d,f,p,m),u.r=g,u.g=x,u.b=y;else{if(a==i.setup){c.setFromColor(h.data.color);const t=h.data.darkColor;u.r=t.r,u.g=t.g,u.b=t.b}c.add((d-c.r)*n,(f-c.g)*n,(p-c.b)*n,(m-c.a)*n),u.r+=(g-u.r)*n,u.g+=(x-u.g)*n,u.b+=(y-u.b)*n}}}class dp extends qf{constructor(t,e,s){super(t,e,[`${Nf}|${s}`,`${Of}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,r,n,i,a,o){t*=7,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=i,this.frames[t+5]=a,this.frames[t+6]=o}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=this.frames,c=h.color,u=h.darkColor;if(s<l[0]){const t=h.data.color,e=h.data.darkColor;switch(a){case i.setup:return c.r=t.r,c.g=t.g,c.b=t.b,u.r=e.r,u.g=e.g,void(u.b=e.b);case i.first:c.r+=(t.r-c.r)*n,c.g+=(t.g-c.g)*n,c.b+=(t.b-c.b)*n,u.r+=(e.r-u.r)*n,u.g+=(e.g-u.g)*n,u.b+=(e.b-u.b)*n}return}let d=0,f=0,p=0,m=0,g=0,x=0;const y=zf.search(l,s,7),b=this.curves[y/7];switch(b){case 0:const t=l[y];d=l[y+1],f=l[y+2],p=l[y+3],m=l[y+4],g=l[y+5],x=l[y+6];const e=(s-t)/(l[y+7]-t);d+=(l[y+7+1]-d)*e,f+=(l[y+7+2]-f)*e,p+=(l[y+7+3]-p)*e,m+=(l[y+7+4]-m)*e,g+=(l[y+7+5]-g)*e,x+=(l[y+7+6]-x)*e;break;case 1:d=l[y+1],f=l[y+2],p=l[y+3],m=l[y+4],g=l[y+5],x=l[y+6];break;default:d=this.getBezierValue(s,y,1,b-2),f=this.getBezierValue(s,y,2,b+18-2),p=this.getBezierValue(s,y,3,b+36-2),m=this.getBezierValue(s,y,4,b+54-2),g=this.getBezierValue(s,y,5,b+72-2),x=this.getBezierValue(s,y,6,b+90-2)}if(1==n)c.r=d,c.g=f,c.b=p,u.r=m,u.g=g,u.b=x;else{if(a==i.setup){const t=h.data.color,e=h.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b,u.r=e.r,u.g=e.g,u.b=e.b}c.r+=(d-c.r)*n,c.g+=(f-c.g)*n,c.b+=(p-c.b)*n,u.r+=(m-u.r)*n,u.g+=(g-u.g)*n,u.b+=(x-u.b)*n}}}class fp extends zf{constructor(t,e){super(t,[`${Lf}|${e}`]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,r,n,o,h){const l=t.slots[this.slotIndex];l.bone.active&&(h!=a.mixOut?s<this.frames[0]?o!=i.setup&&o!=i.first||this.setAttachment(t,l,l.data.attachmentName):this.setAttachment(t,l,this.attachmentNames[zf.search1(this.frames,s)]):o==i.setup&&this.setAttachment(t,l,l.data.attachmentName))}setAttachment(t,e,s){e.setAttachment(s?t.getAttachment(this.slotIndex,s):null)}}class pp extends qf{constructor(t,e,s,r){super(t,e,[`${Vf}|${s}|${r.id}`]),this.slotIndex=0,this.slotIndex=s,this.attachment=r,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.vertices[t]=s}setBezier(t,e,s,r,n,i,a,o,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==s&&(u[e]=2+d);const f=.03*(r-2*i+o),p=.03*h-.06*a,m=.006*(3*(i-o)-r+l),g=.018*(a-h+.33333333);let x=2*f+m,y=2*p+g,b=.3*(i-r)+f+.16666667*m,_=.3*a+p+.16666667*g,v=r+b,E=_;for(let w=d+18;d<w;d+=2)u[d]=v,u[d+1]=E,b+=x,_+=y,x+=m,y+=g,v+=b,E+=_}getCurvePercent(t,e){const s=this.curves;let r=s[e];switch(r){case 0:const s=this.frames[e];return(t-s)/(this.frames[e+this.getFrameEntries()]-s);case 1:return 0}if(r-=2,s[r]>t){const n=this.frames[e];return s[r+1]*(t-n)/(s[r]-n)}const n=r+18;for(r+=2;r<n;r+=2)if(s[r]>=t){const e=s[r-2],n=s[r-1];return n+(t-e)/(s[r]-e)*(s[r+1]-n)}const i=s[n-2],a=s[n-1];return a+(1-a)*(t-i)/(this.frames[e+this.getFrameEntries()]-i)}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=h.getAttachment();if(!l)return;if(!(l instanceof mf)||l.timelineAttachment!=this.attachment)return;const c=h.deform;0==c.length&&(a=i.setup);const u=this.vertices,d=u[0].length,f=this.frames;if(s<f[0]){switch(a){case i.setup:return void(c.length=0);case i.first:if(1==n)return void(c.length=0);c.length=d;const t=l;if(t.bones){n=1-n;for(let t=0;t<d;t++)c[t]*=n}else{const e=t.vertices;for(let t=0;t<d;t++)c[t]+=(e[t]-c[t])*n}}return}if(c.length=d,s>=f[f.length-1]){const t=u[f.length-1];if(1==n)if(a==i.add){const e=l;if(e.bones)for(let s=0;s<d;s++)c[s]+=t[s];else{const s=e.vertices;for(let e=0;e<d;e++)c[e]+=t[e]-s[e]}}else Sh.arrayCopy(t,0,c,0,d);else switch(a){case i.setup:{const e=l;if(e.bones)for(let s=0;s<d;s++)c[s]=t[s]*n;else{const s=e.vertices;for(let e=0;e<d;e++){const r=s[e];c[e]=r+(t[e]-r)*n}}break}case i.first:case i.replace:for(let s=0;s<d;s++)c[s]+=(t[s]-c[s])*n;break;case i.add:const e=l;if(e.bones)for(let s=0;s<d;s++)c[s]+=t[s]*n;else{const s=e.vertices;for(let e=0;e<d;e++)c[e]+=(t[e]-s[e])*n}}return}const p=zf.search1(f,s),m=this.getCurvePercent(s,p),g=u[p],x=u[p+1];if(1==n)if(a==i.add){const t=l;if(t.bones)for(let e=0;e<d;e++){const t=g[e];c[e]+=t+(x[e]-t)*m}else{const e=t.vertices;for(let t=0;t<d;t++){const s=g[t];c[t]+=s+(x[t]-s)*m-e[t]}}}else for(let i=0;i<d;i++){const t=g[i];c[i]=t+(x[i]-t)*m}else switch(a){case i.setup:{const t=l;if(t.bones)for(let e=0;e<d;e++){const t=g[e];c[e]=(t+(x[e]-t)*m)*n}else{const e=t.vertices;for(let t=0;t<d;t++){const s=g[t],r=e[t];c[t]=r+(s+(x[t]-s)*m-r)*n}}break}case i.first:case i.replace:for(let e=0;e<d;e++){const t=g[e];c[e]+=(t+(x[e]-t)*m-c[e])*n}break;case i.add:const t=l;if(t.bones)for(let e=0;e<d;e++){const t=g[e];c[e]+=(t+(x[e]-t)*m)*n}else{const e=t.vertices;for(let t=0;t<d;t++){const s=g[t];c[t]+=(s+(x[t]-s)*m-e[t])*n}}}}}const mp=class extends zf{constructor(t){super(t,mp.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,r,n,i,a){if(!r)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,r,n,i,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=zf.search1(o,e)+1;const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)r.push(this.events[l])}};let gp=mp;gp.propertyIds=[`${Uf}`];const xp=class extends zf{constructor(t){super(t,xp.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,r,n,o,h){if(h==a.mixOut)return void(o==i.setup&&Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(s<this.frames[0])return void(o!=i.setup&&o!=i.first||Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));const l=zf.search1(this.frames,s),c=this.drawOrders[l];if(c){const e=t.drawOrder,s=t.slots;for(let t=0,r=c.length;t<r;t++)e[t]=s[c[t]]}else Sh.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}};let yp=xp;yp.propertyIds=[`${Xf}`];class bp extends qf{constructor(t,e,s){super(t,e,[`${Yf}|${s}`]),this.ikConstraintIndex=0,this.ikConstraintIndex=s}getFrameEntries(){return 6}setFrame(t,e,s,r,n,i,a){t*=6,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=r,this.frames[t+3]=n,this.frames[t+4]=i?1:0,this.frames[t+5]=a?1:0}apply(t,e,s,r,n,o,h){const l=t.ikConstraints[this.ikConstraintIndex];if(!l.active)return;const c=this.frames;if(s<c[0]){switch(o){case i.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case i.first:l.mix+=(l.data.mix-l.mix)*n,l.softness+=(l.data.softness-l.softness)*n,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}return}let u=0,d=0;const f=zf.search(c,s,6),p=this.curves[f/6];switch(p){case 0:const t=c[f];u=c[f+1],d=c[f+2];const e=(s-t)/(c[f+6]-t);u+=(c[f+6+1]-u)*e,d+=(c[f+6+2]-d)*e;break;case 1:u=c[f+1],d=c[f+2];break;default:u=this.getBezierValue(s,f,1,p-2),d=this.getBezierValue(s,f,2,p+18-2)}o==i.setup?(l.mix=l.data.mix+(u-l.data.mix)*n,l.softness=l.data.softness+(d-l.data.softness)*n,h==a.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=c[f+3],l.compress=0!=c[f+4],l.stretch=0!=c[f+5])):(l.mix+=(u-l.mix)*n,l.softness+=(d-l.softness)*n,h==a.mixIn&&(l.bendDirection=c[f+3],l.compress=0!=c[f+4],l.stretch=0!=c[f+5]))}}class _p extends qf{constructor(t,e,s){super(t,e,[`${Gf}|${s}`]),this.transformConstraintIndex=0,this.transformConstraintIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,r,n,i,a,o){const h=this.frames;h[t*=7]=e,h[t+1]=s,h[t+2]=r,h[t+3]=n,h[t+4]=i,h[t+5]=a,h[t+6]=o}apply(t,e,s,r,n,a,o){const h=t.transformConstraints[this.transformConstraintIndex];if(!h.active)return;const l=this.frames;if(s<l[0]){const t=h.data;switch(a){case i.setup:return h.mixRotate=t.mixRotate,h.mixX=t.mixX,h.mixY=t.mixY,h.mixScaleX=t.mixScaleX,h.mixScaleY=t.mixScaleY,void(h.mixShearY=t.mixShearY);case i.first:h.mixRotate+=(t.mixRotate-h.mixRotate)*n,h.mixX+=(t.mixX-h.mixX)*n,h.mixY+=(t.mixY-h.mixY)*n,h.mixScaleX+=(t.mixScaleX-h.mixScaleX)*n,h.mixScaleY+=(t.mixScaleY-h.mixScaleY)*n,h.mixShearY+=(t.mixShearY-h.mixShearY)*n}return}let c,u,d,f,p,m;const g=zf.search(l,s,7),x=this.curves[g/7];switch(x){case 0:const t=l[g];c=l[g+1],u=l[g+2],d=l[g+3],f=l[g+4],p=l[g+5],m=l[g+6];const e=(s-t)/(l[g+7]-t);c+=(l[g+7+1]-c)*e,u+=(l[g+7+2]-u)*e,d+=(l[g+7+3]-d)*e,f+=(l[g+7+4]-f)*e,p+=(l[g+7+5]-p)*e,m+=(l[g+7+6]-m)*e;break;case 1:c=l[g+1],u=l[g+2],d=l[g+3],f=l[g+4],p=l[g+5],m=l[g+6];break;default:c=this.getBezierValue(s,g,1,x-2),u=this.getBezierValue(s,g,2,x+18-2),d=this.getBezierValue(s,g,3,x+36-2),f=this.getBezierValue(s,g,4,x+54-2),p=this.getBezierValue(s,g,5,x+72-2),m=this.getBezierValue(s,g,6,x+90-2)}if(a==i.setup){const t=h.data;h.mixRotate=t.mixRotate+(c-t.mixRotate)*n,h.mixX=t.mixX+(u-t.mixX)*n,h.mixY=t.mixY+(d-t.mixY)*n,h.mixScaleX=t.mixScaleX+(f-t.mixScaleX)*n,h.mixScaleY=t.mixScaleY+(p-t.mixScaleY)*n,h.mixShearY=t.mixShearY+(m-t.mixShearY)*n}else h.mixRotate+=(c-h.mixRotate)*n,h.mixX+=(u-h.mixX)*n,h.mixY+=(d-h.mixY)*n,h.mixScaleX+=(f-h.mixScaleX)*n,h.mixScaleY+=(p-h.mixScaleY)*n,h.mixShearY+=(m-h.mixShearY)*n}}class vp extends Zf{constructor(t,e,s){super(t,e,`${Wf}|${s}`),this.pathConstraintIndex=0,this.pathConstraintIndex=s}apply(t,e,s,r,n,a,o){const h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.position=h.data.position);case i.first:h.position+=(h.data.position-h.position)*n}return}const l=this.getCurveValue(s);a==i.setup?h.position=h.data.position+(l-h.data.position)*n:h.position+=(l-h.position)*n}}class Ep extends Zf{constructor(t,e,s){super(t,e,`${Hf}|${s}`),this.pathConstraintIndex=0,this.pathConstraintIndex=s}apply(t,e,s,r,n,a,o){const h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(s<this.frames[0]){switch(a){case i.setup:return void(h.spacing=h.data.spacing);case i.first:h.spacing+=(h.data.spacing-h.spacing)*n}return}const l=this.getCurveValue(s);a==i.setup?h.spacing=h.data.spacing+(l-h.data.spacing)*n:h.spacing+=(l-h.spacing)*n}}class wp extends qf{constructor(t,e,s){super(t,e,[`${$f}|${s}`]),this.pathConstraintIndex=0,this.pathConstraintIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,r,n){const i=this.frames;i[t<<=2]=e,i[t+1]=s,i[t+2]=r,i[t+3]=n}apply(t,e,s,r,n,a,o){const h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;const l=this.frames;if(s<l[0]){switch(a){case i.setup:return h.mixRotate=h.data.mixRotate,h.mixX=h.data.mixX,void(h.mixY=h.data.mixY);case i.first:h.mixRotate+=(h.data.mixRotate-h.mixRotate)*n,h.mixX+=(h.data.mixX-h.mixX)*n,h.mixY+=(h.data.mixY-h.mixY)*n}return}let c,u,d;const f=zf.search(l,s,4),p=this.curves[f>>2];switch(p){case 0:const t=l[f];c=l[f+1],u=l[f+2],d=l[f+3];const e=(s-t)/(l[f+4]-t);c+=(l[f+4+1]-c)*e,u+=(l[f+4+2]-u)*e,d+=(l[f+4+3]-d)*e;break;case 1:c=l[f+1],u=l[f+2],d=l[f+3];break;default:c=this.getBezierValue(s,f,1,p-2),u=this.getBezierValue(s,f,2,p+18-2),d=this.getBezierValue(s,f,3,p+36-2)}if(a==i.setup){const t=h.data;h.mixRotate=t.mixRotate+(c-t.mixRotate)*n,h.mixX=t.mixX+(u-t.mixX)*n,h.mixY=t.mixY+(d-t.mixY)*n}else h.mixRotate+=(c-h.mixRotate)*n,h.mixX+=(u-h.mixX)*n,h.mixY+=(d-h.mixY)*n}}const Ap=class extends zf{constructor(t,e,s){super(t,[`${jf}|${e}|${s.sequence.id}`]),this.slotIndex=e,this.attachment=s}getFrameEntries(){return Ap.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,s,r,n){const i=this.frames;i[t*=Ap.ENTRIES]=e,i[t+Ap.MODE]=s|r<<4,i[t+Ap.DELAY]=n}apply(t,e,s,r,n,a,o){const h=t.slots[this.slotIndex];if(!h.bone.active)return;const l=h.attachment,c=this.attachment;if(!(l==c||l instanceof mf&&l.timelineAttachment==c))return;const u=this.frames;if(s<u[0])return void(a!=i.setup&&a!=i.first||(h.sequenceIndex=-1));const d=zf.search(u,s,Ap.ENTRIES),f=u[d],p=u[d+Ap.MODE],m=u[d+Ap.DELAY];if(!this.attachment.sequence)return;let g=p>>4;const x=this.attachment.sequence.regions.length,y=Sf[15&p];if(y!=Tf.hold)switch(g+=(s-f)/m+1e-5|0,y){case Tf.once:g=Math.min(x-1,g);break;case Tf.loop:g%=x;break;case Tf.pingpong:{const t=(x<<1)-2;g=0==t?0:g%t,g>=x&&(g=t-g);break}case Tf.onceReverse:g=Math.max(x-1-g,0);break;case Tf.loopReverse:g=x-1-g%x;break;case Tf.pingpongReverse:{const t=(x<<1)-2;g=0==t?0:(g+x-1)%t,g>=x&&(g=t-g)}}h.sequenceIndex=g}};let Tp=Ap;Tp.ENTRIES=3,Tp.MODE=1,Tp.DELAY=2;const Sp=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Cp(this),this.propertyIDs=new xh,this.animationsChanged=!1,this.trackEntryPool=new Ih((()=>new Mp)),this.data=t}static emptyAnimation(){return Sp._emptyAnimation}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(!r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let n=t*r.timeScale;if(r.delay>0){if(r.delay-=n,r.delay>0)continue;n=-r.delay,r.delay=0}let i=r.next;if(i){const e=r.trackLast-i.delay;if(e>=0){for(i.delay=0,i.trackTime+=0==r.timeScale?0:(e/r.timeScale+t)*i.timeScale,r.trackTime+=n,this.setCurrent(s,i,!0);i.mixingFrom;)i.mixTime+=t,i=i.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&!r.mixingFrom){e[s]=null,this.queue.end(r),this.clearNext(r);continue}if(r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(!s)return!0;const r=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),r):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let r=!1;for(let h=0,l=s.length;h<l;h++){const n=s[h];if(!n||n.delay>0)continue;r=!0;const o=0==h?i.first:n.mixBlend;let l=n.alpha;n.mixingFrom?l*=this.applyMixingFrom(n,t,o):n.trackTime>=n.trackEnd&&!n.next&&(l=0);const c=n.animationLast,u=n.getAnimationTime();let d=u,f=e;n.reverse&&(d=n.animation.duration-d,f=null);const p=n.animation.timelines,m=p.length;if(0==h&&1==l||o==i.add)for(let e=0;e<m;e++){const s=p[e];s instanceof fp?this.applyAttachmentTimeline(s,t,d,o,!0):s.apply(t,c,d,f,l,o,a.mixIn)}else{const e=n.timelineMode,s=n.shortestRotation,r=!s&&n.timelinesRotation.length!=m<<1;r&&(n.timelinesRotation.length=m<<1);for(let h=0;h<m;h++){const u=p[h],m=e[h]==kp?o:i.setup;!s&&u instanceof Qf?this.applyRotateTimeline(u,t,d,l,m,n.timelinesRotation,h<<1,r):u instanceof fp?this.applyAttachmentTimeline(u,t,d,o,!0):u.apply(t,c,d,f,l,m,a.mixIn)}}this.queueEvents(n,u),e.length=0,n.nextAnimationLast=u,n.nextTrackLast=n.trackTime}const n=this.unkeyedState+Op,o=t.slots;for(let i=0,a=t.slots.length;i<a;i++){const e=o[i];if(e.attachmentState==n){const s=e.data.attachmentName;e.setAttachment(s?t.getAttachment(e.data.index,s):null)}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,s){const r=t.mixingFrom;r.mixingFrom&&this.applyMixingFrom(r,e,s);let n=0;0==t.mixDuration?(n=1,s==i.first&&(s=i.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=i.first&&(s=r.mixBlend));const o=n<r.attachmentThreshold,h=n<r.drawOrderThreshold,l=r.animation.timelines,c=l.length,u=r.alpha*t.interruptAlpha,d=u*(1-n),f=r.animationLast,p=r.getAnimationTime();let m=p,g=null;if(r.reverse?m=r.animation.duration-m:n<r.eventThreshold&&(g=this.events),s==i.add)for(let i=0;i<c;i++)l[i].apply(e,f,m,g,d,s,a.mixOut);else{const t=r.timelineMode,n=r.timelineHoldMix,p=r.shortestRotation,x=!p&&r.timelinesRotation.length!=c<<1;x&&(r.timelinesRotation.length=c<<1),r.totalAlpha=0;for(let y=0;y<c;y++){const c=l[y];let b,_=a.mixOut,v=0;switch(t[y]){case kp:if(!h&&c instanceof yp)continue;b=s,v=d;break;case Fp:b=i.setup,v=d;break;case Dp:b=s,v=u;break;case Np:b=i.setup,v=u;break;default:b=i.setup;const t=n[y];v=u*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=v,!p&&c instanceof Qf?this.applyRotateTimeline(c,e,m,v,b,r.timelinesRotation,y<<1,x):c instanceof fp?this.applyAttachmentTimeline(c,e,m,b,o):(h&&c instanceof yp&&b==i.setup&&(_=a.mixIn),c.apply(e,f,m,g,v,b,_))}}return t.mixDuration>0&&this.queueEvents(r,p),this.events.length=0,r.nextAnimationLast=p,r.nextTrackLast=r.trackTime,n}applyAttachmentTimeline(t,e,s,r,n){const a=e.slots[t.slotIndex];a.bone.active&&(s<t.frames[0]?r!=i.setup&&r!=i.first||this.setAttachment(e,a,a.data.attachmentName,n):this.setAttachment(e,a,t.attachmentNames[zf.search1(t.frames,s)],n),a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+Op))}setAttachment(t,e,s,r){e.setAttachment(s?t.getAttachment(e.data.index,s):null),r&&(e.attachmentState=this.unkeyedState+Lp)}applyRotateTimeline(t,e,s,r,n,o,h,l){if(l&&(o[h]=0),1==r)return void t.apply(e,0,s,null,1,n,a.mixIn);const c=e.bones[t.boneIndex];if(!c.active)return;let u=0,d=0;if(s<t.frames[0])switch(n){case i.setup:c.rotation=c.data.rotation;default:return;case i.first:u=c.rotation,d=c.data.rotation}else u=n==i.setup?c.data.rotation:c.rotation,d=c.data.rotation+t.getCurveValue(s);let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=o[h];else{let t=0,e=0;l?(t=0,e=p):(t=o[h],e=o[h+1]);const s=p>0;let r=t>=0;vh.signum(e)!=vh.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*vh.signum(t)),r=s),f=p+t-t%360,r!=s&&(f+=360*vh.signum(t)),o[h]=f}o[h+1]=p,c.rotation=u+f*r}queueEvents(t,e){const s=t.animationStart,r=t.animationEnd,n=r-s,i=t.trackLast%n,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<i)break;e.time>r||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==n||i>t.trackTime%n:e>=r&&t.animationLast<r,l&&this.queue.complete(t);o<h;o++){const e=a[o];e.time<s||this.queue.event(t,e)}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let s=e;for(;;){const t=s.mixingFrom;if(!t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const r=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,r&&(s&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s=!1){const r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,r,s)}setAnimationWith(t,e,s=!1){if(!e)throw new Error("animation cannot be null.");let r=!0,n=this.expandToIndex(t);n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.clearNext(n),n=n.mixingFrom,r=!1):this.clearNext(n));const i=this.trackEntry(t,e,s,n);return this.setCurrent(t,i,r),this.queue.drain(),i}addAnimation(t,e,s=!1,r=0){const n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,n,s,r)}addAnimationWith(t,e,s=!1,r=0){if(!e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(n)for(;n.next;)n=n.next;const i=this.trackEntry(t,e,s,n);return n?(n.next=i,i.previous=n,r<=0&&(r+=n.getTrackComplete()-i.mixDuration)):(this.setCurrent(t,i,!0),this.queue.drain()),i.delay=r,i}setEmptyAnimation(t,e=0){const s=this.setAnimationWith(t,Sp.emptyAnimation(),!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e=0,s=0){const r=this.addAnimationWith(t,Sp.emptyAnimation(),!1,s);return s<=0&&(r.delay+=r.mixDuration-e),r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t=0){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,r=this.tracks.length;s<r;s++){const e=this.tracks[s];e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Sh.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,r){const n=this.trackEntryPool.obtain();return n.reset(),n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.reverse=!1,n.shortestRotation=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.mixTime=0,n.mixDuration=r?this.data.getMix(r.animation,e):0,n.interruptAlpha=1,n.totalAlpha=0,n.mixBlend=i.replace,n}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();const t=this.tracks;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s){for(;s.mixingFrom;)s=s.mixingFrom;do{s.mixingTo&&s.mixBlend==i.add||this.computeHold(s),s=s.mixingTo}while(s)}}}computeHold(t){const e=t.mixingTo,s=t.animation.timelines,r=t.animation.timelines.length,n=t.timelineMode;n.length=r;const i=t.timelineHoldMix;i.length=0;const a=this.propertyIDs;if(e&&e.holdPrevious)for(let o=0;o<r;o++)n[o]=a.addAll(s[o].getPropertyIds())?Np:Dp;else t:for(let o=0;o<r;o++){const r=s[o],h=r.getPropertyIds();if(a.addAll(h))if(!e||r instanceof fp||r instanceof yp||r instanceof gp||!e.animation.hasTimeline(h))n[o]=Fp;else{for(let s=e.mixingTo;s;s=s.mixingTo)if(!s.animation.hasTimeline(h)){if(t.mixDuration>0){n[o]=Bp,i[o]=s;continue t}break}n[o]=Np}else n[o]=kp}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){Sp.deprecatedWarning1||(Sp.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,r){Sp.deprecatedWarning2||(Sp.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,r)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return Sp.deprecatedWarning3||(Sp.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Ip=Sp;Ip._emptyAnimation=new If("<empty>",[],0),Ip.deprecatedWarning1=!1,Ip.deprecatedWarning2=!1,Ip.deprecatedWarning3=!1;const Rp=class{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=i.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){const t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}get time(){return Rp.deprecatedWarning1||(Rp.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Rp.deprecatedWarning1||(Rp.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Rp.deprecatedWarning2||(Rp.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Rp.deprecatedWarning2||(Rp.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Mp=Rp;Mp.deprecatedWarning1=!1,Mp.deprecatedWarning2=!1;class Cp{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Pp.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Pp.interrupt),this.objects.push(t)}end(t){this.objects.push(Pp.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Pp.dispose),this.objects.push(t)}complete(t){this.objects.push(Pp.complete),this.objects.push(t)}event(t,e){this.objects.push(Pp.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const r=t[s],n=t[s+1];switch(r){case Pp.start:n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++){const s=e[t];s.start&&s.start(n)}break;case Pp.interrupt:n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++){const s=e[t];s.interrupt&&s.interrupt(n)}break;case Pp.end:n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++){const s=e[t];s.end&&s.end(n)}case Pp.dispose:n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++){const s=e[t];s.dispose&&s.dispose(n)}this.animState.trackEntryPool.free(n);break;case Pp.complete:n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++){const s=e[t];s.complete&&s.complete(n)}break;case Pp.event:const r=t[2+s++];n.listener&&n.listener.event&&n.listener.event(n,r);for(let t=0;t<e.length;t++){const s=e[t];s.event&&s.event(n,r)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var Pp=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(Pp||{});const kp=0,Fp=1,Dp=2,Np=3,Bp=4,Op=1,Lp=2;class Vp{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const r=this.skeletonData.findAnimation(t);if(!r)throw new Error(`Animation not found: ${t}`);const n=this.skeletonData.findAnimation(e);if(!n)throw new Error(`Animation not found: ${e}`);this.setMixWith(r,n,s)}setMixWith(t,e,s){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");const r=`${t.name}.${e.name}`;this.animationToMixTime[r]=s}getMix(t,e){const s=`${t.name}.${e.name}`,r=this.animationToMixTime[s];return void 0===r?this.defaultMix:r}}class Up{constructor(t){this.atlas=t}loadSequence(t,e,s){const r=s.regions;for(let n=0,i=r.length;n<i;n++){const i=s.getPath(e,n),a=this.atlas.findRegion(i);if(null==a)throw new Error(`Region not found in atlas: ${i} (sequence: ${t})`);r[n]=a,r[n].renderObject=r[n]}}newRegionAttachment(t,e,s,r){const n=new Ef(e,s);if(null!=r)this.loadSequence(e,s,r);else{const t=this.atlas.findRegion(s);if(!t)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);t.renderObject=t,n.region=t}return n}newMeshAttachment(t,e,s,r){const n=new yf(e,s);if(null!=r)this.loadSequence(e,s,r);else{const t=this.atlas.findRegion(s);if(!t)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);t.renderObject=t,n.region=t}return n}newBoundingBoxAttachment(t,e){return new gf(e)}newPathAttachment(t,e){return new bf(e)}newPointAttachment(t,e){return new _f(e)}newClippingAttachment(t,e){return new xf(e)}}class Xp{constructor(t,e,s){if(this.matrix=new Ui,this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,r,n,i,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=r,this.ascaleY=n,this.ashearX=i,this.ashearY=a;const o=this.parent,h=this.matrix,c=this.skeleton.scaleX,u=-this.skeleton.scaleY;if(!o){const o=this.skeleton,l=s+90+a;return h.a=vh.cosDeg(s+i)*r*c,h.c=vh.cosDeg(l)*n*c,h.b=vh.sinDeg(s+i)*r*u,h.d=vh.sinDeg(l)*n*u,h.tx=t*c+o.x,void(h.ty=e*u+o.y)}let d=o.matrix.a,f=o.matrix.c,p=o.matrix.b,m=o.matrix.d;switch(h.tx=d*t+f*e+o.matrix.tx,h.ty=p*t+m*e+o.matrix.ty,this.data.transformMode){case l.Normal:{const t=s+90+a,e=vh.cosDeg(s+i)*r,o=vh.cosDeg(t)*n,l=vh.sinDeg(s+i)*r,c=vh.sinDeg(t)*n;return h.a=d*e+f*l,h.c=d*o+f*c,h.b=p*e+m*l,void(h.d=p*o+m*c)}case l.OnlyTranslation:{const t=s+90+a;h.a=vh.cosDeg(s+i)*r,h.c=vh.cosDeg(t)*n,h.b=vh.sinDeg(s+i)*r,h.d=vh.sinDeg(t)*n;break}case l.NoRotationOrReflection:{let t=d*d+p*p,e=0;t>1e-4?(t=Math.abs(d*m-f*p)/t,d/=c,p/=u,f=p*t,m=d*t,e=Math.atan2(p,d)*vh.radDeg):(d=0,p=0,e=90-Math.atan2(m,f)*vh.radDeg);const o=s+i-e,l=s+a-e+90,g=vh.cosDeg(o)*r,x=vh.cosDeg(l)*n,y=vh.sinDeg(o)*r,b=vh.sinDeg(l)*n;h.a=d*g-f*y,h.c=d*x-f*b,h.b=p*g+m*y,h.d=p*x+m*b;break}case l.NoScale:case l.NoScaleOrReflection:{const t=vh.cosDeg(s),e=vh.sinDeg(s);let o=(d*t+f*e)/c,g=(p*t+m*e)/u,x=Math.sqrt(o*o+g*g);x>1e-5&&(x=1/x),o*=x,g*=x,x=Math.sqrt(o*o+g*g),this.data.transformMode==l.NoScale&&d*m-f*p<0!=(c<0!=u<0)&&(x=-x);const y=Math.PI/2+Math.atan2(g,o),b=Math.cos(y)*x,_=Math.sin(y)*x,v=vh.cosDeg(i)*r,E=vh.cosDeg(90+a)*n,w=vh.sinDeg(i)*r,A=vh.sinDeg(90+a)*n;h.a=o*v+b*w,h.c=o*E+b*A,h.b=g*v+_*w,h.d=g*E+_*A;break}}h.a*=c,h.c*=c,h.b*=u,h.d*=u}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*vh.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*vh.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)}updateAppliedTransform(){const t=this.parent,e=this.matrix;if(!t)return this.ax=e.tx-this.skeleton.x,this.ay=e.ty-this.skeleton.y,this.arotation=Math.atan2(e.b,e.a)*vh.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*vh.radDeg);const s=t.matrix,r=1/(s.a*s.d-s.b*s.c),n=e.tx-s.tx,i=e.ty-s.ty;this.ax=n*s.d*r-i*s.c*r,this.ay=i*s.a*r-n*s.b*r;const a=r*s.d,o=r*s.a,h=r*s.c,l=r*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,f=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*vh.radDeg,this.arotation=Math.atan2(d,c)*vh.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*vh.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,r=e.c,n=e.b,i=e.d,a=1/(s*i-r*n),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*i*a-h*r*a,t.y=h*s*a-o*n*a,t}localToWorld(t){const e=this.matrix,s=t.x,r=t.y;return t.x=s*e.a+r*e.c+e.tx,t.y=s*e.b+r*e.d+e.ty,t}worldToLocalRotation(t){const e=vh.sinDeg(t),s=vh.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*s,r.d*s-r.c*e)*vh.radDeg}localToWorldRotation(t){t-=this.rotation-this.shearX;const e=vh.sinDeg(t),s=vh.cosDeg(t),r=this.matrix;return Math.atan2(s*r.b+e*r.d,s*r.a+e*r.c)*vh.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,r=e.c,n=e.b,i=e.d,a=vh.cosDeg(t),o=vh.sinDeg(t);e.a=a*s-o*n,e.c=a*r-o*i,e.b=o*s+a*n,e.d=o*r+a*i}}class Yp{constructor(t,e,s){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=l.Normal,this.skinRequired=!1,this.color=new bh,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}}class Gp{constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}}let Wp=class{constructor(t,e){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!e)throw new Error("data cannot be null.");this.time=t,this.data=e}};class Hp{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class $p{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let r=0;r<t.bones.length;r++){const s=e.findBone(t.bones[r].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[r].name}`);this.bones.push(s)}const s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=s}isActive(){return this.active}update(){if(0==this.mix)return;const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,s,r,n,i,a){const o=t.parent.matrix;if(!o)throw new Error("IK bone must have parent.");const h=o.a;let c=o.c;const u=o.b;let d=o.d,f=-t.ashearX-t.arotation,p=0,m=0;const g=t.skeleton.scaleX,x=-t.skeleton.scaleY;switch(t.data.transformMode){case l.OnlyTranslation:p=e-t.worldX,m=s-t.worldY,m=-m;break;case l.NoRotationOrReflection:const r=Math.abs(h*d-c*u)/(h*h+u*u),n=h/g,i=u/x;c=-i*r*g,d=n*r*x,f+=Math.atan2(i,n)*vh.radDeg;default:const a=e-o.tx,y=s-o.ty,b=h*d-c*u;p=(a*d-y*c)/b-t.ax,m=(y*h-a*u)/b-t.ay}f+=Math.atan2(m,p)*vh.radDeg,t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let y=t.ascaleX,b=t.ascaleY;if(r||n){switch(t.data.transformMode){case l.NoScale:case l.NoScaleOrReflection:p=e-t.worldX,m=s-t.worldY}const o=t.data.length*y,h=Math.sqrt(p*p+m*m);if(r&&h<o||n&&h>o&&o>1e-4){const t=(h/o-1)*a+1;y*=t,i&&(b*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*a,y,b,t.ashearX,t.ashearY)}apply2(t,e,s,r,n,i,a,o,h){const l=t.ax,c=t.ay;let u=t.ascaleX,d=t.ascaleY,f=u,p=d,m=e.ascaleX;const g=t.matrix;let x=0,y=0,b=0;u<0?(u=-u,x=180,b=-1):(x=0,b=1),d<0&&(d=-d,b=-b),m<0?(m=-m,y=180):y=0;const _=e.ax;let v=0,E=0,w=0,A=g.a,T=g.c,S=g.b,I=g.d;const R=Math.abs(u-d)<=1e-4;!R||i?(v=0,E=A*_+g.tx,w=S*_+g.ty):(v=e.ay,E=A*_+T*v+g.tx,w=S*_+I*v+g.ty);const M=t.parent.matrix;if(!M)throw new Error("IK parent must itself have a parent.");A=M.a,T=M.c,S=M.b,I=M.d;const C=1/(A*I-T*S);let P=E-M.tx,k=w-M.ty;const F=(P*I-k*T)*C-l,D=(k*A-P*S)*C-c,N=Math.sqrt(F*F+D*D);let B,O,L=e.data.length*m;if(N<1e-4)return this.apply1(t,s,r,!1,i,!1,h),void e.updateWorldTransformWith(_,v,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);P=s-M.tx,k=r-M.ty;let V=(P*I-k*T)*C-l,U=(k*A-P*S)*C-c,X=V*V+U*U;if(0!=o){o*=u*(m+1)*.5;const t=Math.sqrt(X),e=t-N-L*u+o;if(e>0){let s=Math.min(1,e/(2*o))-1;s=(e-o*(1-s*s))/t,V-=s*V,U-=s*U,X=V*V+U*U}}t:if(R){L*=u;let t=(X-N*N-L*L)/(2*N*L);t<-1?(t=-1,O=Math.PI*n):t>1?(t=1,O=0,i&&(A=(Math.sqrt(X)/(N+L)-1)*h+1,f*=A,a&&(p*=A))):O=Math.acos(t)*n,A=N+L*t,T=L*Math.sin(O),B=Math.atan2(U*A-V*T,V*A+U*T)}else{A=u*L,T=d*L;const t=A*A,e=T*T,s=Math.atan2(U,V);S=e*N*N+t*X-t*e;const r=-2*e*N,i=e-t;if(I=r*r-4*i*S,I>=0){let t=Math.sqrt(I);r<0&&(t=-t),t=.5*-(r+t);const e=t/i,a=S/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=X){k=Math.sqrt(X-o*o)*n,B=s-Math.atan2(k,o),O=Math.atan2(k/d,(o-N)/u);break t}}let a=vh.PI,o=N-A,h=o*o,l=0,c=0,f=N+A,p=f*f,m=0;S=-A*N/(t-e),S>=-1&&S<=1&&(S=Math.acos(S),P=A*Math.cos(S)+N,k=T*Math.sin(S),I=P*P+k*k,I<h&&(a=S,h=I,o=P,l=k),I>p&&(c=S,p=I,f=P,m=k)),X<=.5*(h+p)?(B=s-Math.atan2(l*n,o),O=a*n):(B=s-Math.atan2(m*n,f),O=c*n)}const Y=Math.atan2(v,_)*b;let G=t.arotation;B=(B-Y)*vh.radDeg+x-G,B>180?B-=360:B<-180&&(B+=360),t.updateWorldTransformWith(l,c,G+B*h,f,p,0,0),G=e.arotation,O=((O+Y)*vh.radDeg-e.ashearX)*b+y-G,O>180?O-=360:O<-180&&(O+=360),e.updateWorldTransformWith(_,v,G+O*h,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class jp extends Gp{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class zp extends Gp{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=o.Fixed,this.spacingMode=qp.Fixed,this.rotateMode=h.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var qp=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional",t))(qp||{});const Zp=class{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let r=0,n=t.bones.length;r<n;r++){const s=e.findBone(t.bones[r].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(s)}const s=e.findSlot(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=s,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){const t=this.target.getAttachment();if(!(t instanceof bf))return;const e=this.mixRotate,s=this.mixX,r=this.mixY;if(0==e&&0==s&&0==r)return;const n=this.data,i=n.rotateMode==h.Tangent,a=n.rotateMode==h.ChainScale,o=this.bones,l=o.length,c=i?l:l+1,u=Sh.setArraySize(this.spaces,c),d=a?this.lengths=Sh.setArraySize(this.lengths,l):[],f=this.spacing;switch(n.spacingMode){case qp.Percent:if(a)for(let s=0,r=c-1;s<r;s++){const t=o[s],e=t.data.length;if(e<Zp.epsilon)d[s]=0;else{const r=e*t.matrix.a,n=e*t.matrix.b;d[s]=Math.sqrt(r*r+n*n)}}Sh.arrayFill(u,1,c,f);break;case qp.Proportional:let t=0;for(let s=0,r=c-1;s<r;){const e=o[s],r=e.data.length;if(r<Zp.epsilon)a&&(d[s]=0),u[++s]=f;else{const n=r*e.matrix.a,i=r*e.matrix.b,o=Math.sqrt(n*n+i*i);a&&(d[s]=o),u[++s]=o,t+=o}}if(t>0){t=c/t*f;for(let e=1;e<c;e++)u[e]*=t}break;default:const e=n.spacingMode==qp.Length;for(let s=0,r=c-1;s<r;){const t=o[s],r=t.data.length;if(r<Zp.epsilon)a&&(d[s]=0),u[++s]=f;else{const n=r*t.matrix.a,i=r*t.matrix.b,o=Math.sqrt(n*n+i*i);a&&(d[s]=o),u[++s]=(e?r+f:f)*o/r}}}const p=this.computeWorldPositions(t,c,i);let m=p[0],g=p[1],x=n.offsetRotation,y=!1;if(0==x)y=n.rotateMode==h.Chain;else{y=!1;const t=this.target.bone.matrix;x*=t.a*t.d-t.b*t.c>0?vh.degRad:-vh.degRad}for(let h=0,b=3;h<l;h++,b+=3){const t=o[h],n=t.matrix;n.tx+=(m-n.tx)*s,n.ty+=(g-n.ty)*r;const l=p[b],c=p[b+1],f=l-m,_=c-g;if(a){const t=d[h];if(0!=t){const s=(Math.sqrt(f*f+_*_)/t-1)*e+1;n.a*=s,n.b*=s}}if(m=l,g=c,e>0){const s=n.a,r=n.c,a=n.b,o=n.d;let l=0,c=0,d=0;if(l=i?p[b-1]:0==u[h+1]?p[b+2]:Math.atan2(_,f),l-=Math.atan2(a,s),y){c=Math.cos(l),d=Math.sin(l);const r=t.data.length;m+=(r*(c*s-d*a)-f)*e,g+=(r*(d*s+c*a)-_)*e}else l+=x;l>vh.PI?l-=vh.PI2:l<-vh.PI&&(l+=vh.PI2),l*=e,c=Math.cos(l),d=Math.sin(l),n.a=c*s-d*a,n.c=c*r-d*o,n.b=d*s+c*a,n.d=d*r+c*o}t.updateAppliedTransform()}}computeWorldPositions(t,e,s){const r=this.target;let n=this.position;const i=this.spaces,a=Sh.setArraySize(this.positions,3*e+2);let h=this.world;const l=t.closed;let c=t.worldVerticesLength,u=c/6,d=Zp.NONE;if(!t.constantSpeed){const f=t.lengths;u-=l?1:2;const p=f[u];let m;switch(this.data.positionMode==o.Percent&&(n*=p),this.data.spacingMode){case qp.Percent:m=p;break;case qp.Proportional:m=p/e;break;default:m=1}h=Sh.setArraySize(this.world,8);for(let o=0,g=0,x=0;o<e;o++,g+=3){const e=i[o]*m;n+=e;let y=n;if(l)y%=p,y<0&&(y+=p),x=0;else{if(y<0){d!=Zp.BEFORE&&(d=Zp.BEFORE,t.computeWorldVertices(r,2,4,h,0,2)),this.addBeforePosition(y,h,0,a,g);continue}if(y>p){d!=Zp.AFTER&&(d=Zp.AFTER,t.computeWorldVertices(r,c-6,4,h,0,2)),this.addAfterPosition(y-p,h,0,a,g);continue}}for(;;x++){const t=f[x];if(!(y>t)){if(0==x)y/=t;else{const e=f[x-1];y=(y-e)/(t-e)}break}}x!=d&&(d=x,l&&x==u?(t.computeWorldVertices(r,c-4,4,h,0,2),t.computeWorldVertices(r,0,4,h,4,2)):t.computeWorldVertices(r,6*x+2,8,h,0,2)),this.addCurvePosition(y,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],a,g,s||o>0&&0==e)}return a}l?(c+=2,h=Sh.setArraySize(this.world,c),t.computeWorldVertices(r,2,c-4,h,0,2),t.computeWorldVertices(r,0,2,h,c-4,2),h[c-2]=h[0],h[c-1]=h[1]):(u--,c-=4,h=Sh.setArraySize(this.world,c),t.computeWorldVertices(r,2,c,h,0,2));const f=Sh.setArraySize(this.curves,u);let p,m=0,g=h[0],x=h[1],y=0,b=0,_=0,v=0,E=0,w=0,A=0,T=0,S=0,I=0,R=0,M=0,C=0,P=0;for(let o=0,D=2;o<u;o++,D+=6)y=h[D],b=h[D+1],_=h[D+2],v=h[D+3],E=h[D+4],w=h[D+5],A=.1875*(g-2*y+_),T=.1875*(x-2*b+v),S=.09375*(3*(y-_)-g+E),I=.09375*(3*(b-v)-x+w),R=2*A+S,M=2*T+I,C=.75*(y-g)+A+.16666667*S,P=.75*(b-x)+T+.16666667*I,m+=Math.sqrt(C*C+P*P),C+=R,P+=M,R+=S,M+=I,m+=Math.sqrt(C*C+P*P),C+=R,P+=M,m+=Math.sqrt(C*C+P*P),C+=R+S,P+=M+I,m+=Math.sqrt(C*C+P*P),f[o]=m,g=E,x=w;switch(this.data.positionMode==o.Percent&&(n*=m),this.data.spacingMode){case qp.Percent:p=m;break;case qp.Proportional:p=m/e;break;default:p=1}const k=this.segments;let F=0;for(let o=0,D=0,N=0,B=0;o<e;o++,D+=3){const t=i[o]*p;n+=t;let e=n;if(l)e%=m,e<0&&(e+=m),N=0;else{if(e<0){this.addBeforePosition(e,h,0,a,D);continue}if(e>m){this.addAfterPosition(e-m,h,c-4,a,D);continue}}for(;;N++){const t=f[N];if(!(e>t)){if(0==N)e/=t;else{const s=f[N-1];e=(e-s)/(t-s)}break}}if(N!=d){d=N;let t=6*N;for(g=h[t],x=h[t+1],y=h[t+2],b=h[t+3],_=h[t+4],v=h[t+5],E=h[t+6],w=h[t+7],A=.03*(g-2*y+_),T=.03*(x-2*b+v),S=.006*(3*(y-_)-g+E),I=.006*(3*(b-v)-x+w),R=2*A+S,M=2*T+I,C=.3*(y-g)+A+.16666667*S,P=.3*(b-x)+T+.16666667*I,F=Math.sqrt(C*C+P*P),k[0]=F,t=1;t<8;t++)C+=R,P+=M,R+=S,M+=I,F+=Math.sqrt(C*C+P*P),k[t]=F;C+=R,P+=M,F+=Math.sqrt(C*C+P*P),k[8]=F,C+=R+S,P+=M+I,F+=Math.sqrt(C*C+P*P),k[9]=F,B=0}for(e*=F;;B++){const t=k[B];if(!(e>t)){if(0==B)e/=t;else{const s=k[B-1];e=B+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,x,y,b,_,v,E,w,a,D,s||o>0&&0==t)}return a}addBeforePosition(t,e,s,r,n){const i=e[s],a=e[s+1],o=e[s+2]-i,h=e[s+3]-a,l=Math.atan2(h,o);r[n]=i+t*Math.cos(l),r[n+1]=a+t*Math.sin(l),r[n+2]=l}addAfterPosition(t,e,s,r,n){const i=e[s+2],a=e[s+3],o=i-e[s],h=a-e[s+1],l=Math.atan2(h,o);r[n]=i+t*Math.cos(l),r[n+1]=a+t*Math.sin(l),r[n+2]=l}addCurvePosition(t,e,s,r,n,i,a,o,h,l,c,u){if(0==t||isNaN(t))return l[c]=e,l[c+1]=s,void(l[c+2]=Math.atan2(n-s,r-e));const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,x=p*t,y=3*x,b=p*y,_=y*t,v=e*g+r*b+i*_+o*f,E=s*g+n*b+a*_+h*f;l[c]=v,l[c+1]=E,u&&(l[c+2]=t<.001?Math.atan2(n-s,r-e):Math.atan2(E-(s*m+n*x*2+a*d),v-(e*m+r*x*2+i*d)))}};let Kp=Zp;Kp.NONE=-1,Kp.BEFORE=-2,Kp.AFTER=-3,Kp.epsilon=1e-5;class Qp{constructor(t,e){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new bh,this.darkColor=t.darkColor?new bh:null,this.setToSetupPose(),this.blendMode=this.data.blendMode}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof mf&&this.attachment instanceof mf&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class Jp{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new Rh,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let r=0;r<t.bones.length;r++){const s=e.findBone(t.bones[r].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(s)}const s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=s}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){const t=this.mixRotate,e=this.mixX,s=this.mixY,r=this.mixScaleX,n=this.mixScaleY,i=this.mixShearY,a=0!=e||0!=s,o=this.target,h=o.matrix,l=h.a,c=h.c,u=h.b,d=h.d,f=l*d-c*u>0?vh.degRad:-vh.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let x=0,y=g.length;x<y;x++){const h=g[x],f=h.matrix;if(0!=t){const e=f.a,s=f.c,r=f.b,n=f.d;let i=Math.atan2(u,l)-Math.atan2(r,e)+p;i>vh.PI?i-=vh.PI2:i<-vh.PI&&(i+=vh.PI2),i*=t;const a=Math.cos(i),o=Math.sin(i);f.a=a*e-o*r,f.c=a*s-o*n,f.b=o*e+a*r,f.d=o*s+a*n}if(a){const t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),f.tx+=(t.x-f.tx)*e,f.ty+=(t.y-f.ty)*s}if(0!=r){let t=Math.sqrt(f.a*f.a+f.b*f.b);0!=t&&(t=(t+(Math.sqrt(l*l+u*u)-t+this.data.offsetScaleX)*r)/t),f.a*=t,f.b*=t}if(0!=n){let t=Math.sqrt(f.c*f.c+f.d*f.d);0!=t&&(t=(t+(Math.sqrt(c*c+d*d)-t+this.data.offsetScaleY)*n)/t),f.c*=t,f.d*=t}if(i>0){const t=f.c,e=f.d,s=Math.atan2(e,t);let r=Math.atan2(d,c)-Math.atan2(u,l)-(s-Math.atan2(f.b,f.a));r>vh.PI?r-=vh.PI2:r<-vh.PI&&(r+=vh.PI2),r=s+(r+m)*i;const n=Math.sqrt(t*t+e*e);f.c=Math.cos(r)*n,f.d=Math.sin(r)*n}h.updateAppliedTransform()}}applyRelativeWorld(){const t=this.mixRotate,e=this.mixX,s=this.mixY,r=this.mixScaleX,n=this.mixScaleY,i=this.mixShearY,a=0!=e||0!=s,o=this.target,h=o.matrix,l=h.a,c=h.c,u=h.b,d=h.d,f=l*d-c*u>0?vh.degRad:-vh.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let x=0,y=g.length;x<y;x++){const h=g[x],f=h.matrix;if(0!=t){const e=f.a,s=f.c,r=f.b,n=f.d;let i=Math.atan2(u,l)+p;i>vh.PI?i-=vh.PI2:i<-vh.PI&&(i+=vh.PI2),i*=t;const a=Math.cos(i),o=Math.sin(i);f.a=a*e-o*r,f.c=a*s-o*n,f.b=o*e+a*r,f.d=o*s+a*n}if(a){const t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),f.tx+=t.x*e,f.ty+=t.y*s}if(0!=r){const t=(Math.sqrt(l*l+u*u)-1+this.data.offsetScaleX)*r+1;f.a*=t,f.b*=t}if(0!=n){const t=(Math.sqrt(c*c+d*d)-1+this.data.offsetScaleY)*n+1;f.c*=t,f.d*=t}if(i>0){let t=Math.atan2(d,c)-Math.atan2(u,l);t>vh.PI?t-=vh.PI2:t<-vh.PI&&(t+=vh.PI2);const e=f.c,s=f.d;t=Math.atan2(s,e)+(t-vh.PI/2+m)*i;const r=Math.sqrt(e*e+s*s);f.c=Math.cos(t)*r,f.d=Math.sin(t)*r}h.updateAppliedTransform()}}applyAbsoluteLocal(){const t=this.mixRotate,e=this.mixX,s=this.mixY,r=this.mixScaleX,n=this.mixScaleY,i=this.mixShearY,a=this.target,o=this.bones;for(let h=0,l=o.length;h<l;h++){const l=o[h];let c=l.arotation;if(0!=t){let e=a.arotation-c+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),c+=e*t}let u=l.ax,d=l.ay;u+=(a.ax-u+this.data.offsetX)*e,d+=(a.ay-d+this.data.offsetY)*s;let f=l.ascaleX,p=l.ascaleY;0!=r&&0!=f&&(f=(f+(a.ascaleX-f+this.data.offsetScaleX)*r)/f),0!=n&&0!=p&&(p=(p+(a.ascaleY-p+this.data.offsetScaleY)*n)/p);let m=l.ashearY;if(0!=i){let t=a.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),m+=t*i}l.updateWorldTransformWith(u,d,c,f,p,l.ashearX,m)}}applyRelativeLocal(){const t=this.mixRotate,e=this.mixX,s=this.mixY,r=this.mixScaleX,n=this.mixScaleY,i=this.mixShearY,a=this.target,o=this.bones;for(let h=0,l=o.length;h<l;h++){const l=o[h],c=l.arotation+(a.arotation+this.data.offsetRotation)*t,u=l.ax+(a.ax+this.data.offsetX)*e,d=l.ay+(a.ay+this.data.offsetY)*s,f=l.ascaleX*((a.ascaleX-1+this.data.offsetScaleX)*r+1),p=l.ascaleY*((a.ascaleY-1+this.data.offsetScaleY)*n+1),m=l.ashearY+(a.ashearY+this.data.offsetShearY)*i;l.updateWorldTransformWith(u,d,c,f,p,l.ashearX,m)}}}const tm=class{constructor(t){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let r;if(s.parent){const t=this.bones[s.parent.index];r=new Xp(s,this,t),t.children.push(r)}else r=new Xp(s,this,null);this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],r=this.bones[s.boneData.index],n=new Qp(s,r);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new $p(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new Jp(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new Kp(s,this))}this.color=new bh(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++){const e=t[h];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(this.skin){const t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(s)}}const e=this.ikConstraints,s=this.transformConstraints,r=this.pathConstraints,n=e.length,i=s.length,a=r.length,o=n+i+a;t:for(let h=0;h<o;h++){for(let t=0;t<n;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<i;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=r[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Sh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const s=t.bones,r=s[0];if(this.sortBone(r),1==s.length)this._updateCache.push(t),this.sortReset(r.children);else{const e=s[s.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(r.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&Sh.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,s=e.data.index,r=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,r),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,r);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,r);const n=e.getAttachment();n instanceof bf&&this.sortPathConstraintAttachmentWith(n,r);const i=t.bones,a=i.length;for(let o=0;o<a;o++)this.sortBone(i[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(i[o].children);for(let o=0;o<a;o++)i[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Sh.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let r=0;r<s;r++){const t=e[r];this.sortBone(t.parent),this.sortBone(t)}else for(let r=0;r<s;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<s;r++)this.sortReset(e[r].children);for(let r=0;r<s;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,s){const r=t.attachments[e];if(r)for(const n in r)this.sortPathConstraintAttachmentWith(r[n],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof bf))return;const s=t.bones;if(s){const t=this.bones;for(let e=0,r=s.length;e<r;){let r=s[e++];for(r+=e;e<r;)this.sortBone(t[s[e++]])}}else this.sortBone(e)}sortBone(t){if(!t)return;if(t.sorted)return;const e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){const t=this.bones;for(let s=0,r=t.length;s<r;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY}const e=this._updateCache;for(let s=0,r=e.length;s<r;s++)e[s].update()}updateWorldTransformWith(t){const e=this.getRootBone(),s=t.matrix.a,r=t.matrix.c,n=t.matrix.b,i=t.matrix.d;e.matrix.tx=s*this.x+r*this.y+t.worldX,e.matrix.ty=n*this.x+i*this.y+t.worldY;const a=e.rotation+90+e.shearY,o=vh.cosDeg(e.rotation+e.shearX)*e.scaleX,h=vh.cosDeg(a)*e.scaleY,l=vh.sinDeg(e.rotation+e.shearX)*e.scaleX,c=vh.sinDeg(a)*e.scaleY,u=this.scaleX,d=-this.scaleY;e.matrix.a=(s*o+r*l)*u,e.matrix.c=(s*h+r*c)*u,e.matrix.b=(n*o+i*l)*d,e.matrix.d=(n*h+i*c)*d;const f=this._updateCache;for(let p=0,m=f.length;p<m;p++){const t=f[p];t!=e&&t.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let n=0,i=t.length;n<i;n++)t[n].setToSetupPose();const e=this.ikConstraints;for(let n=0,i=e.length;n<i;n++){const t=e[n];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const s=this.transformConstraints;for(let n=0,i=s.length;n<i;n++){const t=s[n],e=t.data;t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY,t.mixScaleX=e.mixScaleX,t.mixScaleY=e.mixScaleY,t.mixShearY=e.mixShearY}const r=this.pathConstraints;for(let n=0,i=r.length;n<i;n++){const t=r[n],e=t.data;t.position=e.position,t.spacing=e.spacing,t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY}}setSlotsToSetupPose(){const t=this.slots;Sh.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(!e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s],n=r.data.attachmentName;if(n){const e=t.getAttachment(s,n);e&&r.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){const s=this.data.findSlot(t);if(!s)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(s.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){const s=this.skin.getAttachment(t,e);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");const s=this.slots;for(let r=0,n=s.length;r<n;r++){const n=s[r];if(n.data.name==t){let s=null;if(e&&(s=this.getAttachment(r,e),!s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void n.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.data.name==t)return r}return null}getBoundsRect(){const t=new Rh,e=new Rh;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,s=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");const r=this.drawOrder;let n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=r.length;h<l;h++){const t=r[h];if(!t.bone.active)continue;let e=0,l=null;const c=t.getAttachment();if(c instanceof Ef)e=8,l=Sh.setArraySize(s,e,0),c.computeWorldVertices(t,l,0,2);else if(c instanceof yf){const r=c;e=r.worldVerticesLength,l=Sh.setArraySize(s,e,0),r.computeWorldVertices(t,0,e,l,0,2)}if(l)for(let s=0,r=l.length;s<r;s+=2){const t=l[s],e=l[s+1];n=Math.min(n,t),i=Math.min(i,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(n,i),e.set(a-n,o-i)}get flipX(){return-1==this.scaleX}set flipX(t){tm.deprecatedWarning1||(tm.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){tm.deprecatedWarning1||(tm.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let em=tm;em.deprecatedWarning1=!1;class sm{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(!t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,r=e.length;s<r;s++)if(e[s].name==t)return s;return-1}}class rm{constructor(t,e,s){if(this.index=0,this.color=new bh(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=f.NORMAL,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}}class nm extends Gp{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class im{constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}}class am{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(!s)throw new Error("attachment cannot be null.");const r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=s}addSkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];t.attachment&&(t.attachment instanceof yf?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){const s=this.attachments[t];s&&delete s[e]}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const s=this.attachments[e];if(s)for(const r in s){const n=s[r];n&&t.push(new im(e,r,n))}}return t}getAttachmentsForSlot(t,e){const s=this.attachments[t];if(s)for(const r in s){const n=s[r];n&&e.push(new im(t,r,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let r=0;r<t.slots.length;r++){const n=t.slots[r],i=n.getAttachment();if(i&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(i==t[e]){const t=this.getAttachment(s,e);t&&n.setAttachment(t);break}}}s++}}}class om{constructor(t){this.ver40=!1,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new sm;s.name="";const r=new n(t),i=r.readInt32(),a=r.readInt32();s.hash=0==a&&0==i?null:a.toString(16)+i.toString(16),s.version=r.readString();const h=s.version.substr(0,3);if("4.0"!==h&&"4.1"!==h){const t=`Spine 4.1 loader cant load version ${s.version}. Please configure your pixi-spine bundle`;console.error(t)}this.ver40="4.0"===h,s.x=r.readFloat(),s.y=r.readFloat(),s.width=r.readFloat(),s.height=r.readFloat();const l=r.readBoolean();l&&(s.fps=r.readFloat(),s.imagesPath=r.readString(),s.audioPath=r.readString());let c=0;c=r.readInt(!0);for(let n=0;n<c;n++){const t=r.readString();if(!t)throw new Error("String in string table must not be null.");r.strings.push(t)}c=r.readInt(!0);for(let n=0;n<c;n++){const t=r.readString();if(!t)throw new Error("Bone name must not be null.");const i=0==n?null:s.bones[r.readInt(!0)],a=new Yp(n,t,i);a.rotation=r.readFloat(),a.x=r.readFloat()*e,a.y=r.readFloat()*e,a.scaleX=r.readFloat(),a.scaleY=r.readFloat(),a.shearX=r.readFloat(),a.shearY=r.readFloat(),a.length=r.readFloat()*e,a.transformMode=r.readInt(!0),a.skinRequired=r.readBoolean(),l&&bh.rgba8888ToColor(a.color,r.readInt32()),s.bones.push(a)}c=r.readInt(!0);for(let n=0;n<c;n++){const t=r.readString();if(!t)throw new Error("Slot name must not be null.");const e=s.bones[r.readInt(!0)],i=new rm(n,t,e);bh.rgba8888ToColor(i.color,r.readInt32());const a=r.readInt32();-1!=a&&bh.rgb888ToColor(i.darkColor=new bh,a),i.attachmentName=r.readStringRef(),i.blendMode=r.readInt(!0),s.slots.push(i)}c=r.readInt(!0);for(let n,o=0;o<c;o++){const t=r.readString();if(!t)throw new Error("IK constraint data name must not be null.");const i=new jp(t);i.order=r.readInt(!0),i.skinRequired=r.readBoolean(),n=r.readInt(!0);for(let e=0;e<n;e++)i.bones.push(s.bones[r.readInt(!0)]);i.target=s.bones[r.readInt(!0)],i.mix=r.readFloat(),i.softness=r.readFloat()*e,i.bendDirection=r.readByte(),i.compress=r.readBoolean(),i.stretch=r.readBoolean(),i.uniform=r.readBoolean(),s.ikConstraints.push(i)}c=r.readInt(!0);for(let n,o=0;o<c;o++){const t=r.readString();if(!t)throw new Error("Transform constraint data name must not be null.");const i=new nm(t);i.order=r.readInt(!0),i.skinRequired=r.readBoolean(),n=r.readInt(!0);for(let e=0;e<n;e++)i.bones.push(s.bones[r.readInt(!0)]);i.target=s.bones[r.readInt(!0)],i.local=r.readBoolean(),i.relative=r.readBoolean(),i.offsetRotation=r.readFloat(),i.offsetX=r.readFloat()*e,i.offsetY=r.readFloat()*e,i.offsetScaleX=r.readFloat(),i.offsetScaleY=r.readFloat(),i.offsetShearY=r.readFloat(),i.mixRotate=r.readFloat(),i.mixX=r.readFloat(),i.mixY=r.readFloat(),i.mixScaleX=r.readFloat(),i.mixScaleY=r.readFloat(),i.mixShearY=r.readFloat(),s.transformConstraints.push(i)}c=r.readInt(!0);for(let n,d=0;d<c;d++){const t=r.readString();if(!t)throw new Error("Path constraint data name must not be null.");const i=new zp(t);i.order=r.readInt(!0),i.skinRequired=r.readBoolean(),n=r.readInt(!0);for(let e=0;e<n;e++)i.bones.push(s.bones[r.readInt(!0)]);i.target=s.slots[r.readInt(!0)],i.positionMode=r.readInt(!0),i.spacingMode=r.readInt(!0),i.rotateMode=r.readInt(!0),i.offsetRotation=r.readFloat(),i.position=r.readFloat(),i.positionMode==o.Fixed&&(i.position*=e),i.spacing=r.readFloat(),i.spacingMode!=qp.Length&&i.spacingMode!=qp.Fixed||(i.spacing*=e),i.mixRotate=r.readFloat(),i.mixX=r.readFloat(),i.mixY=r.readFloat(),s.pathConstraints.push(i)}const u=this.readSkin(r,s,!0,l);u&&(s.defaultSkin=u,s.skins.push(u));{let t=s.skins.length;for(Sh.setArraySize(s.skins,c=t+r.readInt(!0));t<c;t++){const e=this.readSkin(r,s,!1,l);if(!e)throw new Error("readSkin() should not have returned null.");s.skins[t]=e}}c=this.linkedMeshes.length;for(let n=0;n<c;n++){const t=this.linkedMeshes[n],e=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!e)throw new Error("Not skin found for linked mesh.");if(!t.parent)throw new Error("Linked mesh parent must not be null");const r=e.getAttachment(t.slotIndex,t.parent);if(!r)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?r:t.mesh,t.mesh.setParentMesh(r)}this.linkedMeshes.length=0,c=r.readInt(!0);for(let n=0;n<c;n++){const t=r.readStringRef();if(!t)throw new Error;const e=new Hp(t);e.intValue=r.readInt(!1),e.floatValue=r.readFloat(),e.stringValue=r.readString(),e.audioPath=r.readString(),e.audioPath&&(e.volume=r.readFloat(),e.balance=r.readFloat()),s.events.push(e)}c=r.readInt(!0);for(let n=0;n<c;n++){const t=r.readString();if(!t)throw new Error("Animatio name must not be null.");s.animations.push(this.readAnimation(r,t,s))}return s}readSkin(t,e,s,r){let n=null,i=0;if(s){if(i=t.readInt(!0),0==i)return null;n=new am("default")}else{const s=t.readStringRef();if(!s)throw new Error("Skin name must not be null.");n=new am(s),n.bones.length=t.readInt(!0);for(let r=0,i=n.bones.length;r<i;r++)n.bones[r]=e.bones[t.readInt(!0)];for(let r=0,i=t.readInt(!0);r<i;r++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let r=0,i=t.readInt(!0);r<i;r++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let r=0,i=t.readInt(!0);r<i;r++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);i=t.readInt(!0)}for(let a=0;a<i;a++){const s=t.readInt(!0);for(let i=0,a=t.readInt(!0);i<a;i++){const i=t.readStringRef();if(!i)throw new Error("Attachment name must not be null");const a=this.readAttachment(t,e,n,s,i,r);a&&n.setAttachment(s,i,a)}}return n}readAttachment(t,e,s,n,i,a){const o=this.scale;let h=t.readStringRef();switch(h||(h=i),t.readByte()){case r.Region:{let e=t.readStringRef();const r=t.readFloat(),n=t.readFloat(),i=t.readFloat(),a=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32(),f=this.readSequence(t);e||(e=h);const p=this.attachmentLoader.newRegionAttachment(s,h,e,f);return p?(p.path=e,p.x=n*o,p.y=i*o,p.scaleX=a,p.scaleY=l,p.rotation=r,p.width=c*o,p.height=u*o,bh.rgba8888ToColor(p.color,d),p.sequence=f,null==f&&p.updateRegion(),p):null}case r.BoundingBox:{const e=t.readInt(!0),r=this.readVertices(t,e),n=a?t.readInt32():0,i=this.attachmentLoader.newBoundingBoxAttachment(s,h);return i?(i.worldVerticesLength=e<<1,i.vertices=r.vertices,i.bones=r.bones,a&&bh.rgba8888ToColor(i.color,n),i):null}case r.Mesh:{let e=t.readStringRef();const r=t.readInt32(),n=t.readInt(!0),i=this.readFloatArray(t,n<<1,1),l=this.readShortArray(t),c=this.readVertices(t,n),u=t.readInt(!0),d=this.readSequence(t);let f=[],p=0,m=0;a&&(f=this.readShortArray(t),p=t.readFloat(),m=t.readFloat()),e||(e=h);const g=this.attachmentLoader.newMeshAttachment(s,h,e,d);return g?(g.path=e,bh.rgba8888ToColor(g.color,r),g.bones=c.bones,g.vertices=c.vertices,g.worldVerticesLength=n<<1,g.triangles=l,g.regionUVs=new Float32Array(i),g.hullLength=u<<1,g.sequence=d,a&&(g.edges=f,g.width=p*o,g.height=m*o),g):null}case r.LinkedMesh:{let e=t.readStringRef();const r=t.readInt32(),i=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean(),u=this.readSequence(t);let d=0,f=0;a&&(d=t.readFloat(),f=t.readFloat()),e||(e=h);const p=this.attachmentLoader.newMeshAttachment(s,h,e,u);return p?(p.path=e,bh.rgba8888ToColor(p.color,r),p.sequence=u,a&&(p.width=d*o,p.height=f*o),this.linkedMeshes.push(new hm(p,i,n,l,c)),p):null}case r.Path:{const e=t.readBoolean(),r=t.readBoolean(),n=t.readInt(!0),i=this.readVertices(t,n),l=Sh.newArray(n/3,0);for(let s=0,a=l.length;s<a;s++)l[s]=t.readFloat()*o;const c=a?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(s,h);return u?(u.closed=e,u.constantSpeed=r,u.worldVerticesLength=n<<1,u.vertices=i.vertices,u.bones=i.bones,u.lengths=l,a&&bh.rgba8888ToColor(u.color,c),u):null}case r.Point:{const e=t.readFloat(),r=t.readFloat(),n=t.readFloat(),i=a?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(s,h);return l?(l.x=r*o,l.y=n*o,l.rotation=e,a&&bh.rgba8888ToColor(l.color,i),l):null}case r.Clipping:{const r=t.readInt(!0),n=t.readInt(!0),i=this.readVertices(t,n),o=a?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(s,h);return l?(l.endSlot=e.slots[r],l.worldVerticesLength=n<<1,l.vertices=i.vertices,l.bones=i.bones,a&&bh.rgba8888ToColor(l.color,o),l):null}}return null}readSequence(t){if(this.ver40||!t.readBoolean())return null;const e=new Af(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readDeformTimelineType(t){return this.ver40?Mm:t.readByte()}readVertices(t,e){const s=this.scale,r=e<<1,n=new lm;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,r,s),n;const i=new Array,a=new Array;for(let o=0;o<e;o++){const e=t.readInt(!0);a.push(e);for(let r=0;r<e;r++)a.push(t.readInt(!0)),i.push(t.readFloat()*s),i.push(t.readFloat()*s),i.push(t.readFloat())}return n.vertices=Sh.toFloatArray(i),n.bones=a,n}readFloatArray(t,e,s){const r=new Array(e);if(1==s)for(let n=0;n<e;n++)r[n]=t.readFloat();else for(let n=0;n<e;n++)r[n]=t.readFloat()*s;return r}readShortArray(t){const e=t.readInt(!0),s=new Array(e);for(let r=0;r<e;r++)s[r]=t.readShort();return s}readAnimation(t,e,s){t.readInt(!0);const r=new Array,n=this.scale;for(let o=0,l=t.readInt(!0);o<l;o++){const e=t.readInt(!0);for(let s=0,n=t.readInt(!0);s<n;s++){const s=t.readByte(),n=t.readInt(!0),i=n-1;switch(s){case wm:{const s=new fp(n,e);for(let e=0;e<n;e++)s.setFrame(e,t.readFloat(),t.readStringRef());r.push(s);break}case Am:{const s=t.readInt(!0),a=new hp(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;for(let e=0,r=0;a.setFrame(e,o,h,l,c,u),e!=i;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;switch(t.readByte()){case Dm:a.setStepped(e);break;case Nm:dm(t,a,r++,e,0,o,s,h,n,1),dm(t,a,r++,e,1,o,s,l,i,1),dm(t,a,r++,e,2,o,s,c,d,1),dm(t,a,r++,e,3,o,s,u,f,1)}o=s,h=n,l=i,c=d,u=f}r.push(a);break}case Tm:{const s=t.readInt(!0),a=new lp(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,r=0;a.setFrame(e,o,h,l,c),e!=i;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;switch(t.readByte()){case Dm:a.setStepped(e);break;case Nm:dm(t,a,r++,e,0,o,s,h,n,1),dm(t,a,r++,e,1,o,s,l,i,1),dm(t,a,r++,e,2,o,s,c,u,1)}o=s,h=n,l=i,c=u}r.push(a);break}case Sm:{const s=t.readInt(!0),a=new up(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;for(let e=0,r=0;a.setFrame(e,o,h,l,c,u,d,f,p),e!=i;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,b=t.readUnsignedByte()/255;switch(t.readByte()){case Dm:a.setStepped(e);break;case Nm:dm(t,a,r++,e,0,o,s,h,n,1),dm(t,a,r++,e,1,o,s,l,i,1),dm(t,a,r++,e,2,o,s,c,m,1),dm(t,a,r++,e,3,o,s,u,g,1),dm(t,a,r++,e,4,o,s,d,x,1),dm(t,a,r++,e,5,o,s,f,y,1),dm(t,a,r++,e,6,o,s,p,b,1)}o=s,h=n,l=i,c=m,u=g,d=x,f=y,p=b}r.push(a);break}case Im:{const s=t.readInt(!0),a=new dp(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,r=0;a.setFrame(e,o,h,l,c,u,d,f),e!=i;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,i=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255;switch(t.readByte()){case Dm:a.setStepped(e);break;case Nm:dm(t,a,r++,e,0,o,s,h,n,1),dm(t,a,r++,e,1,o,s,l,i,1),dm(t,a,r++,e,2,o,s,c,p,1),dm(t,a,r++,e,3,o,s,u,m,1),dm(t,a,r++,e,4,o,s,d,g,1),dm(t,a,r++,e,5,o,s,f,x,1)}o=s,h=n,l=i,c=p,u=m,d=g,f=x}r.push(a);break}case Rm:{const s=new cp(n,t.readInt(!0),e);let a=t.readFloat(),o=t.readUnsignedByte()/255;for(let e=0,r=0;s.setFrame(e,a,o),e!=i;e++){const n=t.readFloat(),i=t.readUnsignedByte()/255;switch(t.readByte()){case Dm:s.setStepped(e);break;case Nm:dm(t,s,r++,e,0,a,n,o,i,1)}a=n,o=i}r.push(s)}}}}for(let o=0,l=t.readInt(!0);o<l;o++){const e=t.readInt(!0);for(let s=0,i=t.readInt(!0);s<i;s++){const s=t.readByte(),i=t.readInt(!0),a=t.readInt(!0);switch(s){case fm:r.push(cm(t,new Qf(i,a,e),1));break;case pm:r.push(um(t,new Jf(i,a,e),n));break;case mm:r.push(cm(t,new tp(i,a,e),n));break;case gm:r.push(cm(t,new ep(i,a,e),n));break;case xm:r.push(um(t,new sp(i,a,e),1));break;case ym:r.push(cm(t,new rp(i,a,e),1));break;case bm:r.push(cm(t,new np(i,a,e),1));break;case _m:r.push(um(t,new ip(i,a,e),1));break;case vm:r.push(cm(t,new ap(i,a,e),1));break;case Em:r.push(cm(t,new op(i,a,e),1))}}}for(let o=0,l=t.readInt(!0);o<l;o++){const e=t.readInt(!0),s=t.readInt(!0),i=s-1,a=new bp(s,t.readInt(!0),e);let o=t.readFloat(),h=t.readFloat(),l=t.readFloat()*n;for(let r=0,c=0;a.setFrame(r,o,h,l,t.readByte(),t.readBoolean(),t.readBoolean()),r!=i;r++){const e=t.readFloat(),s=t.readFloat(),i=t.readFloat()*n;switch(t.readByte()){case Dm:a.setStepped(r);break;case Nm:dm(t,a,c++,r,0,o,e,h,s,1),dm(t,a,c++,r,1,o,e,l,i,n)}o=e,h=s,l=i}r.push(a)}for(let o=0,l=t.readInt(!0);o<l;o++){const e=t.readInt(!0),s=t.readInt(!0),n=s-1,i=new _p(s,t.readInt(!0),e);let a=t.readFloat(),o=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat();for(let r=0,f=0;i.setFrame(r,a,o,h,l,c,u,d),r!=n;r++){const e=t.readFloat(),s=t.readFloat(),n=t.readFloat(),p=t.readFloat(),m=t.readFloat(),g=t.readFloat(),x=t.readFloat();switch(t.readByte()){case Dm:i.setStepped(r);break;case Nm:dm(t,i,f++,r,0,a,e,o,s,1),dm(t,i,f++,r,1,a,e,h,n,1),dm(t,i,f++,r,2,a,e,l,p,1),dm(t,i,f++,r,3,a,e,c,m,1),dm(t,i,f++,r,4,a,e,u,g,1),dm(t,i,f++,r,5,a,e,d,x,1)}a=e,o=s,h=n,l=p,c=m,u=g,d=x}r.push(i)}for(let l=0,c=t.readInt(!0);l<c;l++){const e=t.readInt(!0),i=s.pathConstraints[e];for(let s=0,a=t.readInt(!0);s<a;s++)switch(t.readByte()){case Pm:r.push(cm(t,new vp(t.readInt(!0),t.readInt(!0),e),i.positionMode==o.Fixed?n:1));break;case km:r.push(cm(t,new Ep(t.readInt(!0),t.readInt(!0),e),i.spacingMode==qp.Length||i.spacingMode==qp.Fixed?n:1));break;case Fm:const s=new wp(t.readInt(!0),t.readInt(!0),e);let a=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat();for(let e=0,r=0,n=s.getFrameCount()-1;s.setFrame(e,a,h,l,c),e!=n;e++){const n=t.readFloat(),i=t.readFloat(),o=t.readFloat(),u=t.readFloat();switch(t.readByte()){case Dm:s.setStepped(e);break;case Nm:dm(t,s,r++,e,0,a,n,h,i,1),dm(t,s,r++,e,1,a,n,l,o,1),dm(t,s,r++,e,2,a,n,c,u,1)}a=n,h=i,l=o,c=u}r.push(s)}}for(let o=0,l=t.readInt(!0);o<l;o++){const e=s.skins[t.readInt(!0)];for(let s=0,i=t.readInt(!0);s<i;s++){const s=t.readInt(!0);for(let i=0,a=t.readInt(!0);i<a;i++){const i=t.readStringRef();if(!i)throw new Error("attachmentName must not be null.");const a=e.getAttachment(s,i),o=this.readDeformTimelineType(t),h=t.readInt(!0),l=h-1;switch(o){case Mm:{const e=a,i=e.bones,o=e.vertices,c=i?o.length/3*2:o.length,u=t.readInt(!0),d=new pp(h,u,s,e);let f=t.readFloat();for(let s=0,r=0;;s++){let e,a=t.readInt(!0);if(0==a)e=i?Sh.newFloatArray(c):o;else{e=Sh.newFloatArray(c);const s=t.readInt(!0);if(a+=s,1==n)for(let r=s;r<a;r++)e[r]=t.readFloat();else for(let r=s;r<a;r++)e[r]=t.readFloat()*n;if(!i)for(let t=0,r=e.length;t<r;t++)e[t]+=o[t]}if(d.setFrame(s,f,e),s==l)break;const h=t.readFloat();switch(t.readByte()){case Dm:d.setStepped(s);break;case Nm:dm(t,d,r++,s,0,f,h,0,1,1)}f=h}r.push(d);break}case Cm:{const e=new Tp(h,s,a);for(let s=0;s<h;s++){const r=t.readFloat(),n=t.readInt32();e.setFrame(s,r,Sf[15&n],n>>4,t.readFloat())}r.push(e);break}}}}}const i=t.readInt(!0);if(i>0){const e=new yp(i),n=s.slots.length;for(let s=0;s<i;s++){const r=t.readFloat(),i=t.readInt(!0),a=Sh.newArray(n,0);for(let t=n-1;t>=0;t--)a[t]=-1;const o=Sh.newArray(n-i,0);let h=0,l=0;for(let e=0;e<i;e++){const e=t.readInt(!0);for(;h!=e;)o[l++]=h++;a[h+t.readInt(!0)]=h++}for(;h<n;)o[l++]=h++;for(let t=n-1;t>=0;t--)-1==a[t]&&(a[t]=o[--l]);e.setFrame(s,r,a)}r.push(e)}const a=t.readInt(!0);if(a>0){const e=new gp(a);for(let r=0;r<a;r++){const n=t.readFloat(),i=s.events[t.readInt(!0)],a=new Wp(n,i);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readBoolean()?t.readString():i.stringValue,a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(r,a)}r.push(e)}let h=0;for(let o=0,l=r.length;o<l;o++)h=Math.max(h,r[o].getDuration());return new If(e,r,h)}}om.BlendModeValues=[f.NORMAL,f.ADD,f.MULTIPLY,f.SCREEN];let hm=class{constructor(t,e,s,r,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=r,this.inheritTimeline=n}};class lm{constructor(t=null,e=null){this.bones=t,this.vertices=e}}function cm(t,e,s){let r=t.readFloat(),n=t.readFloat()*s;for(let i=0,a=0,o=e.getFrameCount()-1;e.setFrame(i,r,n),i!=o;i++){const o=t.readFloat(),h=t.readFloat()*s;switch(t.readByte()){case Dm:e.setStepped(i);break;case Nm:dm(t,e,a++,i,0,r,o,n,h,s)}r=o,n=h}return e}function um(t,e,s){let r=t.readFloat(),n=t.readFloat()*s,i=t.readFloat()*s;for(let a=0,o=0,h=e.getFrameCount()-1;e.setFrame(a,r,n,i),a!=h;a++){const h=t.readFloat(),l=t.readFloat()*s,c=t.readFloat()*s;switch(t.readByte()){case Dm:e.setStepped(a);break;case Nm:dm(t,e,o++,a,0,r,h,n,l,s),dm(t,e,o++,a,1,r,h,i,c,s)}r=h,n=l,i=c}return e}function dm(t,e,s,r,n,i,a,o,h,l){e.setBezier(s,r,n,i,o,t.readFloat(),t.readFloat()*l,t.readFloat(),t.readFloat()*l,a,h)}const fm=0,pm=1,mm=2,gm=3,xm=4,ym=5,bm=6,_m=7,vm=8,Em=9,wm=0,Am=1,Tm=2,Sm=3,Im=4,Rm=5,Mm=0,Cm=1,Pm=0,km=1,Fm=2,Dm=1,Nm=2;class Bm{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new sm,r="string"==typeof t?JSON.parse(t):t,n=r.skeleton;if(n){s.hash=n.hash,s.version=n.spine;const t=s.version.substr(0,3);if("4.0"!==t&&"4.1"!==t){const t=`Spine 4.1 loader cant load version ${n.spine}. Please configure your pixi-spine bundle`;console.error(t)}s.x=n.x,s.y=n.y,s.width=n.width,s.height=n.height,s.fps=n.fps,s.imagesPath=n.images}if(r.bones)for(let i=0;i<r.bones.length;i++){const t=r.bones[i];let n=null;const a=Xm(t,"parent",null);if(null!=a&&(n=s.findBone(a),null==n))throw new Error(`Parent bone not found: ${a}`);const o=new Yp(s.bones.length,t.name,n);o.length=Xm(t,"length",0)*e,o.x=Xm(t,"x",0)*e,o.y=Xm(t,"y",0)*e,o.rotation=Xm(t,"rotation",0),o.scaleX=Xm(t,"scaleX",1),o.scaleY=Xm(t,"scaleY",1),o.shearX=Xm(t,"shearX",0),o.shearY=Xm(t,"shearY",0),o.transformMode=Sh.enumValue(l,Xm(t,"transform","Normal")),o.skinRequired=Xm(t,"skin",!1);const h=Xm(t,"color",null);h&&o.color.setFromString(h),s.bones.push(o)}if(r.slots)for(let i=0;i<r.slots.length;i++){const t=r.slots[i],e=s.findBone(t.bone);if(!e)throw new Error(`Couldn't find bone ${t.bone} for slot ${t.name}`);const n=new rm(s.slots.length,t.name,e),a=Xm(t,"color",null);a&&n.color.setFromString(a);const o=Xm(t,"dark",null);o&&(n.darkColor=bh.fromString(o)),n.attachmentName=Xm(t,"attachment",null),n.blendMode=Bm.blendModeFromString(Xm(t,"blend","normal")),s.slots.push(n)}if(r.ik)for(let i=0;i<r.ik.length;i++){const t=r.ik[i],n=new jp(t.name);n.order=Xm(t,"order",0),n.skinRequired=Xm(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const r=t.bones[e],i=s.findBone(r);if(null==i)throw new Error(`IK bone not found: ${r}`);n.bones.push(i)}n.target=s.findBone(t.target),n.mix=Xm(t,"mix",1),n.softness=Xm(t,"softness",0)*e,n.bendDirection=Xm(t,"bendPositive",!0)?1:-1,n.compress=Xm(t,"compress",!1),n.stretch=Xm(t,"stretch",!1),n.uniform=Xm(t,"uniform",!1),s.ikConstraints.push(n)}if(r.transform)for(let i=0;i<r.transform.length;i++){const t=r.transform[i],n=new nm(t.name);n.order=Xm(t,"order",0),n.skinRequired=Xm(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const r=t.bones[e],i=s.findBone(r);if(!i)throw new Error(`Couldn't find bone ${r} for transform constraint ${t.name}.`);n.bones.push(i)}const a=t.target,o=s.findBone(a);if(!o)throw new Error(`Couldn't find target bone ${a} for transform constraint ${t.name}.`);n.target=o,n.local=Xm(t,"local",!1),n.relative=Xm(t,"relative",!1),n.offsetRotation=Xm(t,"rotation",0),n.offsetX=Xm(t,"x",0)*e,n.offsetY=Xm(t,"y",0)*e,n.offsetScaleX=Xm(t,"scaleX",0),n.offsetScaleY=Xm(t,"scaleY",0),n.offsetShearY=Xm(t,"shearY",0),n.mixRotate=Xm(t,"mixRotate",1),n.mixX=Xm(t,"mixX",1),n.mixY=Xm(t,"mixY",n.mixX),n.mixScaleX=Xm(t,"mixScaleX",1),n.mixScaleY=Xm(t,"mixScaleY",n.mixScaleX),n.mixShearY=Xm(t,"mixShearY",1),s.transformConstraints.push(n)}if(r.path)for(let i=0;i<r.path.length;i++){const t=r.path[i],n=new zp(t.name);n.order=Xm(t,"order",0),n.skinRequired=Xm(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const r=t.bones[e],i=s.findBone(r);if(!i)throw new Error(`Couldn't find bone ${r} for path constraint ${t.name}.`);n.bones.push(i)}const a=t.target,l=s.findSlot(a);if(!l)throw new Error(`Couldn't find target slot ${a} for path constraint ${t.name}.`);n.target=l,n.positionMode=Sh.enumValue(o,Xm(t,"positionMode","Percent")),n.spacingMode=Sh.enumValue(qp,Xm(t,"spacingMode","Length")),n.rotateMode=Sh.enumValue(h,Xm(t,"rotateMode","Tangent")),n.offsetRotation=Xm(t,"rotation",0),n.position=Xm(t,"position",0),n.positionMode==o.Fixed&&(n.position*=e),n.spacing=Xm(t,"spacing",0),n.spacingMode!=qp.Length&&n.spacingMode!=qp.Fixed||(n.spacing*=e),n.mixRotate=Xm(t,"mixRotate",1),n.mixX=Xm(t,"mixX",1),n.mixY=Xm(t,"mixY",n.mixX),s.pathConstraints.push(n)}if(r.skins)for(let i=0;i<r.skins.length;i++){const t=r.skins[i],e=new am(t.name);if(t.bones)for(let r=0;r<t.bones.length;r++){const n=t.bones[r],i=s.findBone(n);if(!i)throw new Error(`Couldn't find bone ${n} for skin ${t.name}.`);e.bones.push(i)}if(t.ik)for(let r=0;r<t.ik.length;r++){const n=t.ik[r],i=s.findIkConstraint(n);if(!i)throw new Error(`Couldn't find IK constraint ${n} for skin ${t.name}.`);e.constraints.push(i)}if(t.transform)for(let r=0;r<t.transform.length;r++){const n=t.transform[r],i=s.findTransformConstraint(n);if(!i)throw new Error(`Couldn't find transform constraint ${n} for skin ${t.name}.`);e.constraints.push(i)}if(t.path)for(let r=0;r<t.path.length;r++){const n=t.path[r],i=s.findPathConstraint(n);if(!i)throw new Error(`Couldn't find path constraint ${n} for skin ${t.name}.`);e.constraints.push(i)}for(const r in t.attachments){const n=s.findSlot(r);if(!n)throw new Error(`Couldn't find slot ${r} for skin ${t.name}.`);const i=t.attachments[r];for(const t in i){const r=this.readAttachment(i[t],e,n.index,t,s);r&&e.setAttachment(n.index,t,r)}}s.skins.push(e),"default"==e.name&&(s.defaultSkin=e)}for(let i=0,a=this.linkedMeshes.length;i<a;i++){const t=this.linkedMeshes[i],e=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!e)throw new Error(`Skin not found: ${t.skin}`);const r=e.getAttachment(t.slotIndex,t.parent);if(!r)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?r:t.mesh,t.mesh.setParentMesh(r)}if(this.linkedMeshes.length=0,r.events)for(const i in r.events){const t=r.events[i],e=new Hp(i);e.intValue=Xm(t,"int",0),e.floatValue=Xm(t,"float",0),e.stringValue=Xm(t,"string",""),e.audioPath=Xm(t,"audio",null),e.audioPath&&(e.volume=Xm(t,"volume",1),e.balance=Xm(t,"balance",0)),s.events.push(e)}if(r.animations)for(const i in r.animations){const t=r.animations[i];this.readAnimation(t,i,s)}return s}readAttachment(t,e,s,r,n){const i=this.scale;switch(r=Xm(t,"name",r),Xm(t,"type","region")){case"region":{const s=Xm(t,"path",r),n=this.readSequence(Xm(t,"sequence",null)),a=this.attachmentLoader.newRegionAttachment(e,r,s,n);if(!a)return null;a.path=s,a.x=Xm(t,"x",0)*i,a.y=Xm(t,"y",0)*i,a.scaleX=Xm(t,"scaleX",1),a.scaleY=Xm(t,"scaleY",1),a.rotation=Xm(t,"rotation",0),a.width=t.width*i,a.height=t.height*i,a.sequence=n;const o=Xm(t,"color",null);return o&&a.color.setFromString(o),a}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(!s)return null;this.readVertices(t,s,t.vertexCount<<1);const n=Xm(t,"color",null);return n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{const n=Xm(t,"path",r),a=this.readSequence(Xm(t,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(e,r,n,a);if(!o)return null;o.path=n;const h=Xm(t,"color",null);h&&o.color.setFromString(h),o.width=Xm(t,"width",0)*i,o.height=Xm(t,"height",0)*i,o.sequence=a;const l=Xm(t,"parent",null);if(l)return this.linkedMeshes.push(new Om(o,Xm(t,"skin",null),s,l,Xm(t,"timelines",!0))),o;const c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=new Float32Array(c),o.edges=Xm(t,"edges",null),o.hullLength=2*Xm(t,"hull",0),o}case"path":{const s=this.attachmentLoader.newPathAttachment(e,r);if(!s)return null;s.closed=Xm(t,"closed",!1),s.constantSpeed=Xm(t,"constantSpeed",!0);const n=t.vertexCount;this.readVertices(t,s,n<<1);const a=Sh.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*i;s.lengths=a;const o=Xm(t,"color",null);return o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,r);if(!s)return null;s.x=Xm(t,"x",0)*i,s.y=Xm(t,"y",0)*i,s.rotation=Xm(t,"rotation",0);const n=Xm(t,"color",null);return n&&s.color.setFromString(n),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,r);if(!s)return null;const i=Xm(t,"end",null);if(null!=i){const t=n.findSlot(i);if(null==t)throw new Error(`Clipping end slot not found: ${i}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=Xm(t,"color",null);return o&&s.color.setFromString(o),s}}return null}readSequence(t){if(null==t)return null;const e=new Af(Xm(t,"count",0));return e.start=Xm(t,"start",1),e.digits=Xm(t,"digits",0),e.setupIndex=Xm(t,"setup",0),e}readVertices(t,e,s){const r=this.scale;e.worldVerticesLength=s;const n=t.vertices;if(s==n.length){const t=Sh.toFloatArray(n);if(1!=r)for(let e=0,s=n.length;e<s;e++)t[e]*=r;return void(e.vertices=t)}const i=new Array,a=new Array;for(let o=0,h=n.length;o<h;){const t=n[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(n[o]),i.push(n[o+1]*r),i.push(n[o+2]*r),i.push(n[o+3])}e.bones=a,e.vertices=Sh.toFloatArray(i)}readAnimation(t,e,s){const r=this.scale,n=new Array;if(t.slots)for(const a in t.slots){const e=t.slots[a],r=s.findSlot(a);if(!r)throw new Error(`Slot not found: ${a}`);const i=r.index;for(const t in e){const s=e[t];if(!s)continue;const r=s.length;if("attachment"==t){const t=new fp(r,i);for(let e=0;e<r;e++){const r=s[e];t.setFrame(e,Xm(r,"time",0),Xm(r,"name",null))}n.push(t)}else if("rgba"==t){const t=new hp(r,r<<2,i);let e=s[0],a=Xm(e,"time",0),o=bh.fromString(e.color);for(let r=0,n=0;;r++){t.setFrame(r,a,o.r,o.g,o.b,o.a);const i=s[r+1];if(!i){t.shrink(n);break}const h=Xm(i,"time",0),l=bh.fromString(i.color),c=e.curve;c&&(n=Um(c,t,n,r,0,a,h,o.r,l.r,1),n=Um(c,t,n,r,1,a,h,o.g,l.g,1),n=Um(c,t,n,r,2,a,h,o.b,l.b,1),n=Um(c,t,n,r,3,a,h,o.a,l.a,1)),a=h,o=l,e=i}n.push(t)}else if("rgb"==t){const t=new lp(r,3*r,i);let e=s[0],a=Xm(e,"time",0),o=bh.fromString(e.color);for(let r=0,n=0;;r++){t.setFrame(r,a,o.r,o.g,o.b);const i=s[r+1];if(!i){t.shrink(n);break}const h=Xm(i,"time",0),l=bh.fromString(i.color),c=e.curve;c&&(n=Um(c,t,n,r,0,a,h,o.r,l.r,1),n=Um(c,t,n,r,1,a,h,o.g,l.g,1),n=Um(c,t,n,r,2,a,h,o.b,l.b,1)),a=h,o=l,e=i}n.push(t)}else if("alpha"==t)n.push(Lm(s,new cp(r,r,i),0,1));else if("rgba2"==t){const t=new up(r,7*r,i);let e=s[0],a=Xm(e,"time",0),o=bh.fromString(e.light),h=bh.fromString(e.dark);for(let r=0,n=0;;r++){t.setFrame(r,a,o.r,o.g,o.b,o.a,h.r,h.g,h.b);const i=s[r+1];if(!i){t.shrink(n);break}const l=Xm(i,"time",0),c=bh.fromString(i.light),u=bh.fromString(i.dark),d=e.curve;d&&(n=Um(d,t,n,r,0,a,l,o.r,c.r,1),n=Um(d,t,n,r,1,a,l,o.g,c.g,1),n=Um(d,t,n,r,2,a,l,o.b,c.b,1),n=Um(d,t,n,r,3,a,l,o.a,c.a,1),n=Um(d,t,n,r,4,a,l,h.r,u.r,1),n=Um(d,t,n,r,5,a,l,h.g,u.g,1),n=Um(d,t,n,r,6,a,l,h.b,u.b,1)),a=l,o=c,h=u,e=i}n.push(t)}else if("rgb2"==t){const t=new dp(r,6*r,i);let e=s[0],a=Xm(e,"time",0),o=bh.fromString(e.light),h=bh.fromString(e.dark);for(let r=0,n=0;;r++){t.setFrame(r,a,o.r,o.g,o.b,h.r,h.g,h.b);const i=s[r+1];if(!i){t.shrink(n);break}const l=Xm(i,"time",0),c=bh.fromString(i.light),u=bh.fromString(i.dark),d=e.curve;d&&(n=Um(d,t,n,r,0,a,l,o.r,c.r,1),n=Um(d,t,n,r,1,a,l,o.g,c.g,1),n=Um(d,t,n,r,2,a,l,o.b,c.b,1),n=Um(d,t,n,r,3,a,l,h.r,u.r,1),n=Um(d,t,n,r,4,a,l,h.g,u.g,1),n=Um(d,t,n,r,5,a,l,h.b,u.b,1)),a=l,o=c,h=u,e=i}n.push(t)}}}if(t.bones)for(const a in t.bones){const e=t.bones[a],i=s.findBone(a);if(!i)throw new Error(`Bone not found: ${a}`);const o=i.index;for(const t in e){const s=e[t],i=s.length;if(0!=i)if("rotate"===t)n.push(Lm(s,new Qf(i,i,o),0,1));else if("translate"===t){const t=new Jf(i,i<<1,o);n.push(Vm(s,t,"x","y",0,r))}else if("translatex"===t){const t=new tp(i,i,o);n.push(Lm(s,t,0,r))}else if("translatey"===t){const t=new ep(i,i,o);n.push(Lm(s,t,0,r))}else if("scale"===t){const t=new sp(i,i<<1,o);n.push(Vm(s,t,"x","y",1,1))}else if("scalex"===t){const t=new rp(i,i,o);n.push(Lm(s,t,1,1))}else if("scaley"===t){const t=new np(i,i,o);n.push(Lm(s,t,1,1))}else if("shear"===t){const t=new ip(i,i<<1,o);n.push(Vm(s,t,"x","y",0,1))}else if("shearx"===t){const t=new ap(i,i,o);n.push(Lm(s,t,0,1))}else if("sheary"===t){const t=new op(i,i,o);n.push(Lm(s,t,0,1))}}}if(t.ik)for(const a in t.ik){const e=t.ik[a];let i=e[0];if(!i)continue;const o=s.findIkConstraint(a);if(!o)throw new Error(`IK Constraint not found: ${a}`);const h=s.ikConstraints.indexOf(o),l=new bp(e.length,e.length<<1,h);let c=Xm(i,"time",0),u=Xm(i,"mix",1),d=Xm(i,"softness",0)*r;for(let t=0,s=0;;t++){l.setFrame(t,c,u,d,Xm(i,"bendPositive",!0)?1:-1,Xm(i,"compress",!1),Xm(i,"stretch",!1));const n=e[t+1];if(!n){l.shrink(s);break}const a=Xm(n,"time",0),o=Xm(n,"mix",1),h=Xm(n,"softness",0)*r,f=i.curve;f&&(s=Um(f,l,s,t,0,c,a,u,o,1),s=Um(f,l,s,t,1,c,a,d,h,r)),c=a,u=o,d=h,i=n}n.push(l)}if(t.transform)for(const a in t.transform){const e=t.transform[a];let r=e[0];if(!r)continue;const i=s.findTransformConstraint(a);if(!i)throw new Error(`Transform constraint not found: ${a}`);const o=s.transformConstraints.indexOf(i),h=new _p(e.length,6*e.length,o);let l=Xm(r,"time",0),c=Xm(r,"mixRotate",1),u=Xm(r,"mixX",1),d=Xm(r,"mixY",u),f=Xm(r,"mixScaleX",1),p=Xm(r,"mixScaleY",f);const m=Xm(r,"mixShearY",1);for(let t=0,s=0;;t++){h.setFrame(t,l,c,u,d,f,p,m);const n=e[t+1];if(!n){h.shrink(s);break}const i=Xm(n,"time",0),a=Xm(n,"mixRotate",1),o=Xm(n,"mixX",1),g=Xm(n,"mixY",o),x=Xm(n,"mixScaleX",1),y=Xm(n,"mixScaleY",x),b=Xm(n,"mixShearY",1),_=r.curve;_&&(s=Um(_,h,s,t,0,l,i,c,a,1),s=Um(_,h,s,t,1,l,i,u,o,1),s=Um(_,h,s,t,2,l,i,d,g,1),s=Um(_,h,s,t,3,l,i,f,x,1),s=Um(_,h,s,t,4,l,i,p,y,1),s=Um(_,h,s,t,5,l,i,m,b,1)),l=i,c=a,u=o,d=g,f=x,p=y,f=x,r=n}n.push(h)}if(t.path)for(const a in t.path){const e=t.path[a],i=s.findPathConstraint(a);if(!i)throw new Error(`Path constraint not found: ${a}`);const h=s.pathConstraints.indexOf(i);for(const t in e){const s=e[t];let a=s[0];if(!a)continue;const l=s.length;if("position"===t){const t=new vp(l,l,h);n.push(Lm(s,t,0,i.positionMode==o.Fixed?r:1))}else if("spacing"===t){const t=new Ep(l,l,h);n.push(Lm(s,t,0,i.spacingMode==qp.Length||i.spacingMode==qp.Fixed?r:1))}else if("mix"===t){const t=new wp(l,3*l,h);let e=Xm(a,"time",0),r=Xm(a,"mixRotate",1),i=Xm(a,"mixX",1),o=Xm(a,"mixY",i);for(let n=0,h=0;;n++){t.setFrame(n,e,r,i,o);const l=s[n+1];if(!l){t.shrink(h);break}const c=Xm(l,"time",0),u=Xm(l,"mixRotate",1),d=Xm(l,"mixX",1),f=Xm(l,"mixY",d),p=a.curve;p&&(h=Um(p,t,h,n,0,e,c,r,u,1),h=Um(p,t,h,n,1,e,c,i,d,1),h=Um(p,t,h,n,2,e,c,o,f,1)),e=c,r=u,i=d,o=f,a=l}n.push(t)}}}if(t.deform){t.attachments={};for(const e in t.deform){const s=t.deform[e],r=t.attachments[e]={};for(const t in s){const e=s[t],n=r[t]={};for(const t in e)n[t]={deform:e[t]}}}}if(t.attachments)for(const a in t.attachments){const e=t.attachments[a],i=s.findSkin(a);if(null!=i)for(const t in e){const a=e[t],o=s.findSlot(t);if(!o)throw new Error(`Slot not found: ${t}`);const h=o.index;for(const t in a){const e=a[t],s=i.getAttachment(h,t);for(const t in e){const i=e[t];let a=i[0];if(a)if("deform"==t){const t=s.bones,e=s.vertices,o=t?e.length/3*2:e.length,l=new pp(i.length,i.length,h,s);let c=Xm(a,"time",0);for(let s=0,n=0;;s++){let h;const u=Xm(a,"vertices",null);if(u){h=Sh.newFloatArray(o);const s=Xm(a,"offset",0);if(Sh.arrayCopy(u,0,h,s,u.length),1!=r)for(let t=s,e=t+u.length;t<e;t++)h[t]*=r;if(!t)for(let t=0;t<o;t++)h[t]+=e[t]}else h=t?Sh.newFloatArray(o):e;l.setFrame(s,c,h);const d=i[s+1];if(!d){l.shrink(n);break}const f=Xm(d,"time",0),p=a.curve;p&&(n=Um(p,l,n,s,0,c,f,0,1,1)),c=f,a=d}n.push(l)}else if("sequence"==t){const t=new Tp(i.length,h,s);let e=0;for(let s=0;s<i.length;s++){const r=Xm(a,"delay",e),n=Xm(a,"time",0),o=Tf[Xm(a,"mode","hold")],h=Xm(a,"index",0);t.setFrame(s,n,o,h,r),e=r,a=i[s+1]}n.push(t)}}}}}if(t.drawOrder){const e=new yp(t.drawOrder.length),r=s.slots.length;let i=0;for(let n=0;n<t.drawOrder.length;n++,i++){const a=t.drawOrder[n];let o=null;const h=Xm(a,"offsets",null);if(h){o=Sh.newArray(r,-1);const t=Sh.newArray(r-h.length,0);let e=0,n=0;for(let r=0;r<h.length;r++){const i=h[r],a=s.findSlot(i.slot);if(!a)throw new Error(`Slot not found: ${a}`);const l=a.index;for(;e!=l;)t[n++]=e++;o[e+i.offset]=e++}for(;e<r;)t[n++]=e++;for(let s=r-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}e.setFrame(i,Xm(a,"time",0),o)}n.push(e)}if(t.events){const e=new gp(t.events.length);let r=0;for(let n=0;n<t.events.length;n++,r++){const i=t.events[n],a=s.findEvent(i.name);if(!a)throw new Error(`Event not found: ${i.name}`);const o=new Wp(Sh.toSinglePrecision(Xm(i,"time",0)),a);o.intValue=Xm(i,"int",a.intValue),o.floatValue=Xm(i,"float",a.floatValue),o.stringValue=Xm(i,"string",a.stringValue),o.data.audioPath&&(o.volume=Xm(i,"volume",1),o.balance=Xm(i,"balance",0)),e.setFrame(r,o)}n.push(e)}let i=0;for(let a=0,o=n.length;a<o;a++)i=Math.max(i,n[a].getDuration());if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new If(e,n,i))}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return f.NORMAL;if("additive"==t)return f.ADD;if("multiply"==t)return f.MULTIPLY;if("screen"==t)return f.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}}class Om{constructor(t,e,s,r,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=r,this.inheritTimeline=n}}function Lm(t,e,s,r){let n=t[0],i=Xm(n,"time",0),a=Xm(n,"value",s)*r,o=0;for(let h=0;;h++){e.setFrame(h,i,a);const l=t[h+1];if(!l)return e.shrink(o),e;const c=Xm(l,"time",0),u=Xm(l,"value",s)*r;n.curve&&(o=Um(n.curve,e,o,h,0,i,c,a,u,r)),i=c,a=u,n=l}}function Vm(t,e,s,r,n,i){let a=t[0],o=Xm(a,"time",0),h=Xm(a,s,n)*i,l=Xm(a,r,n)*i,c=0;for(let u=0;;u++){e.setFrame(u,o,h,l);const d=t[u+1];if(!d)return e.shrink(c),e;const f=Xm(d,"time",0),p=Xm(d,s,n)*i,m=Xm(d,r,n)*i,g=a.curve;g&&(c=Um(g,e,c,u,0,o,f,h,p,i),c=Um(g,e,c,u,1,o,f,l,m,i)),o=f,h=p,l=m,a=d}}function Um(t,e,s,r,n,i,a,o,h,l){if("stepped"==t)return e.setStepped(r),s;const c=n<<2,u=t[c],d=t[c+1]*l,f=t[c+2],p=t[c+3]*l;return e.setBezier(s,r,n,i,o,u,d,f,p,a,h),s+1}function Xm(t,e,s){return void 0!==t[e]?t[e]:s}const Ym=Object.freeze(Object.defineProperty({__proto__:null,AlphaTimeline:cp,Animation:If,AnimationState:Ip,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:Vp,AtlasAttachmentLoader:Up,Attachment:ff,AttachmentTimeline:fp,Bone:Xp,BoneData:Yp,BoundingBoxAttachment:gf,ClippingAttachment:xf,ConstraintData:Gp,CurveTimeline:qf,CurveTimeline1:Zf,CurveTimeline2:Kf,DeformTimeline:pp,DrawOrderTimeline:yp,Event:Wp,EventData:Hp,EventQueue:Cp,EventTimeline:gp,EventType:Pp,IkConstraint:$p,IkConstraintData:jp,IkConstraintTimeline:bp,MeshAttachment:yf,PathAttachment:bf,PathConstraint:Kp,PathConstraintData:zp,PathConstraintMixTimeline:wp,PathConstraintPositionTimeline:vp,PathConstraintSpacingTimeline:Ep,PointAttachment:_f,RGB2Timeline:dp,RGBA2Timeline:up,RGBATimeline:hp,RGBTimeline:lp,RegionAttachment:Ef,RotateTimeline:Qf,ScaleTimeline:sp,ScaleXTimeline:rp,ScaleYTimeline:np,Sequence:Af,SequenceMode:Tf,SequenceModeValues:Sf,SequenceTimeline:Tp,ShearTimeline:ip,ShearXTimeline:ap,ShearYTimeline:op,Skeleton:em,SkeletonBinary:om,SkeletonBounds:class extends Mh{},SkeletonData:sm,SkeletonJson:Bm,Skin:am,SkinEntry:im,Slot:Qp,SlotData:rm,SpacingMode:qp,Spine:class extends Sl{createSkeleton(t){this.skeleton=new em(t),this.skeleton.updateWorldTransform(),this.stateData=new Vp(t),this.state=new Ip(this.stateData)}},Timeline:zf,TrackEntry:Mp,TransformConstraint:Jp,TransformConstraintData:nm,TransformConstraintTimeline:_p,TranslateTimeline:Jf,TranslateXTimeline:tp,TranslateYTimeline:ep,VertexAttachment:mf},Symbol.toStringTag,{value:"Module"}));var Gm=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.VER37=37]="VER37",t[t.VER38=38]="VER38",t[t.VER40=40]="VER40",t[t.VER41=41]="VER41",t))(Gm||{});function Wm(t){const e=t.substr(0,3),s=Math.floor(10*Number(e)+.001);return"3.7"===e?37:"3.8"===e?38:"4.0"===e?40:"4.1"===e?41:s<37?37:0}class Hm{constructor(){this.scale=1}readSkeletonData(t,e){let s=null,r=this.readVersionOldFormat(e),n=Wm(r);if(n===Gm.VER38&&(s=new Gu(new Eu(t))),r=this.readVersionNewFormat(e),n=Wm(r),n!==Gm.VER40&&n!==Gm.VER41||(s=new om(new Up(t))),!s){const t=`Unsupported version of spine model ${r}, please update pixi-spine`;console.error(t)}return s.scale=this.scale,s.readSkeletonData(e)}readVersionOldFormat(t){const e=new n(t);let s;try{e.readString(),s=e.readString()}catch(Xy){s=""}return s||""}readVersionNewFormat(t){const e=new n(t);let s;e.readInt32(),e.readInt32();try{s=e.readString()}catch(Xy){s=""}return s||""}}class $m{constructor(){this.scale=1}readSkeletonData(t,e){const s=e.skeleton.spine,r=Wm(s);let n=null;if(r===Gm.VER37&&(n=new cf(new Hd(t))),r===Gm.VER38&&(n=new $u(new Eu(t))),r!==Gm.VER40&&r!==Gm.VER41||(n=new Bm(new Up(t))),!n){const t=`Unsupported version of spine model ${s}, please update pixi-spine`;console.error(t)}return n.scale=this.scale,n.readSkeletonData(e)}}class jm extends Sl{createSkeleton(t){const e=Wm(t.version);let s=null;if(e===Gm.VER37&&(s=df),e===Gm.VER38&&(s=zu),e!==Gm.VER40&&e!==Gm.VER41||(s=Ym),!s){const e=`Cant detect version of spine model ${t.version}`;console.error(e)}this.skeleton=new s.Skeleton(t),this.skeleton.updateWorldTransform(),this.stateData=new s.AnimationStateData(t),this.state=new s.AnimationState(this.stateData)}}(new class extends Tc{createBinaryParser(){return new Hm}createJsonParser(){return new $m}parseData(t,e,s){return{spineData:t.readSkeletonData(e,s),spineAtlas:e}}}).installLoader();const zm=new Ui;kh.prototype._cacheAsBitmap=!1,kh.prototype._cacheData=null,kh.prototype._cacheAsBitmapResolution=null,kh.prototype._cacheAsBitmapMultisample=null;class qm{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(kh.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new qm),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),kh.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},kh.prototype._initCachedDisplayObject=function(t){var e,s;if(null==(e=this._cacheData)?void 0:e.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const n=this.getLocalBounds(new Ni,!0);if(null==(s=this.filters)?void 0:s.length){const t=this.filters[0].padding;n.pad(t)}const i=this.cacheAsBitmapResolution||t.resolution;n.ceil(i),n.width=Math.max(n.width,1/i),n.height=Math.max(n.height,1/i);const a=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),h=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,c=Ya.create({width:n.width,height:n.height,resolution:i,multisample:this.cacheAsBitmapMultisample??t.multisample}),u=`cacheAsBitmap_${$n()}`;this._cacheData.textureCacheId=u,yi.addToCache(c.baseTexture,u),Xa.addToCache(c,u);const d=this.transform.localTransform.copyTo(zm).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(a,o,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const f=new Uh(c);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-n.x/n.width,f.anchor.y=-n.y/n.height,f.alpha=r,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)},kh.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},kh.prototype._initCachedDisplayObjectCanvas=function(t){var e;if(null==(e=this._cacheData)?void 0:e.sprite)return;const s=this.getLocalBounds(new Ni,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,i=t._projTransform,a=this.cacheAsBitmapResolution||t.resolution;s.ceil(a),s.width=Math.max(s.width,1/a),s.height=Math.max(s.height,1/a);const o=Ya.create({width:s.width,height:s.height,resolution:a}),h=`cacheAsBitmap_${$n()}`;this._cacheData.textureCacheId=h,yi.addToCache(o.baseTexture,h),Xa.addToCache(o,h);const l=zm;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=s.x,l.ty-=s.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const c=new Uh(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-s.x/s.width,c.anchor.y=-s.y/s.height,c.alpha=r,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},kh.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},kh.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},kh.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,yi.removeFromCache(this._cacheData.textureCacheId),Xa.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},kh.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},kh.prototype.name=null,Oh.prototype.getChildByName=function(t,e){for(let s=0,r=this.children.length;s<r;s++)if(this.children[s].name===t)return this.children[s];if(e)for(let s=0,r=this.children.length;s<r;s++){const e=this.children[s];if(!e.getChildByName)continue;const r=e.getChildByName(t,!0);if(r)return r}return null},kh.prototype.getGlobalPosition=function(t=new Fi,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};class Zm extends Ma{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const Km={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Qm=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Jm extends Ma{constructor(t,e=8,s=4,r=Ma.defaultResolution,n=5){const i=function(t,e){const s=Math.ceil(t/2);let r,n="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",i="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<t;a++){let t=r.replace("%index%",a.toString());t=t.replace("%sampleIndex%",a-(s-1)+".0"),i+=t,i+="\n"}return n=n.replace("%blur%",i),n=n.replace("%size%",t.toString()),n}(n,t),a=function(t){const e=Km[t],s=e.length;let r,n=Qm,i="";for(let a=0;a<t;a++){let n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());r=a,a>=s&&(r=t-a-1),n=n.replace("%value%",e[r].toString()),i+=n,i+="\n"}return n=n.replace("%blur%",i),n=n.replace("%size%",t.toString()),n}(n);super(i,a),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=s,this.blur=e}apply(t,e,s,r){if(s?this.horizontal?this.uniforms.strength=1/s.width*(s.width/e.width):this.uniforms.strength=1/s.height*(s.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,s,r);else{const n=t.getFilterTexture(),i=t.renderer;let a=e,o=n;this.state.blend=!1,t.applyFilter(this,a,o,w.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(a,w.BLIT),this.uniforms.uSampler=o;const e=o;o=a,a=e,i.shader.bind(this),i.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,o,s,r),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class tg extends Ma{constructor(t=8,e=4,s=Ma.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Jm(!0,t,e,s,r),this.blurYFilter=new Jm(!1,t,e,s,r),this.resolution=s,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,s,r){const n=Math.abs(this.blurXFilter.strength),i=Math.abs(this.blurYFilter.strength);if(n&&i){const n=t.getFilterTexture();this.blurXFilter.apply(t,e,n,w.CLEAR),this.blurYFilter.apply(t,n,s,r),t.returnFilterTexture(n)}else i?this.blurYFilter.apply(t,e,s,r):this.blurXFilter.apply(t,e,s,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}class eg extends Ma{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super($o,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let s=t;e&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,e,s){return t[0]=e[0]*s[0]+e[1]*s[5]+e[2]*s[10]+e[3]*s[15],t[1]=e[0]*s[1]+e[1]*s[6]+e[2]*s[11]+e[3]*s[16],t[2]=e[0]*s[2]+e[1]*s[7]+e[2]*s[12]+e[3]*s[17],t[3]=e[0]*s[3]+e[1]*s[8]+e[2]*s[13]+e[3]*s[18],t[4]=e[0]*s[4]+e[1]*s[9]+e[2]*s[14]+e[3]*s[19]+e[4],t[5]=e[5]*s[0]+e[6]*s[5]+e[7]*s[10]+e[8]*s[15],t[6]=e[5]*s[1]+e[6]*s[6]+e[7]*s[11]+e[8]*s[16],t[7]=e[5]*s[2]+e[6]*s[7]+e[7]*s[12]+e[8]*s[17],t[8]=e[5]*s[3]+e[6]*s[8]+e[7]*s[13]+e[8]*s[18],t[9]=e[5]*s[4]+e[6]*s[9]+e[7]*s[14]+e[8]*s[19]+e[9],t[10]=e[10]*s[0]+e[11]*s[5]+e[12]*s[10]+e[13]*s[15],t[11]=e[10]*s[1]+e[11]*s[6]+e[12]*s[11]+e[13]*s[16],t[12]=e[10]*s[2]+e[11]*s[7]+e[12]*s[12]+e[13]*s[17],t[13]=e[10]*s[3]+e[11]*s[8]+e[12]*s[13]+e[13]*s[18],t[14]=e[10]*s[4]+e[11]*s[9]+e[12]*s[14]+e[13]*s[19]+e[14],t[15]=e[15]*s[0]+e[16]*s[5]+e[17]*s[10]+e[18]*s[15],t[16]=e[15]*s[1]+e[16]*s[6]+e[17]*s[11]+e[18]*s[16],t[17]=e[15]*s[2]+e[16]*s[7]+e[17]*s[12]+e[18]*s[17],t[18]=e[15]*s[3]+e[16]*s[8]+e[17]*s[13]+e[18]*s[18],t[19]=e[15]*s[4]+e[16]*s[9]+e[17]*s[14]+e[18]*s[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const s=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}tint(t,e){const[s,r,n]=Nn.shared.setValue(t).toArray(),i=[s,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(i,e)}greyscale(t,e){const s=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const s=Math.cos(t),r=Math.sin(t),n=1/3,i=(0,Math.sqrt)(n),a=[s+(1-s)*n,n*(1-s)-i*r,n*(1-s)+i*r,0,0,n*(1-s)+i*r,s+n*(1-s),n*(1-s)-i*r,0,0,n*(1-s)-i*r,n*(1-s)+i*r,s+n*(1-s),0,0,0,0,0,1,0];this._loadMatrix(a,e)}contrast(t,e){const s=(t||0)+1,r=-.5*(s-1),n=[s,0,0,0,r,0,s,0,0,r,0,0,s,0,r,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const s=2*t/3+1,r=-.5*(s-1),n=[s,r,r,0,0,r,s,r,0,0,r,r,s,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,s,r,n){t=t||.2,e=e||.15,s=s||16770432,r=r||3375104;const i=Nn.shared,[a,o,h]=i.setValue(s).toArray(),[l,c,u]=i.setValue(r).toArray(),d=[.3,.59,.11,0,0,a,o,h,t,0,l,c,u,e,0,a-l,o-c,h-u,0,0];this._loadMatrix(d,n)}night(t,e){const s=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}predator(t,e){const s=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(s,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}eg.prototype.grayscale=eg.prototype.greyscale;class sg extends Ma{constructor(t,e){const s=new Ui;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=s,null==e&&(e=20),this.scale=new Fi(e,e)}apply(t,e,s,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,i=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);0!==i&&0!==a&&(this.uniforms.rotation[0]=n.a/i,this.uniforms.rotation[1]=n.b/i,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,e,s,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}class rg extends Ma{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}}class ng extends Ma{constructor(t=.5,e=Math.random()){super($o,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const ig=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Go.system.add(this.tickerUpdate,this,Uo.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Go.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class ag{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ag.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Fi,this.page=new Fi,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,s,r,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class og extends ag{constructor(){super(...arguments),this.client=new Fi,this.movement=new Fi,this.offset=new Fi,this.global=new Fi,this.screen=new Fi}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,s){return t.worldTransform.applyInverse(s||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,s,r,n,i,a,o,h,l,c,u,d,f,p){throw new Error("Method not implemented.")}}class hg extends og{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class lg extends og{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}lg.DOM_DELTA_PIXEL=0,lg.DOM_DELTA_LINE=1,lg.DOM_DELTA_PAGE=2;const cg=new Fi,ug=new Fi;class dg{constructor(t){this.dispatch=new q,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let s=0,r=e.length;s<r;s++)e[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){ig.pauseUpdate=!0;const s=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,cg.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,n=s.length-1;r<n;r++)if(t.currentTarget=s[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=s.length-2;r>=0;r--)if(t.currentTarget=s[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,s=this._allInteractiveElements){if(0===s.length)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(e)?e:[e];for(let n=s.length-1;n>=0;n--)r.forEach((e=>{t.currentTarget=s[n],this.notifyTarget(t,e)}))}propagationPath(t){const e=[t];for(let s=0;s<2048&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,s,r,n,i=!1){let a=!1;if(this._interactivePrune(t))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(ig.pauseUpdate=!1),t.interactiveChildren&&t.children){const o=t.children;for(let h=o.length-1;h>=0;h--){const l=o[h],c=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,s,r,n,i||n(t,s));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),a=!0}}}const o=this._isInteractive(e),h=t.isInteractive();return o&&h&&this._allInteractiveElements.push(t),i||this._hitElements.length>0?null:a?this._hitElements:o&&!n(t,s)&&r(t,s)?h?[t]:[]:null}hitTestRecursive(t,e,s,r,n){if(this._interactivePrune(t)||n(t,s))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(ig.pauseUpdate=!1),t.interactiveChildren&&t.children){const i=t.children;for(let a=i.length-1;a>=0;a--){const o=i[a],h=this.hitTestRecursive(o,this._isInteractive(e)?e:o.eventMode,s,r,n);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const i=this._isInteractive(e),a=t.isInteractive();return i&&r(t,s)?a?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable&&"none"!==t.eventMode&&("passive"!==t.eventMode||t.interactiveChildren)&&!t.isMask)}hitPruneFn(t,e){var s;if(t.hitArea&&(t.worldTransform.applyInverse(e,ug),!t.hitArea.contains(ug.x,ug.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!(null==(s=r.containsPoint)?void 0:s.call(r,e)))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){var s,r;const n=`on${e=e??t.type}`;null==(r=(s=t.currentTarget)[n])||r.call(s,t);const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof hg))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,s;if(!(t instanceof hg))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const r=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n="mouse"===r.pointerType||"pen"===r.pointerType,i=this.trackingData(t.pointerId),a=this.findMountedTarget(i.overTargets);if((null==(e=i.overTargets)?void 0:e.length)>0&&a!==r.target){const e="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,e,a);if(this.dispatchEvent(s,"pointerout"),n&&this.dispatchEvent(s,"mouseout"),!r.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a);for(e.eventPhase=e.AT_TARGET;e.target&&!r.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(s)}if(a!==r.target){const e="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(r,e);this.dispatchEvent(s,"pointerover"),n&&this.dispatchEvent(s,"mouseover");let i=null==a?void 0:a.parent;for(;i&&i!==this.rootTarget.parent&&i!==r.target;)i=i.parent;if(!i||i===this.rootTarget.parent){const t=this.clonePointerEvent(r,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==a&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),n&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const o=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(r,"pointermove"),h&&o.push("globalpointermove"),"touch"===r.pointerType&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(r,"touchmove"),h&&o.push("globaltouchmove")),n&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(r,"mousemove"),h&&o.push("globalmousemove"),this.cursor=null==(s=r.target)?void 0:s.cursor),o.length>0&&this.all(r,o),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var e;if(!(t instanceof hg))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const s=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=null==(e=r.target)?void 0:e.cursor);const i=this.clonePointerEvent(r,"pointerenter");for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),n&&this.notifyTarget(i,"mouseenter"),i.target=i.target.parent;s.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(i)}mapPointerOut(t){if(!(t instanceof hg))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const s="mouse"===t.pointerType||"pen"===t.pointerType,r=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(n),s&&this.dispatchEvent(n,"mouseout");const i=this.createPointerEvent(t,"pointerleave",r);for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),s&&this.notifyTarget(i,"mouseleave"),i.target=i.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(i)}this.cursor=null}mapPointerUp(t){if(!(t instanceof hg))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerup"),"touch"===s.pointerType)this.dispatchEvent(s,"touchend");else if("mouse"===s.pointerType||"pen"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]);let i=n;if(n&&!s.composedPath().includes(n)){let e=n;for(;e&&!s.composedPath().includes(e);){if(s.currentTarget=e,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType)this.notifyTarget(s,"touchendoutside");else if("mouse"===s.pointerType||"pen"===s.pointerType){const t=2===s.button;this.notifyTarget(s,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete r.pressTargetsByButton[t.button],i=e}if(i){const n=this.clonePointerEvent(s,"click");n.target=i,n.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:n.target,timeStamp:e});const a=r.clicksByButton[t.button];if(a.target===n.target&&e-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=n.target,a.timeStamp=e,n.detail=a.clickCount,"mouse"===n.pointerType){const t=2===n.button;this.dispatchEvent(n,t?"rightclick":"click")}else"touch"===n.pointerType&&this.dispatchEvent(n,"tap");this.dispatchEvent(n,"pointertap"),this.freeEvent(n)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof hg))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),s=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(s){let n=s;for(;n;)r.currentTarget=n,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):("mouse"===r.pointerType||"pen"===r.pointerType)&&this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof lg))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let s=1;s<t.length&&t[s].parent===e;s++)e=t[s];return e}createPointerEvent(t,e,s){const r=this.allocateEvent(hg);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=s??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],"string"==typeof e&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(lg);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const s=this.allocateEvent(hg);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=e??s.type,s}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof hg&&e instanceof hg&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof og&&e instanceof og&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const s=t.currentTarget._events[e];if(s&&t.currentTarget.isInteractive())if("fn"in s)s.once&&t.currentTarget.removeListener(e,s.fn,void 0,!0),s.fn.call(s.context,t);else for(let r=0,n=s.length;r<n&&!t.propagationImmediatelyStopped;r++)s[r].once&&t.currentTarget.removeListener(e,s[r].fn,void 0,!0),s[r].fn.call(s[r].context,t)}}const fg={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},pg=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new dg(null),ig.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new hg(null),this.rootWheelEvent=new lg(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,e,s)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=s),t[e]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:s,resolution:r}=this.renderer;this.setTargetElement(s),this.resolution=r,t._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];if(s)switch(typeof s){case"string":e&&(this.domElement.style.cursor=s);break;case"function":s(t);break;case"object":e&&Object.assign(this.domElement.style,s)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let s=0,r=e.length;s<r;s++){const t=e[s],r=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,ig.pointerMoved();const e=this.normalizeToPointerData(t);for(let s=0,r=e.length;s<r;s++){const t=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const s=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let n=0,i=r.length;n<i;n++){const t=this.bootstrapEvent(this.rootPointerEvent,r[n]);t.type+=s,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let s=0,r=e.length;s<r;s++){const t=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,ig.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;ig.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;ig.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,s){const r=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*n,t.y=(s-r.top)*(this.domElement.height/r.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let s=0,r=t.changedTouches.length;s<r;s++){const r=t.changedTouches[s];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const s=t;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=1),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=fg[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};pg.extension={name:"events",type:[ri.RendererSystem,ri.CanvasRendererSystem]},pg.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let mg=pg;function gg(t){return"dynamic"===t||"static"===t}ai.add(mg);const xg={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??gg(mg.defaultEventMode)},set interactive(t){Jr("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??mg.defaultEventMode},set eventMode(t){this._internalInteractive=gg(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,s){const r="boolean"==typeof s&&s||"object"==typeof s&&s.capture,n="object"==typeof s?s.signal:void 0,i="object"==typeof s&&!0===s.once,a="function"==typeof e?void 0:e;t=r?`${t}capture`:t;const o="function"==typeof e?e:e.handleEvent,h=this;n&&n.addEventListener("abort",(()=>{h.off(t,o,a)})),i?h.once(t,o,a):h.on(t,o,a)},removeEventListener(t,e,s){const r="function"==typeof e?void 0:e;t="boolean"==typeof s&&s||"object"==typeof s&&s.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,r)},dispatchEvent(t){if(!(t instanceof ag))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};kh.mixin(xg);kh.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class yg{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(j.tablet||j.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null==(t=this.renderer.view.parentNode)||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null==(t=this.div.parentNode)||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let s=0;s<e.length;s++)this.updateAccessibleObjects(e[s])}update(){const t=performance.now();if(j.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:s,width:r,height:n}=this.renderer.view.getBoundingClientRect(),{width:i,height:a,resolution:o}=this.renderer,h=r/i*o,l=n/a*o;let c=this.div;c.style.left=`${e}px`,c.style.top=`${s}px`,c.style.width=`${i}px`,c.style.height=`${a}px`;for(let u=0;u<this.children.length;u++){const t=this.children[u];if(t.renderId!==this.renderId)t._accessibleActive=!1,Gn(this.children,u,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,u--;else{c=t._accessibleDiv;let e=t.hitArea;const s=t.worldTransform;t.hitArea?(c.style.left=(s.tx+e.x*s.a)*h+"px",c.style.top=(s.ty+e.y*s.d)*l+"px",c.style.width=e.width*s.a*h+"px",c.style.height=e.height*s.d*l+"px"):(e=t.getBounds(),this.capHitArea(e),c.style.left=e.x*h+"px",c.style.top=e.y*l+"px",c.style.width=e.width*h+"px",c.style.height=e.height*l+"px",c.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(c.title=t.accessibleTitle),c.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&c.setAttribute("aria-label",t.accessibleHint)),(t.accessibleTitle!==c.title||t.tabIndex!==c.tabIndex)&&(c.title=t.accessibleTitle,c.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:s}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>s&&(t.height=s-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:s}=t.target,r=this.renderer.events.rootBoundary,n=Object.assign(new ag(r),{target:s});r.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>r.dispatchEvent(n,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}yg.extension={name:"accessibility",type:[ri.RendererPlugin,ri.CanvasRendererPlugin]},ai.add(yg);const bg=class t{constructor(e){this.stage=new Oh,e=Object.assign({forceCanvas:!1},e),this.renderer=function(t){for(const e of Ho)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(e),t._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render(this.stage)}get view(){var t;return null==(t=this.renderer)?void 0:t.view}get screen(){var t;return null==(t=this.renderer)?void 0:t.screen}destroy(e,s){const r=t._plugins.slice(0);r.reverse(),r.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(s),this.stage=null,this.renderer.destroy(e),this.renderer=null}};bg._plugins=[];let _g=bg;ai.handleByList(ri.Application,_g._plugins);class vg{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:r}=this._resizeTo;t=s,e=r}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}vg.extension=ri.Application,ai.add(vg);var Eg=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t))(Eg||{});const wg={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Ag,Tg;function Sg(){Tg={bptc:Ag.getExtension("EXT_texture_compression_bptc"),astc:Ag.getExtension("WEBGL_compressed_texture_astc"),etc:Ag.getExtension("WEBGL_compressed_texture_etc"),s3tc:Ag.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ag.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Ag.getExtension("WEBGL_compressed_texture_pvrtc")||Ag.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Ag.getExtension("WEBGL_compressed_texture_etc1"),atc:Ag.getExtension("WEBGL_compressed_texture_atc")}}const Ig={extension:{type:ri.DetectionParser,priority:2},test:async()=>{const t=M.ADAPTER.createCanvas().getContext("webgl");return t?(Ag=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{Tg||Sg();const e=[];for(const s in Tg)Tg[s]&&e.push(s);return[...e,...t]},remove:async t=>(Tg||Sg(),t.filter((t=>!(t in Tg))))};ai.add(Ig);class Rg extends mi{constructor(t,e={width:1,height:1,autoLoad:!0}){let s,r;"string"==typeof t?(s=t,r=new Uint8Array):(s=null,r=t),super(r,e),this.origin=s,this.buffer=r?new oi(r):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new oi(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class Mg extends Rg{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Mg._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Mg._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,s){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;r.pixelStorei(r.UNPACK_ALIGNMENT,4);for(let n=0,i=this.levels;n<i;n++){const{levelID:t,levelWidth:e,levelHeight:s,levelBuffer:i}=this._levelBuffers[n];r.compressedTexImage2D(r.TEXTURE_2D,t,this.format,e,s,0,i)}return!0}onBlobLoaded(){this._levelBuffers=Mg._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(36196===t)return"etc1";if(35986===t||35987===t||34798===t)return"atc";if(t>=36492&&t<=36495)return"bptc";if(37808===t)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,s,r,n,i,a){const o=new Array(s);let h=t.byteOffset,l=i,c=a,u=l+r-1&~(r-1),d=c+n-1&~(n-1),f=u*d*wg[e];for(let p=0;p<s;p++)o[p]={levelID:p,levelWidth:s>1?l:u,levelHeight:s>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,l=l>>1||1,c=c>>1||1,u=l+r-1&~(r-1),d=c+n-1&~(n-1),f=u*d*wg[e];return o}}const Cg=124,Pg=3,kg=4,Fg=7,Dg=19,Ng=2,Bg=0,Og=1,Lg=2,Vg=3,Ug=827611204,Xg=861165636,Yg=894720068,Gg={[Ug]:Eg.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Xg]:Eg.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Yg]:Eg.COMPRESSED_RGBA_S3TC_DXT5_EXT},Wg={70:Eg.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Eg.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Eg.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Eg.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Eg.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Eg.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Eg.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Eg.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Eg.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Eg.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Eg.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Eg.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Eg.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};const Hg=[171,75,84,88,32,49,49,187,13,10,26,10],$g=12,jg=16,zg=24,qg=28,Zg=36,Kg=40,Qg=44,Jg=48,tx=52,ex=56,sx=60,rx=64,nx={[x.UNSIGNED_BYTE]:1,[x.UNSIGNED_SHORT]:2,[x.INT]:4,[x.UNSIGNED_INT]:4,[x.FLOAT]:4,[x.HALF_FLOAT]:8},ix={[m.RGBA]:4,[m.RGB]:3,[m.RG]:2,[m.RED]:1,[m.LUMINANCE]:1,[m.LUMINANCE_ALPHA]:2,[m.ALPHA]:1},ax={[x.UNSIGNED_SHORT_4_4_4_4]:2,[x.UNSIGNED_SHORT_5_5_5_1]:2,[x.UNSIGNED_SHORT_5_6_5]:2};function ox(t,e,s=!1){const r=new DataView(e);if(!function(t,e){for(let s=0;s<Hg.length;s++)if(e.getUint8(s)!==Hg[s])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,r))return null;const n=67305985===r.getUint32($g,!0),i=r.getUint32(jg,n),a=r.getUint32(zg,n),o=r.getUint32(qg,n),h=r.getUint32(Zg,n),l=r.getUint32(Kg,n)||1,c=r.getUint32(Qg,n)||1,u=r.getUint32(Jg,n)||1,d=r.getUint32(tx,n),f=r.getUint32(ex,n),p=r.getUint32(sx,n);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const m=h+3&-4,g=l+3&-4,y=new Array(u);let b,_=h*l;if(0===i&&(_=m*g),b=0!==i?nx[i]?nx[i]*ix[a]:ax[i]:wg[o],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const v=s?function(t,e,s){const r=new Map;let n=0;for(;n<e;){const i=t.getUint32(rx+n,s),a=rx+n+4,o=3-(i+3)%4;if(0===i||i>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<i&&0!==t.getUint8(a+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,a,h)),c=new DataView(t.buffer,a+h+1,i-h-1);r.set(l,c),n+=4+i+o}return r}(r,p,n):null;let E=_*b,w=h,A=l,T=m,S=g,I=rx+p;for(let x=0;x<f;x++){const t=r.getUint32(I,n);let s=I+4;for(let r=0;r<u;r++){let t=y[r];t||(t=y[r]=new Array(f)),t[x]={levelID:x,levelWidth:f>1||0!==i?w:T,levelHeight:f>1||0!==i?A:S,levelBuffer:new Uint8Array(e,s,E)},s+=E}I+=t+4,I=I%4!=0?I+4-I%4:I,w=w>>1||1,A=A>>1||1,T=w+4-1&-4,S=A+4-1&-4,E=T*S*b}return 0!==i?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,s=!1;return i===x.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):i===x.UNSIGNED_INT?(s=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):i===x.INT&&(s=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new mi(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:i,format:s?hx(a):a}})),kvData:v}:{compressed:y.map((t=>new Mg(null,{format:o,width:h,height:l,levels:f,levelBuffers:t}))),kvData:v}}function hx(t){switch(t){case m.RGBA:return m.RGBA_INTEGER;case m.RGB:return m.RGB_INTEGER;case m.RG:return m.RG_INTEGER;case m.RED:return m.RED_INTEGER;default:return t}}const lx={extension:{type:ri.LoadParser,priority:Ll.High},name:"loadDDS",test:t=>Cl(t,".dds"),async load(t,e,s){const r=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const s=new Uint32Array(t,0,Cg/Uint32Array.BYTES_PER_ELEMENT),r=s[Pg],n=s[kg],i=s[Fg],a=new Uint32Array(t,Dg*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),o=a[1];if(4&o){const s=a[Ng];if(808540228!==s){const e=Gg[s],a=new Uint8Array(t,128);return[new Mg(a,{format:e,width:n,height:r,levels:i})]}const o=128,h=new Uint32Array(e.buffer,o,20/Uint32Array.BYTES_PER_ELEMENT),l=h[Bg],c=h[Og],u=h[Lg],d=h[Vg],f=Wg[l];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(t,m));else{const e=wg[f];let s=0,a=n,o=r;for(let t=0;t<i;t++)s+=Math.max(1,a+3&-4)*Math.max(1,o+3&-4)*e,a>>>=1,o>>>=1;let h=m;for(let r=0;r<d;r++)p.push(new Uint8Array(t,h,s)),h+=s}return p.map((t=>new Mg(t,{format:f,width:n,height:r,levels:i})))}throw 64&o?new Error("DDSParser does not support uncompressed texture data."):512&o?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&o?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&o?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await M.ADAPTER.fetch(t)).arrayBuffer()).map((r=>tc(new yi(r,{mipmap:v.OFF,alphaMode:E.NO_PREMULTIPLIED_ALPHA,resolution:si(t),...e.data}),s,t)));return 1===r.length?r[0]:r},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};ai.add(lx);const cx={extension:{type:ri.LoadParser,priority:Ll.High},name:"loadKTX",test:t=>Cl(t,".ktx"),async load(t,e,s){const r=await(await M.ADAPTER.fetch(t)).arrayBuffer(),{compressed:n,uncompressed:i,kvData:a}=ox(t,r),o=n??i,h={mipmap:v.OFF,alphaMode:E.NO_PREMULTIPLIED_ALPHA,resolution:si(t),...e.data},l=o.map((e=>{o===i&&Object.assign(h,{type:e.type,format:e.format});const r=e.resource??e,n=new yi(r,h);return n.ktxKeyValueData=a,tc(n,s,t)}));return 1===l.length?l[0]:l},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};ai.add(cx);const ux=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],dx={extension:ri.ResolveParser,test:t=>{const e=sn.extname(t).slice(1);return["basis","ktx","dds"].includes(e)},parse:t=>{var e,s;const r=t.split("."),n=r.pop();if(["ktx","dds"].includes(n)){const s=r.pop();if(ux.includes(s))return{resolution:parseFloat((null==(e=M.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:s,src:t}}return{resolution:parseFloat((null==(s=M.RETINA_PREFIX.exec(t))?void 0:s[1])??"1"),format:n,src:t}}};ai.add(dx);const fx=new Ni,px=class t{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var t;const e=null==(t=this.renderer)?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(t,e,s,r){const n=new Image;return n.src=await this.base64(t,e,s,r),n}async base64(t,e,s,r){const n=this.canvas(t,r);if(void 0!==n.toBlob)return new Promise(((t,r)=>{n.toBlob((e=>{if(!e)return void r(new Error("ICanvas.toBlob failed!"));const s=new FileReader;s.onload=()=>t(s.result),s.onerror=r,s.readAsDataURL(e)}),e,s)}));if(void 0!==n.toDataURL)return n.toDataURL(e,s);if(void 0!==n.convertToBlob){const t=await n.convertToBlob({type:e,quality:s});return new Promise(((e,s)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=s,r.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,s){const{pixels:r,width:n,height:i,flipY:a,premultipliedAlpha:o}=this._rawPixels(e,s);a&&t._flipY(r,n,i),o&&t._unpremultiplyAlpha(r);const h=new Qn(n,i,1),l=new ImageData(new Uint8ClampedArray(r.buffer),n,i);return h.context.putImageData(l,0,0),h.canvas}pixels(e,s){const{pixels:r,width:n,height:i,flipY:a,premultipliedAlpha:o}=this._rawPixels(e,s);return a&&t._flipY(r,n,i),o&&t._unpremultiplyAlpha(r),r}_rawPixels(t,e){const s=this.renderer;if(!s)throw new Error("The Extract has already been destroyed");let r,n,i=!1,a=!1,o=!1;t&&(t instanceof Ya?n=t:(n=s.generateTexture(t,{region:e,resolution:s.resolution,multisample:s.multisample}),o=!0,e&&(fx.width=e.width,fx.height=e.height,e=fx)));const h=s.gl;if(n){if(r=n.baseTexture.resolution,e=e??n.frame,i=!1,a=n.baseTexture.alphaMode>0&&n.baseTexture.format===m.RGBA,!o){s.renderTexture.bind(n);const t=n.framebuffer.glFramebuffers[s.CONTEXT_UID];t.blitFramebuffer&&s.framebuffer.bind(t.blitFramebuffer)}}else r=s.resolution,e||((e=fx).width=s.width/r,e.height=s.height/r),i=!0,a=this._rendererPremultipliedAlpha,s.renderTexture.bind();const l=Math.max(Math.round(e.width*r),1),c=Math.max(Math.round(e.height*r),1),u=new Uint8Array(4*l*c);return h.readPixels(Math.round(e.x*r),Math.round(e.y*r),l,c,h.RGBA,h.UNSIGNED_BYTE,u),o&&(null==n||n.destroy(!0)),{pixels:u,width:l,height:c,flipY:i,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(t,e,s){const r=e<<2,n=s>>1,i=new Uint8Array(r);for(let a=0;a<n;a++){const e=a*r,n=(s-a-1)*r;i.set(t.subarray(e,e+r)),t.copyWithin(e,n,n+r),t.set(i,n)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let s=0;s<e;s+=4){const e=t[s+3];if(0!==e){const r=255.001/e;t[s]=t[s]*r+.5,t[s+1]=t[s+1]*r+.5,t[s+2]=t[s+2]*r+.5}}}};px.extension={name:"extract",type:ri.RendererSystem};let mx=px;ai.add(mx);class gx{constructor(t,e,s){this.geometry=new Ii,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let s=t[r];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||x.FLOAT,offset:s.offset},e[r]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new vi(function(t,e=null){const s=6*t;if((e=e||new Uint16Array(s)).length!==s)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${s}`);for(let r=0,n=0;r<s;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let i=0;i<this.dynamicProperties.length;++i){const t=this.dynamicProperties[i];t.offset=e,e+=t.size,this.dynamicStride+=t.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new vi(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let i=0;i<this.staticProperties.length;++i){const t=this.staticProperties[i];t.offset=r,r+=t.size,this.staticStride+=t.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new vi(this.staticData,!0,!1);for(let i=0;i<this.dynamicProperties.length;++i){const e=this.dynamicProperties[i];t.addAttribute(e.attributeName,this.dynamicBuffer,0,e.type===x.UNSIGNED_BYTE,e.type,4*this.dynamicStride,4*e.offset)}for(let i=0;i<this.staticProperties.length;++i){const e=this.staticProperties[i];t.addAttribute(e.attributeName,this.staticBuffer,0,e.type===x.UNSIGNED_BYTE,e.type,4*this.staticStride,4*e.offset)}}uploadDynamic(t,e,s){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(t,e,s,n.type===x.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,s){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(t,e,s,n.type===x.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class xx extends Ta{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Ui,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:x.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ea.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ci.for2d()}render(t){const e=t.children,s=t._maxSize,r=t._batchSize,n=this.renderer;let i=e.length;if(0===i)return;i>s&&!t.autoResize&&(i=s);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const o=e[0]._texture.baseTexture,h=o.alphaMode>0;this.state.blendMode=Ln(t.blendMode,h),n.state.set(this.state);const l=n.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Nn.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);let u=!1;for(let d=0,f=0;d<i;d+=r,f+=1){let s=i-d;s>r&&(s=r),f>=a.length&&a.push(this._generateOneMoreBuffer(t));const o=a[f];o.uploadDynamic(e,d,s);const h=t._bufferUpdateIDs[f]||0;u=u||o._updateID<h,u&&(o._updateID=t._updateID,o.uploadStatic(e,d,s)),n.geometry.bind(o.geometry),l.drawElements(l.TRIANGLES,6*s,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],s=t._maxSize,r=t._batchSize,n=t._properties;for(let i=0;i<s;i+=r)e.push(new gx(this.properties,n,r));return e}_generateOneMoreBuffer(t){const e=t._batchSize,s=t._properties;return new gx(this.properties,s,e)}uploadVertices(t,e,s,r,n,i){let a=0,o=0,h=0,l=0;for(let c=0;c<s;++c){const s=t[e+c],u=s._texture,d=s.scale.x,f=s.scale.y,p=u.trim,m=u.orig;p?(o=p.x-s.anchor.x*m.width,a=o+p.width,l=p.y-s.anchor.y*m.height,h=l+p.height):(a=m.width*(1-s.anchor.x),o=m.width*-s.anchor.x,h=m.height*(1-s.anchor.y),l=m.height*-s.anchor.y),r[i]=o*d,r[i+1]=l*f,r[i+n]=a*d,r[i+n+1]=l*f,r[i+2*n]=a*d,r[i+2*n+1]=h*f,r[i+3*n]=o*d,r[i+3*n+1]=h*f,i+=4*n}}uploadPosition(t,e,s,r,n,i){for(let a=0;a<s;a++){const s=t[e+a].position;r[i]=s.x,r[i+1]=s.y,r[i+n]=s.x,r[i+n+1]=s.y,r[i+2*n]=s.x,r[i+2*n+1]=s.y,r[i+3*n]=s.x,r[i+3*n+1]=s.y,i+=4*n}}uploadRotation(t,e,s,r,n,i){for(let a=0;a<s;a++){const s=t[e+a].rotation;r[i]=s,r[i+n]=s,r[i+2*n]=s,r[i+3*n]=s,i+=4*n}}uploadUvs(t,e,s,r,n,i){for(let a=0;a<s;++a){const s=t[e+a]._texture._uvs;s?(r[i]=s.x0,r[i+1]=s.y0,r[i+n]=s.x1,r[i+n+1]=s.y1,r[i+2*n]=s.x2,r[i+2*n+1]=s.y2,r[i+3*n]=s.x3,r[i+3*n+1]=s.y3,i+=4*n):(r[i]=0,r[i+1]=0,r[i+n]=0,r[i+n+1]=0,r[i+2*n]=0,r[i+2*n+1]=0,r[i+3*n]=0,r[i+3*n+1]=0,i+=4*n)}}uploadTint(t,e,s,r,n,i){for(let a=0;a<s;++a){const s=t[e+a],o=Nn.shared.setValue(s._tintRGB).toPremultiplied(s.alpha,s.texture.baseTexture.alphaMode>0);r[i]=o,r[i+n]=o,r[i+2*n]=o,r[i+3*n]=o,i+=4*n}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}xx.extension={name:"particle",type:ri.RendererPlugin},ai.add(xx);var yx=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(yx||{});const bx={willReadFrequently:!0},_x=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const s=M.ADAPTER.getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in s||"textLetterSpacing"in s}return e}constructor(t,e,s,r,n,i,a,o,h){this.text=t,this.style=e,this.width=s,this.height=r,this.lines=n,this.lineWidths=i,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(e,s,r,n=t._canvas){r=r??s.wordWrap;const i=s.toFontString(),a=t.measureFont(i);0===a.fontSize&&(a.fontSize=s.fontSize,a.ascent=s.fontSize);const o=n.getContext("2d",bx);o.font=i;const h=(r?t.wordWrap(e,s,n):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let p=0;p<h.length;p++){const e=t._measureText(h[p],s.letterSpacing,o);l[p]=e,c=Math.max(c,e)}let u=c+s.strokeThickness;s.dropShadow&&(u+=s.dropShadowDistance);const d=s.lineHeight||a.fontSize+s.strokeThickness;let f=Math.max(d,a.fontSize+2*s.strokeThickness)+s.leading+(h.length-1)*(d+s.leading);return s.dropShadow&&(f+=s.dropShadowDistance),new t(e,s,u,f,h,l,d+s.leading,c,a)}static _measureText(e,s,r){let n=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(r.letterSpacing=`${s}px`,r.textLetterSpacing=`${s}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let i=r.measureText(e).width;return i>0&&(n?i-=s:i+=(t.graphemeSegmenter(e).length-1)*s),i}static wordWrap(e,s,r=t._canvas){const n=r.getContext("2d",bx);let i=0,a="",o="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=s,u=t.collapseSpaces(c),d=t.collapseNewlines(c);let f=!u;const p=s.wordWrapWidth+l,m=t.tokenize(e);for(let g=0;g<m.length;g++){let e=m[g];if(t.isNewline(e)){if(!d){o+=t.addLine(a),f=!u,a="",i=0;continue}e=" "}if(u){const s=t.isBreakingSpace(e),r=t.isBreakingSpace(a[a.length-1]);if(s&&r)continue}const r=t.getFromCache(e,l,h,n);if(r>p)if(""!==a&&(o+=t.addLine(a),a="",i=0),t.canBreakWords(e,s.breakWords)){const r=t.wordWrapSplit(e);for(let c=0;c<r.length;c++){let u=r[c],d=u,m=1;for(;r[c+m];){const n=r[c+m];if(t.canBreakChars(d,n,e,c,s.breakWords))break;u+=n,d=n,m++}c+=m-1;const g=t.getFromCache(u,l,h,n);g+i>p&&(o+=t.addLine(a),f=!1,a="",i=0),a+=u,i+=g}}else{a.length>0&&(o+=t.addLine(a),a="",i=0);const s=g===m.length-1;o+=t.addLine(e,!s),f=!1,a="",i=0}else r+i>p&&(f=!1,o+=t.addLine(a),a="",i=0),(a.length>0||!t.isBreakingSpace(e)||f)&&(a+=e,i+=r)}return o+=t.addLine(a,!1),o}static addLine(e,s=!0){return e=t.trimRight(e),e=s?`${e}\n`:e}static getFromCache(e,s,r,n){let i=r[e];return"number"!=typeof i&&(i=t._measureText(e,s,n)+s,r[e]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(e){if("string"!=typeof e)return"";for(let s=e.length-1;s>=0;s--){const r=e[s];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,s){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const s=[];let r="";if("string"!=typeof e)return s;for(let n=0;n<e.length;n++){const i=e[n],a=e[n+1];t.isBreakingSpace(i,a)||t.isNewline(i)?(""!==r&&(s.push(r),r=""),s.push(i)):r+=i}return""!==r&&s.push(r),s}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,r,n){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const s={ascent:0,descent:0,fontSize:0},r=t._canvas,n=t._context;n.font=e;const i=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(n.measureText(i).width);let o=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width);const h=Math.ceil(t.HEIGHT_MULTIPLIER*o);if(o=o*t.BASELINE_MULTIPLIER|0,0===a||0===h)return t._fonts[e]=s,s;r.width=a,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,a,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(i,0,o);const l=n.getImageData(0,0,a,h).data,c=l.length,u=4*a;let d=0,f=0,p=!1;for(d=0;d<o;++d){for(let t=0;t<u;t+=4)if(255!==l[f+t]){p=!0;break}if(p)break;f+=u}for(s.ascent=o-d,f=c-u,p=!1,d=h;d>o;--d){for(let t=0;t<u;t+=4)if(255!==l[f+t]){p=!0;break}if(p)break;f-=u}return s.descent=d-o,s.fontSize=s.ascent+s.descent,t._fonts[e]=s,s}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){var e;if(!t.__canvas){let s;try{const r=new OffscreenCanvas(0,0);if(null==(e=r.getContext("2d",bx))?void 0:e.measureText)return t.__canvas=r,r;s=M.ADAPTER.createCanvas()}catch{s=M.ADAPTER.createCanvas()}s.width=s.height=10,t.__canvas=s}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",bx)),t.__context}};_x.METRICS_STRING="|q",_x.BASELINE_SYMBOL="M",_x.BASELINE_MULTIPLIER=1.4,_x.HEIGHT_MULTIPLIER=2,_x.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),_x.experimentalLetterSpacing=!1,_x._fonts={},_x._newlines=[10,13],_x._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let vx=_x;const Ex=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],wx=class t{constructor(t){this.styleID=0,this.reset(),Sx(this,t,t)}clone(){const e={};return Sx(e,this,t.defaultStyle),new t(e)}reset(){Sx(this,t.defaultStyle,t.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Tx(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Tx(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Tx(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let t=e[s].trim();!/([\"\'])[^\'\"]+\1/.test(t)&&!Ex.includes(t)&&(t=`"${t}"`),e[s]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};wx.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:yx.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ax=wx;function Tx(t){const e=Nn.shared,s=t=>{const s=e.setValue(t);return 1===s.alpha?s.toHex():s.toRgbaString()};return Array.isArray(t)?t.map(s):s(t)}function Sx(t,e,s){for(const r in s)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}const Ix={texture:!0,children:!1,baseTexture:!0},Rx=class t extends Uh{constructor(e,s,r){let n=!1;r||(r=M.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const i=Xa.from(r);i.orig=new Ni,i.trim=new Ni,super(i),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=t.defaultResolution??M.RESOLUTION,this._autoResolution=t.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=s,this.localStyleID=-1}static get experimentalLetterSpacing(){return vx.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Jr("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),vx.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const s=this.context,r=vx.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=r.width,i=r.height,a=r.lines,o=r.lineHeight,h=r.lineWidths,l=r.maxLineWidth,c=r.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=e.strokeThickness,s.textBaseline=e.textBaseline,s.lineJoin=e.lineJoin,s.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const t=e.dropShadow&&0===p,n=t?Math.ceil(Math.max(1,i)+2*e.padding):0,f=n*this._resolution;if(t){s.fillStyle="black",s.strokeStyle="black";const t=e.dropShadowColor,r=e.dropShadowBlur*this._resolution,n=e.dropShadowDistance*this._resolution;s.shadowColor=Nn.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),s.shadowBlur=r,s.shadowOffsetX=Math.cos(e.dropShadowAngle)*n,s.shadowOffsetY=Math.sin(e.dropShadowAngle)*n+f}else s.fillStyle=this._generateFillStyle(e,a,r),s.strokeStyle=e.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;let m=(o-c.fontSize)/2;o-c.fontSize<0&&(m=0);for(let s=0;s<a.length;s++)u=e.strokeThickness/2,d=e.strokeThickness/2+s*o+c.ascent+m,"right"===e.align?u+=l-h[s]:"center"===e.align&&(u+=(l-h[s])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[s],u+e.padding,d+e.padding-n,!0),e.fill&&this.drawLetterSpacing(a[s],u+e.padding,d+e.padding-n)}this.updateTexture()}drawLetterSpacing(t,e,s,r=!1){const n=this._style.letterSpacing;let i=!1;if(vx.experimentalLetterSpacingSupported&&(vx.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,i=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===n||i)return void(r?this.context.strokeText(t,e,s):this.context.fillText(t,e,s));let a=e;const o=vx.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let c=0;c<o.length;++c){const t=o[c];r?this.context.strokeText(t,a,s):this.context.fillText(t,a,s);let e="";for(let s=c+1;s<o.length;++s)e+=o[s];l=this.context.measureText(e).width,a+=h-l+n,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=ei(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,s=this._style,r=s.trim?0:s.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,s){const r=t.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let n;const i=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,o=this.canvas.width/this._resolution-i-2*a,h=this.canvas.height/this._resolution-i-2*a,l=r.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(r[0]),c.unshift(0),l.push(r[r.length-1]),c.push(1),t.fillGradientType===yx.LINEAR_VERTICAL){n=this.context.createLinearGradient(o/2,a,o/2,h+a);const r=s.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const i=s.lineHeight*(t-1)+r,a=s.lineHeight*t;let o=a;t>0&&i>a&&(o=(a+i)/2);const u=a+r,d=s.lineHeight*(t+1);let f=u;t+1<e.length&&d<u&&(f=(u+d)/2);const p=(f-o)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let s=Math.min(1,Math.max(0,o/h+e*p));s=Number(s.toFixed(5)),n.addColorStop(s,l[t])}}}else{n=this.context.createLinearGradient(a,h/2,o+a,h/2);const t=l.length+1;let e=1;for(let s=0;s<l.length;s++){let r;r="number"==typeof c[s]?c[s]:e/t,n.addColorStop(r,l[s]),e++}}return n}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Ix,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Wn(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Wn(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Ax?t:new Ax(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Rx.defaultAutoResolution=!0;let Mx=Rx;class Cx{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Px(t,e){var s;let r=!1;if(null==(s=null==t?void 0:t._textures)?void 0:s.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof Xa){const s=t._textures[n].baseTexture;e.includes(s)||(e.push(s),r=!0)}return r}function kx(t,e){if(t.baseTexture instanceof yi){const s=t.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function Fx(t,e){if(t._texture&&t._texture instanceof Xa){const s=t._texture.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function Dx(t,e){return e instanceof Mx&&(e.updateText(!0),!0)}function Nx(t,e){if(e instanceof Ax){const t=e.toFontString();return vx.measureFont(t),!0}return!1}function Bx(t,e){if(t instanceof Mx){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const s=t._texture.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function Ox(t,e){return t instanceof Ax&&(e.includes(t)||e.push(t),!0)}const Lx=class t{constructor(e){this.limiter=new Cx(t.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Bx),this.registerFindHook(Ox),this.registerFindHook(Px),this.registerFindHook(kx),this.registerFindHook(Fx),this.registerUploadHook(Dx),this.registerUploadHook(Nx)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Go.system.addOnce(this.tick,this,Uo.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let s=0,r=this.uploadHooks.length;s<r;s++)if(this.uploadHooks[s](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Go.system.addOnce(this.tick,this,Uo.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,s=t.length;e<s;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,s=this.addHooks.length;e<s&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Oh)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Go.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Lx.uploadsPerFrame=4;let Vx=Lx;function Ux(t,e){return e instanceof yi&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Xx(t,e){if(!(e instanceof vl))return!1;const{geometry:s}=e;e.finishPoly(),s.updateBatches();const{batches:r}=s;for(let n=0;n<r.length;n++){const{texture:e}=r[n].style;e&&Ux(t,e.baseTexture)}return s.batchable||t.geometry.bind(s,e._resolveDirectShader(t)),!0}function Yx(t,e){return t instanceof vl&&(e.push(t),!0)}Object.defineProperties(M,{UPLOADS_PER_FRAME:{get:()=>Vx.uploadsPerFrame,set(t){Jr("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Vx.uploadsPerFrame=t}}});class Gx extends Vx{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Yx),this.registerUploadHook(Ux),this.registerUploadHook(Xx)}}Gx.extension={name:"prepare",type:ri.RendererSystem},ai.add(Gx);var Wx="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Hx=new Ui;class $x extends Ta{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Ha,this.state=ci.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Ea.from(Wx,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Ea.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Ea.from(Wx,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,s=this.quad;let r=s.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,i=t.uvRespectAnchor?t.anchor.y:0;r=s.uvs,r[0]=r[6]=-n,r[1]=r[3]=-i,r[2]=r[4]=1-n,r[5]=r[7]=1-i,s.invalidate();const a=t._texture,o=a.baseTexture,h=o.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let u=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==_.CLAMP:o.wrapMode===_.CLAMP&&(o.wrapMode=_.REPEAT));const d=u?this.simpleShader:this.shader,f=a.width,p=a.height,m=t._width,g=t._height;Hx.set(l.a*f/m,l.b*f/g,l.c*p/m,l.d*p/g,l.tx/m,l.ty/g),Hx.invert(),u?Hx.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=Hx.toArray(!0),d.uniforms.uColor=Nn.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=a,e.shader.bind(d),e.geometry.bind(s),this.state.blendMode=Ln(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}$x.extension={name:"tilingSprite",type:ri.RendererPlugin},ai.add($x);const jx=class t{constructor(t,e,s){this.linkedSheets=[],(t instanceof yi||t instanceof Xa)&&(t={texture:t,data:e,resolutionFilename:s});const{texture:r,data:n,resolutionFilename:i=null,cachePrefix:a=""}=t;this.cachePrefix=a,this._texture=r instanceof Xa?r:null,this.baseTexture=r instanceof yi?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const o=this.baseTexture.resource;this.resolution=this._updateResolution(i||(o?o.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let s=si(t,null);return null===s&&(s="number"==typeof e?e:parseFloat(e??"1")),1!==s&&this.baseTexture.setResolution(s),s}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let s=e;const r=t.BATCH_SIZE;for(;s-e<r&&s<this._frameKeys.length;){const t=this._frameKeys[s],e=this._frames[t],r=e.frame;if(r){let s=null,n=null;const i=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,a=new Ni(0,0,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution);s=e.rotated?new Ni(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new Ni(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(n=new Ni(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[t]=new Xa(this.baseTexture,s,a,n,e.rotated?2:0,e.anchor,e.borders),Xa.addToCache(this.textures[t],this.cachePrefix+t.toString())}s++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let s=0;s<t[e].length;s++){const r=t[e][s];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){var e;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};jx.BATCH_SIZE=1e3;let zx=jx;const qx=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Zx(t,e,s){const r={};if(t.forEach((t=>{r[t]=e})),Object.keys(e.textures).forEach((t=>{r[`${e.cachePrefix}${t}`]=e.textures[t]})),!s){const s=sn.dirname(t[0]);e.linkedSheets.forEach(((t,n)=>{Object.assign(r,Zx([`${s}/${e.data.meta.related_multi_packs[n]}`],t,!0))}))}return r}const Kx={extension:ri.Asset,cache:{test:t=>t instanceof zx,getCacheableAssets:(t,e)=>Zx(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),s=e.pop(),r=e.pop();return"json"===s&&qx.includes(r)},parse:t=>{var e;const s=t.split(".");return{resolution:parseFloat((null==(e=M.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:s[s.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:ri.LoadParser,priority:Ll.Normal},testParse:async(t,e)=>".json"===sn.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,s){var r,n;const{texture:i,imageFilename:a,cachePrefix:o}=(null==e?void 0:e.data)??{};let h,l=sn.dirname(e.src);if(l&&l.lastIndexOf("/")!==l.length-1&&(l+="/"),i&&i.baseTexture)h=i;else{const r=kl(l+(a??t.meta.image),e.src);h=(await s.load([r]))[r]}const c=new zx({texture:h.baseTexture,data:t,resolutionFilename:e.src,cachePrefix:o});await c.parse();const u=null==(r=null==t?void 0:t.meta)?void 0:r.related_multi_packs;if(Array.isArray(u)){const t=[];for(const i of u){if("string"!=typeof i)continue;let r=l+i;(null==(n=e.data)?void 0:n.ignoreMultiPack)||(r=kl(r,e.src),t.push(s.load({src:r,data:{ignoreMultiPack:!0}})))}const r=await Promise.all(t);c.linkedSheets=r,r.forEach((t=>{t.linkedSheets=[c].concat(c.linkedSheets.filter((e=>e!==t)))}))}return c},unload(t){t.destroy(!0)}}};ai.add(Kx);class Qx{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Jx{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const t=e[n].match(/^[a-z]+/gm)[0],r=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),i={};for(const e in r){const t=r[e].split("="),s=t[0],n=t[1].replace(/"/gm,""),a=parseFloat(n),o=isNaN(a)?n:a;i[s]=o}s[t].push(i)}const r=new Qx;return s.info.forEach((t=>r.info.push({face:t.face,size:parseInt(t.size,10)}))),s.common.forEach((t=>r.common.push({lineHeight:parseInt(t.lineHeight,10)}))),s.page.forEach((t=>r.page.push({id:parseInt(t.id,10),file:t.file}))),s.char.forEach((t=>r.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),s.kerning.forEach((t=>r.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),s.distanceField.forEach((t=>r.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),r}}class ty{static test(t){const e=t;return"string"!=typeof t&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Qx,s=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),i=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),o=t.getElementsByTagName("distanceField");for(let h=0;h<s.length;h++)e.info.push({face:s[h].getAttribute("face"),size:parseInt(s[h].getAttribute("size"),10)});for(let h=0;h<r.length;h++)e.common.push({lineHeight:parseInt(r[h].getAttribute("lineHeight"),10)});for(let h=0;h<n.length;h++)e.page.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});for(let h=0;h<i.length;h++){const t=i[h];e.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<o.length;h++)e.distanceField.push({fieldType:o[h].getAttribute("fieldType"),distanceRange:parseInt(o[h].getAttribute("distanceRange"),10)});return e}}class ey{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&ty.test(M.ADAPTER.parseXML(t))}static parse(t){return ty.parse(M.ADAPTER.parseXML(t))}}const sy=[Jx,ty,ey];function ry(t,e,s,r,n,i,a){const o=s.text,h=s.fontProperties;e.translate(r,n),e.scale(i,i);const l=a.strokeThickness/2,c=-a.strokeThickness/2;if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=function(t,e,s,r,n,i){const a=s.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let o;const h=s.dropShadow?s.dropShadowDistance:0,l=s.padding||0,c=t.width/r-h-2*l,u=t.height/r-h-2*l,d=a.slice(),f=s.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),s.fillGradientType===yx.LINEAR_VERTICAL){o=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const r=(i.fontProperties.fontSize+s.strokeThickness)/u;for(let e=0;e<n.length;e++){const s=i.lineHeight*e;for(let e=0;e<d.length;e++){let n=0;n="number"==typeof f[e]?f[e]:e/d.length;const i=s/u+n*r;let a=Math.max(t,i);a=Math.min(a,1),o.addColorStop(a,d[e]),t=a}}}else{o=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let s=1;for(let e=0;e<d.length;e++){let r;r="number"==typeof f[e]?f[e]:s/t,o.addColorStop(r,d[e]),s++}}return o}(t,e,a,i,[o],s),e.strokeStyle=a.stroke,a.dropShadow){const t=a.dropShadowColor,s=a.dropShadowBlur*i,r=a.dropShadowDistance*i;e.shadowColor=Nn.shared.setValue(t).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=s,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*r,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*r}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(o,l,c+s.lineHeight-h.descent),a.fill&&e.fillText(o,l,c+s.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function ny(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function iy(t){return Array.from?Array.from(t):t.split("")}const ay=class t{constructor(t,e,s){var r;const[n]=t.info,[i]=t.common,[a]=t.page,[o]=t.distanceField,h=si(a.file),l={};this._ownsTextures=s,this.font=n.face,this.size=n.size,this.lineHeight=i.lineHeight/h,this.chars={},this.pageTextures=l;for(let c=0;c<t.page.length;c++){const{id:s,file:r}=t.page[c];l[s]=e instanceof Array?e[c]:e[r],(null==o?void 0:o.fieldType)&&"none"!==o.fieldType&&(l[s].baseTexture.alphaMode=E.NO_PREMULTIPLIED_ALPHA,l[s].baseTexture.mipmap=v.OFF)}for(let c=0;c<t.char.length;c++){const{id:e,page:s}=t.char[c];let{x:r,y:n,width:i,height:a,xoffset:o,yoffset:u,xadvance:d}=t.char[c];r/=h,n/=h,i/=h,a/=h,o/=h,u/=h,d/=h;const f=new Ni(r+l[s].frame.x/h,n+l[s].frame.y/h,i,a);this.chars[e]={xOffset:o,yOffset:u,xAdvance:d,kerning:{},texture:new Xa(l[s].baseTexture,f),page:s}}for(let c=0;c<t.kerning.length;c++){let{first:e,second:s,amount:r}=t.kerning[c];e/=h,s/=h,r/=h,this.chars[s]&&(this.chars[s].kerning[e]=r)}this.distanceFieldRange=null==o?void 0:o.distanceRange,this.distanceFieldType=(null==(r=null==o?void 0:o.fieldType)?void 0:r.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(e,s,r){let n;if(e instanceof Qx)n=e;else{const t=function(t){for(let e=0;e<sy.length;e++)if(sy[e].test(t))return sy[e];return null}(e);if(!t)throw new Error("Unrecognized data format for font.");n=t.parse(e)}s instanceof Xa&&(s=[s]);const i=new t(n,s,r);return t.available[i.font]=i,i}static uninstall(e){const s=t.available[e];if(!s)throw new Error(`No font found named '${e}'`);s.destroy(),delete t.available[e]}static from(e,s,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:i,resolution:a,textureWidth:o,textureHeight:h,...l}=Object.assign({},t.defaultOptions,r),c=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let s=0,r=t.length;s<r;s++){const r=t[s];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const t=r[0].charCodeAt(0),s=r[1].charCodeAt(0);if(s<t)throw new Error("[BitmapFont]: Invalid character range.");for(let r=t,n=s;r<=n;r++)e.push(String.fromCharCode(r))}else e.push(...iy(r))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(n),u=s instanceof Ax?s:new Ax(s),d=o,f=new Qx;f.info[0]={face:u.fontFamily,size:u.fontSize},f.common[0]={lineHeight:u.fontSize};let p,m,g,x=0,y=0,b=0;const _=[];for(let t=0;t<c.length;t++){p||(p=M.ADAPTER.createCanvas(),p.width=o,p.height=h,m=p.getContext("2d"),g=new yi(p,{resolution:a,...l}),_.push(new Xa(g)),f.page.push({id:_.length-1,file:""}));const e=c[t],s=vx.measureText(e,u,!1,p),r=s.width,n=Math.ceil(s.height),v=Math.ceil(("italic"===u.fontStyle?2:1)*r);if(y>=h-n*a){if(0===y)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${e}')`);--t,p=null,m=null,g=null,y=0,x=0,b=0;continue}if(b=Math.max(n+s.fontProperties.descent,b),v*a+x>=d){if(0===x)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${e}')`);--t,y+=b*a,y=Math.ceil(y),x=0,b=0;continue}ry(p,m,s,x,y,a,u);const E=ny(s.text);f.char.push({id:E,page:_.length-1,x:x/a,y:y/a,width:v,height:n,xoffset:0,yoffset:0,xadvance:r-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),x+=(v+2*i)*a,x=Math.ceil(x)}if(!(null==r?void 0:r.skipKerning))for(let t=0,E=c.length;t<E;t++){const e=c[t];for(let t=0;t<E;t++){const s=c[t],r=m.measureText(e).width,n=m.measureText(s).width,i=m.measureText(e+s).width-(r+n);i&&f.kerning.push({first:ny(e),second:ny(s),amount:i})}}const v=new t(f,_,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=v,v}};ay.ALPHA=[["a","z"],["A","Z"]," "],ay.NUMERIC=[["0","9"]],ay.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],ay.ASCII=[[" ","~"]],ay.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:ay.ALPHANUMERIC},ay.available={};let oy=ay;const hy=[],ly=[],cy=[];(class t extends Oh{constructor(e,s={}){super();const{align:r,tint:n,maxWidth:i,letterSpacing:a,fontName:o,fontSize:h}=Object.assign({},t.styleDefaults,s);if(!oy.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new Nn(n),this._font=void 0,this._fontName=o,this._fontSize=h,this.text=e,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new qi((()=>{this.dirty=!0}),this,0,0),this._roundPixels=M.ROUND_PIXELS,this.dirty=!0,this._resolution=M.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var t;const e=oy.available[this._fontName],s=this.fontSize,r=s/e.size,n=new Fi,i=[],a=[],o=[],h=iy(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/s,c="none"===e.distanceFieldType?hy:ly;let u=null,d=0,p=0,m=0,g=-1,x=0,y=0,b=0,_=0;for(let f=0;f<h.length;f++){const t=h[f],s=ny(t);if(/(?:\s)/.test(t)&&(g=f,x=d,_++),"\r"===t||"\n"===t){a.push(d),o.push(-1),p=Math.max(p,d),++m,++y,n.x=0,n.y+=e.lineHeight,u=null,_=0;continue}const r=e.chars[s];if(!r)continue;u&&r.kerning[u]&&(n.x+=r.kerning[u]);const c=cy.pop()||{texture:Xa.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Fi};c.texture=r.texture,c.line=m,c.charCode=s,c.position.x=Math.round(n.x+r.xOffset+this._letterSpacing/2),c.position.y=Math.round(n.y+r.yOffset),c.prevSpaces=_,i.push(c),d=c.position.x+Math.max(r.xAdvance-r.xOffset,r.texture.orig.width),n.x+=r.xAdvance+this._letterSpacing,b=Math.max(b,r.yOffset+r.texture.height),u=s,-1!==g&&l>0&&n.x>l&&(++y,Gn(i,1+g-y,1+f-g),f=g,g=-1,a.push(x),o.push(i.length>0?i[i.length-1].prevSpaces:0),p=Math.max(p,x),m++,n.x=0,n.y+=e.lineHeight,u=null,_=0)}const v=h[h.length-1];"\r"!==v&&"\n"!==v&&(/(?:\s)/.test(v)&&(d=x),a.push(d),p=Math.max(p,d),o.push(-1));const E=[];for(let f=0;f<=m;f++){let t=0;"right"===this._align?t=p-a[f]:"center"===this._align?t=(p-a[f])/2:"justify"===this._align&&(t=o[f]<0?0:(p-a[f])/o[f]),E.push(t)}const w=i.length,A={},T=[],S=this._activePagesMeshData;c.push(...S);for(let I=0;I<w;I++){const t=i[I].texture,s=t.baseTexture.uid;if(!A[s]){let r=c.pop();if(!r){const t=new $h;let s,n;"none"===e.distanceFieldType?(s=new jh(Xa.EMPTY),n=f.NORMAL):(s=new jh(Xa.EMPTY,{program:ba.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),n=f.NORMAL_NPM);const i=new Hh(t,s);i.blendMode=n,r={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:i,vertices:null,uvs:null,indices:null}}r.index=0,r.indexCount=0,r.vertexCount=0,r.uvsCount=0,r.total=0;const{_textureCache:n}=this;n[s]=n[s]||new Xa(t.baseTexture),r.mesh.texture=n[s],r.mesh.tint=this._tintColor.value,T.push(r),A[s]=r}A[s].total++}for(let f=0;f<S.length;f++)T.includes(S[f])||this.removeChild(S[f].mesh);for(let f=0;f<T.length;f++)T[f].mesh.parent!==this&&this.addChild(T[f].mesh);this._activePagesMeshData=T;for(const f in A){const e=A[f],s=e.total;if(!((null==(t=e.indices)?void 0:t.length)>6*s)||e.vertices.length<2*Hh.BATCHABLE_SIZE)e.vertices=new Float32Array(8*s),e.uvs=new Float32Array(8*s),e.indices=new Uint16Array(6*s);else{const t=e.total,s=e.vertices;for(let e=4*t*2;e<s.length;e++)s[e]=0}e.mesh.size=6*s}for(let f=0;f<w;f++){const t=i[f];let e=t.position.x+E[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(e=Math.round(e));const s=e*r,n=t.position.y*r,a=t.texture,o=A[a.baseTexture.uid],h=a.frame,l=a._uvs,c=o.index++;o.indices[6*c+0]=0+4*c,o.indices[6*c+1]=1+4*c,o.indices[6*c+2]=2+4*c,o.indices[6*c+3]=0+4*c,o.indices[6*c+4]=2+4*c,o.indices[6*c+5]=3+4*c,o.vertices[8*c+0]=s,o.vertices[8*c+1]=n,o.vertices[8*c+2]=s+h.width*r,o.vertices[8*c+3]=n,o.vertices[8*c+4]=s+h.width*r,o.vertices[8*c+5]=n+h.height*r,o.vertices[8*c+6]=s,o.vertices[8*c+7]=n+h.height*r,o.uvs[8*c+0]=l.x0,o.uvs[8*c+1]=l.y0,o.uvs[8*c+2]=l.x1,o.uvs[8*c+3]=l.y1,o.uvs[8*c+4]=l.x2,o.uvs[8*c+5]=l.y2,o.uvs[8*c+6]=l.x3,o.uvs[8*c+7]=l.y3}this._textWidth=p*r,this._textHeight=(n.y+e.lineHeight)*r;for(const f in A){const t=A[f];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const s=this._textWidth*this.anchor.x,r=this._textHeight*this.anchor.y;for(let n=0;n<t.total;n++)t.vertices[e++]-=s,t.vertices[e++]-=r,t.vertices[e++]-=s,t.vertices[e++]-=r,t.vertices[e++]-=s,t.vertices[e++]-=r,t.vertices[e++]-=s,t.vertices[e++]-=r}this._maxLineHeight=b*r;const e=t.mesh.geometry.getBuffer("aVertexPosition"),s=t.mesh.geometry.getBuffer("aTextureCoord"),n=t.mesh.geometry.getIndex();e.data=t.vertices,s.data=t.uvs,n.data=t.indices,e.update(),s.update(),n.update()}for(let f=0;f<i.length;f++)cy.push(i[f]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:s,size:r}=oy.available[this._fontName];if("none"!==s){const{a:s,b:n,c:i,d:a}=this.worldTransform,o=Math.sqrt(s*s+n*n),h=Math.sqrt(i*i+a*a),l=(Math.abs(o)+Math.abs(h))/2,c=this.fontSize/r,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=oy.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!oy.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??oy.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,s="none"===oy.available[this._fontName].distanceFieldType?hy:ly;s.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],s.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Xa.EMPTY}));for(const r in e)e[r].destroy(),delete e[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}}).styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const uy=[".xml",".fnt"],dy={extension:{type:ri.LoadParser,priority:Ll.Normal},name:"loadBitmapFont",test:t=>uy.includes(sn.extname(t).toLowerCase()),testParse:async t=>Jx.test(t)||ey.test(t),async parse(t,e,s){const r=Jx.test(t)?Jx.parse(t):ey.parse(t),{src:n}=e,{page:i}=r,a=[];for(let l=0;l<i.length;++l){const t=i[l].file;let e=sn.join(sn.dirname(n),t);e=kl(e,n),a.push(e)}const o=await s.load(a),h=a.map((t=>o[t]));return oy.install(r,h,!0)},load:async(t,e)=>(await M.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};ai.add(dy);const fy=class t extends Ax{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new t(Object.keys(t.defaultOptions).reduce(((t,s)=>({...t,[s]:e[s]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((e=>{URL.revokeObjectURL(e.src),e.refs--,0===e.refs&&(e.fontFace&&document.fonts.delete(e.fontFace),delete t.availableFonts[e.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,s={}){const{availableFonts:r}=t;if(r[e]){const t=r[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return M.ADAPTER.fetch(e).then((t=>t.blob())).then((async t=>new Promise(((e,s)=>{const r=URL.createObjectURL(t),n=new FileReader;n.onload=()=>e([r,n.result]),n.onerror=s,n.readAsDataURL(t)})))).then((async([t,n])=>{const i=Object.assign({family:sn.basename(e,sn.extname(e)),weight:"normal",style:"normal",display:"auto",src:t,dataSrc:n,refs:1,originalUrl:e,fontFace:null},s);r[e]=i,this._fonts.push(i),this.styleID++;const a=new FontFace(i.family,`url(${i.src})`,{weight:i.weight,style:i.style,display:i.display});i.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style};\n                font-display: ${e.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Bn(t)),"number"==typeof t?(e=t,Jr("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Nn.shared.setValue(e).toHex()):t;var e}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const n=`${s}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,t.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=M.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};fy.availableFonts={},fy.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let py=fy;const my=class t extends Uh{constructor(e="",s={}){super(Xa.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,n=Xa.from(r,{scaleMode:M.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new Ni,n.trim=new Ni,this.texture=n;const i="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg"),h=document.createElementNS(i,"foreignObject"),l=document.createElementNS(a,"div"),c=document.createElementNS(a,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",o.appendChild(h),this.maxWidth=t.defaultMaxWidth,this.maxHeight=t.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=o,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=r,this._loadImage=new Image,this._autoResolution=t.defaultAutoResolution,this._resolution=t.defaultResolution??M.RESOLUTION,this.text=e,this.style=s}measureText(t){var e,s;const{text:r,style:n,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:r,style:n.toCSS(i)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const a=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:h}=a;(o>this.maxWidth||h>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const l=Math.min(this.maxWidth,Math.ceil(o)),c=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",c.toString()),r!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:null==(e=this._style)?void 0:e.toCSS(i)}),this._styleElement.textContent=null==(s=this._style)?void 0:s.toGlobalCSS()),{width:l+2*n.padding,height:c+2*n.padding}}async updateText(t=!0){const{style:e,_image:s,_loadImage:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:i}=this.measureText();s.width=r.width=Math.ceil(Math.max(1,n)),s.height=r.height=Math.ceil(Math.max(1,i)),this._updateID++;const a=this._updateID;await new Promise((t=>{r.onload=async()=>{a<this._updateID||(await e.onBeforeDraw(),s.src=r.src,r.onload=null,r.src="",this.updateTexture()),t()};const n=(new XMLSerializer).serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(n)}`}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:s,resolution:r}=this,{padding:n}=t,{baseTexture:i}=e;e.trim.width=e._frame.width=s.width/r,e.trim.height=e._frame.height=s.height/r,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),i.setRealSize(s.width,s.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var s,r,n,i,a;"boolean"==typeof e&&(e={children:e}),e=Object.assign({},t.defaultDestroyOptions,e),super.destroy(e);const o=null;this.ownsStyle&&(null==(s=this._style)||s.cleanFonts()),this._style=o,null==(r=this._svgRoot)||r.remove(),this._svgRoot=o,null==(n=this._domElement)||n.remove(),this._domElement=o,null==(i=this._foreignObject)||i.remove(),this._foreignObject=o,null==(a=this._styleElement)||a.remove(),this._styleElement=o,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=o,this._image.src="",this._image=o}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Wn(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Wn(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof py?(this.ownsStyle=!1,this._style=t):t instanceof Ax?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=py.from(t)):(this.ownsStyle=!0,this._style=new py(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let gy;function xy(){return gy}my.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},my.defaultMaxWidth=2024,my.defaultMaxHeight=2024,my.defaultAutoResolution=!0;let yy=0;const by=class extends q{constructor(t){super(),this.id=yy++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),r=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);this._source.volume=n*s*r,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:r,loop:n,volume:i,muted:a}=t;s&&console.assert(s>e,"End time is before start time"),this._speed=r,this._volume=i,this._loop=!!n,this._muted=a,this.refresh(),this.loop&&null!==s&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=e,this._end=s||this._duration,this._start=Math.max(0,this._start-by.PADDING),this._end=Math.min(this._end+by.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),Go.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){Go.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){Go.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let _y=by;_y.PADDING=.1;class vy extends q{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new _y(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,s=this.parent;if(4===e.readyState){s.isLoaded=!0;const e=s.autoPlayStart();return void(t&&setTimeout((()=>{t(null,s,e)}),0))}if(!s.url)return void t(new Error("sound.url or sound.source must be set"));e.src=s.url;const r=()=>{a(),s.isLoaded=!0;const e=s.autoPlayStart();t&&t(null,s,e)},n=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},i=()=>{a();const s=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(s)):console.error(s)},a=()=>{e.removeEventListener("canplaythrough",r),e.removeEventListener("load",r),e.removeEventListener("abort",n),e.removeEventListener("error",i)};e.addEventListener("canplaythrough",r,!1),e.addEventListener("load",r,!1),e.addEventListener("abort",n,!1),e.addEventListener("error",i,!1),e.load()}}class Ey{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}const wy=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],Ay=["audio/mpeg","audio/ogg"],Ty={};!function(t){const e={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...t||{}},s=document.createElement("audio"),r={},n=/^no$/;wy.forEach((t=>{const i=s.canPlayType(`audio/${t}`).replace(n,""),a=e[t]?s.canPlayType(e[t]).replace(n,""):"";r[t]=!!i||!!a})),Object.assign(Ty,r)}();class Sy{static setParamValue(t,e){if(t.setValueAtTime){const s=xy().context;t.setValueAtTime(e,s.audioContext.currentTime)}else t.value=e;return e}}let Iy=0;class Ry extends q{constructor(t){super(),this.id=Iy++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){var e;this._filters&&(null==(e=this._filters)||e.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=(null==t?void 0:t.length)?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),r=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);Sy.setParamValue(this._gain.gain,n*r*s),Sy.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){var t;if(null==(t=this._filters)?void 0:t.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:r,loop:n,volume:i,muted:a,filters:o}=t;s&&console.assert(s>e,"End time is before start time"),this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=r,this._volume=i,this._loop=!!n,this._muted=a,this._filters=o,this.refresh();const c=this._source.buffer.duration;this._duration=c,this._end=s,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=s,this._source.loopStart=e,this._source.start(0,e)):s?this._source.start(0,e,s-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){Go.shared.remove(this._updateListener,this),t&&Go.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),null==(t=this._filters)||t.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),s=e-this._lastUpdate;if(s>0||t){const t=this._source.playbackRate.value;this._elapsed+=s*t,this._lastUpdate=e;const r=this._duration;let n;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;n=(this._source.loopStart+this._elapsed%t)/r}else n=this._elapsed%r/r;this._progress=n,this.emit("progress",this._progress,r)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class My{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const Cy=class extends My{constructor(t){const e=t.audioContext,s=e.createBufferSource(),r=e.createGain(),n=e.createAnalyser();s.connect(n),n.connect(r),r.connect(t.destination),super(n,r),this.context=t,this.bufferSource=s,this.gain=r,this.analyser=n}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Cy.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,Sy.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const s=this.context.audioContext.createGain();return e.connect(s),s.connect(this.destination),{source:e,gain:s}}get bufferSize(){return this.script.bufferSize}};let Py=Cy;Py.BUFFER_SIZE=0;class ky{init(t){this.parent=t,this._nodes=new Py(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new Ry(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){const e=this.parent.url,s=await M.ADAPTER.fetch(e);this._decode(await s.arrayBuffer(),t)}_decode(t,e){const s=(t,s)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=s;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};if(t instanceof AudioBuffer)s(null,t);else{this.parent.context.decode(t,s)}}}const Fy=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:Array.isArray(t)?e.url=t:e=t,e={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...e},Object.freeze(e);const s=xy().useLegacy?new vy:new ky;return new Fy(s,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const s=e.complete;this._autoPlayOptions=s?{complete:s}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=Array.isArray(e.url)?this.preferUrl(e.url):e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}preferUrl(t){const[e]=t.map((t=>({url:t,ext:sn.extname(t).slice(1)}))).filter((({ext:t})=>Ty[t])).sort(((t,e)=>wy.indexOf(t.ext)-wy.indexOf(e.ext)));if(!e)throw new Error("No supported file type found");return e.url}get context(){return xy().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const s in t)e[s]=this.addSprites(s,t[s]);return e}console.assert(!this._sprites[t],`Alias ${t} is already taken`);const s=new Ey(this,e);return this._sprites[t]=s,s}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const e in this._sprites)this.removeSprites(e);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let s;if("string"==typeof t){s={sprite:t,loop:this.loop,complete:e}}else"function"==typeof t?(s={},s.complete=t):s=t;if(s={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...s||{}},s.sprite){const t=s.sprite;console.assert(!!this._sprites[t],`Alias ${t} is not available`);const e=this._sprites[t];s.start=e.start+(s.start||0),s.end=e.end,s.speed=e.speed||1,s.loop=e.loop||s.loop,delete s.sprite}if(s.offset&&(s.start=s.offset),!this.isLoaded)return this._preloadQueue?new Promise((t=>{this._preloadQueue.push((()=>{t(this.play(s))}))})):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=s,new Promise(((t,e)=>{this._preload(((r,n,i)=>{this._preloadQueue.forEach((t=>t())),this._preloadQueue=null,r?e(r):(s.loaded&&s.loaded(r,n,i),t(i))}))})));(this.singleInstance||s.singleInstance)&&this._removeInstances();const r=this._createInstance();return this._instances.push(r),this.isPlaying=!0,r.once("end",(()=>{s.complete&&s.complete(this),this._onComplete(r)})),r.once("stop",(()=>{this._onComplete(r)})),r.play(s),r}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(Fy._pool.length>0){const t=Fy._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),Fy._pool.indexOf(t)<0&&Fy._pool.push(t)}};let Dy=Fy;Dy._pool=[];class Ny extends q{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class By extends My{constructor(){const t=window,e=new By.AudioContext,s=e.createDynamicsCompressor(),r=e.createAnalyser();r.connect(s),s.connect(e.destination),super(r,s),this.autoPause=!0,this._ctx=e,this._offlineCtx=new By.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=s,this.analyser=r,this.events=new q,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked="suspended"===e.state&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;const t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;void 0!==t.close&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const s=t=>{e(new Error((null==t?void 0:t.message)||"Unable to decode file"))},r=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),s);r&&r.catch(s)}}const Oy=t=>{var e;const s=t.src;return(null==(e=null==t?void 0:t.alias)?void 0:e[0])??sn.basename(s,sn.extname(s))},Ly={extension:ri.Asset,detection:{test:async()=>!0,add:async t=>[...t,...wy.filter((t=>Ty[t]))],remove:async t=>t.filter((e=>t.includes(e)))},loader:{extension:{type:[ri.LoadParser],priority:Ll.High},test(t){const e=sn.extname(t).slice(1);return!!Ty[e]||Ay.some((e=>t.startsWith(`data:${e}`)))},async load(t,e){const s=await new Promise(((s,r)=>Dy.from({...e.data,url:t,preload:!0,loaded(t,n){var i,a;t?r(t):s(n),null==(a=null==(i=e.data)?void 0:i.loaded)||a.call(i,t,n)}})));return xy().add(Oy(e),s),s},async unload(t,e){xy().remove(Oy(e))}}};ai.add(Ly);const Vy=(Uy=new class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new By),this._htmlAudioContext=new Ny,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==By.AudioContext}add(t,e){if("object"==typeof t){const s={};for(const r in t){const n=this._getOptions(t[r],e);s[r]=this.add(r,n)}return s}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof Dy)return this._sounds[t]=e,e;const s=this._getOptions(e),r=Dy.from(s);return this._sounds[t]=r,r}_getOptions(t,e){let s;return s="string"==typeof t||Array.isArray(t)?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,s={...s,...e||{}},s}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const s=!!this._sounds[t];return e&&console.assert(s,`No sound matching alias '${t}'.`),s}isPlaying(){for(const t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const s=this.find(t);return void 0!==e&&(s.volume=e),s.volume}speed(t,e){const s=this.find(t);return void 0!==e&&(s.speed=e),s.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}},gy=Uy,Uy);var Uy;export{Zm as A,tg as B,eg as C,sg as D,rg as F,ng as N,jm as S,Jm as a,_g as b,lc as c,Jr as d,Vy as s};
